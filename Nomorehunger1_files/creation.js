var Creation=function(e){function t(t){for(var r,a,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)a=s[d],o[a]&&p.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={1:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonpCreation=window.webpackJsonpCreation||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;return i.push([875,0]),n()}({101:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("url"!==t.content.type)throw new Error("Unsupported content type for image item.");return new Promise(function(n,o){var i=new Image;i.onerror=function(){n(e)},i.onload=function(){try{var a=e.getContext("2d");(0,r.drawImage)(a,i,t.frame,t.opacity,t.rotation,t.flipH,t.flipV),n(e)}catch(e){o("Something went wrong")}},"three_d"!==t.type?i.src=t.content.body:t.content.attributes&&(i.src=t.content.attributes.preview_url)})};var r=n(260)},102:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ungroupItems=function(e,t,n){if("group"!==e.type)throw new Error("Item of type "+e.type+"cannot be ungrouped.");var r=t,o=n.items,s=[];return e.content.body.forEach(function(t){var n=t.frame.origin.x,i=t.frame.origin.y;if(e.flipH){var c=e.frame.width/2;n=c-(t.frame.origin.x+t.frame.width-c)}if(e.flipV){var l=e.frame.height/2;i=l-(t.frame.origin.y+t.frame.height-l)}var u=Object.assign({},t.frame,{origin:{x:n+e.frame.origin.x,y:i+e.frame.origin.y,space:t.frame.origin.space}});if(0!==e.rotation){var d=a.GeometryUtil.rotatePoint(u.origin,e.rotation,{x:e.frame.origin.x+e.frame.width/2,y:e.frame.origin.y+e.frame.height/2});u=Object.assign({},u,{origin:Object.assign({},d,{space:t.frame.origin.space})})}var p=Object.assign({},t,{rotation:t.rotation+e.rotation,flipH:e.flipH!==(null!==t.flipH&&t.flipH),flipV:e.flipV!==(null!==t.flipV&&t.flipH),frame:u});r[p.id]=p,o.push(p.id),s.push(p)}),delete r[e.id],o=(0,i.difference)(o,[e.id]),{items:s,newItemDict:r,newSlideItems:o}},t.createGroup=function(e,t,n,r){var o=e.filter(function(e){return"group"===e.type}),c=e.filter(function(e){return"drawing"!==e.type&&"group"!==e.type}).map(function(e){if(0===e.rotation)return e.frame;var t=180*e.rotation/Math.PI;return(0,s.enclosingRotatedFrame)(e.frame,t)}),u=void 0;(0,i.forEach)(o,function(e){var t=e.content.body;(0,i.forEach)(t,function(n,r){var o=Object.assign({},n.frame,{origin:{x:n.frame.origin.x+e.frame.origin.x,y:n.frame.origin.y+e.frame.origin.y,space:n.frame.origin.space}});c.push(o),t[r]=Object.assign({},n,{frame:o})}),"string"==typeof e.name&&(u=e)});var d=a.GeometryUtil.enclosingRect.apply(a.GeometryUtil,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(c)),p=[];(0,i.forEach)(e,function(e){"group"===e.type?(0,i.forEach)(e.content.body,function(e){p.push(l(e,d))}):p.push(l(e,d))});var f=(0,a.generateItem)({type:"group",content:{type:"items",body:p},name:r||(u?u.name:void 0),flipH:!!u&&u.flipH,flipV:!!u&&u.flipV,rotation:u?u.rotation:0,frame:d,locked:!0}),m=e.map(function(e){return e.id}),h=(0,i.omit)(t,m),v=(0,i.difference)(n.items,m);return v.push(f.id),h[f.id]=f,{item:f,newItemDict:h,newSlideItems:v}};var r=n(68),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(6),a=n(4),s=n(140),c=n(266);function l(e,t){return Object.assign({},e,{frame:Object.assign({},e.frame,{origin:{space:e.frame.origin.space,x:e.frame.origin.x-t.origin.x,y:e.frame.origin.y-t.origin.y}})})}t.default=function(e){var t=e.item,n=r.Util.ObjectUtil.get(e.item,"content.body"),i=function(){return t.id};return Array.isArray(n)&&0!==n.length?o.createElement("div",{className:"item-content item-group",style:e.style},n.map(function(n,r){return o.createElement(c.ConnectedHOCItem,{key:n.id,item:n,event_listeners:!t.locked,getItemIdForUpdate:i,handleClick:e.handleClick,mutatePathforUpdate:function(e){return'content.body.{"id":"'+n.id+'"}'+(e.length>0?"."+e:e)},parent:e.item,index:r,offset:e.offset})})):null}},117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(4),a=n(16);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClickOrTouch=function(e){void 0!==e.touches&&"template"===n.props.item_browser||void 0!==e.touches&&"audio"===n.props.item_browser||void 0!==e.touches&&"stitch"===n.props.item_browser||(n.isLocked()&&"template"!==n.props.item_browser?n.props.promptUpgrade&&n.props.promptUpgrade():n.props.handleSelected(n.props.id,!n.props.element.selected,e.nativeEvent))},n.isVideo=function(e){return"stitch"!==n.props.item_browser&&!("string"!=typeof e||!e.match(/\.(mp4)($|(\?))/i))},n.isPlayable=function(e){return"stitch"!==n.props.item_browser&&!!(n.props.element.preview||"string"==typeof e&&e.match(/\.(gif|mp3|wav)($|(\?))/i))},n.isLocked=function(){return!0===n.props.element.is_premium&&!i.User.isPremium()},n.handlePreviewClick=function(){n.state.preview_playing?n.setState({preview_src:n.isVideo(n.props.element.result_payload)?o.createElement("video",{height:"200",controls:!0},o.createElement("source",{src:n.props.element.result_payload})):o.createElement("img",{src:n.props.element.thumbnails[0],height:"140"}),preview_playing:!n.state.preview_playing}):"khanacademy"===n.props.item_browser?n.setState({preview_src:o.createElement("iframe",{height:"140",src:"//www.youtube.com/embed/"+(0,a.getYoutubeId)(n.props.element.result_payload)+"?autoplay=1&showinfo=0&controls=0",frameBorder:"0",style:{pointerEvents:"none"}}),preview_playing:!n.state.preview_playing}):"youtube"===n.props.item_browser||"omni"===n.props.item_browser&&n.props.element.preview?n.setState({preview_src:o.createElement("iframe",{height:"140",src:"//www.youtube.com/embed/"+n.props.element.id+"?autoplay=1&showinfo=0&controls=0",frameBorder:"0",style:{pointerEvents:"none"}}),preview_playing:!n.state.preview_playing}):"audio"===n.props.item_browser?n.setState({preview_src:o.createElement("div",null,o.createElement("img",{src:n.props.element.thumbnails[0],height:"140"}),o.createElement("audio",{src:n.props.element.result_payload,autoPlay:!0,style:{display:"none"}})),preview_playing:!n.state.preview_playing}):n.setState({preview_src:o.createElement("img",{src:n.props.element.result_payload,height:"140"}),preview_playing:!n.state.preview_playing})},n.renderContent=function(){return"template"===n.props.item_browser?o.createElement("div",{className:"result-wrapper"},n.state.preview_src,n.props.element.catalog_guid?null:o.createElement("span",{className:"custom"},"Custom")):n.state.preview_src},n.renderLockedOverlay=function(){return n.isLocked()?o.createElement("div",{className:"locked-overlay"},o.createElement("span",{className:"icon-lockblack"})):void 0},n.state={preview_src:n.isVideo(n.props.element.result_payload)?o.createElement("video",{height:"200",controls:!0},o.createElement("source",{src:n.props.element.result_payload})):o.createElement("img",{src:n.props.element.thumbnails[0],height:"140"}),preview_playing:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"render",value:function(){var e=["result"],t=["preview-play"];return this.props.element.selected&&e.push("selected"),this.isLocked()&&e.push("locked"),this.state.preview_playing?t.push("icon-pausepreview"):t.push("icon-playpreview"),o.createElement("div",{className:"results"},this.isPlayable(this.props.element.result_payload)&&!this.isLocked()?o.createElement("div",{className:t.join(" "),onClick:this.handlePreviewClick}):null,o.createElement("div",{className:e.join(" "),id:this.props.element.id,key:this.props.id,onClick:this.state.preview_playing?this.handlePreviewClick:this.handleClickOrTouch,onTouchEnd:this.handleClickOrTouch,onMouseDown:this.props.handleMouseTouchDown,onTouchStart:this.props.handleMouseTouchDown},this.renderLockedOverlay(),this.renderContent()),this.props.element.title?o.createElement("div",{className:"result-title",onClick:this.handleClickOrTouch,onTouchEnd:this.handleClickOrTouch,onMouseDown:this.props.handleMouseTouchDown,onTouchStart:this.props.handleMouseTouchDown},this.props.element.title):null)}}]),t}();t.default=s},118:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r},s=n(4);t.default=function(e){var t=["browser-results grid"];"shape"===e.item_browser&&t.push("no-tab");var n=e.results.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent,promptUpgrade:e.promptUpgrade})}),r=null;return n.length<1?t.push("no-results"):"three_d"===e.item_browser&&s.Device.isIPadOrIPhone()&&(r=o.createElement("div",{className:"warning"},o.createElement("span",null,"Lets get visual! Mix and match ",o.createElement("span",{className:"emphasis"},"up to ten 3D assets at a time on your tablet.")))),o.createElement("div",{className:t.join(" "),id:"browser-results"},r,n.length>0?n:o.createElement("div",{className:"no-results-text"},"No results found"))}},138:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genericState=t.createReducer=void 0;var r=n(367);Object.defineProperty(t,"createReducer",{enumerable:!0,get:function(){return u(r).default}});var o=n(4),i=u(n(366)),a=u(n(365)),s=u(r),c=u(n(364)),l=u(n(363));function u(e){return e&&e.__esModule?e:{default:e}}var d=(0,o.generateStore)();t.genericState=d;var p=(0,s.default)(d,{add_history:c.default,undo:c.default,redo:c.default,operational_transform:l.default,update_clipboard:a.default,open_gateway:i.default,close_gateway:i.default,open_modal:i.default,update_settings:i.default,update_item_defaults:i.default,open_view_panel:i.default,add_tag:i.default,remove_tag:i.default,set_fullscreen:i.default,update_likes:i.default,add_comment:i.default,remove_comment:i.default,update_store:i.default,mark_slide_clean:i.default,mark_slide_dirty:i.default,mark_item_clean:i.default,mark_item_dirty:i.default,set_gridline_intersect:i.default});t.default=p},140:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}t.degreesToRadians=function(e){return e*Math.PI/180},t.radiansToDegrees=function(e){return 180*e/Math.PI},t.comparePointEqual=c,t.rotatePoint=l,t.differenceBetweenRotatedPoints=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=l(t,e,r),c=l(n,e,o);return u(s,c,i)},t.pointFromEvent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"client",n=arguments[2],o=void 0;if("object"===r(e.touches))o="touchend"===(e=e).type?e.changedTouches[0]:e.touches[0];else{if(!(e instanceof MouseEvent))throw new Error("Unsupported event class.");o=e}var i=n.isPanning?1:n.scaleOffset/100;if("client"===t)return{x:o.clientX/i,y:o.clientY/i,space:t};if("page"===t)return{x:o.pageX/i,y:o.pageY/i,space:t};if("screen"===t)return{x:o.screenX/i,y:o.screenY/i,space:t};throw new Error("Unrecognized coordinate space.")},t.differenceBetweenPoints=u,t.angleBetweenPoints=function(e,t){var n=u(e,t);return Math.atan2(n.y,n.x)%(2*Math.PI)},t.absoluteDistanceBetweenPoints=function(e,t){if(e.space!==t.space)throw new Error("Points are in different coordinate spaces.");return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},t.translatePoint=d,t.scalePoint=function(e,t,n){return{x:e.x*t,y:e.y*(n||t),space:e.space}},t.translateRect=function(e,t){return{origin:d(e.origin,t),width:e.width,height:e.height}},t.scaleRect=function(e,t,n){return{origin:{x:e.origin.x*t,y:e.origin.y*n,space:e.origin.space},width:e.width*t,height:e.height*n}},t.enclosingRect=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return i;var r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=0,s=0,c=t[0].origin.space,l=!0,u=!1,d=void 0;try{for(var p,f=t[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var m=p.value;if(m.origin.space!==c)throw new Error("Rectangles must be in the same coordinate space.");r=Math.min(r,m.origin.y),o=Math.min(o,m.origin.x),a=Math.max(a,m.origin.x+m.width),s=Math.max(s,m.origin.y+m.height)}}catch(e){u=!0,d=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw d}}return{origin:{x:o,y:r,space:c},width:a-o,height:s-r}},t.enclosingRotatedFrame=function(e,t,n){void 0===n&&(n={x:e.origin.x+e.width/2,y:e.origin.y+e.height/2});var r=[{x:e.origin.x,y:e.origin.y},{x:e.origin.x,y:e.origin.y+e.height},{x:e.origin.x+e.width,y:e.origin.y},{x:e.origin.x+e.width,y:e.origin.y+e.height}].map(function(e){return l(e,t,n)}),i=r.map(function(e){return e.x}),a=r.map(function(e){return e.y}),s=Math.max.apply(Math,o(i)),c=Math.max.apply(Math,o(a)),u=Math.min.apply(Math,o(i)),d=Math.min.apply(Math,o(a));return{width:s-u,height:c-d,origin:{x:u,y:d,space:e.origin.space}}},t.areInteresectingRectangles=function(e,t){if(t.origin.x>e.origin.x+e.width||t.origin.x+t.width<e.origin.x||t.origin.y>e.origin.y+e.height||t.origin.y+t.height<e.origin.y)return!1;return!0},t.isEnclosingRectangle=function(e,t){return t.origin.x>e.origin.x&&t.origin.y>e.origin.y&&t.origin.x+t.width<e.origin.x+e.width&&t.origin.y+t.height<e.origin.y+e.height},t.anchorRectFromControlPoint=p,t.offsetRect=function(e,t){return Object.assign({},t,{origin:{x:t.origin.x+e.x,y:t.origin.y+e.y,space:t.origin.space}})},t.resizeRectFromTopLeft=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:{x:t.origin.x+e.x,y:t.origin.y+e.y,space:t.origin.space},width:t.width-e.x,height:t.height-e.y};return p("TOP_LEFT",n,t,r)},t.resizeRectFromTopMid=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:{x:t.origin.x,y:t.origin.y+e.y,space:t.origin.space},width:t.width,height:t.height-e.y};return p("TOP_MID",n,t,r)},t.resizeRectFromTopRight=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:{x:t.origin.x-e.x,y:t.origin.y+e.y,space:t.origin.space},width:t.width+e.x,height:t.height-e.y};return p("TOP_RIGHT",n,t,r)},t.resizeRectFromMidLeft=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:{x:t.origin.x+e.x,y:t.origin.y,space:t.origin.space},width:t.width-e.x,height:t.height};return p("MID_LEFT",n,t,r)},t.resizeRectFromMidRight=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:t.origin,width:t.width+e.x,height:t.height};return p("MID_RIGHT",n,t,r)},t.resizeRectFromBottomLeft=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:{x:t.origin.x+e.x,y:t.origin.y,space:t.origin.space},width:t.width-e.x,height:t.height+e.y};return p("BOTTOM_LEFT",n,t,r)},t.resizeRectFromBottomMid=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:t.origin,width:t.width,height:t.height+e.y};return p("BOTTOM_MID",n,t,r)},t.resizeRectFromBottomRight=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={origin:t.origin,width:t.width+e.x,height:t.height+e.y};return p("BOTTOM_RIGHT",n,t,r)},t.compareRectEqual=function(e,t){return c(e.origin,t.origin)&&e.width===t.width&&e.height===t.height},t.forceRectMinSize=function(e,t,n){if(e.width<t||e.height<n)return Object.assign({},e,{width:Math.max(t,e.width),height:Math.max(n,e.height)});return e},t.rectMidpoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return{x:(t.x+e.width)/2,y:(t.y+e.height)/2,space:e.origin.space}},t.rectTopLeftPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return{x:t.x,y:t.y+e.height,space:e.origin.space}},t.rectTopRightPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return{x:t.x+e.width,y:t.y+e.height,space:e.origin.space}},t.rectBottomLeftPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return{x:t.x,y:t.y,space:e.origin.space}},t.rectBottomRightPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return{x:t.x+e.width,y:t.y,space:e.origin.space}};var i=t.RECT_ZERO={origin:{x:0,y:0,space:"client"},width:0,height:0},a=t.POINT_ZERO={x:0,y:0,space:"page"},s={TOP_LEFT:{x:1,y:-1},TOP_MID:{x:-1,y:-1},TOP_RIGHT:{x:-1,y:-1},MID_LEFT:{x:1,y:-1},MID_RIGHT:{x:-1,y:-1},BOTTOM_LEFT:{x:1,y:1},BOTTOM_MID:{x:-1,y:1},BOTTOM_RIGHT:{x:-1,y:1}};function c(e,t){return e.x===t.x&&e.y===t.y&&e.space===t.space}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,r=e.x-n.x,o=e.y-n.y,i=Math.cos(t),s=Math.sin(t);return{x:r*i-o*s+n.x,y:r*s+o*i+n.y,space:e.space}}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.space!==t.space)throw new Error("Points are in different coordinate spaces.");return{x:(e.x-t.x)/n,y:(e.y-t.y)/n,space:e.space}}function d(e,t){return{x:e.x+t.x,y:e.y+t.y,space:e.space}}function p(e,t,n,r){var o=s[e],i=l({x:o.x*n.width/2,y:o.y*n.height/2,space:n.origin.space},t),a=n.origin.x+n.width/2+i.x,c=n.origin.y+n.height/2-i.y,u=(n.origin.space,l({x:o.x*r.width/2,y:o.y*r.height/2,space:r.origin.space},t)),d=r.origin.x+r.width/2+u.x,p=r.origin.y+r.height/2-u.y;r.origin.space;return{origin:{x:r.origin.x+(a-d),y:r.origin.y+(c-p),space:r.origin.space},width:r.width,height:r.height}}},143:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assetTracking=void 0;var r=l(n(39));t.fetchBunceeAssets=p,t.fetchBunceeSearch=f,t.fetchWebContent=m,t.fetchOmniContent=h,t.uploadToFileDatabase=function(e,t,n){var r=new URLSearchParams;r.set("import","false"),r.set("file[url]",e),r.set("file[title]",t),r.set("file[mime_type]",n);var i=new Headers;o.Client.post("/files",r,i)},t.fetchUploadContent=v,t.fetchClips=b,t.fetchMoreResults=w,t.resultsFetchMoreMap=function(e,t,n){return"upload"===e||"audio"===e?w(n).then(function(e){return t?y(e,t.guid):d}):"stitch"===e?w(n).then(function(e){return g(e)}):w(n)},t.resultsFetchMap=function(e,t,n){var r=n.length;switch(e){case"animation":case"sticker":case"message":case"emoji":case"shape":case"template":case"three_d":if(t&&0===r)return p(e,t.guid);if(t&&r>0)return f(e,n);case"web":case"youtube":case"khanacademy":case"panorama":if(r>0)return m(e,n);case"background":if(t){if(t.browser_component===a.default)return r>0?f(e,n):p(e,t.guid);if(t.browser_component!==c.default)return Promise.resolve(d);if(r>0)return m(e,n)}case"omni":return t&&r>0?h(n,t):Promise.resolve(d);case"audio":case"upload":if(t&&t.browser_component===s.default)return v(e,t.guid,n);case"stitch":return b();default:return Promise.resolve(d)}};var o=n(38),i=n(16),a=l(n(118)),s=l(n(219)),c=l(n(162));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},d={data:[],links:{next_page:!1,prev_page:!1}};function p(e,t){return u(this,void 0,void 0,r.default.mark(function n(){var i,a,s;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(i=new URLSearchParams,a=void 0,"trending"!==t){n.next=10;break}return i.set("time_period","month"),i.set("asset_type","three_d"===e?"3d":e),n.next=7,o.Client.get("/media/buncee/trending",i);case 7:a=n.sent,n.next=33;break;case 10:if("recent"!==t){n.next=18;break}return i.set("asset_type","three_d"===e?"3d":e),n.next=15,o.Client.get("/media/buncee/recent",i);case 15:a=n.sent,n.next=33;break;case 18:if("newly"!==t){n.next=27;break}return i.set("vendor","buncee"),i.set("asset_type","three_d"===e?"3d":e),i.set("sort_by","newest"),n.next=24,o.Client.get("/media",i);case 24:a=n.sent,n.next=33;break;case 27:return i.set("vendor","buncee"),i.set("asset_type","three_d"===e?"3d":e),i.set("category",t),n.next=32,o.Client.get("/media",i);case 32:a=n.sent;case 33:if(!a.ok){n.next=40;break}return n.next=36,a.json();case 36:return s=n.sent,n.abrupt("return",s);case 40:return n.abrupt("return",d);case 42:case"end":return n.stop()}},n,this)}))}function f(e,t){return u(this,void 0,void 0,r.default.mark(function n(){var i,a,s;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(i=new URLSearchParams).set("vendor","buncee"),i.set("asset_type",e),i.set("sort_by","newest"),i.set("keywords",t),n.next=7,o.Client.get("/media",i);case 7:if(!(a=n.sent).ok){n.next=15;break}return n.next=11,a.json();case 11:return s=n.sent,n.abrupt("return",s);case 15:return n.abrupt("return",d);case 17:case"end":return n.stop()}},n,this)}))}t.assetTracking=function(e,t){var n=new URLSearchParams;n.set("asset_guid",e),n.set("buncee_guid",t),o.Client.post("media/buncee/track",n).then(function(e){e.ok})};function m(e,t){return u(this,void 0,void 0,r.default.mark(function n(){var i,a,s,c;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=new URLSearchParams,a=e,"web"!==e&&"background"!==e||(a="pixabay"),"panorama"!==e?(i.set("vendor",a),i.set("keywords",t)):(i.set("type","panoramic-image"),i.set("keywords",t),i.set("tags","equirectangular"),i.set("aspect_ratio","2")),n.next=6,o.Client.get("/media",i);case 6:if(!(s=n.sent).ok){n.next=14;break}return n.next=10,s.json();case 10:return c=n.sent,n.abrupt("return",c);case 14:return n.abrupt("return",d);case 16:case"end":return n.stop()}},n,this)}))}function h(e,t){return u(this,void 0,void 0,r.default.mark(function n(){var i,s,c;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==t){n.next=2;break}throw new Error("Omni Browser wrong tab");case 2:if(i=new URLSearchParams,s=void 0,t.browser_component!==a.default){n.next=13;break}return i.set("type","buncee"),i.set("keywords",e),i.set("exclude_asset_types[]","background"),n.next=10,o.Client.get("/media",i);case 10:s=n.sent,n.next=17;break;case 13:return"omniWebImage"===t.canonical_name?(i.set("type","image"),i.set("keywords",e)):(i.set("type","video"),i.set("keywords",e)),n.next=16,o.Client.get("/media",i);case 16:s=n.sent;case 17:if(!s.ok){n.next=24;break}return n.next=20,s.json();case 20:return c=n.sent,n.abrupt("return",c);case 24:return n.abrupt("return",d);case 26:case"end":return n.stop()}},n,this)}))}function v(e,t,n){return u(this,void 0,void 0,r.default.mark(function i(){var a,s,c;return r.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=new URLSearchParams,"upload"!==e&&"audio"!==e||("myimages"===t?(a.append("mime_type[]","image/png"),a.append("mime_type[]","image/jpeg"),a.append("mime_type[]","image/jpg"),a.append("mime_type[]","image/gif"),a.append("keyword",n)):"mydocument"===t?(a.append("mime_type[]","application/pdf"),a.append("mime_type[]","application/msword"),a.append("mime_type[]","application/vnd.ms-powerpoint"),a.append("mime_type[]","application/vnd.ms-excel"),a.append("mime_type[]","application/vnd.openxmlformats-officedocument.wordprocessingml.document"),a.append("mime_type[]","application/vnd.openxmlformats-officedocument.presentationml.presentation"),a.append("mime_type[]","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),a.append("keyword",n)):"myvideo"===t?a.append("mime_type[]","video/mp4"):"myaudio"===t&&a.append("mime_type[]","audio/mp3")),r.next=4,o.Client.get("/files",a);case 4:if(!(s=r.sent).ok){r.next=12;break}return r.next=8,s.json();case 8:return c=r.sent,r.abrupt("return",y(c,t));case 12:return r.abrupt("return",d);case 14:case"end":return r.stop()}},i,this)}))}function y(e,t){return{data:e.data.map(function(e){return{id:e.data.guid,title:e.data.title,thumbnails:"mydocument"===t?(0,i.cloudfrontURL)("creation/images/item-document.png"):"myaudio"===t?(0,i.cloudfrontURL)("images/audiothumbnail.svg"):e.data.url,result_payload:e.data.url,selected:!1,preview:!1}}),links:e.links}}function b(){return u(this,void 0,void 0,r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Client.request("get","/clips");case 2:if(!(t=e.sent).ok){e.next=10;break}return e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",g(n));case 10:return e.abrupt("return",d);case 12:case"end":return e.stop()}},e,this)}))}function g(e){return{data:e.data.filter(function(e){return"3"===e.creation_version}).map(function(e){return{id:e.guid,title:e.buncee_title,thumbnails:[e.thumbnail_url],result_payload:JSON.stringify(e.slide),selected:!1,preview:!1}}),links:e.links}}function w(e){return u(this,void 0,void 0,r.default.mark(function t(){var n,i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=16;break}return e=e.replace(o.Client.getBaseURI(),""),t.next=4,o.Client.request("get",e);case 4:if(!(n=t.sent).ok){t.next=12;break}return t.next=8,n.json();case 8:return i=t.sent,t.abrupt("return",i);case 12:return t.abrupt("return",d);case 14:t.next=17;break;case 16:return t.abrupt("return",d);case 17:case"end":return t.stop()}},t,this)}))}},144:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateId=l,t.initializeIds=function(e,t){r.forOwn(e,function(e){e.id&&a.push(e.id)}),t.forEach(function(e){s.push(e.id)})},t.generateItem=function(e){var t=l(a);return Object.assign({locked:!1,type:"image",frame:{origin:i.GeometryUtil.POINT_ZERO,width:200,height:200},rotation:0,content:{type:"url",body:"https://via.placeholder.com/200?text="+encodeURIComponent(t),attributes:{}},prev_item_id:void 0,flipH:!1,flipV:!1,opacity:1,skewX:0,skewY:0},e,{id:t})},t.generateSlide=u,t.generateUser=d,t.generateBunceeDocument=p,t.generateStoreBuncee=f,t.generateStore=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],n=[u({items:e.map(function(e){return e.id})})];t&&t.buncee&&t.buncee.document.slides&&(n=t.buncee.document.slides);var r=f({document:p({items:i.ArrayUtil.arrayToObject(e,"id"),slides:n})}),o=d(),a={};a[o.id]=r.document.slides[0].id;var s=t&&t.buncee?t.buncee.document.canvas:r.document.canvas,c=t&&void 0!==t.renderingMode?t.renderingMode:"edit",l=(0,i.getCanvasScale)(s,c);return Object.assign({buncee:Object.assign({},r,{selected_slides:a}),user:o,settings:{gridlines:!1,clip_and_stitch:!1},displaySettings:{scale:l,scaleOffset:100,viewportOffset:{x:0,y:0,space:"screen"},isPanning:!1,isEmbed:!1,isFullscreen:!1,renderFooter:!0},history:{actions:[],undo:[]},renderingMode:"edit",gateway:void 0,openModal:void 0,links:{},bunceeMeta:{views:0,likes:0,reactions:{},author:"anon",comments:[]},item_defaults:{},isEditingBackground:!1,preferences:{},dirtySlides:new Set,dirtyItems:new Set,gridlineIntersects:[]},t)};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(6)),o=n(164),i=n(4);var a=[],s=[],c=20;function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=void 0,o=0;do{if(n=String.fromCharCode(r.random(97,122))+r.times(t-1,function(){return r.random(35).toString(36)}).join(""),++o>=c)throw new Error("Could not generate an id")}while(n in e);return e.push(n),n}function u(e){var t=localStorage.getItem(window.config.buncee_guid),n=null;t&&(n=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)?{type:"color",body:t,attributes:{opacity:1}}:{type:"url",body:t,attributes:{opacity:1,x:0,y:0}});var r=l(s);return Object.assign({background:n,items:[]},e,{id:r})}function d(e){return Object.assign({id:"usr-1",type:o.UserType.ADMIN,first_name:"Mock",last_name:"User",username:"MockUsername",permissions:{},settings:{}},e)}function p(e){return Object.assign({slides:[u()],items:{},canvas:{size_type:"buncee-landscape"}},e)}function f(e){return Object.assign({document:p(),owner_guid:"",copyable:!1,commentable:!1,show_watermark:!1,privacy_level:"public",id:"1",title:"test buncee",selected_items:{},selected_slides:{},tags:[]},e)}},150:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(372);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},151:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewHeader=t.SlideThumbnail=t.SlidesPanel=t.ItemsPanel=t.ItemThumbnail=t.Footer=t.EditHeader=void 0;var r=u(n(418)),o=u(n(417)),i=u(n(416)),a=u(n(415)),s=u(n(194)),c=u(n(261)),l=u(n(398));function u(e){return e&&e.__esModule?e:{default:e}}t.EditHeader=r.default,t.Footer=o.default,t.ItemThumbnail=s.default,t.ItemsPanel=i.default,t.SlidesPanel=a.default,t.SlideThumbnail=c.default,t.ViewHeader=l.default},16:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.storeQuestionResponse=void 0;var r=l(n(39));t.ltrim=d,t.rtrim=p,t.cloudfrontURL=function(e,t){var n=window.config.cloudfront_url;if(t=t||window.config.release_id,null===n)throw new Error("Cloudfront URL missing");return"https://"+p(n,"/")+"/"+d(e,"/")+"?timestamp="+t},t.getCanvasDimensions=f,t.getCanvasScale=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"edit",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{fullscreen:!1,embed:!1,renderFooter:!0,extraOffset:{width:0,height:0}},r=f(e),o="edit"===t?170:120;c.default.isIpadPro()&&(o+=25);var i=n.fullscreen||!1,a=n.embed||!1,s=!1!==n.renderFooter,l=void 0===n.extraOffset?{width:0,height:0}:n.extraOffset,u=window.innerHeight,d=window.innerWidth-30;a&&(o-=40);i&&(u=screen.height,d=screen.width,o=0);s||(o-=65);var p=(d-l.width)/r.width;p*r.height>u-(o+l.height)&&(p=(u-(o+l.height))/r.height);return p},t.recalculateItemPosition=function(e,t,n){var r=f(t).width,o=f(t).height,i=0,a=0;if(null!==n){var s=document.getElementById("custom-width"),c=document.getElementById("custom-height"),l={width:void 0,height:void 0};s&&c&&(l=f({size_type:n,width:parseInt(s.value,10),height:parseInt(c.value,10)})),i=l.width?l.width:f({size_type:n}).width,a=l.height?l.height:f({size_type:n}).height}var u=e.frame.origin.x,d=e.frame.origin.y;return{x:u/r*i,y:d/o*a}},t.getYoutubeId=function(e){var t=new RegExp("(http[s]?:[\\/]{2}|[\\/]{2})??([a-z0-9\\-\\.]+)??(youtube.com|youtu.be)/(watch|v|embed)?[/]?(\\?v=|v\\/)?([a-z0-9-_]{11,})","i"),n=e.match(t);if(null===n)throw new Error("Unable to extract video id from URL");var r=n.pop();if(r)return r;return""},t.getVimeoId=function(e){var t=new RegExp("vimeo.*?([0-9]+$)","i"),n=e.match(t);if(null===n)throw new Error("Unable to extract video id from URL");var r=n.pop();if(r)return r;return""},t.displayToastMessage=function(e,t){var n=document.createElement("div");n.className="toast",n.innerHTML=e;var r=document.getElementById("creation-content");null!==r&&(r.appendChild(n),setTimeout(function(){n.className="toast show"},500),setTimeout(function(){n.className="toast",setTimeout(function(){r.removeChild(n)},500)},t||3e3))},t.formattedTimer=function(e){return Math.floor(e/60)+":"+("0"+e%60).slice(-2)},t.getURLParameter=function(e){return new URLSearchParams(window.location.search).get(e)},t.getScaleMultiplier=m,t.fitToCanvas=h,t.getImageDimensions=v,t.getVideoDimensions=y,t.getDimensionsForFile=function(e,t){return u(this,void 0,void 0,r.default.mark(function n(){return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("video/mp4"!==t){n.next=6;break}return n.next=3,y(e);case 3:return n.abrupt("return",n.sent);case 6:return n.next=8,v(e);case 8:return n.abrupt("return",n.sent);case 9:case"end":return n.stop()}},n,this)}))},t.generateFrame=function(e,t,n,r,o){var i=document.getElementById("canvas");if(!i)throw new Error("Canvas does not exist");var s=r||a.random(100,i.offsetWidth-150),c=o||a.random(100,i.offsetHeight-150),l=e*m(n),u=t*m(n),d=h(l,u,i.offsetWidth,i.offsetHeight);l>=i.offsetWidth?(l=.75*d.width,u=.75*d.height):u>=i.offsetHeight&&(l=.75*d.width,u=.75*d.height);s+l>i.offsetWidth?s=i.offsetWidth-l:s<0&&(s=0);c+u>i.offsetHeight?c=i.offsetHeight-u:c<0&&(c=0);return{origin:{x:s,y:c,space:"client"},width:l,height:u}},t.elementsFromPoint=function(e,t){var n=[],r=void 0;do{r!==document.elementFromPoint(e,t)?(r=document.elementFromPoint(e,t),n.push(r),r.style.pointerEvents="none"):r=void 0}while(r);return n.forEach(function(e){return e.style.pointerEvents="all"}),n},t.getBucket=function(e,t,n){var r=f(n);return{row:Math.floor(t/r.height*10),column:Math.floor(e/r.width*10)}},t.isWorkingOnSubmission=function(){var e=!1,t=window;try{e=t.inAssignmentMode()&&(!t.submission.data.grade||t.submission.data.turned_back_at)&&s.User.getUser().guid===t.submission.data.owner_guid}catch(e){}return e},t.recalculateFontPixelSize=function(e,t){if(e>=t)return 2.5.toString().concat("rem");var n=e/t*2.5;return n.toString().concat("rem")},t.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},t.speechSynthSpeak=function(e,t,n,r){var o=window.speechSynthesis;o.paused&&!r?(o.resume(),t(e.text)):o.speaking&&!r?(o.pause(),n(e.text)):(setTimeout(function(){o.speak(e)},100),e.onstart=function(){t(e.text)},e.onend=function(){n("")})},t.mcqToString=function(e){var t=e.content.body.question;return Object.keys(e.content.body.choices).forEach(function(n,r){t=t.concat(", Choice "+(r+1)+", "+e.content.body.choices[n])}),t},t.copyObjectNewCoordinates=function(e,t){var n=f(t).width,r=f(t).height,o=n/2+e.frame.width/2,i=r/2+e.frame.height/2,s=n/2,c=r/2;if(o>n/(4/3)){var l=o-n/(4/3);s=(o-=l)-e.frame.width/2}else if(o<n/4){var u=n/4-o;s=(o+=u)-e.frame.width/2}if(i>r/(4/3)){var d=i-r/(4/3);c=(i-=d)-e.frame.height/2}else if(i<r/4){var p=r/4-i;c=(i+=p)-e.frame.height/2}return{x:s+a.random(-200,200,!1),y:c+a.random(-200,200,!1)}};var o=n(38),i=n(119),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(6));n(655);var s=n(56),c=l(n(310));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})};function d(e,t){for(;e[0]===t;)e=e.substr(1,e.length);return e}function p(e,t){for(;e.slice(-1)===t;)e=e.substr(0,e.length-1);return e}function f(e){if("custom"===e.size_type||void 0===e.size_type){var t=0,n=0;return e.width&&e.height&&e.width>0&&e.height>0&&(e.width>e.height?(t=1920,n=e.height/e.width*1920):e.width<e.height?(n=1920,t=e.width/e.height*1920):(n=1920,t=1920)),{width:t,height:n}}return i.CanvasSizeTypeToSize[e.size_type]}function m(e){switch(e.size_type){case"square":return 1.5;default:return 1}}function h(e,t,n,r){var o=Math.min(n/e,r/t);return{width:e*o,height:t*o}}function v(e){return u(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){var r=new Image;r.onload=function(){t({width:r.width,height:r.height})},r.onerror=n,r.src=e}));case 1:case"end":return t.stop()}},t,this)}))}function y(e){return u(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){var r=document.createElement("source");r.setAttribute("type","video/mp4"),r.setAttribute("src",e);var o=document.createElement("video");o.addEventListener("loadedmetadata",function(){t({width:o.videoWidth,height:o.videoHeight})}),o.appendChild(r)}));case 1:case"end":return t.stop()}},t,this)}))}t.storeQuestionResponse=a.debounce(function(e,t){return u(void 0,void 0,void 0,r.default.mark(function n(){var i,s,c,l,u;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=window,s=i.submission,(c=new URLSearchParams).set("type","question"),c.set("data",JSON.stringify({question_id:e.attributes.question_id,question_response:t,buncee_guid:i.config.buncee_guid})),n.next=7,o.Client.post("/submissions/"+s.data.guid+"/responses",c).then(function(e){return e.json()});case 7:l=n.sent,(u=a.find(i.submission.data.responses,{question_id:e.attributes.question_id}))?u.question_response=t:i.submission.data.responses.push(l.data);case 10:case"end":return n.stop()}},n,this)}))},200)},162:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){var t=["browser-results grid"];"omni"!==e.item_browser&&"background"!==e.item_browser&&t.push("web");var n=e.results.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent})});return o.createElement("div",{className:t.join(" ")},e.search_query.length>0?n.length>0?n:o.createElement("div",{className:"no-results-text"}," No result found "):o.createElement("div",{className:"no-results-text"}," Enter a Keyword to Search "))}},164:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssignmentFeedbackLevel=t.UserType=t.CanvasSizeTypeToSize=void 0;var r=n(119);t.CanvasSizeTypeToSize=r.CanvasSizeTypeToSize;var o=t.UserType=void 0;!function(e){e.STUDENT="student",e.TEACHER="teacher",e.GENERIC_FREE="generic-free",e.GENERIC_PREMIUM="generic-premium",e.OWNER="owner",e.ADMIN="admin"}(o||(t.UserType=o={}));var i=t.AssignmentFeedbackLevel=void 0;!function(e){e[e.NONE=0]="NONE",e[e.AFTER_SUBMISSION=1]="AFTER_SUBMISSION",e[e.INSTANT=2]="INSTANT"}(i||(t.AssignmentFeedbackLevel=i={}))},165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Yes",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"No";return new Promise(function(a){var s=document.getElementById("creation-content"),c=s.appendChild(document.createElement("div"));i.render(o.createElement(r.ConfirmModal,{message:e,closeModal:function(){i.unmountComponentAtNode(c),c.remove(),a(!1)},onAccept:function(){i.unmountComponentAtNode(c),c.remove(),a(!0)},onReject:function(){i.unmountComponentAtNode(c),c.remove(),a(!1)},acceptText:t,rejectText:n}),c)})};var r=n(311),o=a(n(0)),i=a(n(55));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getThumbnailForItem=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(38),a=n(11),s=n(68),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=h(n(403)),d=h(n(402)),p=h(n(401)),f=h(n(400)),m=h(n(399));function h(e){return e&&e.__esModule?e:{default:e}}var v=function(e){return c.createElement(a.LazyLoadImage,{src:e.content.body})},y=t.getThumbnailForItem=function(e){switch(e.type){case"text":return function(e){return c.createElement(m.default,{item:e})}(e);case"soundcloud":return c.createElement(a.LazyLoadImage,{src:"https://3efaa8228ae8d8782d83-d080dc8acde12e16e524531aade69ab5.ssl.cf5.rackcdn.com/shared/loading-indicator-80x80.gif"});case"video":return function(e){var t=s.Util.ObjectUtil.get(e.content,"attributes.thumbnails");if(Array.isArray(t)&&t.length>0)return t[0];var n=s.Util.ObjectUtil.get(e.content,"body");return n?c.createElement("video",{src:n,preload:"metadata",style:{width:"100%",height:"100%"},controls:!1}):c.createElement(a.LazyLoadImage,{src:"https://3efaa8228ae8d8782d83-d080dc8acde12e16e524531aade69ab5.ssl.cf5.rackcdn.com/shared/loading-indicator-80x80.gif"})}(e);case"youtube":return function(e){return c.createElement(a.LazyLoadImage,{src:"https://img.youtube.com/vi/"+e.content.body+"/default.jpg"})}(e);case"vimeo":return function(e){return c.createElement(a.LazyLoadImage,{src:"https://i.vimeocdn.com/video/"+e.content.body+"_295x166.jpg"})}(e);case"image":return v(e);case"shape":return function(e){return c.createElement(f.default,{item:e})}(e);case"three_d":return function(e){return e.content.attributes&&e.content.attributes.preview_url?c.createElement(a.LazyLoadImage,{src:e.content.attributes.preview_url}):c.createElement(a.LazyLoadImage,{src:e.content.body})}(e);case"drawing":return function(e){return c.createElement(u.default,{item:e})}(e);case"qrcode":return c.createElement(a.LazyLoadImage,{src:i.Client.getBaseURI()+"/qr_code?data="+encodeURIComponent(window.config.view_link)});case"panoramic":return v(e);case"mcq":case"frq":return function(e){return c.createElement(p.default,{item:e})}(e);case"group":return function(e){return c.createElement(d.default,{item:e})}(e);default:return c.createElement(a.LazyLoadImage,null)}},b=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),r(t,[{key:"componentDidMount",value:function(){this.props.markClean()}},{key:"componentDidUpdate",value:function(){this.props.isDirty&&this.props.markClean()}},{key:"shouldComponentUpdate",value:function(e){return!!e.isDirty||this.props.isSelected!==e.isSelected}},{key:"render",value:function(){return c.createElement("div",{className:"item-thumbnail "+(this.props.isSelected?"selected":"")},y(this.props.item),this.props.displayIndex&&c.createElement("span",{className:"item-number"},this.props.index+1))}}]),t}(),g=(0,l.connect)(function(e,t){return{isDirty:e.dirtyItems.has(t.item.id)}},function(e,t){return{markClean:function(){e(o.Actions.markItemClean({value:t.item.id}))}}})(b);t.default=g},195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNoFillShape=t.requestSVGData=t.Polygon=void 0;var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(6),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var l=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})};function u(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(r.replace("_","-")+": "+t[r]);var o=e.search(/style=\"/);if(e.search(/viewBox=\".+?\"/)>-1){var i=420.4+t.stroke_width,a=-10-t.stroke_width/2;e=e.replace(/viewBox=\".+?\"/,'viewBox="'+a+" "+a+" "+i+" "+i+'"')}if(o>-1&&o<e.indexOf(">")){var s=e.replace(/style=\".+?\"/,'style="'+n.join("; ")+';"'),c=s.indexOf(">");if(-1===s.indexOf("preserveAspectRatio"))s=s.substring(0,c)+' preserveAspectRatio="none"'+s.substring(c);return s}var l=e.indexOf(">"),u=e.substring(0,l),d=e.substring(l);return u+' class="item-content" style="'+n.join("; ")+'" preserveAspectRatio="none" '+d}function d(e,t,n){return l(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.content.attributes&&"string"==typeof e.content.attributes.svg_url){t.next=2;break}throw new Error("Improper body content");case 2:return t.abrupt("return",fetch(e.content.attributes.svg_url).then(function(e){return e.text()}).then(function(t){var r=e.content.attributes,o=(0,s.omit)(Object.assign({},e.content.attributes,{width:"100%",height:"100%",fill:p(r.svg_url)?"none":r.fill}),["type","svg_url"]);o["stroke-opacity"]=p(r.svg_url)?r.fill_opacity:"1";var i=u(t,o);n(i)}));case 3:case"end":return t.stop()}},t,this)}))}function p(e){var t=new RegExp("("+["shapes_wave.svg","shapes_xy_coordinates.svg","shapes_line.svg","shapes_crosshair.svg"].join("|")+")+");return null!==e.match(t)}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={svgData:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),a(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.item.content.attributes,r=(0,s.omit)(Object.assign({},e.item.content.attributes,{width:"100%",height:"100%",fill:p(n.svg_url)?"none":n.fill}),["type","svg_url"]);return r["stroke-opacity"]=p(n.svg_url)?n.fill_opacity:"1",{svgData:u(t.svgData,r)}}}]),a(t,[{key:"componentDidMount",value:function(){var e=this;d(this.props.item,this.props.mode,function(t){e.setState({svgData:t})})}},{key:"componentDidUpdate",value:function(e){void 0!==this.props.item.content.attributes&&e.item.content.attributes}},{key:"render",value:function(){return this.state.svgData.indexOf("<svg")>-1?c.createElement("div",{className:"item-content",dangerouslySetInnerHTML:{__html:this.state.svgData},style:this.props.style}):c.createElement("div",null)}}]),t}();t.Polygon=f,t.requestSVGData=d,t.isNoFillShape=p},196:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.commands=[],this.getCanvas=function(){return n.context.canvas},this.context=t;var r=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype),o=function(e){if("function"==typeof Object.getOwnPropertyDescriptor(CanvasRenderingContext2D.prototype,e).value)n[e]=function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];n.commands.push(e,r.slice()),CanvasRenderingContext2D.prototype[e].apply(n.context,r)};else{var t={configurable:!1,get:function(){return n.context[e]},set:function(t){n.commands.push("_S"+e,[t]),n.context[e]=t}};Object.defineProperty(n,e,t)}},i=!0,a=!1,s=void 0;try{for(var c,l=r[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){o(c.value)}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}return r(e,[{key:"flush",value:function(){var e=this.commands.slice(0);return this.commands=[],e}},{key:"execute",value:function(e){for(var t=0;t<e.length;t+=2){var n=e[t],r=e[t+1];if("string"!=typeof n)throw new Error("Expected string for command name.");if(!Array.isArray(r))throw new Error("Expected array for command arguments.");"_S"===n.substr(0,2)?this.context[n.substr(2)]=r[0]:CanvasRenderingContext2D.prototype[n].apply(this.context,r)}}},{key:"innerContext",get:function(){return this.context}}]),e}();t.default=o},198:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(215),i=(r=o)&&r.__esModule?r:{default:r},a=n(11),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t="function"==typeof e.handleOpacity,n=s.createElement("div",{className:"toolbar-button"},s.createElement("div",{className:"current-color",style:{backgroundColor:e.color}}),s.createElement("span",{className:"label"},e.text?e.text:"Color")),r=s.createElement("div",{className:t?"toolbar-color-opacity ":"toolbar-color"},s.createElement(i.default,{color:e.color,mode:"popup",handleSelect:function(t,n){e.handleColorChange(t,n)},handleOpacity:e.handleOpacity,initialOpacityValue:e.opacity}));return s.createElement("div",{className:"toolbar-button",id:e.id,onClick:e.handleButtonClick},s.createElement(a.PopupMenu,{showMenu:e.showMenu,buttonContent:n},r))}},199:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedUploadBrowser=t.UploadBrowser=void 0;var r=v(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=v(n(165)),s=h(n(163)),c=h(n(6)),l=h(n(0)),u=n(5),d=n(4),p=h(n(144)),f=n(16),m=n(143);function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={fileInfo:{}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidMount",value:function(){var e=this,t=[];t="background"===this.props.item_browser?["image/*"]:"audio"===this.props.item_browser?["audio/mp3"]:["image/*","video/mp4",".pdf"];var n={uploadInBackground:!1,displayMode:s.PickerDisplayMode.inline,cleanupImageExif:!0,dropPane:{},accept:t,fromSources:["local_file_system"],maxFiles:"background"===this.props.item_browser||"audio"===this.props.item_browser?1:10,maxSize:15728640,container:"uploadZone",exposeOriginalFile:!0,storeTo:{location:"s3",path:"user-uploads/"+window.config.tenant+"/"+this.props.user.id+"/"},onUploadStarted:function(t){var n={};t.forEach(function(t){return y(e,void 0,void 0,r.default.mark(function e(){var o,i;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.originalFile,i=URL.createObjectURL(o),e.next=4,(0,f.getDimensionsForFile)(i,t.mimetype);case 4:n[t.uploadId]=e.sent,this.setState({fileInfo:n});case 6:case"end":return e.stop()}},e,this)}))})},onUploadDone:function(t){return y(e,void 0,void 0,r.default.mark(function e(){var n,o,i,s=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.filesUploaded[0],"background"!==this.props.item_browser){e.next=8;break}return e.next=4,(0,a.default)("Would you like to apply this background to...","All Pages","This Page");case 4:e.sent?(o=this.props.slides.map(function(e){return Object.assign({},e,{background:{type:"url",body:(0,d.cloudfrontURL)(n.key),attributes:{opacity:1,x:0,y:0}}})}),localStorage.setItem(window.config.buncee_guid,(0,d.cloudfrontURL)(n.key)),this.props.updateAllSlides(o)):this.props.updateSlide({type:"url",body:(0,d.cloudfrontURL)(n.key),attributes:{opacity:1,x:0,y:0}},this.props.slide),e.next=9;break;case 8:"audio"===this.props.item_browser?((0,m.uploadToFileDatabase)(encodeURI((0,d.cloudfrontURL)(n.key)),n.filename,"audio/mp3"),this.props.updateItem(this.props.selectedItemId.id,"audio",(0,d.cloudfrontURL)(n.key)),(0,f.displayToastMessage)("Audio Attached",2e3)):(i=t.filesUploaded.map(function(e,n){var r;r=e.mimetype;var o=t.filesUploaded[n];switch((0,m.uploadToFileDatabase)(encodeURI((0,d.cloudfrontURL)(o.key)),o.filename,r),r){case"video/mp4":case"video/wav":var i=s.state.fileInfo[o.uploadId].width,a=s.state.fileInfo[o.uploadId].height,c=i/610;return i/=c,a/=c,p.generateItem({type:"video",content:{type:"url",body:(0,d.cloudfrontURL)(o.key)},frame:(0,f.generateFrame)(i,a,s.props.canvas)});case"application/pdf":return p.generateItem({type:"image",content:{type:"url",body:(0,d.cloudfrontURL)("creation/images/item-document.png")},link:(0,d.cloudfrontURL)(o.key),frame:(0,f.generateFrame)(220,280,s.props.canvas)});default:var l=s.state.fileInfo[o.uploadId].width,u=s.state.fileInfo[o.uploadId].height;return p.generateItem({type:"image",content:{type:"url",body:(0,d.cloudfrontURL)(o.key)},frame:(0,f.generateFrame)(l,u,s.props.canvas)})}}),this.props.selectedItemId&&this.props.setItemSelected(this.props.selectedItemId.id,null),i.length>0&&(this.props.setItemSelected(i[0].id,this.props.user),this.props.addItem(i,this.props.addToIndex,this.props.slide)));case 9:this.props.closeGateway(),d.fileStackClient.picker().close();case 11:case"end":return e.stop()}},e,this)}))}};d.fileStackClient.picker(n).open()}},{key:"render",value:function(){return l.createElement("div",{className:"upload-wrapper"},l.createElement("div",{className:"upload-disclaimer"}," Please only upload files that you own or have permission to use."),l.createElement("div",{className:["browser-results upload"].join(" "),id:"uploadZone"}))}}]),t}(),g=(0,u.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.buncee.document.slides,o=e.user,i=e.buncee.selected_items,a=c.keys(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),s=e.gateway?e.gateway.addToIndex:void 0;return{slide:n,slides:r,user:o,selectedItemId:a[0],addToIndex:s}},function(e,t){return{addItem:function(t,n,r){var o=r.items,a=[];t.length>0&&(t.forEach(function(e){a.push(i.Actions.addItem({item:e})),o="number"==typeof n?d.ArrayUtil.insert(o,e.id,o.length-n):d.ArrayUtil.push(o,e.id)}),e(i.Actions.batchActions({actions:[].concat(a,[i.Actions.updateSlide({id:r.id,path:"items",value:o})])})))},updateItem:function(t,n,r){e(i.Actions.updateItem({path:t+(n.length>0?"."+n:n),value:r}))},updateSlide:function(t,n){e(i.Actions.updateSlide({path:"background",id:n.id,value:t}))},updateAllSlides:function(t){e(i.Actions.updateSlide({path:"",value:t}))},setItemSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},closeGateway:function(){e(i.Actions.closeGateway({activeBrowser:void 0}))}}})(b);t.UploadBrowser=b,t.ConnectedUploadBrowser=g},200:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){var t=["grid"],n=e.results.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent})});return n.length<1&&t.push("no-results"),o.createElement("div",{className:"browser-results"},o.createElement("div",{className:"content-static"},o.createElement("h2",{id:"templates-header"},"Create a new Buncee"),o.createElement("div",{className:"results blank-template-result"},o.createElement("div",{id:"blank-template",onClick:function(){return e.processSelectedResult(-1,!0)}},o.createElement("span",{className:"icon-addnew"}),o.createElement("div",{className:"result-title"},"Start from scratch"))),o.createElement("div",{id:"templates-divider"},o.createElement("span",{className:"horizontal"}),o.createElement("p",null,"or"),o.createElement("span",{className:"horizontal"})),o.createElement("h2",{id:"result-section-header"},"Select a template from any of our 25+ categories")),o.createElement("div",{className:t.join(" "),id:"browser-results"},n.length>0?n:o.createElement("div",{className:"no-results-text"},"No results found")))}},215:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(634),c=n(25),l=n(4);var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.COLORS=[[l.ColorUtil.Colors.RED,l.ColorUtil.Colors.ORANGE,l.ColorUtil.Colors.GREEN,l.ColorUtil.Colors.MARINER,l.ColorUtil.Colors.PURAV,l.ColorUtil.Colors.DARK_ADI,l.ColorUtil.Colors.BLACK,l.ColorUtil.Colors.BUNCEE_BLUE],[l.ColorUtil.Colors.BLUSH,l.ColorUtil.Colors.JOSH,l.ColorUtil.Colors.FRUIT_SALAD,l.ColorUtil.Colors.JOEL,l.ColorUtil.Colors.PURPLE,l.ColorUtil.Colors.BROWN,l.ColorUtil.Colors.DARK_GREY,l.ColorUtil.Colors.BUNCEE_CHERRY],[l.ColorUtil.Colors.MANNY,l.ColorUtil.Colors.SAFFRON,l.ColorUtil.Colors.PASTEL_GREEN,l.ColorUtil.Colors.MELROSE,l.ColorUtil.Colors.VIOLET,l.ColorUtil.Colors.OCHRE,l.ColorUtil.Colors.LIGHT_GREY,l.ColorUtil.Colors.BUNCEE_BLACK],[l.ColorUtil.Colors.MINRAN,l.ColorUtil.Colors.ANNIE,l.ColorUtil.Colors.MOSS,l.ColorUtil.Colors.ZIGGURAT,l.ColorUtil.Colors.TIM,l.ColorUtil.Colors.MAC_N_CHEESE,l.ColorUtil.Colors.WHITE,l.ColorUtil.Colors.BUNCEE_YELLOW]],n.renderOpacitySlider=function(){return"function"==typeof n.props.handleOpacity?a.createElement("div",{className:"toolbar-button color-picker-panel",id:"opacity-text-toolbar"},a.createElement(i.Slider,{onChange:function(e){n.updateOpacity(e)},minValue:0,maxValue:100,step:10,unit:"%",value:100*n.state.opacity})):void 0},n.handlePickerInteraction=function(e){document.querySelector(".color-input input").blur(),n.props.onChange&&n.props.onChange(e)},n.handleInputChange=function(e){n.setState({selectedColor:e})},n.handleKeyPress=function(e){e.stopPropagation(),"enter"===l.KeyUtil.getKey(e.nativeEvent)&&(e.preventDefault(),n.applyColor())},n.applyColor=function(){n.props.handleSelect(n.state.selectedColor,!0)},n.getSwatchStyle=function(e){var t={backgroundColor:e};return e===l.ColorUtil.Colors.WHITE&&n.state.selectedColor!==e&&(t.border="1px solid gray"),t},n.state={selectedColor:n.props.hex||"22194d",opacity:n.props.initialOpacityValue||0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"componentDidUpdate",value:function(e){void 0!==this.props.hex&&e.hex!==this.props.hex&&(this.setState({selectedColor:this.props.hex}),this.props.handleSelect(this.props.hex,!1),0===this.state.opacity&&"function"==typeof this.props.handleOpacity&&(this.setState({opacity:1}),this.props.handleOpacity(1)))}},{key:"updateOpacity",value:function(e){this.props.handleOpacity(e/100),this.setState({opacity:e/100})}},{key:"render",value:function(){return"modal"===this.props.mode?this.renderModalView():"popup"===this.props.mode?this.renderPopupView():this.renderPaletteView()}},{key:"renderCustomColorPicker",value:function(){return a.createElement("div",{className:"color-picker-panel custom-panel"},a.createElement("div",{className:"picker-components"},a.createElement("div",{className:"saturation-canvas"},a.createElement(c.Saturation,r({},this.props,{onChange:this.handlePickerInteraction}))),a.createElement("div",{className:"row"},a.createElement("div",{className:"color-preview",style:{backgroundColor:this.state.selectedColor}}),a.createElement("div",{className:"hue-slider"},a.createElement(c.Hue,r({},this.props,{onChange:this.handlePickerInteraction}))),"modal"===this.props.mode&&this.renderHexInput()),"popup"===this.props.mode&&this.renderHexInput()))}},{key:"renderBasicColorsPanel",value:function(){var e=this,t=this.COLORS.map(function(t,n){return a.createElement("div",{key:"color-row-"+n,className:"color-row row"},t.map(function(t){return a.createElement("div",{className:"color-swatch",key:t},a.createElement("div",{style:e.getSwatchStyle(t),className:e.state.selectedColor===t?"selected":"",onClick:function(){e.selectColor(t,!0)}}))}))});return a.createElement("div",{className:"color-picker-panel basic-panel"},a.createElement("div",{id:"color-grid"},t))}},{key:"renderModalView",value:function(){return a.createElement("div",{id:"color-picker",style:{margin:"0 auto"}},this.renderBasicColorsPanel(),this.renderCustomColorPicker())}},{key:"renderPopupView",value:function(){return a.createElement("div",{id:"color-picker",className:"popup",style:{margin:"0 auto"},onKeyDown:this.handleKeyPress},this.renderCustomColorPicker(),this.renderBasicColorsPanel(),this.renderOpacitySlider())}},{key:"renderPaletteView",value:function(){return a.createElement("div",{id:"color-picker",className:"popup",style:{margin:"0 auto"},onKeyDown:this.handleKeyPress},this.renderBasicColorsPanel())}},{key:"renderHexInput",value:function(){var e={input:{border:"1px solid #979797",borderRight:"none",width:"100%",height:"100%",textAlign:"center",borderRadius:"3px",borderBottomRightRadius:"0",borderTopRightRadius:"0",display:"inline-block"},wrap:{display:"inline-block",width:"popup"===this.props.mode?"80%":"60%"}};return a.createElement("div",{className:"hex-input"},a.createElement("div",{className:"color-input"},a.createElement(c.EditableInput,{value:this.state.selectedColor,onChange:this.handleInputChange,style:e}),a.createElement("button",{className:"btn",onClick:this.applyColor},"Apply")))}},{key:"selectColor",value:function(e,t){this.props.handleSelect(e,t),this.setState(Object.assign({},this.state,{selectedColor:e}))}}]),t}();u.displayName="BunceeColorPicker",t.default=(0,s.CustomPicker)(u)},216:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(215),a=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){var t=e.selected_results[0]?e.selected_results[0].result_payload:"#0000";return o.createElement("div",{className:["browser-results color-picker"].join(" ")},o.createElement(a.default,{mode:"modal",handleSelect:function(t){return function(t){e.processSelectedColor(t)}(t)},color:t}))}},217:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedAudioBrowser=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=p(n(163)),a=p(n(6)),s=p(n(0)),c=n(5),l=n(4),u=n(16),d=n(143);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.sec=0,n.picker=l.fileStackClient.picker(),n.addAudioToItem=function(){if(!n.state.audioFile)throw new Error("Audio file was not uploaded");n.props.updateItem(n.props.selectedItem.id,"audio",n.state.audioFile),(0,u.displayToastMessage)("Audio Attached",2e3),n.picker.close(),n.props.closeGateway()},n.removeAudioFromItem=function(){n.state.audioFile&&(n.props.updateItem(n.props.selectedItem.id,"audio",null),(0,u.displayToastMessage)("Audio Removed",2e3)),n.setState({audioFile:null}),n.makeAudioPane()},n.makeAudioPane=function(){var e={uploadInBackground:!1,displayMode:i.PickerDisplayMode.inline,fromSources:["audio"],dropPane:{},container:"audio-panel",storeTo:{location:"s3",path:"user-uploads/"+window.config.tenant+"/"+n.props.user.id+"/"},onUploadDone:function(e){var t=e.filesUploaded[0];(0,d.uploadToFileDatabase)(encodeURI((0,l.cloudfrontURL)(t.key)),t.filename,"audio/mp3"),n.setState({audioFile:(0,l.cloudfrontURL)(e.filesUploaded[0].key)}),n.picker.close()}};n.picker=l.fileStackClient.picker(e),n.picker.open()},n.state={startTimer:!0,sec:0,audioFile:n.props.selectedItem.audio?n.props.selectedItem.audio:null},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),r(t,[{key:"componentDidMount",value:function(){var e=this;this.props.selectedItem.audio||this.makeAudioPane(),window.onclick=function(t){var n=t.target;if(n)if("fsp-button fsp-button--primary fsp-button--video"===n.className||"fsp-icon--video-start"===n.className){var r=document.getElementsByClassName("fsp-button--video")[0];r&&(r.style.pointerEvents="none"),e.timer=setInterval(function(){2===e.state.sec&&(r.style.pointerEvents="auto"),e.state.sec>=300?(e.setState({sec:0}),n.click(),clearInterval(e.timer)):e.setState({sec:e.state.sec+1})},1e3)}else"fsp-button fsp-button--cancel fsp-button--video"!==n.className&&"fsp-icon--video-stop"!==n.className||(e.setState({sec:0}),clearInterval(e.timer))}}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),this.picker.close()}},{key:"render",value:function(){return s.createElement("div",{className:"audio-browser-wrapper"},s.createElement("div",null,this.state.audioFile?s.createElement("div",{className:"audio-preview"},s.createElement("audio",{controls:!0},s.createElement("source",{src:this.state.audioFile,type:"audio/mpeg"})),s.createElement("div",{className:"audio-buttons row"},s.createElement("div",{className:"btn btn-pink",onClick:this.removeAudioFromItem},"Remove"),s.createElement("div",{className:"btn",onClick:this.addAudioToItem},"Add"))):s.createElement("div",{className:"audio-recorder-wrapper"},s.createElement("div",{className:"audio-timer"},(0,u.formattedTimer)(this.state.sec),"/5:00"),s.createElement("div",{id:"audio-panel"}))))}}]),t}(),m=(0,c.connect)(function(e){var t=e.buncee.selected_items,n=a.keys(t).filter(function(n){return void 0!==t[n]&&null!==t[n]&&t[n].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),r=e.user;return{selectedItem:n[0],user:r}},function(e,t){return{updateItem:function(t,n,r){e(o.Actions.updateItem({path:t+(n.length>0?"."+n:n),value:r}))},closeGateway:function(){e(o.Actions.closeGateway({}))}}})(f);t.ConnectedAudioBrowser=m},218:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultTabs=t.fetchTabs=t.resultToCanvasMap=t.resultsFetchMap=t.resultsFetchMoreMap=t.assetTracking=t.StitchBrowser=t.ColorBrowser=t.ConnectedUploadBrowser=t.OmniBrowser=t.WebContentBrowser=t.BunceeAssetBrowser=t.ConnectedItemgateway=t.ConnectedAudioBrowser=t.ConnectedHOCResults=t.Tabs=t.BrowserHeader=t.ConnectedHOCBrowser=void 0,t.InfoForBrowserType=function(e){return w[e]};var r=n(637),o=n(143),i=n(636),a=n(635),s=n(308),c=n(479),l=n(217),u=g(n(118)),d=g(n(216)),p=n(477),f=g(n(476)),m=n(475),h=g(n(200)),v=n(199),y=g(n(162)),b=n(474);function g(e){return e&&e.__esModule?e:{default:e}}var w={itemgateway:{default_tab:void 0,default_browser_componentType:p.ConnectedItemgateway},background:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},sticker:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},animation:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},message:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},three_d:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},web:{default_tab:void 0,default_browser_componentType:y.default},panorama:{default_tab:void 0,default_browser_componentType:y.default},youtube:{default_tab:void 0,default_browser_componentType:y.default},khanacademy:{default_tab:void 0,default_browser_componentType:y.default},omni:{default_tab:{name:"Buncee Art",guid:"omnibuncee",canonical_name:"omniBunceeArt",browser_component:u.default},default_browser_componentType:f.default},upload:{default_tab:{name:"Upload",guid:"upload",canonical_name:"upload",browser_component:v.ConnectedUploadBrowser},default_browser_componentType:v.ConnectedUploadBrowser},audio:{default_tab:{name:"Record",guid:"record",canonical_name:"record",browser_component:l.ConnectedAudioBrowser},default_browser_componentType:l.ConnectedAudioBrowser},emoji:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},default_browser_componentType:u.default},shape:{default_tab:{name:"Shape",guid:"",canonical_name:"shape",browser_component:u.default},default_browser_componentType:u.default},stitch:{default_tab:{name:"Stitch",guid:"",canonical_name:"stitch",browser_component:m.StitchBrowser},default_browser_componentType:m.StitchBrowser},template:{default_tab:{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:h.default},default_browser_componentType:h.default}};t.ConnectedHOCBrowser=s.ConnectedHOCBrowser,t.BrowserHeader=r.BrowserHeader,t.Tabs=b.Tabs,t.ConnectedHOCResults=c.ConnectedHOCResults,t.ConnectedAudioBrowser=l.ConnectedAudioBrowser,t.ConnectedItemgateway=p.ConnectedItemgateway,t.BunceeAssetBrowser=u.default,t.WebContentBrowser=y.default,t.OmniBrowser=f.default,t.ConnectedUploadBrowser=v.ConnectedUploadBrowser,t.ColorBrowser=d.default,t.StitchBrowser=m.StitchBrowser,t.assetTracking=o.assetTracking,t.resultsFetchMoreMap=o.resultsFetchMoreMap,t.resultsFetchMap=o.resultsFetchMap,t.resultToCanvasMap=i.resultToCanvasMap,t.fetchTabs=a.fetchTabs,t.getDefaultTabs=a.getDefaultTabs},219:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){var t=e.results;e.search_query&&(t=t.filter(function(t){if(t.title)return t.title.toLowerCase().indexOf(e.search_query.toLowerCase())>-1}));var n=t.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent})});return o.createElement("div",{className:["browser-results grid"].join(" "),id:"browser-results"},n.length>0?n:o.createElement("div",{className:"no-results-text"},"No results found"))}},254:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.translateActionToOperation=t.getHistoryItemValue=t.handleAction=void 0;var r=n(7),o=n(68),i=n(150),a=n(139),s=(t.handleAction=function(e,t){var n=l(e);void 0!==n&&t({type:"operational_transform",payload:{operation:n}});return n},function(e,t){if((0,r.isSetPayload)(e.payload)){var n=e.payload.path.match(/^([a-z0-9]+)\.content\.body/i);if(n){var o=t.buncee.document.items[n[1]];if(void 0!==o&&null!==o&&"text"===o.type)return!1}}return!!e.type.match(/^([a-z]*_){1}(slide|slides|item|items)(_.+)?$/i)||!!(0,r.isBatchActionPayload)(e.payload)}),c=t.getHistoryItemValue=function(e,t){var n=void 0;if((0,r.isAddItemPayload)(e.payload)||(0,r.isAddSlidePayload)(e.payload))n=(0,r.isAddItemPayload)(e.payload)?e.payload.item:e.payload.slide;else if((0,r.isRemovePayload)(e.payload)||(0,r.isSetPayload)(e.payload)){var i=u(e);n=o.Util.ObjectUtil.get(t.buncee,i)}return n},l=t.translateActionToOperation=function(e){var t=p(e);if(void 0!==t){var n=void 0;n=(0,r.isSetPayload)(e.payload)?e.payload.value:(0,r.isAddItemPayload)(e.payload)||(0,r.isAddSlidePayload)(e.payload)?(0,r.isAddItemPayload)(e.payload)?e.payload.item:e.payload.slide:(0,r.isBatchActionPayload)(e.payload)?e.payload.actions:void 0;var o=u(e);return i.OTKit.generateOperation(t,o,n)}},u=function(e){if((0,r.isBatchActionPayload)(e.payload))return"";var t=e.type.split("_");if(t.length<2)throw new Error("Invalid action type format for operations");var n=[];if("update_buncee"!==e.type&&n.push(t.slice(1).join("_")),"item"!==t[t.length-1]&&"slide"!==t[t.length-1]||(n[n.length-1]+="s"),d(n[n.length-1])&&n.unshift("document"),(0,r.isAddItemPayload)(e.payload))n.push(e.payload.item.id);else if((0,r.isRemovePayload)(e.payload)){var o=e.payload.id;n.push(JSON.stringify({id:o}))}else if((0,r.isSetPayload)(e.payload)){var i=e.payload.id;"string"==typeof i&&n.push(JSON.stringify({id:i})),"string"==typeof e.payload.path&&e.payload.path.length>1&&n.push(e.payload.path)}return n.join(".")},d=function(e){return-1!==["items","slides","canvas"].indexOf(e)},p=function(e){switch(e.type){case"add_slide":return o.OperationType.ADD;case"remove_slide":case"remove_item":return o.OperationType.REMOVE;case"update_item":case"update_slide":case"update_selected_item":case"update_selected_slide":case"update_canvas":case"add_item":case"update_buncee":return o.OperationType.SET;case"batch_actions":return o.OperationType.BATCH;default:return}};t.default=function(e){var t=e.dispatch,n=e.getState;return function(e){return function(o){var i=a.WebsocketClient.getInstance(),u=void 0,d=[],p=void 0;if((0,r.isBatchActionPayload)(o.payload)){var f=[];o.payload.actions.forEach(function(e){var t=l(e);void 0!==t&&(f.push({operation:t,timestamp:Date.now(),old_value:c(e,n())}),d.push(t))}),u=l(o),p=f}else"set_template"===o.type?(d.push(l(r.Actions.updateBuncee({path:"document",value:o.payload.document}))),d.push(l(r.Actions.updateBuncee({path:"title",value:o.payload.title}))),d.push(l(r.Actions.updateSlideSelected({path:n().user.id,value:o.payload.document.slides[0].id})))):(void 0!==(u=l(o))&&d.push(u),p=c(o,n()));if(s(o,n())&&void 0!==u){var m={type:"add_history",payload:{history_item:{operation:u,timestamp:Date.now(),old_value:p}}};t(m)}var h=[];return d.forEach(function(e){var n={type:"operational_transform",payload:{operation:e}};h.push(e),t(n)}),void 0!==i&&i.socket.connected&&"edit"===n().renderingMode&&h.length>0&&i.socket.emit("update-buncee-doc",{operations:h}),e(o)}}}},259:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewPanelTypes=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5),c=n(397),l=f(n(390)),u=f(n(389)),d=f(n(388)),p=f(n(387));function f(e){return e&&e.__esModule?e:{default:e}}var m=t.ViewPanelTypes=void 0;!function(e){e.TAGS="tags",e.COMMENTS="comments",e.CLIP_AND_STITCH="clip & stitch",e.IMAGE_ATTRIBUTION="image attribution"}(m||(t.ViewPanelTypes=m={}));var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.getPanelComponent=function(){switch(n.props.panelType){case m.TAGS:return a.createElement(p.default,null);case m.CLIP_AND_STITCH:return a.createElement(l.default,null);case m.COMMENTS:return a.createElement(u.default,null);case m.IMAGE_ATTRIBUTION:return a.createElement(d.default,null);default:return}},n.state={isOpen:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentDidMount",value:function(){this.setState({isOpen:!0})}},{key:"componentWillUnmount",value:function(){this.setState({isOpen:!1})}},{key:"render",value:function(){return a.createElement(c.CSSTransition,{in:void 0!==this.props.panelType&&null!==this.props.panelType,classNames:"view-panel",timeout:500,mountOnEnter:!0,unmountOnExit:!0},a.createElement("div",{className:"view-panel"},a.createElement("div",{className:"panel-header"},(0,i.startCase)(this.props.panelType),a.createElement("span",{className:"icon-cancel1 close",onClick:this.props.closePanel})),a.createElement("div",{className:"panel-content"},this.getPanelComponent())))}}]),t}();t.default=(0,s.connect)(function(e){return{buncee:e.buncee}},function(e){return{closePanel:function(){e(o.Actions.openViewPanel({viewPanel:null}))}}})(h)},260:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawImage=function(e,t,n,r,o,i,a){e.save(),e.translate(n.origin.x,n.origin.y),e.translate(n.width/2,n.height/2),e.rotate(o),e.scale(i?-1:1,a?-1:1),e.globalAlpha=r,e.drawImage(t,-n.width/2,-n.height/2,n.width,n.height),e.restore()}},261:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(6),s=n(414),c=(r=s)&&r.__esModule?r:{default:r},l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4);var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderCanvas=function(){var e=Object.assign({},n.props.canvasDimensions,{origin:{x:0,y:0}});c.default.enqueue(e,n.props.slide.background,n.props.items).then(function(e){n.canvasElement&&n.canvasElement.getContext("2d").drawImage(e,0,0,n.props.canvasDimensions.width,n.props.canvasDimensions.height)}).catch(function(){})},n.canvasElement=null,n.renderCanvas=(0,a.throttle)(n.renderCanvas,2e3,{leading:!0,trailing:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidCatch",value:function(){}},{key:"componentDidMount",value:function(){this.renderCanvas()}},{key:"componentDidUpdate",value:function(){this.props.isDirty&&(this.renderCanvas(),this.props.markSlideClean())}},{key:"shouldComponentUpdate",value:function(e){return!!e.isDirty||(this.props.isSelected!==e.isSelected||this.props.index!==e.index)}},{key:"render",value:function(){var e=this,t="boolean"!=typeof this.props.displayIndex||this.props.displayIndex,n=68/this.props.canvasDimensions.height;this.props.canvasDimensions.width*n>120&&(n=120/this.props.canvasDimensions.width);var r=this.props.canvasDimensions.width*n,o=this.props.canvasDimensions.height*n;return l.createElement("div",{className:"slide-thumbnail "+(this.props.isSelected?"selected":""),style:{width:r,height:o},onClick:function(){e.props.onClick(e.props.slide.id)}},l.createElement("canvas",{ref:function(t){e.canvasElement=t},width:this.props.canvasDimensions.width,height:this.props.canvasDimensions.height}),t&&l.createElement("span",{className:"slide-number"},this.props.prefix?this.props.prefix+" ":"",this.props.index+1))}}]),t}();p.defaultProps={onClick:function(){}};t.default=(0,u.connect)(function(e,t){var n=t.slide.items.map(function(t){return e.buncee.document.items[t]}).filter(function(e){return e});return{canvasDimensions:(0,d.getCanvasDimensions)(e.buncee.document.canvas),items:n,isDirty:e.dirtySlides.has(t.slide.id)}},function(e,t){return{markSlideClean:function(){e(i.Actions.markSlideClean({value:t.slide.id}))}}})(p)},262:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SlideBackgroundImage=t.SlideBackgoundColor=t.HOCSlideBackground=void 0;var r=a(n(422)),o=a(n(421)),i=a(n(420));function a(e){return e&&e.__esModule?e:{default:e}}t.HOCSlideBackground=r.default,t.SlideBackgoundColor=o.default,t.SlideBackgroundImage=i.default},263:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.componentForShapeType=u;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=c(n(429)),i=n(195),a=c(n(428)),s=c(n(427));function c(e){return e&&e.__esModule?e:{default:e}}var l={rectangle:a.default,ellipse:o.default,triangle:s.default,polygon:i.Polygon};function u(e){return l[e]}t.default=function(e){if("shape"!==e.item.content.type)throw new Error("Invalid item passed to shape");var t=u(e.item.content.attributes.type);return r.createElement(t,{item:e.item,mode:e.mode,displaySettings:e.displaySettings,style:e.style})}},264:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOembedUrlFromContent=t.fetchEmbedData=t.OembedItem=void 0;var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var c=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})};function l(e){return c(this,void 0,void 0,i.default.mark(function t(){var n,r,o;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.content,r=u(n),t.next=4,fetch(r).then(function(e){if(200!==e.status)throw new Error("Oembed endpoint request failed");return e.json()});case 4:return o=t.sent,t.abrupt("return",o);case 6:case"end":return t.stop()}},t,this)}))}function u(e){if(void 0===e.attributes||void 0===e.attributes.vendor_url)throw new Error("Invalid item: attributes field missing");if("string"!=typeof e.body)throw new Error("Invalid body content: type must string");var t=e.attributes.vendor_url,n=e.attributes.vendor_url.search(/\?[-a-z0-9@:%_\+.~#&//]+\b=[-a-z0-9@:%_\+.~#&//]+/i);return n>-1&&(t=t.substring(0,n)),t+"?url="+encodeURIComponent(e.body)}var d={embed_data:""},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=d,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getEmbedData&&this.props.getEmbedData(this.props.item).then(function(t){e.setState({embed_data:t})})}},{key:"render",value:function(){return"edit"===this.props.mode?s.createElement("img",{src:this.state.embed_data.thumbnail_url,width:this.props.item.frame.width,height:this.props.item.frame.height,style:this.props.style}):s.createElement("div",{className:"item-content",dangerouslySetInnerHTML:{__html:this.state.embed_data.html},style:this.props.style})}}]),t}();p.defaultProps={getEmbedData:l},t.OembedItem=p,t.fetchEmbedData=l,t.createOembedUrlFromContent=u},265:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function o(e){return e.stopPropagation(),e.preventDefault(),!1}var i=function(e){var t=e.label.replace("_","-"),n=["control",t];return e.label===e.active_label&&n.push("active"),e.size_large&&n.push("large"),r.createElement("div",{onDragStart:o,key:e.label,id:"control-"+t,className:n.join(" "),"data-transform":e.label})},a=function(e){var t=["transform-controls"],n=["rotation-connector"];return e.gridlines&&t.push("gridlines"),e.size_large&&n.push("large"),r.createElement("div",{className:t.join(" "),onDragStart:o,style:e.style},e.top_left&&r.createElement(i,{label:"top_left",active_label:e.active_label,size_large:e.size_large}),e.top_mid&&r.createElement(i,{label:"top_mid",active_label:e.active_label,size_large:e.size_large}),e.top_right&&r.createElement(i,{label:"top_right",active_label:e.active_label,size_large:e.size_large}),e.mid_left&&r.createElement(i,{label:"mid_left",active_label:e.active_label,size_large:e.size_large}),e.mid_mid&&r.createElement(i,{label:"mid_mid",active_label:e.active_label,size_large:e.size_large}),e.mid_right&&r.createElement(i,{label:"mid_right",active_label:e.active_label,size_large:e.size_large}),e.bottom_left&&r.createElement(i,{label:"bottom_left",active_label:e.active_label,size_large:e.size_large}),e.bottom_mid&&r.createElement(i,{label:"bottom_mid",active_label:e.active_label,size_large:e.size_large}),e.bottom_right&&r.createElement(i,{label:"bottom_right",active_label:e.active_label,size_large:e.size_large}),e.rotation&&r.createElement("div",{className:n.join(" ")}),e.rotation&&r.createElement(i,{label:"rotation",active_label:e.active_label,size_large:e.size_large}))};a.defaultProps={top_left:!0,top_mid:!0,top_right:!0,mid_left:!0,mid_mid:!1,mid_right:!0,bottom_left:!0,bottom_mid:!0,bottom_right:!0,rotation:!0},t.default=a},266:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedHOCItem=t.HOCItem=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(7),s=n(68),c=g(n(6)),l=b(n(148)),u=b(n(124)),d=g(n(0)),p=n(5),f=n(4),m=n(140),h=n(16),v=n(268),y=b(n(265));function b(e){return e&&e.__esModule?e:{default:e}}function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var w=60,_=20,E=50,k=200,O=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isDragging=!1,n.isSelected=function(){return n.props.selected_by_user&&n.props.selected_by_user.id===n.props.user.id||!1},n.getFrameAndRotation=function(e){var t=n.state.item.frame.origin.space,r=void 0;if(null===(r="string"==typeof e?document.getElementById(e):document.getElementById(n.state.item.id)))throw new Error("Root element is not available.");var o={width:r.style.width?parseInt(r.style.width,10):200,height:r.style.height?parseInt(r.style.height,10):200,origin:{x:c.toNumber(r.style.left?r.style.left.substring(0,r.style.left.length-2):0),y:c.toNumber(r.style.top?r.style.top.substring(0,r.style.top.length-2):0),space:t}},i=(r.style.transform||"").match(/rotate\(([0-9\.\-]+)rad\)/);return{frame:o,rotation:i?c.toNumber(i[1]):0}},n.addTouchListeners=function(){document.body.addEventListener("touchmove",n.handleMoveEvent),document.body.addEventListener("touchend",n.handleMouseOrTouchEndEvent,{once:!0})},n.removeTouchListeners=function(){document.body.removeEventListener("touchmove",n.handleTouchMove),document.body.removeEventListener("touchend",n.handleMouseOrTouchEndEvent)},n.addMouseListeners=function(){document.body.addEventListener("mousemove",n.handleMoveEvent),document.body.addEventListener("mouseup",n.handleMouseOrTouchEndEvent,{once:!0})},n.removeMouseListeners=function(){document.body.removeEventListener("mousemove",n.handleMoveEvent),document.body.removeEventListener("mouseup",n.handleMouseOrTouchEndEvent)},n.eventOriginFromEvent=function(e){var t=f.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings),r=n.state.item,o=60+r.frame.height/2,i=Math.PI/2-r.rotation;return{point:t,item:Object.assign({},(0,l.default)(r),{rotation_origin:{x:t.x-Math.cos(i)*o,y:t.y+Math.sin(i)*o,space:t.space}}),target:e.target}},n.handleMouseDownOrTouchStart=function(e){(function(e,t){var n="drawing"===e.type,r="group"===e.type;if(n&&!e.locked)return!0;if(r&&!e.locked)return!0;if(!n&&!r&&e.locked)return!0;if(t.isPanning)return!0;return!1})(n.state.item,n.props.displaySettings)||(n.eventOrigin=n.eventOriginFromEvent(e),n.rootElement&&(n.rootElement.style.willChange="top, left, width, height, transform"),Object.hasOwnProperty("touches")&&Array.isArray(e.touches)?(n.initDragTimeout=window.setTimeout(n.initDragCallback,k),window.addEventListener("mouseup",n.handleMouseOrTouchEndEvent,{once:!0}),window.addEventListener("touchend",n.handleMouseOrTouchEndEvent,{once:!0})):n.initDragCallback())},n.initDragCallback=function(){n.addTouchListeners(),n.addMouseListeners(),n.isDragging=!0},n.handleMoveEvent=function(e){if("edit"===n.props.mode){if(!n.eventOrigin)return n.removeMouseListeners(),void n.removeTouchListeners();var t=f.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings),r=n.eventOrigin.target.dataset.transform;if("rotation"===r){var o=f.GeometryUtil.angleBetweenPoints(t,n.eventOrigin.item.rotation_origin),i=Math.round(1e4*(o+Math.PI/2))/1e4;n.applyNewRotation(i)}else{var a=f.GeometryUtil.differenceBetweenPoints(t,n.eventOrigin.point,n.props.displaySettings.scale);void 0!==r&&(a=f.GeometryUtil.rotatePoint(a,-1*n.eventOrigin.item.rotation),n.setState({offset:a}));var s=S(n.eventOrigin.item.frame,a,-1*n.eventOrigin.item.rotation,r);if(s.width>=_&&s.height>=E&&(n.props.preferences.gridlines.value&&n.displayNearestGridlines(s),n.isValidItemPosition(s)&&(n.applyNewFrame(s),n.setState({item:Object.assign({},n.state.item,{frame:s})})),void 0!==r&&"group"===n.eventOrigin.item.type)){var l=s.width/n.eventOrigin.item.frame.width,u=s.height/n.eventOrigin.item.frame.height;c.each(n.eventOrigin.item.content.body,function(e){var t=f.GeometryUtil.scaleRect(e.frame,l,u);n.applyNewFrame(t,e.id)})}}}},n.handleMouseOrTouchEndEvent=function(e){if(window.clearTimeout(n.initDragTimeout),n.isDragging=!1,n.handleMoveEvent.cancel(),n.rootElement&&(n.rootElement.style.willChange="auto"),"edit"===n.props.mode){if("function"==typeof n.props.handleClick&&n.eventOrigin){var t=f.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings),r=f.GeometryUtil.differenceBetweenPoints(t,n.eventOrigin.point,n.props.displaySettings.scale);Math.abs(r.x)<10&&Math.abs(r.y)<10&&n.props.handleClick(e,n.state.item)}var o=n.getFrameAndRotation();if((!n.props.parent||n.props.parent&&!n.props.parent.locked)&&n.itemDidChange(n.props.item,o.frame,o.rotation)){var i=n.state.item.content;if("group"===n.state.item.type){var a=n.state.item.content.body.map(function(e){return Object.assign({},e,n.getFrameAndRotation(e.id))});i=Object.assign({},i,{body:a})}n.props.updateItem("",Object.assign({},n.state.item,o,{content:i}))}n.hideAllGridlines()}else{var s=!1;void 0!==n.itemActionsElement&&n.itemActionsElement.contains(e.target)&&(s=!0),f.Device.isIPadOrIPhone()||f.Device.isMobile()||s||"image"!==n.props.item.type&&"qrcode"!==n.props.item.type||n.props.openModal("itempreview",{item:n.props.item})}n.eventOrigin=void 0,n.setState({offset:void 0}),n.removeMouseListeners(),n.removeTouchListeners()},n.updateStateItem=function(e,t){n.setState(s.Util.ObjectUtil.set(n.state,"item."+e,t))},n.audioEnded=function(){n.setState({audio_is_playing:!1})},n.toggleAudioState=function(){void 0!==n.props.item.audio&&(n.state.audio_is_playing?(n.audioElement.pause(),n.setState({audio_is_playing:!1})):(n.audioElement.play(),n.setState({audio_is_playing:!0})))},n.isValidItemPosition=function(e){var t=180*n.props.item.rotation/Math.PI,r=(0,m.enclosingRotatedFrame)(e,t),o=Math.max(40,.1*r.height),i=Math.max(40,.1*r.width),a=(0,h.getCanvasDimensions)(n.props.canvas);return!(r.origin.y<0&&r.height+r.origin.y<o)&&(!(r.origin.y+o>a.height)&&(!(r.origin.x<0&&r.width+r.origin.x<i)&&!(r.origin.x+i>a.width)))},n.itemDidChange=function(e,t,n){return e.rotation!==n||(e.frame.width!==t.width||e.frame.height!==t.height||e.frame.origin.x!==t.origin.x||e.frame.origin.y!==t.origin.y)},n.displayNearestGridlines=function(e){for(var t=(0,h.getBucket)(e.origin.x,e.origin.y,n.props.canvas),r=(0,h.getBucket)(e.origin.x+e.width,e.origin.y+e.height,n.props.canvas),o=[],i=0;i<r.row-t.row;i++)o.push(".gridline-row-"+i+":not(.gridline-"+n.props.item.id+")");for(var a=0;a<r.column-t.column;a++)o.push(".gridline-col-"+a+":not(.gridline-"+n.props.item.id+")");if(n.hideAllGridlines(),0!==o.length){var s=document.querySelectorAll(o.join(", ")),l=[];c.forEach(s,function(t){if(!t.classList.contains("gridline-"+n.props.item.id)){var r=parseInt(t.style.left,10),o=parseInt(t.style.top,10),i=!1,a=!1,s=t.classList[1].split("-")[1],c=new Set;if(t.classList.contains("vertical")){var u=Math.round(Math.abs(e.origin.x-r)),d=Math.round(Math.abs(e.origin.x+e.width/2-r)),p=Math.round(Math.abs(e.origin.x+e.width-r));(u<10||d<10||p<10)&&(i=!0),(u<=1||d<=1||p<=1)&&(t.classList.contains("gridline-left")?c.add("top_left").add("mid_left").add("bottom_left"):t.classList.contains("gridline-mid")?c.add("top_mid").add("bottom_mid"):t.classList.contains("gridline-right")&&c.add("top_right").add("mid_right").add("bottom_right"),a=!0)}if(t.classList.contains("horizontal")){var f=Math.round(Math.abs(e.origin.y-o)),m=Math.round(Math.abs(e.origin.y+e.height/2-o)),h=Math.round(Math.abs(e.origin.y+e.height-o));(f<10||m<10||h<10)&&(i=!0),(f<=1||m<=1||h<=1)&&(t.classList.contains("gridline-top")?c.add("top_left").add("top_mid").add("top_right"):t.classList.contains("gridline-mid")?c.add("mid_left").add("mid_right"):t.classList.contains("gridline-bottom")&&c.add("bottom_left").add("bottom_mid").add("bottom_right"),a=!0)}!t.classList.contains("visible")&&i&&(t.classList.add("visible"),a&&(t.classList.add("touches"),l.push({id:s,intersects:c})))}}),n.props.setGridlineIntersect(l)}},n.hideAllGridlines=function(){c.forEach(document.getElementsByClassName("gridline"),function(e){e.classList.remove("visible"),e.classList.remove("touches")}),n.props.setGridlineIntersect([])},n.getTransformLabelProps=function(){if("object"===o(n.props.transform_controls))return n.props.transform_controls;var e=!("group"===n.props.item.type||"video"===n.props.item.type||"three_d"===n.props.item.type);if(void 0!==n.props.gridlineIntersect){var t=n.props.gridlineIntersect.intersects;return{top_left:t.has("top_left"),top_mid:t.has("top_mid"),top_right:t.has("top_right"),mid_left:t.has("mid_left"),mid_right:t.has("mid_right"),bottom_left:t.has("bottom_left"),bottom_mid:t.has("bottom_mid"),bottom_right:t.has("bottom_right"),rotation:!1,gridlines:!0}}return{top_mid:e,mid_left:e,mid_right:e,bottom_mid:e}},n.shouldRenderTransformControls=function(e,t){var r=n.props.item,i=n.props.mode;return!(void 0===n.props.selected_by_user)&&("edit"===i&&("group"===r.type?r.locked:"drawing"===r.type?r.locked:void 0!==e||!r.locked&&"object"===(void 0===t?"undefined":o(t))))},n.handleMoveEvent=(0,u.default)(n.handleMoveEvent,1e3/w),n.state={item:e.item,show_transform_controls:"object"===o(e.transform_controls)||!1,audio_is_playing:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.Component),i(t,[{key:"componentDidCatch",value:function(){}},{key:"componentDidUpdate",value:function(e){if(e.offset!==this.props.offset&&void 0!==this.props.offset){var t=S(this.props.item.frame,this.props.offset,this.props.item.rotation,"top_right");this.applyNewFrame(t)}c.isEqual(e.item,this.props.item)||(this.applyNewFrame(this.props.item.frame),this.setState({item:this.props.item}))}},{key:"componentDidMount",value:function(){if("three_d"===this.props.item.type){var e=document.querySelector("#model-viewer");if(e){var t=e.shadowRoot;if(t){var n=t.querySelector(".container"),r=t.querySelector("canvas");r&&(r.style.outline="none"),"view"===this.props.mode&&(f.Device.isSafari()||f.Device.isIPadOrIPhone())&&(n&&(n.style.width="100%",n.style.height="100%"),r&&(r.setAttribute("width",this.props.item.frame.width+"px"),r.setAttribute("height",this.props.item.frame.height+"px")))}}}}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=(0,v.componentForItemType)(this.state.item.type),n=this.state.item,i="square"===this.props.canvas.size_type,a="object"===o(this.props.transform_controls)?this.props.transform_controls:this.shouldRenderTransformControls(this.props.gridlineIntersect,this.props.selected_by_user),s=function(e,t){return{pointerEvents:e.locked!==("group"===e.type)?"none":"auto",zIndex:"auto",width:e.frame.width+"px",height:e.frame.height+"px",top:e.frame.origin.y+"px",left:e.frame.origin.x+"px",WebkitTransform:"\n\t\t\tskewx("+e.skewX+"rad)\n\t\t\tskewy("+e.skewY+"rad)\n\t\t\trotate("+e.rotation+"rad)\n\t\t",transform:"\n\t\t\tskewx("+e.skewX+"rad)\n\t\t\tskewy("+e.skewY+"rad)\n\t\t\trotate("+e.rotation+"rad)\n\t\t",userSelect:"edit"===t?"inherit":"none"}}(n,this.props.mode),c=function(e,t){return{transform:"\n\t\t\tscalex("+(e.flipH?-1:1)+")\n\t\t\tscaley("+(e.flipV?-1:1)+")\n\t\t",WebkitTransform:"\n\t\t\tscalex("+(e.flipH?-1:1)+")\n\t\t\tscaley("+(e.flipV?-1:1)+")\n\t\t",opacity:e.opacity}}(n,this.props.mode),l=this.isSelected();l?s.zIndex=99999:(s.zIndex=this.props.index+10,"drawing"===n.type&&(s.pointerEvents="none"));var u=["hoc-item"];return a&&u.push("selected"),f.Device.isMobile()&&u.push("mobile"),d.createElement("div",{ref:function(t){return t&&(e.rootElement=t)},key:n.id,id:n.id,style:s,className:u.join(" "),onTouchStart:this.props.event_listeners?this.handleMouseDownOrTouchStart:void 0,onMouseDown:this.props.event_listeners?this.handleMouseDownOrTouchStart:void 0},d.createElement("div",{className:"relative-wrapper w-100 h-100"},d.createElement(t,{key:"item",item:n,mode:this.props.mode,displaySettings:this.props.displaySettings,is_selected:l,style:c,handleClick:this.props.handleClick,offset:this.state.offset,links:this.props.links}),d.createElement("div",{className:"item-actions",ref:function(t){return e.itemActionsElement=t}},this.props.item.link&&"edit"!==this.props.mode&&d.createElement("a",{href:this.props.item.link,target:"_blank"},d.createElement("div",{className:"item-icon item-link"},d.createElement("span",{className:"icon-link"})))),this.props.item.audio&&"edit"!==this.props.mode&&d.createElement("div",{className:"item-actions audio",ref:function(t){return e.itemActionsElement=t}},d.createElement("div",{className:"item-icon item-audio"},d.createElement("audio",{src:this.props.item.audio,onEnded:this.audioEnded,ref:function(t){return e.audioElement=t}}),d.createElement("span",{className:this.state.audio_is_playing?"icon-pause1":"icon-play1",onClick:this.toggleAudioState}))),a&&d.createElement(y.default,r({key:"controls"},this.getTransformLabelProps(),{size_large:i}))))}},{key:"applyNewFrame",value:function(e,t){var n=this;window.requestAnimationFrame(function(){var r=void 0;if(!(r="string"==typeof t?document.getElementById(t):n.rootElement))throw new Error("Root element is not available.");r.style.top=e.origin.y+"px",r.style.left=e.origin.x+"px",r.style.width=e.width+"px",r.style.height=e.height+"px"})}},{key:"applyNewRotation",value:function(e){var t=this;window.requestAnimationFrame(function(){if(!t.rootElement)throw new Error("Root element is not available.");var n=t.rootElement.style.transform;"string"==typeof n&&n.indexOf("rotate")>-1?t.rootElement.style.transform=n.replace(/rotate\(([0-9\.\-]+)rad\)/i,"rotate("+e+"rad)"):t.rootElement.style.transform=n+" rotate("+e+"rad"})}}]),t}();function S(e,t,n,r){var o=void 0;switch(r){default:return f.GeometryUtil.offsetRect(t,e);case"top_left":return o={x:t.y*(e.width/e.height),y:t.y,space:t.space},f.GeometryUtil.resizeRectFromTopLeft(o,e,n);case"top_mid":return f.GeometryUtil.resizeRectFromTopMid(t,e,n);case"top_right":return o={x:t.y*(e.width/e.height)*-1,y:t.y,space:t.space},f.GeometryUtil.resizeRectFromTopRight(o,e,n);case"mid_left":return f.GeometryUtil.resizeRectFromMidLeft(t,e,n);case"mid_right":return f.GeometryUtil.resizeRectFromMidRight(t,e,n);case"bottom_left":return o={x:t.y*(e.width/e.height)*-1,y:t.y,space:t.space},f.GeometryUtil.resizeRectFromBottomLeft(o,e,n);case"bottom_mid":return f.GeometryUtil.resizeRectFromBottomMid(t,e,n);case"bottom_right":return o={x:t.y*(e.width/e.height),y:t.y,space:t.space},f.GeometryUtil.resizeRectFromBottomRight(o,e,n)}}O.defaultProps={event_listeners:!0,mode:"edit",handleClick:function(){}};var P=(0,p.connect)(function(e,t){var n=e.buncee.selected_items,r=n[t.item.id]&&null!==n[t.item.id]?n[t.item.id]:void 0,o=c.find(e.gridlineIntersects,function(e){return e.id===t.item.id}),i=e.links;return{selected_by_user:r,user:e.user,mode:e.renderingMode,displaySettings:e.displaySettings,canvas:e.buncee.document.canvas,preferences:e.preferences,gridlineIntersect:o,links:i}},function(e,t){return{updateItem:function(n,r){var i="function"==typeof t.getItemIdForUpdate?t.getItemIdForUpdate():t.item.id;"function"==typeof t.mutatePathforUpdate&&(n=t.mutatePathforUpdate(n));var s=[];if("object"!==o(t.parent)||t.parent.locked)s.push(a.Actions.updateItem({path:""+i+(n.length>0?"."+n:n),value:r}));else{var l=t.parent,u=l.content.body,d=[];c.forEach(u,function(e,n){if(e.id!==t.item.id){var o=Object.assign({},e.frame,{origin:{x:e.frame.origin.x+l.frame.origin.x,y:e.frame.origin.y+l.frame.origin.y,space:e.frame.origin.space}});d.push(o),u[n]=Object.assign({},u[n],{frame:o})}else{var i=Object.assign({},r.frame,{origin:{x:r.frame.origin.x+l.frame.origin.x,y:r.frame.origin.y+l.frame.origin.y,space:l.frame.origin.space}});d.push(i),u[n]=Object.assign({},u[n],{frame:i})}});var p=f.GeometryUtil.enclosingRect.apply(f.GeometryUtil,d);c.forEach(u,function(e,t){u[t]=Object.assign({},u[t],{frame:Object.assign({},e.frame,{origin:{x:e.frame.origin.x-p.origin.x,y:e.frame.origin.y-p.origin.y,space:e.frame.origin.space}})})}),s.push(a.Actions.updateItem({path:""+t.parent.id,value:Object.assign({},t.parent,{frame:p,content:Object.assign({},t.parent.content,{body:u})})}))}e(a.Actions.batchActions({actions:s}))},updateSelectedItems:function(t,n){e(a.Actions.updateItemsSelected({id:t,path:t,value:n}))},openModal:function(t,n){e(a.Actions.openModal({type:t,props:n}))},setGridlineIntersect:function(t){e(a.Actions.setGridlineIntersect({value:t}))}}})(O);t.HOCItem=O,t.ConnectedHOCItem=P},267:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyCanvasRenderingContext2D=t.DrawingCanvas=void 0,t.classForBrushStyle=function(e){return s[e]};var r=n(438);Object.defineProperty(t,"DrawingCanvas",{enumerable:!0,get:function(){return a(r).default}});var o=n(196);Object.defineProperty(t,"ProxyCanvasRenderingContext2D",{enumerable:!0,get:function(){return a(o).default}});var i=n(437);function a(e){return e&&e.__esModule?e:{default:e}}Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s={CUBIC_BEZIER_BRUSH:a(n(436)).default}},268:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeDItem=t.VideoItem=t.VimeoItem=t.YoutubeItem=t.TransformControls=t.OembedItem=t.ItemTypeComponentMap=t.ImageItem=t.HOCItem=t.GroupItem=t.ConnectedHOCItem=t.createOembedUrlFromContent=void 0,t.componentForItemType=function(e){return w[e]};var r=g(n(441)),o=n(439),i=g(n(435)),a=g(n(102)),s=n(266),c=g(n(433)),l=g(n(432)),u=n(264),d=g(n(431)),p=g(n(430)),f=g(n(263)),m=g(n(426)),h=g(n(265)),v=g(n(425)),y=g(n(424)),b=g(n(423));function g(e){return e&&e.__esModule?e:{default:e}}var w={image:c.default,text:m.default,drawing:o.ConnectedDrawingItem,video:v.default,panoramic:d.default,oembed:u.OembedItem,youtube:b.default,vimeo:y.default,group:a.default,shape:f.default,soundcloud:u.OembedItem,qrcode:p.default,frq:i.default,mcq:l.default,three_d:r.default};t.createOembedUrlFromContent=u.createOembedUrlFromContent,t.ConnectedHOCItem=s.ConnectedHOCItem,t.GroupItem=a.default,t.HOCItem=s.HOCItem,t.ImageItem=c.default,t.ItemTypeComponentMap=w,t.OembedItem=u.OembedItem,t.TransformControls=h.default,t.YoutubeItem=b.default,t.VimeoItem=y.default,t.VideoItem=v.default,t.ThreeDItem=r.default},269:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(119),a=n(197),s=(r=a)&&r.__esModule?r:{default:r};for(var c=s.default.import("formats/font"),l=s.default.import("attributors/style/size"),u=s.default.import("modules/clipboard"),d=s.default.import("delta"),p=1;p<=800;p++)l.whitelist.push(p+"px");c.whitelist=Object.keys(i.Fonts),s.default.register(c,!0),s.default.register(l,!0);var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u),o(t,[{key:"onPaste",value:function(e){e.preventDefault();var t=this.quill.getSelection(),n=e.clipboardData.getData("text/plain"),r=(new d).retain(t.index).delete(t.length).insert(n),o=n.length+t.index;this.quill.updateContents(r,"silent"),this.quill.setSelection(o,0,"silent"),this.quill.scrollIntoView()}}]),t}();s.default.register("modules/clipboard",f,!0),t.default=s.default},270:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToS3=function(e,t,n){var o={filename:e,path:t,location:"s3"};return r.upload(n,{},o)};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(453)).init(window.config.filestack);t.default=r},271:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(11),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(4),l=n(215),u=(r=l)&&r.__esModule?r:{default:r};var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleUpdate=function(e){"function"==typeof n.props.updateItem?n.props.updateItem("color",e):c.QuillSingleton.format("color",e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:"render",value:function(){var e=this.getColor(),t=s.createElement("div",null,s.createElement("div",{className:"current-color",style:{backgroundColor:e}}),s.createElement("span",{className:"label"},"Text Color"));return s.createElement("div",{className:"toolbar-button",id:"brush-color",onClick:this.props.onClick},s.createElement(a.PopupMenu,{text:"Color",showMenu:this.props.showMenu,buttonContent:t,popDirection:this.props.direction||"up"},this.props.showMenu&&s.createElement("div",{className:"toolbar-color"},s.createElement(u.default,{color:e,mode:this.props.mode||"popup",handleSelect:this.handleUpdate}))))}},{key:"getColor",value:function(){if(this.props.item)return this.props.item.content.attributes.color;var e="#000";try{var t=c.QuillSingleton.getInstance();t&&(e=t.getFormat(0,0).color||"#000","object"===(void 0===(e=t.getFormat().color||"#000")?"undefined":o(e))&&(e=e[0]))}catch(e){}return e}}]),t}();t.default=d},272:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextToolbarButton=t.TextFontSizeSelector=t.TextFontSelector=t.TextAlignmentSelector=t.ListButton=void 0;var r=c(n(472)),o=c(n(471)),i=c(n(470)),a=c(n(469)),s=c(n(468));function c(e){return e&&e.__esModule?e:{default:e}}t.ListButton=a.default,t.TextAlignmentSelector=r.default,t.TextFontSelector=o.default,t.TextFontSizeSelector=i.default,t.TextToolbarButton=s.default},273:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(7),s=n(119),c=n(11),l=n(6),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),d=n(5),p=n(4),f=n(272),m=w(n(198)),h=w(n(271)),v=w(n(467)),y=n(84),b=w(y),g=w(n(83));function w(e){return e&&e.__esModule?e:{default:e}}var _=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.textFormat={font:"raleway",color:"#000000",size:"60px"},n.onQuillChange=function(e){if(p.Device.isIPadOrIPhone()){var t=p.QuillSingleton.getInstance();null!==t&&t.hasFocus()?n.setState({selectedButton:""}):n.forceUpdate()}else null!==p.QuillSingleton.getInstance()&&(p.QuillSingleton.getInstance().hasFocus()||p.Device.isIPadOrIPhone())&&n.forceUpdate();"text-change"!==e&&"selection-change"!==e||n.saveLastTextFormat()},n.saveLastTextFormat=function(){var e=p.QuillSingleton.getInstance();if(e&&e.getText().length>1){var t=void 0;try{t=e.getFormat()}catch(n){t=e.getFormat(0,0)}n.textFormat={color:t.color,font:t.font,size:t.size}}else e&&1===e.getText().length&&(n.textFormat.color&&p.QuillSingleton.format("color",n.textFormat.color),n.textFormat.font&&p.QuillSingleton.format("font",n.textFormat.font),n.textFormat.size&&p.QuillSingleton.format("size",n.textFormat.size))},n.renderOpacitySlider=function(e){return u.createElement("div",{key:"opacity",className:"toolbar-button opacity-slider",id:"opacity",onClick:n.handleButtonClick},u.createElement(c.PopupMenu,{text:"Text Opacity",showMenu:"opacity"===n.state.selectedButton,icon:"icon-opacity",iconPosition:"top",popDirection:e||"up"},u.createElement(c.Slider,{onChange:function(e){n.setOpacity(e)},minValue:0,maxValue:100,unit:"%",step:10,value:100*n.getOpacity()})))},n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t&&n.updateSelectedButton(e.currentTarget.id)},n.openMenu=function(e){n.updateSelectedButton(e)},n.closeMenu=function(){n.updateSelectedButton("")},p.QuillSingleton.subscribe(n.onQuillChange),n.state={selectedButton:"",numFittable:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,b.default),o(t,[{key:"componentWillUnmount",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this),p.QuillSingleton.unsubscribe(this.onQuillChange)}},{key:"getButtons",value:function(){return this.props.mode===y.ToolbarMode.STANDALONE?this.getStandaloneButtons():p.QuillSingleton.isEnabled()&&!p.Device.isIPadOrIPhone()?this.getQuillButtons():this.getItemButtons()}},{key:"getItemButtons",value:function(){var e=this,n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return n.push.apply(n,[u.createElement(g.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),u.createElement("div",{key:"spacer-1",className:"spacer"}),u.createElement(g.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),u.createElement("div",{key:"spacer-2",className:"spacer"}),u.createElement(m.default,{key:"brush-color",id:"brush-color",text:"Fill Color",handleButtonClick:this.handleButtonClick,handleColorChange:function(t,n){e.handleUpdateBackgroundColor(t)},handleOpacity:function(t){e.handleUpdateOpacity(t)},showMenu:"brush-color"===this.state.selectedButton,color:this.props.selectedItem.content.attributes&&this.props.selectedItem.content.attributes.background_color||"#FFF",opacity:this.props.selectedItem.content.attributes&&this.props.selectedItem.content.attributes.background_opacity}),u.createElement("div",{key:"spacer-4",className:"spacer"}),this.renderCopyGroup(),u.createElement("div",{key:"spacer-8",className:"spacer"}),u.createElement("div",{key:"position-group",className:"toolbar-button-group"},u.createElement(g.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),u.createElement(g.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),u.createElement(g.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),n}},{key:"handleUpdateBackgroundColor",value:function(e){this.props.updateItem(this.props.selectedItem,"content.attributes.background_color",e)}},{key:"handleUpdateOpacity",value:function(e){this.props.updateItem(this.props.selectedItem,"content.attributes.background_opacity",e)}},{key:"getQuillButtons",value:function(){var e=void 0;e="string"==typeof this.textFormat.font?this.textFormat.font:Array.isArray(this.textFormat.font)?this.textFormat.font[0]:"raleway";var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return n.push.apply(n,[u.createElement(g.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),u.createElement("div",{key:"spacer-1",className:"spacer"}),u.createElement(v.default,{key:"text-link-input",showMenu:"link"===this.state.selectedButton,openMenu:this.openMenu,closeMenu:this.closeMenu}),u.createElement(g.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),u.createElement("div",{key:"spacer-2",className:"spacer"}),u.createElement(h.default,{key:"text-color-picker",closeMenu:this.closeMenu,showMenu:"brush-color"===this.state.selectedButton,onClick:this.handleButtonClick}),this.renderOpacitySlider(),u.createElement("div",{key:"spacer-3",className:"spacer"}),u.createElement(f.TextFontSelector,{key:"font-selector",closeMenu:this.closeMenu,showMenu:"text-font"===this.state.selectedButton,onClick:this.handleButtonClick}),u.createElement(f.TextFontSizeSelector,{key:"font-size-selector"}),u.createElement("div",{key:"spacer-4",className:"spacer"}),u.createElement("div",{key:"text-style-group",className:"toolbar-button-group no-individual-label-group"},s.Fonts[e].bold_enabled&&u.createElement(f.TextToolbarButton,{property:"bold",key:"bold",onClick:this.handleButtonClick}),u.createElement(f.TextToolbarButton,{property:"italic",key:"italic",onClick:this.handleButtonClick}),u.createElement(f.TextToolbarButton,{property:"underline",key:"underline",onClick:this.handleButtonClick}),u.createElement("span",{className:"label align"},"Style")),u.createElement("div",{key:"spacer-5",className:"spacer"}),u.createElement(f.ListButton,{key:"list-button"}),u.createElement("div",{key:"spacer-6",className:"spacer"}),u.createElement(f.TextAlignmentSelector,{key:"font-alignment-selector"}),u.createElement("div",{key:"spacer-7",className:"spacer"}),this.renderCopyGroup(),u.createElement("div",{key:"spacer-8",className:"spacer"}),u.createElement("div",{key:"position-group",className:"toolbar-button-group"},u.createElement(g.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),u.createElement(g.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),u.createElement(g.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),n}},{key:"getStandaloneButtons",value:function(){var e=void 0;e="string"==typeof this.textFormat.font?this.textFormat.font:Array.isArray(this.textFormat.font)?this.textFormat.font[0]:"raleway";var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return n.push.apply(n,[u.createElement(v.default,{key:"text-link-input",showMenu:"link"===this.state.selectedButton,openMenu:this.openMenu,closeMenu:this.closeMenu,direction:"down"}),u.createElement("div",{key:"spacer-2",className:"spacer"}),this.renderOpacitySlider("down"),u.createElement(h.default,{key:"text-color-picker",closeMenu:this.closeMenu,showMenu:"brush-color"===this.state.selectedButton,onClick:this.handleButtonClick,direction:"down",mode:"palette-only"}),u.createElement("div",{key:"spacer-3",className:"spacer"}),u.createElement(f.TextFontSelector,{key:"font-selector",closeMenu:this.closeMenu,showMenu:"text-font"===this.state.selectedButton,onClick:this.handleButtonClick,direction:"down"}),u.createElement(f.TextFontSizeSelector,{key:"font-size-selector"}),u.createElement("div",{key:"spacer-4",className:"spacer"}),u.createElement("div",{key:"text-style-group",className:"toolbar-button-group no-individual-label-group"},s.Fonts[e].bold_enabled&&u.createElement(f.TextToolbarButton,{property:"bold",key:"bold",onClick:this.handleButtonClick}),u.createElement(f.TextToolbarButton,{property:"italic",key:"italic",onClick:this.handleButtonClick}),u.createElement(f.TextToolbarButton,{property:"underline",key:"underline",onClick:this.handleButtonClick}),u.createElement("span",{className:"label align"},"Style")),u.createElement("div",{key:"spacer-5",className:"spacer"}),u.createElement(f.ListButton,{key:"list-button"}),u.createElement("div",{key:"spacer-6",className:"spacer"}),u.createElement(f.TextAlignmentSelector,{key:"font-alignment-selector"})]),n}},{key:"getID",value:function(){return"text-toolbar"}}]),t}();t.default=(0,d.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:n,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e,t){return{setItems:function(t,n){e(a.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(a.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(a.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(a.Actions.updateClipboard({path:"",value:t}))},updateItem:function(n,r,o){r=void 0!==t.selectedItemParent?t.selectedItemParent.id+'.content.body.{"id": "'+n.id+'"}'+(r.length>0?"."+r:r):n.id+(r.length>0?"."+r:r),e(a.Actions.updateItem({path:r,value:o}))},removeItem:function(t,n,r){e(a.Actions.batchActions({actions:[a.Actions.updateItemsSelected({path:n.id,value:null}),a.Actions.updateItem({path:"",value:(0,l.omit)(t,[n.id])}),a.Actions.updateSlide({id:r.id,path:"items",value:p.ArrayUtil.findAndRemove(r.items,function(e){return e===n.id})})]}))},updateTextDefaults:function(t){e(a.Actions.updateItemDefaults({path:"text",value:t}))},addItem:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.addItem({item:t}),a.Actions.updateSlide({id:n.id,path:"items",value:p.ArrayUtil.push(n.items,t.id)})]}))},addSlide:function(t,n,r){void 0===r?a.Actions.updateSlide({path:"",value:n}):e(a.Actions.batchActions({actions:[a.Actions.updateSlide({path:"",value:n}),a.Actions.updateItem({path:"",value:r}),a.Actions.updateSlideSelected({path:p.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(a.Actions.undoPrevAction({}))},redoPrevAction:function(){e(a.Actions.redoPrevAction({}))},openBrowser:function(t){e(a.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.updateItem({path:"",value:n}),a.Actions.updateSlide({path:"",value:t})]}))}}})(_)},307:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(4);var a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.renderPixabayMessage=function(){return!(e.props.selected_results.length>0)&&("web"===e.props.browser||!(!e.props.selected_tab||"backgroundWeb"!==e.props.selected_tab.canonical_name&&"omniWebImage"!==e.props.selected_tab.canonical_name))},e.shouldRenderPlaceholderText=function(){switch(e.props.browser){case"itemgateway":return"Search for Images, Videos, and Buncee Art";case"template":return"Search";default:return"Type a keyword to search"}},e.shouldRenderSearchBox=function(){var t=e.props.browser;return"audio"!==t&&"shape"!==t&&(!e.props.selected_tab||"Color"!==e.props.selected_tab.name&&"Upload"!==e.props.selected_tab.name&&"Record"!==e.props.selected_tab.name)},e.handleSearch=function(t){"Enter"===t.key&&(t.currentTarget&&t.currentTarget.blur(),e.props.handleSearch(e.searchField.value))},e.handleFocus=function(){e.searchField&&(e.searchField.placeholder="")},e.handleBlur=function(){e.searchField&&(e.searchField.placeholder=e.shouldRenderPlaceholderText())},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"render",value:function(){var e=this,t=["search-box"];return"itemgateway"===this.props.browser&&t.push("item-gateway"),(this.props.selected_tab&&("backgroundWeb"===this.props.selected_tab.canonical_name||"omniWebImage"===this.props.selected_tab.canonical_name)||"web"===this.props.browser)&&t.push("row"),this.shouldRenderSearchBox()?o.createElement("div",{className:t.join(" ")},o.createElement("input",{placeholder:this.shouldRenderPlaceholderText(),id:"browser-search-input",onKeyDown:function(t){t.stopPropagation(),e.handleSearch(t)},autoFocus:!i.Device.isIPadOrIPhone(),ref:function(t){return e.searchField=t},onFocus:this.handleFocus,onBlur:this.handleBlur}),this.renderPixabayMessage()?o.createElement("a",{id:"pixabay-disclaimer",href:"https://pixabay.com/",target:"_blank"},"Powered by Pixabay"):null):o.createElement("div",{className:"search-box"},o.createElement("input",{style:{visibility:"hidden"},onKeyDown:function(e){return e.stopPropagation()}}))}}]),t}();t.default=a},308:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedHOCBrowser=t.HOCBrowser=void 0;var r=y(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=v(n(6)),s=v(n(0)),c=n(5),l=n(4),u=y(n(165)),d=n(144),p=n(16),f=n(218),m=y(n(307)),h=y(n(118));function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.queueSelectedResults=function(e){n.setState({selected_results:e})},n.pushSelectedTab=function(e){"omni"===n.state.item_browser?n.setState({selected_tab:e,selected_results:[]}):n.setState({selected_tab:e,search_query:"",selected_results:[]})},n.addSelectedResults=function(){return w(n,void 0,void 0,r.default.mark(function e(){var t,n,o,i,s=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("background"!==this.state.item_browser){e.next=5;break}this.state.selected_tab&&this.state.selected_tab.browser_component===f.ColorBrowser?this.props.updateSlide({type:"color",body:this.state.selected_results[0].result_payload,attributes:{opacity:1}},this.props.slide):(this.props.updateSlide({type:"url",body:this.state.selected_results[0].result_payload,attributes:{opacity:1,x:0,y:0}},this.props.slide),this.state.selected_tab&&this.state.selected_tab.browser_component===h.default&&(0,f.assetTracking)(this.state.selected_results[0].id,this.props.bunceeId)),this.props.close(),e.next=25;break;case 5:if("audio"!==this.state.item_browser){e.next=10;break}this.props.updateItem(this.props.selectedItem.id,"audio",this.state.selected_results[0].result_payload),this.props.close(),e.next=25;break;case 10:if("stitch"!==this.state.item_browser){e.next=24;break}if(t=!1,n=this.state.selected_results.map(function(e){var n=JSON.parse(e.result_payload),r=(0,l.generateSlide)(n.slides[0]);return n.canvas.size_type!==s.props.canvas.size_type&&r.background&&(r=Object.assign({},r,{background:Object.assign({},r.background,{attributes:Object.assign({},r.background.attributes,{x:0,y:0})})})),{stitchSlide:r,stitchItems:n.items.map(function(e){if(e){var r=(0,l.generateItem)(e);if("mcq"===r.type){var o=(0,d.generateId)([],4),i={};a.forOwn(r.content.body.choices,function(e,t){i=t===r.content.body.correct_choice?Object.assign({},i,g({},o,e)):Object.assign({},i,g({},(0,d.generateId)([o],4),e))}),r=Object.assign({},r,{content:Object.assign({},r.content,{attributes:Object.assign({},r.content.attributes,{question_id:(0,d.generateId)([],16)}),body:Object.assign({},r.content.body,{choices:Object.assign({},i),correct_choice:o})})})}return"frq"===r.type&&(r=Object.assign({},r,{content:Object.assign({},r.content,{attributes:Object.assign({},r.content.attributes,{question_id:(0,d.generateId)([],16)})})})),"group"===r.type&&(r=Object.assign({},r,{content:Object.assign({},r.content,{body:a.map(r.content.body,function(e){return(0,l.generateItem)(e)})})})),n.canvas.size_type!==s.props.canvas.size_type?(t=!0,Object.assign({},r,{frame:Object.assign({},r.frame,{origin:Object.assign({},r.frame.origin,{x:(0,p.recalculateItemPosition)(r,n.canvas,s.props.canvas.size_type).x,y:(0,p.recalculateItemPosition)(r,n.canvas,s.props.canvas.size_type).y})})})):r}})}}),!t){e.next=20;break}return e.next=16,(0,u.default)("Creativity can get messy!\nStitching different canvas size may shuffle your masterpiece! Continue?","Stitch","No");case 16:e.sent?(this.props.stitch(n,this.props.slides,this.props.addAtIndex),this.props.close()):this.props.close(),e.next=22;break;case 20:this.props.stitch(n,this.props.slides,this.props.addAtIndex),this.props.close();case 22:e.next=25;break;case 24:"template"===this.state.item_browser?(o=this.state.selected_results[0].result_payload,this.props.setTemplate({canvas:o.canvas,slides:o.slides,items:o.items},"Template - "+o.title),this.props.updateDisplaySetting(o.canvas.size_type),(0,f.assetTracking)(this.state.selected_results[0].id,this.props.bunceeId),this.props.closeModal()):(i=[],this.state.selected_results.forEach(function(e){var t=(0,f.InfoForBrowserType)(s.state.item_browser).default_browser_componentType;s.state.selected_tab&&(t=s.state.selected_tab.browser_component);var n=(0,f.resultToCanvasMap)(s.state.item_browser,t,e,s.props.canvas);i.push(n),s.state.selected_tab&&s.state.selected_tab.browser_component===h.default&&(0,f.assetTracking)(e.id,s.props.bunceeId)}),this.props.selectedItem&&this.props.deselectItemSelected(this.props.selectedItem.id),document.getElementById("viewport").focus(),this.props.addItem(i,this.props.slide,this.props.user),this.props.close());case 25:case"end":return e.stop()}},e,this)}))},n.applyAllBackground=function(){var e=[];e=n.state.selected_tab&&n.state.selected_tab.browser_component===f.ColorBrowser?n.props.slides.map(function(e){return Object.assign({},e,{background:{type:"color",body:n.state.selected_results[0].result_payload,attributes:{opacity:1}}})}):n.props.slides.map(function(e){return Object.assign({},e,{background:{type:"url",body:n.state.selected_results[0].result_payload,attributes:{opacity:1,x:0,y:0}}})}),localStorage.setItem(window.config.buncee_guid,n.state.selected_results[0].result_payload),n.props.updateAllSlides(e),n.props.close()},n.handleBackClick=function(){n.setState({item_browser:"itemgateway",search_query:"",selected_tab:void 0,selected_results:[]})},n.handleSearch=function(e){e.length>0?(e=e.replace(" ","+"),"itemgateway"===n.state.item_browser?n.setState({item_browser:"omni",search_query:e,selected_results:[],selected_tab:(0,f.InfoForBrowserType)(n.state.item_browser).default_tab}):n.setState({search_query:e,selected_results:[]})):n.setState({search_query:"",selected_results:[],item_browser:"omni"===n.state.item_browser?"itemgateway":n.state.item_browser})},n.handleBrowserChange=function(e){n.setState({item_browser:e})},n.shouldRenderHeader=function(){return"template"!==n.props.browser},n.getStaticContent=function(){if("template"===n.props.browser)return s.createElement("div",null,s.createElement("img",{className:"buncee-logo",src:(0,p.cloudfrontURL)("/images/home/BunceeLogo-white.svg")}),s.createElement(m.default,{browser:n.props.browser,selected_results:n.state.selected_results,selected_tab:n.state.selected_tab,handleSearch:n.handleSearch}))},n.shouldRenderTabs=function(){return!!localStorage.hasOwnProperty(n.props.user.id)||"shape"!==n.state.item_browser&&("stitch"!==n.state.item_browser&&!!(0,f.InfoForBrowserType)(n.state.item_browser).default_tab)},n.state={item_browser:n.props.browser,search_query:"",selected_tab:void 0,selected_results:[],all_button_clicked:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidMount",value:function(){this.setState({selected_tab:(0,f.InfoForBrowserType)(this.state.item_browser).default_tab})}},{key:"componentDidUpdate",value:function(e,t){if(this.state.item_browser!==t.item_browser&&"omni"!==this.state.item_browser){this.setState({selected_tab:(0,f.InfoForBrowserType)(this.state.item_browser).default_tab,search_query:""});var n=document.getElementById("browser-search-input");n&&!l.Device.isIPadOrIPhone()&&(n.value="",n.focus())}}},{key:"render",value:function(){var e=this.shouldRenderTabs();return s.createElement("div",{className:"gateway "+this.props.browser+"-gateway"+(e?"":" no-tabs"),id:"gateway"},this.shouldRenderHeader()&&s.createElement(f.BrowserHeader,{key:"browserHeader",browser:this.state.item_browser,selected_results:this.state.selected_results,selected_tab:this.state.selected_tab,handleAddClick:this.addSelectedResults,handleAllClick:this.applyAllBackground,handleSearch:this.handleSearch,handleBack:this.handleBackClick,handleClose:this.props.close}),e?s.createElement(f.Tabs,{item_browser:this.state.item_browser,key:"tabs",pushSelectedTab:this.pushSelectedTab,staticContent:this.getStaticContent()}):null,s.createElement(f.ConnectedHOCResults,{key:"hocResults",item_browser:this.state.item_browser,selected_results:this.state.selected_results,selected_tab:this.state.selected_tab,search_query:this.state.search_query,queueSelectedresults:this.queueSelectedResults,handleBrowserChange:this.handleBrowserChange,handleClose:this.props.close,handleAddItems:this.addSelectedResults}))}}]),t}(),E=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.buncee.document.slides,o=e.user,i=e.buncee.id,s=e.buncee.selected_items;return{slides:r,slide:n,user:o,bunceeId:i,selectedItem:a.keys(s).filter(function(t){return void 0!==s[t]&&null!==s[t]&&s[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]})[0],canvas:e.buncee.document.canvas}},function(e,t){return{stitch:function(t,n,r){var o=[],a=n;t.forEach(function(e){var t={id:e.stitchSlide.id,items:e.stitchItems.filter(function(e){return e}).map(function(e){return e.id}),background:e.stitchSlide.background};a="number"==typeof r?l.ArrayUtil.insert(a,t,r):l.ArrayUtil.push(a,t),e.stitchItems.length>0&&e.stitchItems.forEach(function(e){o=l.ArrayUtil.push(o,i.Actions.addItem({item:e}))})}),e(i.Actions.batchActions({actions:[i.Actions.updateStore({path:"item_defaults",value:{}})].concat(b(o),[i.Actions.updateSlide({path:"",value:a}),i.Actions.updateSlideSelected({path:l.User.getUser().guid,value:t[t.length-1].stitchSlide.id})])}))},addItem:function(n,r,o){var a=r.items,s=[];n.length>0&&(n.forEach(function(e){s=l.ArrayUtil.push(s,i.Actions.addItem({item:e})),a="number"==typeof t.addAtIndex?l.ArrayUtil.insert(a,e.id,a.length-t.addAtIndex):l.ArrayUtil.push(a,e.id)}),e(i.Actions.batchActions({actions:[].concat(b(s),[i.Actions.updateSlide({id:r.id,path:"items",value:a}),i.Actions.updateStore({path:"item_defaults",value:{}})])})),e(i.Actions.updateItemsSelected({path:n[0].id,value:o})))},updateItem:function(t,n,r){e(i.Actions.updateItem({path:t+(n.length>0?"."+n:n),value:r}))},updateSlide:function(t,n){e(i.Actions.updateSlide({path:"background",id:n.id,value:t}))},updateAllSlides:function(t){e(i.Actions.updateSlide({path:"",value:t}))},deselectItemSelected:function(t){e(i.Actions.updateItemsSelected({path:t,value:null}))},setTemplate:function(t,n){e(i.Actions.setTemplate({document:t,title:n}))},closeModal:function(){e(i.Actions.openModal({type:void 0}))},updateDisplaySetting:function(t,n,r){e(i.Actions.updateStore({path:"displaySettings.scale",value:(0,l.getCanvasScale)({size_type:t,width:n||void 0,height:r||void 0})}));var o=100;"business-landscape"===t&&(o=50),"business-portrait"===t&&(o=75),"banner-landscape"===t&&(o=75),e(i.Actions.updateStore({path:"displaySettings.scaleOffset",value:o}))}}})(_);t.HOCBrowser=_,t.ConnectedHOCBrowser=E},309:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(5),s=n(308);var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"render",value:function(){var e=this,t=["browser-container"];return"modal"===this.props.mode&&t.push("modal"),void 0===this.props.activeBrowser?null:i.createElement("div",{className:t.join(" ")},"browser"===this.props.mode&&i.createElement("div",{className:"overlay",id:"overlay",onClick:this.props.closeActiveBrowser}),i.createElement(s.ConnectedHOCBrowser,{browser:this.props.activeBrowser,close:function(){e.props.closeActiveBrowser()},addAtIndex:this.props.addToIndex,mode:this.props.mode}))}}]),t}(),l=(0,a.connect)(function(e){return{addToIndex:void 0===e.gateway?void 0:e.gateway.addToIndex}},function(e){return{closeActiveBrowser:function(){e(o.Actions.closeGateway({}))}}})(c);t.default=l},310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"isIPadOrIPhone",value:function(){if(void 0!==this.cache.isIPadOrIPhone)return this.cache.isIPadOrIPhone;var e=navigator.userAgent,t=/iPad/i.test(e)||/iPhone OS 3_1_2/i.test(e)||/iPhone OS 3_2_2/i.test(e);return this.cache.isIPadOrIPhone=t,t}},{key:"isSafari",value:function(){if(void 0!==this.cache.isSafari)return this.cache.isSafari;var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return this.cache.isSafari=e,e}},{key:"isFirefox",value:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}},{key:"isWebView",value:function(){if(void 0!==this.cache.isWebView)return this.cache.isWebView;var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Version)/i.test(navigator.userAgent);return this.cache.isWebView=e,e}},{key:"isIpadPro",value:function(){if(void 0!==this.cache.isIpadPro)return this.cache.isIpadPro;var e=document.createElement("canvas");if(e){var t=e.getContext("webgl")||e.getContext("experimental-webgl");if(t){var n=t.getExtension("WEBGL_debug_renderer_info");if(n){var r=t.getParameter(n.UNMASKED_RENDERER_WEBGL);if(r){var o=!1;return"Apple A12X GPU"===r&&(o=!0),this.cache.isIpadPro=o,o}}}}return!1}},{key:"isMobile",value:function(){if(void 0!==this.cache.isMobile)return this.cache.isMobile;var e=screen.width<768;return this.cache.isMobile=e,e}},{key:"isLandscape",value:function(){var e=screen.msOrientation||(screen.orientation||screen.mozOrientation||{}).type||window.orientation;return"number"==typeof e?90===e||-90===e:"string"!=typeof e||e.indexOf("landscape")>-1}},{key:"isPortrait",value:function(){var e=screen.msOrientation||(screen.orientation||screen.mozOrientation||{}).type||window.orientation;return"number"==typeof e?0===e||180===e:"string"==typeof e&&e.indexOf("portrait")>-1}}]),e}();t.default=o,o.cache={}},311:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpgradeModal=t.TextEditorModal=t.TemplatesModal=t.InputModal=t.StitchModal=t.VideoRecordModal=t.SimultaneousEditModal=t.ShareModal=t.PhotoModal=t.MCQEditorModal=t.FRQEditorModal=t.CopyModal=t.ConfirmModal=t.CanvasResizeModal=void 0;var r=y(n(656)),o=y(n(654)),i=y(n(653)),a=y(n(652)),s=y(n(651)),c=y(n(650)),l=y(n(649)),u=y(n(643)),d=y(n(642)),p=y(n(641)),f=y(n(638)),m=y(n(473)),h=y(n(466)),v=y(n(465));function y(e){return e&&e.__esModule?e:{default:e}}t.CanvasResizeModal=r.default,t.ConfirmModal=o.default,t.CopyModal=i.default,t.FRQEditorModal=a.default,t.MCQEditorModal=c.default,t.PhotoModal=p.default,t.ShareModal=l.default,t.SimultaneousEditModal=u.default,t.VideoRecordModal=v.default,t.StitchModal=d.default,t.InputModal=s.default,t.TemplatesModal=f.default,t.TextEditorModal=m.default,t.UpgradeModal=h.default},312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRGBAString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n){return e+e+t+t+n+n});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?"rgba("+parseInt(n[1],16)+", "+parseInt(n[2],16)+", "+parseInt(n[3],16)+", "+t+")":null};var r=t.Colors=void 0;!function(e){e.RED="#c14234",e.BLUSH="#c04567",e.MANNY="#e75884",e.MINRAN="#f5a1c3",e.ORANGE="#ee6a49",e.JOSH="#f49f65",e.SAFFRON="#f7c333",e.ANNIE="#ffdc8d",e.GREEN="#1a941a",e.FRUIT_SALAD="#4eaa4e",e.PASTEL_GREEN="#83da83",e.MOSS="#95cd9d",e.MARINER="#2a75ba",e.JOEL="#5375fb",e.MELROSE="#a7bcfc",e.ZIGGURAT="#b5d6de",e.PURAV="#320852",e.PURPLE="#511280",e.VIOLET="#9626ea",e.TIM="#a16ecf",e.DARK_ADI="#42220b",e.BROWN="#754c24",e.OCHRE="#d07322",e.MAC_N_CHEESE="#ffbe85",e.BLACK="#000000",e.DARK_GREY="#5f5f5f",e.LIGHT_GREY="#d3d3d3",e.WHITE="#ffffff",e.BUNCEE_BLUE="#00a3a8",e.BUNCEE_CHERRY="#ec2e5e",e.BUNCEE_BLACK="#263238",e.BUNCEE_YELLOW="#fdbe13"}(r||(t.Colors=r={}))},313:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProperty=function(e,t){return e[t]}},318:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{payload:function(){return Object.assign(function(t){return{type:e,payload:t}},{type:e})}}}},362:function(e,t,n){},363:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(150),o=n(138);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.genericState,t=arguments[1];return"operational_transform"===t.type?Object.assign({},e,{buncee:Object.assign({},r.OTKit.apply(t.payload.operation))}):e}},364:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),o=n(254),i=n(150),a=n(4),s=n(139),c=n(138);var l=function e(t){var n=t.operation;if(void 0===n)return[];var o=t.old_value,a=[];if(n.type===r.OperationType.ADD){var s=n.path+"."+JSON.stringify({id:o.id});a=[i.OTKit.generateOperation(r.OperationType.REMOVE,s,o)]}else if(n.type===r.OperationType.REMOVE)a=[i.OTKit.generateOperation(r.OperationType.ADD,n.path,o)];else if(n.type===r.OperationType.SET)a=[i.OTKit.generateOperation(r.OperationType.SET,n.path,o)];else{if(n.type!==r.OperationType.BATCH)return[];o.reverse().forEach(function(t){var n;(n=a).push.apply(n,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e(t)))})}return a},u=function(e,t){var n=s.WebsocketClient.getInstance(),o=t;return e.forEach(function(e){if(e.type===r.OperationType.SET)void 0===e.value&&(e.value=null),o=r.Util.ObjectUtil.set(o,e.path,e.value);else if(e.type===r.OperationType.ADD){var t=r.Util.ObjectUtil.get(o,e.path);t.push(e.value),o=r.Util.ObjectUtil.set(o,e.path,t)}else e.type===r.OperationType.REMOVE&&r.Util.ObjectUtil.remove(o,e.path);void 0!==n&&n.socket.emit("update-buncee-doc",{operation:e})}),o};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.genericState,t=arguments[1];switch(t.type){case"add_history":return Object.assign({},e,{history:{actions:a.ArrayUtil.push(e.history.actions,t.payload.history_item),undo:[]}});case"undo":var n=e.history.actions.pop();if(void 0===n)return e;var s=l(n);return Object.assign({},e,{buncee:Object.assign({},u(s,e.buncee)),history:{actions:e.history.actions,undo:a.ArrayUtil.push(e.history.undo,n)}});case"redo":var d=e.history.undo.pop();if(void 0===d)return e;var p=e.buncee;if(d.operation.type===r.OperationType.BATCH){var f=function(e){if(e.type!==r.OperationType.BATCH)throw new Error("Cannot get batch operations from operation of type "+e.type);var t=[];return e.value.forEach(function(e){var n=(0,o.translateActionToOperation)(e);void 0!==n&&t.push(n)}),t}(d.operation);p=u(f,p)}else p=i.OTKit.apply(d.operation);return Object.assign({},e,{buncee:Object.assign({},p),history:{actions:a.ArrayUtil.push(e.history.actions,d),undo:e.history.undo}});default:return e}}},365:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(138);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.genericState,t=arguments[1];return"update_clipboard"===t.type?Object.assign({},e,{clipboard:t.payload.value}):e}},366:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),o=n(68),i=n(4),a=n(138);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.genericState,t=arguments[1];switch(t.type){case"set_active_browser":return Object.assign({},e,{activeBrowser:t.payload.activeBrowser,isEditingBackground:!1,displaySettings:Object.assign({},e.displaySettings,{isPanning:!1,viewportOffset:{x:0,y:0,space:"screen"}})});case"open_gateway":return Object.assign({},e,{gateway:t.payload,isEditingBackground:!1,displaySettings:Object.assign({},e.displaySettings,{isPanning:!1,viewportOffset:{x:0,y:0,space:"screen"}})});case"close_gateway":return Object.assign({},e,{gateway:void 0,isEditingBackground:!1,displaySettings:Object.assign({},e.displaySettings,{isPanning:!1,viewportOffset:{x:0,y:0,space:"screen"}})});case"open_modal":return Object.assign({},e,{openModal:void 0===t.payload.type?void 0:t.payload,isEditingBackground:!1,displaySettings:Object.assign({},e.displaySettings,{isPanning:!1})});case"update_settings":var n=o.Util.ObjectUtil.set({},t.payload.path,t.payload.value);return r.Client.put("/buncees/"+e.buncee.id,"data="+JSON.stringify({document:n}),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}),o.Util.ObjectUtil.set(e,"settings."+t.payload.path,t.payload.value);case"update_item_defaults":var s=o.Util.ObjectUtil.set(e.item_defaults,t.payload.path,t.payload.value);return Object.assign({},e,{item_defaults:s});case"open_view_panel":return Object.assign({},e,{viewPanel:t.payload.viewPanel});case"add_tag":return Object.assign({},e,{buncee:Object.assign({},e.buncee,{tags:i.ArrayUtil.push(e.buncee.tags,t.payload.tag)})});case"remove_tag":return Object.assign({},e,{buncee:Object.assign({},e.buncee,{tags:i.ArrayUtil.findAndRemove(e.buncee.tags,function(e){return e.guid===t.payload.id})})});case"set_fullscreen":return Object.assign({},e,{isFullscreen:t.payload.value});case"update_likes":return Object.assign({},e,{bunceeMeta:Object.assign({},e.bunceeMeta,{likes:t.payload.value})});case"add_comment":return Object.assign({},e,{bunceeMeta:Object.assign({},e.bunceeMeta,{comments:i.ArrayUtil.insert(e.bunceeMeta.comments,t.payload.value,0)})});case"remove_comment":return Object.assign({},e,{bunceeMeta:Object.assign({},e.bunceeMeta,{comments:i.ArrayUtil.findAndRemove(e.bunceeMeta.comments,function(e){return e.guid===t.payload.value})})});case"update_store":return o.Util.ObjectUtil.set(e,t.payload.path,t.payload.value);case"mark_slide_dirty":var c=new Set(e.dirtySlides);return c.add(t.payload.value),o.Util.ObjectUtil.set(e,"dirtySlides",c);case"mark_slide_clean":var l=new Set(e.dirtySlides);return l.delete(t.payload.value),o.Util.ObjectUtil.set(e,"dirtySlides",l);case"mark_item_dirty":var u=new Set(e.dirtyItems);return u.add(t.payload.value),o.Util.ObjectUtil.set(e,"dirtyItems",u);case"mark_item_clean":var d=new Set(e.dirtyItems);return d.delete(t.payload.value),o.Util.ObjectUtil.set(e,"dirtyItems",d);case"set_gridline_intersect":return Object.assign({},e,{gridlineIntersects:t.payload.value});default:return e}}},367:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments[1];return"function"==typeof t[r.type]?t[r.type](n,r):n}}},368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=["add_history","undo","redo","batch_actions","update_clipboard","operational_transform"],i=function(e){e({type:"update_store",payload:{type:"update_store",path:"isEditingBackground",value:!1}})};t.default=function(e){var t=e.dispatch;e.getState;return function(e){return function(n){return o.indexOf(n.type)>=0||!(0,r.isSetPayload)(n.payload)?e(n):"update_store"===n.type&&n.payload.path.indexOf("displaySettings")>=0?e(n):("update_store"!==n.type&&"update_slide"!==n.type?i(t):"update_store"===n.type&&"isEditingBackground"!==n.payload.path?i(t):"update_slide"===n.type&&-1===n.payload.path.indexOf("background")&&i(t),e(n))}}}},369:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(4);t.default=function(e){var t=e.dispatch,n=e.getState;return function(e){return function(i){if((0,r.isSetPayload)(i.payload)&&i.payload.path.match(/content.body.\{(\"[a-zA-Z0-9]+\":\"[a-zA-Z0-9]+\",*)+\}.frame/i)){var a=n().buncee.document.items[i.payload.id];if(void 0===a)return e(i);var s=a.content.body.map(function(e){return e.frame}),c=o.GeometryUtil.enclosingRect.apply(o.GeometryUtil,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(s)),l={type:"update_item",payload:{id:i.payload.id,path:"frame",value:c}};t(l)}return e(i)}}}},370:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(4);t.default=function(e){var t=e.dispatch,n=e.getState;return function(e){return function(i){if("operational_transform"!==i.type)return e(i);if(!(0,r.isOperationPayload)(i.payload))return e(i);var a=n();return"edit"!==a.renderingMode?e(i):i.payload.operation.path.indexOf("selected_items")>-1||i.payload.operation.path.indexOf("selected_slides")>-1?e(i):(function(e,t,n){e.payload.operation.path.indexOf("document.canvas")>-1?t.buncee.document.slides.map(function(e){n({type:"mark_slide_dirty",payload:{value:e.id}})}):n({type:"mark_slide_dirty",payload:{value:t.buncee.selected_slides[o.User.getUser().guid]}})}(i,a,t),function(e,t,n){var r=e.payload.operation.path.split(".");if(r.length>2&&"document"===r[0]&&"items"===r[1]){var o=t.buncee.document.items[r[2]];o&&n({type:"mark_item_dirty",payload:{value:o.id}})}}(i,a,t),e(i))}}}},371:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Middlewares=void 0;var r=s(n(370)),o=s(n(369)),i=s(n(254)),a=s(n(368));function s(e){return e&&e.__esModule?e:{default:e}}t.Middlewares=[i.default,o.default,a.default,r.default]},372:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OTKit=void 0,t.configureStore=function(e){return l=(0,c.createStore)(s.default,e,(0,c.compose)(c.applyMiddleware.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i.Middlewares))))},t.getStore=function(){return l};var r,o=n(68),i=n(371),a=n(138),s=(r=a)&&r.__esModule?r:{default:r},c=n(250);var l=void 0;t.OTKit=new o.Manager("constant-machine-uuid",new o.Adapters.ClosureAdapter(function(){if(void 0===l)throw new Error("Redux store has not been configured.");return l.getState().buncee}))},378:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(358),c=(r=s)&&r.__esModule?r:{default:r},l=n(5),u=n(4);var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.steps=[{target:"body",placement:"center",content:a.createElement("div",{className:"tour-container"},a.createElement("p",null,"Click through to learn all about the Buncee creation canvas. Then, start creating a Buncee from scratch or use one of our 500+ templates!"),a.createElement("img",{className:"welcome",src:(0,u.cloudfrontURL)("/images/tour/welcome-01.jpg")})),disableBeacon:!0,styles:{options:{width:600}},title:"Cheers to New Beginnings!"},{target:".tab",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Pages and layers can be hidden for more space. Click on tabs to access them"),a.createElement("img",{className:"tour-image",src:(0,u.cloudfrontURL)("/images/tour/slidepanel.gif")})),title:"Pages and Layers Panel",placement:"left"},{target:".button-resize",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Resize your canvas to create different sized artwork! Select from our list of standard sizes or set a custom size for your unique creation!"),a.createElement("img",{className:"tour-image",src:(0,u.cloudfrontURL)("/images/tour/canvassizing.gif")})),title:"Resizing Your Canvas",placement:"right"},{target:".canvas-toolbar .float-left",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Undo any of your changes or bring them back with redo.")),title:"Undo and Redo",placement:"bottom"},{target:".canvas-toolbar .float-right",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Zoom and pan your Buncee for working with different canvas sizes.")),title:"Zoom and Pan",placement:"bottom"},{target:".guide-insert-item",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Access the Media Palette to insert text, stickers, video and more."),a.createElement("img",{className:"tour-image",src:(0,u.cloudfrontURL)("/images/tour/additem.gif")})),title:"Adding an Item",placement:"left"},{target:".gateway",content:a.createElement("div",{className:"tour-container"},a.createElement("p",{className:"tour-content"},"Check out the new additions like Emojis, Shapes, and Take Photo!"),a.createElement("p",null,"This completes your tour! Click Finish to explore 500+ templates or jump right into creating your own!")),title:"New Media Palette",locale:{next:"Start creating"},placement:"top"}],n.renderCanvasResize=function(){return a.createElement("div",null,a.createElement("img",{src:(0,u.cloudfrontURL)("/images/tour/canvassizing.gif")}))},n.handleTourStateChange=function(e){"tour:end"===e.type&&n.state.runTour?"1"===window.config.is_new_buncee&&"1"===window.config.templates_enabled&&(n.props.activeBrowser&&n.props.closeActiveBrowser(),n.props.openModal("templates")):5===e.index&&"step:after"===e.type&&"prev"!==e.action?(n.setState({runTour:!1}),setTimeout(function(){n.props.openBrowser(),n.setState({runTour:!0,stepIndex:e.index+("prev"===e.action?-1:1)})},300)):5===e.index&&"step:before"===e.type&&"prev"===e.action?n.props.closeActiveBrowser():"step:after"!==e.type&&"error:target_not_found"!==e.type||n.setState({stepIndex:e.index+("prev"===e.action?-1:1)}),"close"===e.action&&n.props.openModal("templates"),"update"===e.action&&"tooltip"===e.type&&n.props.modal&&"templates"===n.props.modal.type&&n.props.closeModal()},n.state={runTour:!0,stepIndex:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"render",value:function(){var e=this;return a.createElement("div",{id:"tour"},a.createElement(c.default,{steps:this.steps,run:this.state.runTour,showSkipButton:!0,showProgress:!0,continuous:!0,styles:{options:{primaryColor:"#ec2e5f"},tooltip:{paddingTop:30},tooltipTitle:{margin:"0 0 20px 0"},buttonNext:{minWidth:85,height:30,fontSize:13},buttonBack:{fontSize:13}},callback:this.handleTourStateChange,ref:function(t){e.tour=t},stepIndex:this.state.stepIndex,locale:{last:"Finish"}}))}}]),t}();t.default=(0,l.connect)(function(e){return{modal:e.openModal,activeBrowser:void 0===e.gateway?void 0:e.gateway.activeBrowser}},function(e){return{openBrowser:function(){e(i.Actions.openGateway({activeBrowser:"itemgateway"}))},closeActiveBrowser:function(){e(i.Actions.closeGateway({}))},openModal:function(t,n){e(i.Actions.openModal({type:t,props:n}))},closeModal:function(){e(i.Actions.openModal({type:void 0}))}}})(d)},379:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=p(n(84)),d=p(n(83));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.canvasClickListner=function(e){if(""!==n.state.selectedButton){var t=document.getElementById("viewport-background"),r=document.getElementById("guide-overlay"),o=document.getElementById("viewport"),i=e.target;i&&o&&t&&(i.id!==o.id&&i.id!==t.id||n.setState({selectedButton:""})),r&&i.id===r.id&&n.setState({selectedButton:""})}},n.setOpacity=function(e){n.props.updateBackground(e/100,n.props.selectedSlide)},n.getOpacity=function(){return n.props.selectedSlide.background&&n.props.selectedSlide.background.attributes?n.props.selectedSlide.background.attributes.opacity:1},n.state={selectedButton:"",numFittable:999},n.getButtons.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"componentDidMount",value:function(){window.addEventListener("click",this.canvasClickListner,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.canvasClickListner,!1)}},{key:"getButtons",value:function(){var e=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return void 0!==this.props.clipboard&&(e.push(s.createElement(d.default,r({key:"paste"},this.generateToolbarButtonProps("Paste","icon-paste",this.paste)))),e.push(s.createElement("div",{key:"spacer-1",className:"spacer"}))),this.props.selectedSlide.background&&"url"===this.props.selectedSlide.background.type&&e.push(s.createElement(d.default,r({key:"move-background"},this.generateToolbarButtonProps("Move Background","icon-move",this.moveBackground)))),e.push(s.createElement(d.default,r({key:"change-background"},this.generateToolbarButtonProps("Change Background","icon-backgrounds",this.changeBackground)))),this.props.selectedSlide.background&&e.push(this.renderOpacitySlider()),e.push.apply(e,[s.createElement("div",{key:"spacer-2",className:"spacer"}),s.createElement(d.default,r({key:"duplicate-slide"},this.generateToolbarButtonProps("Duplicate Page","icon-copy",this.duplicateSlide))),s.createElement(d.default,r({key:"delete-slide"},this.generateToolbarButtonProps("Delete Page","icon-delete1",this.deleteSlide)))]),e}},{key:"getID",value:function(){return"slide-toolbar"}}]),t}();t.default=(0,c.connect)(function(e){var t=e.buncee.selected_items,n=(0,a.keys)(t).filter(function(n){return void 0!==t[n]&&null!==t[n]&&t[n].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),r=e.buncee.selected_slides[e.user.id],o=e.buncee.document.slides.find(function(e){return e.id===r});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedItem:n[0],selectedSlide:o,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e){return{setItems:function(t,n){e(i.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(i.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(i.Actions.updateClipboard({path:"",value:t}))},updateItem:function(t,n,r){e(i.Actions.updateItem({path:t.id+(n.length>0?"."+n:n),value:r}))},removeItem:function(t,n,r){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:(0,a.omit)(t,[n.id])}),i.Actions.updateSlide({id:r.id,path:"items",value:l.ArrayUtil.findAndRemove(r.items,function(e){return e===n.id})})]}))},addItem:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.addItem({item:t}),i.Actions.updateSlide({id:n.id,path:"items",value:l.ArrayUtil.push(n.items,t.id)})]}))},addSlide:function(t,n,r){void 0===r?i.Actions.updateSlide({path:"",value:n}):e(i.Actions.batchActions({actions:[i.Actions.updateSlide({path:"",value:n}),i.Actions.updateItem({path:"",value:r}),i.Actions.updateSlideSelected({path:l.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},openBrowser:function(t){e(i.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:n}),i.Actions.updateSlide({path:"",value:t})]}))},updateStore:function(t,n){e(i.Actions.updateStore({path:t,value:n}))},updateBackground:function(t,n){e(i.Actions.updateSlide({path:"background.attributes",id:n.id,value:Object.assign({},n.background.attributes,{opacity:t})}))}}})(f)},380:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(7),s=n(102),c=n(195),l=n(11),u=n(6),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),p=n(5),f=n(4),m=b(n(198)),h=n(84),v=b(h),y=b(n(83));function b(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderEditShapeButtons=function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",n).call(n);return e.push.apply(e,[d.createElement(y.default,r({key:"delete"},n.generateToolbarButtonProps("Delete","icon-delete1",n.delete))),d.createElement("div",{key:"spacer-1",className:"spacer"}),n.renderFillColor(),n.renderOpacitySlider(),d.createElement("div",{key:"spacer-2",className:"spacer"}),n.renderStrokes(),n.renderStrokeColor(),d.createElement("div",{key:"spacer-3",className:"spacer"}),n.renderCopyGroup(),d.createElement("div",{key:"spacer-4",className:"spacer"}),d.createElement("div",{key:"flip-group",className:"toolbar-button-group no-individual-label-group"},d.createElement(y.default,r({},n.generateToolbarButtonProps("Flip Vertical","icon-flipvert",function(){n.flip("horizontal")}),{iconPosition:"top"})),d.createElement(y.default,r({},n.generateToolbarButtonProps("Flip Horizontal","icon-fliphorizontal",function(){n.flip("vertical")}),{iconPosition:"top"})),d.createElement("span",{className:"label flip"},"Flip")),d.createElement("div",{key:"spacer-5",className:"spacer"}),d.createElement("div",{key:"position-group",className:"toolbar-button-group"},d.createElement(y.default,r({},n.generateToolbarButtonProps("To Front","icon-bringtop",n.moveToFront),{iconPosition:"top"})),d.createElement(y.default,r({},n.generateToolbarButtonProps("To Back","icon-bringbot",n.moveToBack),{iconPosition:"top"})),d.createElement(y.default,r({},n.generateToolbarButtonProps("Reset","icon-reset",n.resetRotation),{iconPosition:"top"})))]),e},n.renderOpacitySlider=function(){return d.createElement("div",{className:"toolbar-button",id:"opacity",onClick:n.handleButtonClick},d.createElement(l.PopupMenu,{text:"Opacity",showMenu:"opacity"===n.state.selectedButton,icon:"icon-opacity",iconPosition:"top"},d.createElement(l.Slider,{onChange:function(e){n.handleUpdate("fill_opacity",e/100)},minValue:0,maxValue:100,step:10,unit:"%",value:100*n.props.shapeDefaults.fill_opacity})))},n.handleUpdate=function(e,t,r){Object.assign({},n.props.shapeDefaults)[e]=t,void 0!==n.props.selectedItem&&n.props.updateItem(n.props.selectedItem,"content.attributes."+e,t)},n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t&&n.updateSelectedButton(e.currentTarget.id)},n.state={selectedButton:"",numFittable:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,v.default),o(t,[{key:"componentWillUnmount",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this)}},{key:"getButtons",value:function(){return this.renderEditShapeButtons()}},{key:"getID",value:function(){return"shapes-toolbar"}},{key:"renderStrokes",value:function(){var e=this;return d.createElement(l.NumberInput,{value:this.props.shapeDefaults.stroke_width,min:0,max:50,onValueChange:function(t){e.handleUpdate("stroke_width",t)},text:"Border",textPosition:"bottom"})}},{key:"renderStrokeColor",value:function(){var e=this;return d.createElement(m.default,{key:"stroke-color",id:"stroke-color",text:"Border Color",handleButtonClick:this.handleButtonClick,handleColorChange:function(t,n){e.handleUpdate("stroke",t,n)},showMenu:"stroke-color"===this.state.selectedButton,color:this.props.shapeDefaults.stroke})}},{key:"renderFillColor",value:function(){var e=this;if(!(0,c.isNoFillShape)(this.props.shapeDefaults.svg_url))return d.createElement(m.default,{key:"fill-color",id:"fill-color",text:"Fill Color",handleButtonClick:this.handleButtonClick,handleColorChange:function(t,n){e.handleUpdate("fill",t,n)},showMenu:"fill-color"===this.state.selectedButton,color:this.props.shapeDefaults.fill})}}]),t}();g.defaultProps={mode:h.ToolbarMode.DEFAULT,buttons:{},shapeDefaults:{fill:"white",stroke:"black",stroke_width:5,fill_opacity:1,type:"rectangle"},selectedButton:""};t.default=(0,p.connect)(function(e,t){var n=e.buncee.selected_slides[e.user.id],r=e.buncee.document.slides.find(function(e){return e.id===n});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:r,clipboard:e.clipboard,user:e.user,shapeDefaults:t.selectedItem.content.attributes,displaySettings:e.displaySettings,canvas:e.buncee.document.canvas,preferences:e.preferences}},function(e,t){return{updateItem:function(n,r,o){r=void 0!==t.selectedItemParent?t.selectedItemParent.id+'.content.body.{"id": "'+n.id+'"}'+(r.length>0?"."+r:r):n.id+(r.length>0?"."+r:r),e(a.Actions.updateItem({path:r,value:o}))},addItem:function(t,n){e(a.Actions.addItem({item:t})),e(a.Actions.updateSlide({id:n.id,path:"items",value:f.ArrayUtil.push(n.items,t.id)}))},updateSelectedItems:function(t,n){e(a.Actions.updateItemsSelected({path:t,value:n}))},setItems:function(t,n){e(a.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(a.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(a.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(a.Actions.updateClipboard({path:"",value:t}))},removeItem:function(n,r,o){var i=[];if(i.push(a.Actions.updateItemsSelected({path:r.id,value:null})),void 0!==t.selectedItemParent){var c=(0,s.ungroupItems)(t.selectedItemParent,n,o);if(2===c.items.length)i.push(a.Actions.updateItem({path:"",value:(0,u.omit)(c.newItemDict,[r.id])})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:f.ArrayUtil.findAndRemove(c.newSlideItems,function(e){return e===r.id})}));else{c.items=(0,u.filter)(c.items,function(e){return e.id!==r.id}),c.newItemDict=(0,u.omit)(c.newItemDict,[r.id]),c.newSlideItems=(0,u.remove)(c.newSlideItems,r.id);var l=(0,s.createGroup)(c.items,c.newItemDict,Object.assign({},o,{items:c.newSlideItems}),t.selectedItemParent.name);i.push(a.Actions.updateItem({path:"",value:l.newItemDict})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:l.newSlideItems}))}}else i.push(a.Actions.updateItem({path:"",value:(0,u.omit)(n,[r.id])})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:f.ArrayUtil.findAndRemove(o.items,function(e){return e===r.id})}));e(a.Actions.batchActions({actions:i}))},addSlide:function(t,n,r){void 0===r?a.Actions.updateSlide({path:"",value:n}):e(a.Actions.batchActions({actions:[a.Actions.updateSlide({path:"",value:n}),a.Actions.updateItem({path:"",value:r}),a.Actions.updateSlideSelected({path:f.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(a.Actions.undoPrevAction({}))},redoPrevAction:function(){e(a.Actions.redoPrevAction({}))},openBrowser:function(t){e(a.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.updateItem({path:"",value:n}),a.Actions.updateSlide({path:"",value:t})]}))}}})(g)},381:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(102),s=n(6),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=n(4),d=n(272),p=h(n(271)),f=h(n(84)),m=h(n(83));function h(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.updateItem=function(e,t){n.props.updateItem(n.props.selectedItem,"content.attributes."+e,t)},n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t&&n.updateSelectedButton(e.currentTarget.id)},n.openMenu=function(e){n.updateSelectedButton(e)},n.closeMenu=function(){n.updateSelectedButton("")},n.state={selectedButton:"",numFittable:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.default),o(t,[{key:"getButtons",value:function(){var e=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[c.createElement(m.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),c.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderLinkButton(),c.createElement(m.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),c.createElement("div",{key:"spacer-2",className:"spacer"}),c.createElement(p.default,{key:"text-color-picker",closeMenu:this.closeMenu,showMenu:"brush-color"===this.state.selectedButton,onClick:this.handleButtonClick,item:this.props.selectedItem,updateItem:this.updateItem}),this.renderOpacitySlider(),c.createElement("div",{key:"spacer-3",className:"spacer"}),c.createElement(d.TextFontSelector,{key:"font-selector",closeMenu:this.closeMenu,showMenu:"text-font"===this.state.selectedButton,onClick:this.handleButtonClick,item:this.props.selectedItem,updateItem:this.updateItem}),c.createElement(d.TextFontSizeSelector,{key:"font-size-selector",item:this.props.selectedItem,updateItem:this.updateItem}),c.createElement("div",{key:"spacer-4",className:"spacer"}),c.createElement("div",{key:"text-style-group",className:"toolbar-button-group"},c.createElement(d.TextToolbarButton,{property:"bold",key:"bold",onClick:this.handleButtonClick,item:this.props.selectedItem,updateItem:this.updateItem}),c.createElement(d.TextToolbarButton,{property:"italic",key:"italic",onClick:this.handleButtonClick,item:this.props.selectedItem,updateItem:this.updateItem}),c.createElement(d.TextToolbarButton,{property:"underline",key:"underline",onClick:this.handleButtonClick,item:this.props.selectedItem,updateItem:this.updateItem})),c.createElement("div",{key:"spacer-7",className:"spacer"}),this.renderCopyGroup(),c.createElement("div",{key:"spacer-8",className:"spacer"}),c.createElement("div",{key:"position-group",className:"toolbar-button-group"},c.createElement(m.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),c.createElement(m.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),c.createElement(m.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),e}},{key:"getID",value:function(){return"question-text-toolbar"}}]),t}();t.default=(0,l.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:n,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e,t){return{setItems:function(t,n){e(i.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(i.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(i.Actions.updateClipboard({path:"",value:t}))},updateItem:function(n,r,o){r=void 0!==t.selectedItemParent?t.selectedItemParent.id+'.content.body.{"id": "'+n.id+'"}'+(r.length>0?"."+r:r):n.id+(r.length>0?"."+r:r),e(i.Actions.updateItem({path:r,value:o}))},removeItem:function(n,r,o){var c=[];if(c.push(i.Actions.updateItemsSelected({path:r.id,value:null})),void 0!==t.selectedItemParent){var l=(0,a.ungroupItems)(t.selectedItemParent,n,o);if(2===l.items.length)c.push(i.Actions.updateItem({path:"",value:(0,s.omit)(l.newItemDict,[r.id])})),c.push(i.Actions.updateSlide({id:o.id,path:"items",value:u.ArrayUtil.findAndRemove(l.newSlideItems,function(e){return e===r.id})}));else{l.items=(0,s.filter)(l.items,function(e){return e.id!==r.id}),l.newItemDict=(0,s.omit)(l.newItemDict,[r.id]),l.newSlideItems=(0,s.remove)(l.newSlideItems,r.id);var d=(0,a.createGroup)(l.items,l.newItemDict,Object.assign({},o,{items:l.newSlideItems}),t.selectedItemParent.name);c.push(i.Actions.updateItem({path:"",value:d.newItemDict})),c.push(i.Actions.updateSlide({id:o.id,path:"items",value:d.newSlideItems}))}}else c.push(i.Actions.updateItem({path:"",value:(0,s.omit)(n,[r.id])})),c.push(i.Actions.updateSlide({id:o.id,path:"items",value:u.ArrayUtil.findAndRemove(o.items,function(e){return e===r.id})}));e(i.Actions.batchActions({actions:c}))},updateTextDefaults:function(t){e(i.Actions.updateItemDefaults({path:"text",value:t}))},addItem:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.addItem({item:t}),i.Actions.updateSlide({id:n.id,path:"items",value:u.ArrayUtil.push(n.items,t.id)})]}))},addSlide:function(t,n,r){void 0===r?i.Actions.updateSlide({path:"",value:n}):e(i.Actions.batchActions({actions:[i.Actions.updateSlide({path:"",value:n}),i.Actions.updateItem({path:"",value:r}),i.Actions.updateSlideSelected({path:u.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},openBrowser:function(t){e(i.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:n}),i.Actions.updateSlide({path:"",value:t})]}))}}})(v)},382:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(7),s=n(102),c=n(6),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4),p=m(n(84)),f=m(n(83));function m(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={selectedButton:"",numFittable:999},n.getButtons.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.default),o(t,[{key:"componentWillUnmount",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"componentWillUnmount",this).call(this)}},{key:"getButtons",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);switch(this.props.selectedItem.type){case"oembed":case"image":return this.getImageButtons();case"video":case"vimeo":case"youtube":return this.getVideoButtons();case"panoramic":return this.getPanoramicButtons();case"three_d":return this.getThreeDButtons();case"qrcode":return this.getQRCodeButtons()}return e}},{key:"getImageButtons",value:function(){var e=this,n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return n.push.apply(n,[l.createElement(f.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),l.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderLinkButton(),l.createElement(f.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),this.renderOpacitySlider(),this.renderAltTextButton(),l.createElement("div",{key:"spacer-2",className:"spacer"}),this.renderCopyGroup(),l.createElement("div",{key:"spacer-3",className:"spacer"}),l.createElement("div",{key:"flip-group",className:"toolbar-button-group no-individual-label-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("Flip Vertical","icon-flipvert",function(){e.flip("horizontal")}),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Flip Horizontal","icon-fliphorizontal",function(){e.flip("vertical")}),{iconPosition:"top"})),l.createElement("span",{className:"label flip"},"Flip")),l.createElement("div",{key:"spacer-5",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),n}},{key:"getVideoButtons",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[l.createElement(f.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),l.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderCopyGroup(),l.createElement("div",{key:"spacer-5",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),e}},{key:"getPanoramicButtons",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[l.createElement(f.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),l.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderLinkButton(),l.createElement(f.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),l.createElement("div",{key:"spacer-2",className:"spacer"}),this.renderCopyGroup(),l.createElement("div",{key:"spacer-5",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),e}},{key:"getThreeDButtons",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[l.createElement(f.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),l.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderLinkButton(),l.createElement(f.default,r({key:"audio"},this.generateToolbarButtonProps("Audio","icon-soundmax",this.addAudio))),this.renderOpacitySlider(),l.createElement("div",{key:"spacer-2",className:"spacer"}),this.renderCopyGroup(),l.createElement("div",{key:"spacer-5",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),e}},{key:"getQRCodeButtons",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[l.createElement(f.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),l.createElement("div",{key:"spacer-1",className:"spacer"}),this.renderCopyGroup(),l.createElement("div",{key:"spacer-2",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,r({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,r({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]),e}},{key:"getID",value:function(){return"media-toolbar"}}]),t}();t.default=(0,u.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:n,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e,t){return{setItems:function(t,n){e(a.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(a.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(a.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(a.Actions.updateClipboard({path:"",value:t}))},updateItem:function(n,r,o){r=void 0!==t.selectedItemParent?t.selectedItemParent.id+'.content.body.{"id": "'+n.id+'"}'+(r.length>0?"."+r:r):n.id+(r.length>0?"."+r:r),e(a.Actions.updateItem({path:r,value:o}))},removeItem:function(n,r,o){var i=[];if(i.push(a.Actions.updateItemsSelected({path:r.id,value:null})),void 0!==t.selectedItemParent){var l=(0,s.ungroupItems)(t.selectedItemParent,n,o);if(2===l.items.length)i.push(a.Actions.updateItem({path:"",value:(0,c.omit)(l.newItemDict,[r.id])})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:d.ArrayUtil.findAndRemove(l.newSlideItems,function(e){return e===r.id})}));else{l.items=(0,c.filter)(l.items,function(e){return e.id!==r.id}),l.newItemDict=(0,c.omit)(l.newItemDict,[r.id]),l.newSlideItems=(0,c.remove)(l.newSlideItems,r.id);var u=(0,s.createGroup)(l.items,l.newItemDict,Object.assign({},o,{items:l.newSlideItems}),t.selectedItemParent.name);i.push(a.Actions.updateItem({path:"",value:u.newItemDict})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:u.newSlideItems}))}}else i.push(a.Actions.updateItem({path:"",value:(0,c.omit)(n,[r.id])})),i.push(a.Actions.updateSlide({id:o.id,path:"items",value:d.ArrayUtil.findAndRemove(o.items,function(e){return e===r.id})}));e(a.Actions.batchActions({actions:i}))},addItem:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.addItem({item:t}),a.Actions.updateSlide({id:n.id,path:"items",value:d.ArrayUtil.push(n.items,t.id)})]}))},addSlide:function(t,n,r){void 0===r?a.Actions.updateSlide({path:"",value:n}):e(a.Actions.batchActions({actions:[a.Actions.updateSlide({path:"",value:n}),a.Actions.updateItem({path:"",value:r}),a.Actions.updateSlideSelected({path:d.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(a.Actions.undoPrevAction({}))},redoPrevAction:function(){e(a.Actions.redoPrevAction({}))},openBrowser:function(t){e(a.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.updateItem({path:"",value:n}),a.Actions.updateSlide({path:"",value:t})]}))}}})(h)},383:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(7),s=n(102),c=n(6),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4),p=m(n(84)),f=m(n(83));function m(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.canvasClickListner=function(e){if(""!==n.state.selectedButton){var t=document.getElementById("viewport-background"),r=document.getElementById("guide-overlay"),o=document.getElementById("viewport"),i=e.target;i&&o&&t&&(i.id!==o.id&&i.id!==t.id||n.setState({selectedButton:""})),r&&i.id===r.id&&n.setState({selectedButton:""})}},n.openNameGroupModal=function(){n.props.openModal("input",{title:"Group Name",message:"What would you call this group?",handleSubmit:n.nameGroup})},n.ungroup=function(){var e=(0,s.ungroupItems)(n.props.selectedItem,n.props.items,n.props.selectedSlide);n.props.updateItemsSelected(n.props.selectedItem.id,null),n.props.updateItems(e.newItemDict,n.props.selectedSlide,e.newSlideItems)},n.nameGroup=function(e){n.props.updateItem(n.props.selectedItem,"name",e)},n.toggleLock=function(){n.props.updateItem(n.props.selectedItem,"locked",!n.props.selectedItem.locked)},n.state={selectedButton:"",numFittable:999},n.getButtons.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.default),i(t,[{key:"componentDidMount",value:function(){window.addEventListener("click",this.canvasClickListner,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.canvasClickListner,!1)}},{key:"getButtons",value:function(){var e=this,n=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this),r=this.props.selectedItem.locked;return"string"==typeof this.props.selectedItem.name?n.push.apply(n,[l.createElement(f.default,{key:"lock",text:r?"Unlock":"Lock",action:this.toggleLock,icon:r?"icon-unlock":"icon-locked"}),l.createElement(f.default,{key:"ungroup",text:"Ungroup",action:this.ungroup,icon:"icon-group"}),l.createElement("div",{key:"spacer-1",className:"spacer"}),l.createElement(f.default,o({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),this.renderCopyGroup(),l.createElement("div",{key:"spacer-2",className:"spacer"}),l.createElement("div",{key:"flip-group",className:"toolbar-button-group no-individual-label-group"},l.createElement(f.default,o({},this.generateToolbarButtonProps("Flip Vertical","icon-flipvert",function(){e.flip("horizontal")}),{iconPosition:"top"})),l.createElement(f.default,o({},this.generateToolbarButtonProps("Flip Horizontal","icon-fliphorizontal",function(){e.flip("vertical")}),{iconPosition:"top"})),l.createElement("span",{className:"label flip"},"Flip")),l.createElement("div",{key:"spacer-3",className:"spacer"}),l.createElement("div",{key:"position-group",className:"toolbar-button-group"},l.createElement(f.default,o({},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),l.createElement(f.default,o({},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"})),l.createElement(f.default,o({},this.generateToolbarButtonProps("Reset","icon-reset",this.resetRotation),{iconPosition:"top"})))]):n.push.apply(n,[l.createElement(f.default,o({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),this.renderCopyGroup(),l.createElement(f.default,{key:"group",text:"Group",action:this.openNameGroupModal,icon:"icon-group"})]),n}},{key:"getID",value:function(){return"slide-toolbar"}}]),t}();t.default=(0,u.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:n,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e){return{setItems:function(t,n){e(a.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(a.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(a.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(a.Actions.updateClipboard({path:"",value:t}))},updateItem:function(t,n,r){e(a.Actions.updateItem({path:t.id+(n.length>0?"."+n:n),value:r}))},removeItem:function(t,n,r){e(a.Actions.batchActions({actions:[a.Actions.updateItem({path:"",value:(0,c.omit)(t,[n.id])}),a.Actions.updateSlide({id:r.id,path:"items",value:d.ArrayUtil.findAndRemove(r.items,function(e){return e===n.id})})]}))},addItem:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.addItem({item:t}),a.Actions.updateSlide({id:n.id,path:"items",value:d.ArrayUtil.push(n.items,t.id)})]}))},addSlide:function(t,n,r){void 0===r?a.Actions.updateSlide({path:"",value:n}):e(a.Actions.batchActions({actions:[a.Actions.updateSlide({path:"",value:n}),a.Actions.updateItem({path:"",value:r}),a.Actions.updateSlideSelected({path:d.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(a.Actions.undoPrevAction({}))},redoPrevAction:function(){e(a.Actions.redoPrevAction({}))},openBrowser:function(t){e(a.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(a.Actions.batchActions({actions:[a.Actions.updateItem({path:"",value:n}),a.Actions.updateSlide({path:"",value:t})]}))},updateStore:function(t,n){e(a.Actions.updateStore({path:t,value:n}))},updateBackground:function(t,n){e(a.Actions.updateSlide({path:"background.attributes",id:n.id,value:Object.assign({},n.background.attributes,{opacity:t})}))},openModal:function(t,n){e(a.Actions.openModal({type:t,props:n}))},updateItems:function(t,n,o){var i=[];i.push(a.Actions.updateItem({path:"",value:t})),"object"===(void 0===n?"undefined":r(n))&&void 0!==o?i.push(a.Actions.updateSlide({id:n.id,path:"items",value:o})):"object"===(void 0===n?"undefined":r(n))&&(o=n.items.filter(function(e){return void 0!==t[e]}),i.push(a.Actions.updateSlide({id:n.id,path:"items",value:o}))),e(a.Actions.batchActions({actions:i}))}}})(h)},384:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(102),s=h(n(198)),c=n(11),l=n(6),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),d=n(5),p=n(4),f=h(n(84)),m=h(n(83));function h(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t?n.setState({selectedButton:t}):n.setState({selectedButton:""})},n.renderBrushSize=function(){return u.createElement(c.NumberInput,{value:n.props.drawingDefaults.brush_size,min:1,max:50,onValueChange:function(e){n.handleUpdate("brush_size",e)},text:"Brush Size",textPosition:"bottom"})},n.renderBrushColor=function(){return u.createElement(s.default,{key:"brush-color",id:"brush-color",text:"Brush Color",handleButtonClick:n.handleButtonClick,handleColorChange:function(e,t){n.handleUpdate("brush_color",e,t)},showMenu:"brush-color"===n.state.selectedButton,color:n.props.drawingDefaults.brush_color})},n.finishDrawing=function(){n.props.updateItemSelected(n.props.selectedItem.id,null)},n.state={numFittable:999,selectedButton:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.default),o(t,[{key:"getID",value:function(){return"drawing-toolbar"}},{key:"getButtons",value:function(){var e=this,n=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return n.push.apply(n,[u.createElement(m.default,r({key:"delete"},this.generateToolbarButtonProps("Delete","icon-delete1",this.delete))),u.createElement("div",{key:"spacer-1",className:"spacer"}),u.createElement(m.default,{key:"draw",text:"Draw",icon:"icon-drawing",iconPosition:"top",action:function(){e.handleUpdate("brush_mode",0)},active:0===this.props.drawingDefaults.brush_mode}),u.createElement(m.default,{key:"erase",text:"Erase",icon:"icon-erase",iconPosition:"top",action:function(){e.handleUpdate("brush_mode",1)},active:1===this.props.drawingDefaults.brush_mode}),u.createElement("div",{key:"spacer-2",className:"spacer"}),this.renderBrushSize(),this.renderBrushColor(),this.renderOpacitySlider(),u.createElement(m.default,{key:"done",text:"Done",icon:"icon-tick",iconPosition:"top",action:this.finishDrawing}),u.createElement("div",{key:"spacer-3",className:"spacer"}),u.createElement(m.default,r({key:"send-to-front"},this.generateToolbarButtonProps("To Front","icon-bringtop",this.moveToFront),{iconPosition:"top"})),u.createElement(m.default,r({key:"send-to-back"},this.generateToolbarButtonProps("To Back","icon-bringbot",this.moveToBack),{iconPosition:"top"}))]),n}},{key:"handleUpdate",value:function(e,t,n){var r=Object.assign({},this.props.drawingDefaults);r[e]=t,this.props.updateDrawingDefaults(r),n&&this.setState({selectedButton:""})}}]),t}();v.defaultProps={drawingDefaults:{brush_color:"#000",brush_mode:0,brush_size:12,brush_style:"CUBIC_BEZIER_BRUSH",brush_opacity:1}};t.default=(0,d.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedSlide:n,canvas:e.buncee.document.canvas,clipboard:e.clipboard,drawingDefaults:e.item_defaults.drawing,user:e.user,preferences:e.preferences}},function(e,t){return{updateItem:function(n,r,o){r=void 0!==t.selectedItemParent?t.selectedItemParent.id+'.content.body.{"id": "'+n.id+'"}'+(r.length>0?"."+r:r):n.id+(r.length>0?"."+r:r),e(i.Actions.updateItem({path:r,value:o}))},updateDrawingDefaults:function(t){e(i.Actions.updateItemDefaults({path:"drawing",value:t}))},updateItemSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},setItems:function(t,n){e(i.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(i.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(i.Actions.updateClipboard({path:"",value:t}))},removeItem:function(n,r,o){var s=[];if(s.push(i.Actions.updateItemsSelected({path:r.id,value:null})),void 0!==t.selectedItemParent){var c=(0,a.ungroupItems)(t.selectedItemParent,n,o);if(2===c.items.length)s.push(i.Actions.updateItem({path:"",value:(0,l.omit)(c.newItemDict,[r.id])})),s.push(i.Actions.updateSlide({id:o.id,path:"items",value:p.ArrayUtil.findAndRemove(c.newSlideItems,function(e){return e===r.id})}));else{c.items=(0,l.filter)(c.items,function(e){return e.id!==r.id}),c.newItemDict=(0,l.omit)(c.newItemDict,[r.id]),c.newSlideItems=(0,l.remove)(c.newSlideItems,r.id);var u=(0,a.createGroup)(c.items,c.newItemDict,Object.assign({},o,{items:c.newSlideItems}),t.selectedItemParent.name);s.push(i.Actions.updateItem({path:"",value:u.newItemDict})),s.push(i.Actions.updateSlide({id:o.id,path:"items",value:u.newSlideItems}))}}else s.push(i.Actions.updateItem({path:"",value:(0,l.omit)(n,[r.id])})),s.push(i.Actions.updateSlide({id:o.id,path:"items",value:p.ArrayUtil.findAndRemove(o.items,function(e){return e===r.id})}));e(i.Actions.batchActions({actions:s}))},addItem:function(t,n){e(i.Actions.addItem({item:t})),e(i.Actions.updateSlide({id:n.id,path:"items",value:p.ArrayUtil.push(n.items,t.id)}))},addSlide:function(t,n,r){void 0===r?i.Actions.updateSlide({path:"",value:n}):e(i.Actions.batchActions({actions:[i.Actions.updateSlide({path:"",value:n}),i.Actions.updateItem({path:"",value:r}),i.Actions.updateSlideSelected({path:p.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},openBrowser:function(t){e(i.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:n}),i.Actions.updateSlide({path:"",value:t})]}))}}})(v)},385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=p(n(84)),d=p(n(83));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.doneEditingBackground=function(){n.props.updateStore("isEditingBackground",!1)},n.state={selectedButton:"",numFittable:999},n.getButtons.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"getButtons",value:function(){var e=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getButtons",this).call(this);return e.push.apply(e,[s.createElement(d.default,r({key:"done"},this.generateToolbarButtonProps("Done","icon-tick",this.doneEditingBackground)))]),e}},{key:"getID",value:function(){return"background-toolbar"}}]),t}();t.default=(0,c.connect)(function(e){var t=e.buncee.selected_items,n=(0,a.keys)(t).filter(function(n){return void 0!==t[n]&&null!==t[n]&&t[n].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),r=e.buncee.selected_slides[e.user.id],o=e.buncee.document.slides.find(function(e){return e.id===r});return{items:e.buncee.document.items,slides:e.buncee.document.slides,selectedItem:n[0],selectedSlide:o,canvas:e.buncee.document.canvas,clipboard:e.clipboard,user:e.user,preferences:e.preferences}},function(e){return{setItems:function(t,n){e(i.Actions.updateSlide({path:"items",id:n,value:t}))},updateItemsSelected:function(t,n){e(i.Actions.updateItemsSelected({path:t,value:n}))},updateSlideSelected:function(t,n){e(i.Actions.updateSlideSelected({path:n,value:t}))},updateClipboard:function(t){e(i.Actions.updateClipboard({path:"",value:t}))},updateItem:function(t,n,r){e(i.Actions.updateItem({path:t.id+(n.length>0?"."+n:n),value:r}))},removeItem:function(t,n,r){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:(0,a.omit)(t,[n.id])}),i.Actions.updateSlide({id:r.id,path:"items",value:l.ArrayUtil.findAndRemove(r.items,function(e){return e===n.id})})]}))},addItem:function(t,n){e(i.Actions.addItem({item:t})),e(i.Actions.updateSlide({id:n.id,path:"items",value:l.ArrayUtil.push(n.items,t.id)}))},addSlide:function(t,n,r){void 0===r?i.Actions.updateSlide({path:"",value:n}):e(i.Actions.batchActions({actions:[i.Actions.updateSlide({path:"",value:n}),i.Actions.updateItem({path:"",value:r}),i.Actions.updateSlideSelected({path:l.User.getUser().guid,value:t.id})]}))},undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},openBrowser:function(t){e(i.Actions.openGateway({activeBrowser:t}))},removeSlide:function(t,n){e(i.Actions.batchActions({actions:[i.Actions.updateItem({path:"",value:n}),i.Actions.updateSlide({path:"",value:t})]}))},updateStore:function(t,n){e(i.Actions.updateStore({path:t,value:n}))}}})(f)},386:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(5),s=n(4),c=v(n(385)),l=v(n(384)),u=v(n(383)),d=v(n(382)),p=v(n(381)),f=v(n(380)),m=v(n(379)),h=v(n(273));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"render",value:function(){if(void 0===this.props.selectedItem)return this.props.isEditingBackground?i.createElement(c.default,null):i.createElement(m.default,null);switch(this.props.selectedItem.type||""){case"image":case"oembed":case"video":case"vimeo":case"youtube":case"panoramic":case"qrcode":case"three_d":return i.createElement(d.default,{selectedItem:this.props.selectedItem,selectedItemParent:this.props.selectedItemParent});case"shape":return i.createElement(f.default,{selectedItem:this.props.selectedItem,selectedItemParent:this.props.selectedItemParent});case"text":return i.createElement(h.default,{selectedItem:this.props.selectedItem,selectedItemParent:this.props.selectedItemParent});case"mcq":case"frq":return i.createElement(p.default,{selectedItem:this.props.selectedItem,selectedItemParent:this.props.selectedItemParent});case"drawing":return i.createElement(l.default,{selectedItem:this.props.selectedItem,selectedItemParent:this.props.selectedItemParent});case"group":return i.createElement(u.default,{selectedItem:this.props.selectedItem})}return i.createElement("div",null)}}]),t}();t.default=(0,a.connect)(function(e){var t=s.User.getUser(),n=(0,o.findKey)(e.buncee.selected_items,function(e){return void 0!==e&&null!==e&&e.id===t.guid}),r=n?e.buncee.document.items[n]:void 0,i=void 0;if(void 0===r){var a=(0,o.values)(e.buncee.document.items).filter(function(e){return void 0!==e&&null!==e&&"group"===e.type});(0,o.forEach)(a,function(e){(0,o.forEach)(e.content.body,function(t){t.id===n&&(r=t,i=e)})})}return{selectedItem:r,selectedItemParent:i,canvas:e.buncee.document.canvas,itemDefaults:e.item_defaults,isEditingBackground:e.isEditingBackground}},void 0)(y)},387:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(38),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.addTag=function(){var e=new URLSearchParams;e.set("data",JSON.stringify([n.tagInput.value])),i.Client.post("/buncees/"+n.props.bunceeId+"/tags",e).then(function(e){return e.json()}).then(function(e){n.props.addTag(e.data[0]),n.tagInput.value=""})},n.removeTag=function(){i.Client.delete("/buncees/"+n.props.bunceeId+"/tags/"+n.state.selectedTag).then(function(e){e.ok&&(n.props.removeTag(n.state.selectedTag),n.setState({selectedTag:void 0}))})},n.selectTag=function(e){n.setState({selectedTag:e.currentTarget.id})},n.state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"render",value:function(){var e=this;return a.createElement("div",{id:"tags-panel"},a.createElement("div",{className:"input-group"},a.createElement("input",{placeholder:"Tag your Buncee",ref:function(t){return e.tagInput=t}}),a.createElement("div",{className:"btn btn-blue",onClick:this.addTag},"Add")),a.createElement("div",{className:"tags"},a.createElement("ul",null,this.props.tags.map(function(t){return a.createElement("li",{key:t.guid,className:"tag "+(e.state.selectedTag===t.guid?"selected":""),id:t.guid,onClick:e.selectTag},a.createElement("p",null,t.tag),a.createElement("span",{className:"icon-delete2",onClick:e.removeTag}))}))))}}]),t}();t.default=(0,s.connect)(function(e){return{tags:e.buncee.tags,bunceeId:e.buncee.id}},function(e){return{addTag:function(t){e(o.Actions.addTag({tag:t}))},removeTag:function(t){e(o.Actions.removeTag({id:t}))}}})(c)},388:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5),c=n(194),l=(r=c)&&r.__esModule?r:{default:r};var u=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.getWebImages=function(){return(0,i.values)(e.props.items).filter(function(e){return"image"===e.type&&e.content.body.indexOf("pixabay")>-1})},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"render",value:function(){return a.createElement("div",{id:"image-attribution-panel"},a.createElement("p",null,"Source for images in this Buncee added from the web are listed below"),a.createElement("div",{className:"column"},this.getWebImages().map(function(e,t){return a.createElement("div",{key:e.id,className:"image-attribution"},a.createElement(l.default,{item:e,index:t,isSelected:!1,displayIndex:!1}),a.createElement("a",{href:e.content.body,target:"_blank"},a.createElement("span",{className:"icon-link"})))})))}}]),t}();t.default=(0,s.connect)(function(e){return{items:e.buncee.document.items}},void 0)(u)},389:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(38),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=n(56),d=(r=u)&&r.__esModule?r:{default:r};var p=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.shouldRenderDelete=function(t){var n=d.default.getUser();return n.guid===e.props.buncee.owner_guid||n.guid===t},e.handleKeyPress=function(t){"enter"!==l.KeyUtil.getKey(t.nativeEvent)||t.shiftKey||(e.addComment(),t.preventDefault())},e.formatDate=function(e){return"string"==typeof e?new Date(e).toLocaleString():e.toLocaleString()},e.addComment=function(){var t=e.commentInput.value;if(""!==t){var n=new URLSearchParams;n.set("body",t),a.Client.post("/buncees/"+e.props.buncee.id+"/comments",n).then(function(n){n.ok&&n.json().then(function(n){var r=d.default.getUser(),o={body:t,created_at:new Date,first_name:r.firstName,last_name:r.lastName,guid:n.data,avatar:r.avatar,owner_guid:r.guid};e.props.addComment(o),e.commentInput.value=""})})}},e.deleteComment=function(t){a.Client.delete("/buncees/"+e.props.buncee.id+"/comments/"+t).then(function(n){n.ok&&e.props.removeComment(t)})},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"render",value:function(){var e=this;return s.createElement("div",{id:"comments-panel"},s.createElement("div",{className:"comments"},this.props.comments.map(function(t){return s.createElement("div",{key:t.guid,className:"comment"},s.createElement("div",{className:"left"},s.createElement("img",{src:t.avatar,className:"avatar"})),s.createElement("div",{className:"right"},s.createElement("p",{className:"body"},s.createElement("span",{className:"name"},t.first_name," ",t.last_name)," ",t.body),s.createElement("p",{className:"timestamp"},e.formatDate(t.created_at)),e.shouldRenderDelete(t.owner_guid)&&s.createElement("p",{className:"delete",onClick:function(){return e.deleteComment(t.guid)}},"Delete")))})),s.createElement("div",{className:"comment-input"},s.createElement("textarea",{placeholder:"Enter a comment...",ref:function(t){return e.commentInput=t},maxLength:255,onKeyPress:this.handleKeyPress}),s.createElement("button",{className:"btn btn-blue",onClick:this.addComment},"Add Comment")))}}]),t}();t.default=(0,c.connect)(function(e){return{comments:e.bunceeMeta.comments,buncee:e.buncee}},function(e){return{addComment:function(t){e(i.Actions.addComment({value:t}))},removeComment:function(t){e(i.Actions.removeComment({value:t}))}}})(p)},390:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(38),i=n(11),a=p(n(6)),s=p(n(0)),c=n(5),l=n(4),u=n(16),d=n(151);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.deselectAllClips=function(){n.setState({selectedSlides:[]})},n.selectAllClips=function(){var e=n.props.slides.map(function(e){return e.id});n.setState({selectedSlides:e})},n.clip=function(){n.setState({clipping:!0});var e=new URLSearchParams;e.append("buncee_id",n.props.buncee_Id),n.reorderClips().forEach(function(t){var r=n.props.slides.find(function(e){return t===e.id});if(r){var o=new URLSearchParams;o.set("slide",r.id);var i={slides:[r],items:r.items.map(function(e){return n.props.items[e]}),canvas:n.props.canvas,thumbnail:window.config.web_uri+"/buncee/"+window.config.buncee_guid+"/thumbnail?"+o.toString(),slide_original_order:n.props.slides.indexOf(r)};e.append("slides[]",JSON.stringify(i))}});var t=new Headers;o.Client.post("/clips",e,t).then(function(e){e.ok?(n.setState({clipping:!1}),(0,u.displayToastMessage)("Clip Successful",3e3)):(n.setState({clipping:!1}),(0,u.displayToastMessage)("Clip Failed",3e3))})},n.selectSlide=function(e){n.state.selectedSlides.indexOf(e.currentTarget.id)>-1?n.setState({selectedSlides:n.state.selectedSlides.filter(function(t){return t!==e.currentTarget.id})}):n.setState({selectedSlides:l.ArrayUtil.push(n.state.selectedSlides,e.currentTarget.id)})},n.reorderClips=function(){var e=n.state.selectedSlides.map(function(e){return{index:n.props.slidesIds.indexOf(e),slideID:e}});return a.sortBy(e,["index"]).map(function(e){return e.slideID})},n.state={selectedSlides:[],clipping:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),r(t,[{key:"render",value:function(){var e=this;return s.createElement("div",{id:"clip-and-stitch-panel"},this.state.clipping?s.createElement("div",{className:"overlay"},s.createElement(i.LoadingIndicator,{color:"#00A3A8"})):null,s.createElement("div",{className:"row"},s.createElement("div",{className:"btn",onClick:this.selectAllClips},"Select All"),s.createElement("div",{className:"btn",onClick:this.deselectAllClips},"Deselect All")),s.createElement("div",{className:"clips grid"},this.props.slides.map(function(t,n){return s.createElement("div",{className:"clip",key:t.id,id:t.id,onClick:e.selectSlide},s.createElement(d.SlideThumbnail,{slide:t,index:n,isSelected:e.state.selectedSlides.indexOf(t.id)>-1,displayIndex:!0,prefix:"Page"}))})),s.createElement("div",{className:"clip-button-wrapper row"},s.createElement("button",{className:"clip-button btn btn-blue",onClick:this.clip,disabled:0===this.state.selectedSlides.length},"Clip ",this.state.selectedSlides.length>0?this.state.selectedSlides.length:null," Pages")))}}]),t}();t.default=(0,c.connect)(function(e){return{slides:e.buncee.document.slides,buncee_Id:e.buncee.id,items:e.buncee.document.items,canvas:e.buncee.document.canvas,slidesIds:e.buncee.document.slides.map(function(e){return e.id})}},void 0)(f)},398:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(38),s=n(11),c=n(6),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4),p=n(16),f=n(56),m=(r=f)&&r.__esModule?r:{default:r},h=n(259);var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.user=m.default.getUser(),n.handleScaleOffsetChange=function(e){n.props.updateScaleOffset(e)},n.renderImmersiveReader=function(){return!!window.config.hasOwnProperty("immersive_reader_key")&&!!(!m.default.isLoggedIn()||n.props.preferences.ireader&&n.props.preferences.ireader.value)},n.renderButtons=function(){var e=[];return"guest"!==n.user.guid||d.Device.isMobile()?n.user.guid===n.props.buncee.owner_guid?e.push(l.createElement("a",{href:n.props.links.edit,className:"btn btn-blue"},"Edit")):m.default.isLoggedIn()&&n.user.guid!==n.props.buncee.owner_guid&&n.props.buncee.copyable&&e.push(l.createElement("div",{className:"btn btn-white",onClick:function(){return n.props.openModal("copy")}},"Copy")):e.push(l.createElement("a",{href:window.config.web_uri+"/choose-account-type",id:"sign-up-button",className:"btn btn-pink"},"Sign Up Now!")),e.push(l.createElement("div",{className:"btn btn-orange",onClick:function(){return n.props.openModal("share")}},"Share")),l.createElement("div",{className:"column",id:"view-buttons"},l.createElement("div",{className:"buttons"},e))},n.renderLogo=function(){return m.default.isLoggedIn()?l.createElement(s.Tooltip,{text:"Back to your dashboard",direction:"down"},l.createElement("div",{className:"column"},l.createElement("a",{href:window.config.web_uri+"/dashboard"},l.createElement("img",{className:"buncee-logo",src:(0,d.cloudfrontURL)("/images/home/BunceeLogo-blackBETA.svg")})))):l.createElement("div",{className:"column"},l.createElement("a",{href:window.config.web_uri+"/dashboard"},l.createElement("img",{className:"buncee-logo",src:(0,d.cloudfrontURL)("/images/home/BunceeLogo-blackBETA.svg")})))},n.renderComments=function(){return n.props.buncee.commentable?l.createElement(s.Tooltip,{text:"Comments",direction:"down"},l.createElement("div",{className:"action-group",onClick:n.toggleCommentsPanel},l.createElement("span",{className:"icon-comment action-icon clickable"}),l.createElement("span",{className:"view-header-text"},n.props.bunceeMeta.comments.length))):void 0},n.renderLikes=function(){if(m.default.isLoggedIn())return l.createElement(s.Tooltip,{text:"Likes",direction:"down"},l.createElement("div",{className:"action-group",id:"buncee-likes",onClick:n.likeBuncee},n.renderLikeicon(),l.createElement("span",{className:"view-header-text"},n.props.bunceeMeta.likes)))},n.openClipsPanel=function(){n.props.openViewPanel(h.ViewPanelTypes.CLIP_AND_STITCH)},n.toggleImageAttributionPanel=function(){n.props.viewPanel===h.ViewPanelTypes.IMAGE_ATTRIBUTION?n.props.openViewPanel(null):n.props.openViewPanel(h.ViewPanelTypes.IMAGE_ATTRIBUTION)},n.toggleCommentsPanel=function(){m.default.isLoggedIn()&&(n.props.viewPanel===h.ViewPanelTypes.COMMENTS?n.props.openViewPanel(null):n.props.openViewPanel(h.ViewPanelTypes.COMMENTS))},n.likeBuncee=function(){a.Client.post("/buncees/"+n.props.buncee.id+"/like").then(function(e){e.ok&&(n.state.liked?n.props.updateLikes(n.props.bunceeMeta.likes-1):n.props.updateLikes(n.props.bunceeMeta.likes+1),n.setState({liked:!n.state.liked}))})},n.state={saving_status:"success",liked:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidMount",value:function(){var e=this;m.default.isLoggedIn()&&a.Client.get("/buncees/"+this.props.buncee.id+"/like").then(function(t){t.ok&&t.json().then(function(t){e.setState({liked:t.data})})})}},{key:"render",value:function(){var e=this;return l.createElement("div",{className:"header-wrapper view"},l.createElement("div",{className:"header",id:"view-header"},this.renderLogo(),l.createElement("div",{className:"main"},l.createElement("div",{className:"view-buncee-title"},l.createElement("h2",null,this.props.title),l.createElement("h4",null," by ",this.props.bunceeMeta.author)),l.createElement("div",{className:"actions"},l.createElement(s.Tooltip,{text:"Views",direction:"down"},l.createElement("div",{className:"action-group"},l.createElement("span",{className:"icon-view action-icon"}),l.createElement("span",{className:"view-header-text"},this.props.bunceeMeta.views))),this.renderLikes(),this.renderComments(),l.createElement(s.Tooltip,{text:"Image Attribution",direction:"down"},l.createElement("span",{className:"action-group clickable",onClick:this.toggleImageAttributionPanel},l.createElement("span",{className:"icon-attribution action-icon clickable"}))),this.renderImmersiveReader()?l.createElement("div",{className:"action-group immersive-reader",onClick:function(){return(0,d.launchImmersiveReader)(e.slideText())}},l.createElement("img",{src:(0,d.cloudfrontURL)("images/immersive-reader/ir-icon.svg")})):null,m.default.isLoggedIn()&&this.props.buncee.copyable?l.createElement("span",{className:"action-group",onClick:this.openClipsPanel},l.createElement("span",{className:"icon-clip action-icon clickable"})):null)),this.renderButtons()))}},{key:"renderLikeicon",value:function(){return this.state.liked?l.createElement("span",{className:"icon-like2hover action-icon clickable"}):l.createElement("span",{className:"icon-like2 action-icon clickable"})}},{key:"isText",value:function(e){switch(e){case"text":case"frq":case"mcq":return!0;default:return!1}}},{key:"slideText",value:function(){var e=this,t="";this.props.slides[0].id===this.props.slide.id&&(t+=this.props.title+"\n");var n=this.props.slide.items.map(function(t,n){if(e.props.items[t]&&e.isText(e.props.items[t].type))return e.props.items[t]}).filter(function(e){return e}),r=0,o={};(0,c.sortBy)(n,function(e){return e.frame.origin.y}).forEach(function(e){0===r&&(r=e.frame.origin.y),e.frame.origin.y<=r+100?o[r]?o[r]=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(o[r]),[e]):o[r]=[e]:(r=e.frame.origin.y,o[r]=[e])});var i=[];return(0,c.forEach)(o,function(e){i.push((0,c.sortBy)(e,function(e){return e.frame.origin.x}))}),(0,c.flattenDeep)(i).forEach(function(e){"text"===e.type&&e.content.body.ops&&e.content.body.ops.forEach(function(e){t+=e.insert}),"frq"===e.type&&(t+=e.content.body.question+"\n"),"mcq"===e.type&&(t+=(0,p.mcqToString)(e)+"\n")}),t}}]),t}(),y=(0,u.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{title:e.buncee.title,links:e.links,bunceeMeta:e.bunceeMeta,buncee:e.buncee,viewPanel:e.viewPanel,slide:n,slides:e.buncee.document.slides,items:e.buncee.document.items,preferences:e.preferences}},function(e){return{undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},updateScaleOffset:function(t){e(i.Actions.updateStore({path:"displaySettings.scaleOffset",value:t}))},openModal:function(t,n){e(i.Actions.openModal({type:t,props:n}))},openViewPanel:function(t){e(i.Actions.openViewPanel({viewPanel:t}))},updateLikes:function(t){e(i.Actions.updateLikes({value:t}))}}})(v);t.default=y},399:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(11),a=n(6),s=n(197),c=(r=s)&&r.__esModule?r:{default:r},l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderThumbnail=function(){var e=document.createElement("canvas");e.style.width="100%",e.style.height="100%";var t=e.getContext("2d"),r=document.createElement("div");r.style.width="100%",r.style.height="100%";var o=new c.default(r);"string"==typeof n.props.item.content.body?o.setText(n.props.item.content.body):o.setContents(n.props.item.content.body);var i=new Image;i.onload=function(){t.drawImage(i,0,0),e.toBlob(function(e){var t=URL.createObjectURL(e);n.setState({src:t,loaded:!0})})};var a="<svg xmlns='http://www.w3.org/2000/svg' width='"+n.props.item.frame.width+"' height='"+n.props.item.frame.height+"'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml'>"+r.innerHTML.toString()+"</div></foreignObject></svg>";a=a.replace("<br>","<br/>"),i.src="data:image/svg+xml,"+a},n.state={loaded:!1,src:"https://3efaa8228ae8d8782d83-d080dc8acde12e16e524531aade69ab5.ssl.cf5.rackcdn.com/shared/loading-indicator-80x80.gif"},n.renderThumbnail=(0,a.throttle)(n.renderThumbnail,2e3,{trailing:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidMount",value:function(){this.renderThumbnail()}},{key:"componentDidUpdate",value:function(e){JSON.stringify(this.props.item.content.body)!==JSON.stringify(e.item.content.body)&&this.renderThumbnail()}},{key:"render",value:function(){return l.createElement(i.LazyLoadImage,{src:this.state.src})}}]),t}();t.default=u},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.launchImmersiveReader=t.getURLParameter=t.confirm=t.getCanvasScale=t.getCanvasDimensions=t.cloudfrontURL=t.initializeIds=t.generateUser=t.generateStoreBuncee=t.generateStore=t.generateSlide=t.generateItem=t.fileStackClient=t.User=t.QuillSingleton=t.Quill=t.ColorUtil=t.KeyUtil=t.TypeUtil=t.ObjectUtil=t.GeometryUtil=t.Device=t.AsyncUtil=t.ArrayUtil=void 0;var r=w(n(658)),o=w(n(657)),i=w(n(312)),a=g(n(165)),s=g(n(310)),c=g(n(270)),l=n(144),u=w(n(140)),d=n(16),p=w(n(452)),f=n(451),m=w(n(313)),h=g(n(269)),v=g(n(444)),y=w(n(443)),b=g(n(56));function g(e){return e&&e.__esModule?e:{default:e}}function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.ArrayUtil=r,t.AsyncUtil=o,t.Device=s.default,t.GeometryUtil=u,t.ObjectUtil=m,t.TypeUtil=y,t.KeyUtil=p,t.ColorUtil=i,t.Quill=h.default,t.QuillSingleton=v.default,t.User=b.default,t.fileStackClient=c.default,t.generateItem=l.generateItem,t.generateSlide=l.generateSlide,t.generateStore=l.generateStore,t.generateStoreBuncee=l.generateStoreBuncee,t.generateUser=l.generateUser,t.initializeIds=l.initializeIds,t.cloudfrontURL=d.cloudfrontURL,t.getCanvasDimensions=d.getCanvasDimensions,t.getCanvasScale=d.getCanvasScale,t.confirm=a.default,t.getURLParameter=d.getURLParameter,t.launchImmersiveReader=f.launchImmersiveReader},400:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(263),i=(r=o)&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item.content.attributes,n=Object.assign({},e.item,{frame:Object.assign({},e.item.frame,{width:118,height:60}),content:Object.assign({},e.item.content,{attributes:Object.assign({},t)})}),r="ellipse"===t.type||"rectangle"===t.type||"triangle"===t.type;return a.createElement("div",{className:"shape-thumbnail "+(r?"":"padded")},a.createElement("div",{style:{transform:"scale(1, 1)"}},a.createElement(i.default,{item:n,mode:"thumbnail",displaySettings:{scale:1,scaleOffset:100,isPanning:!1,viewportOffset:{x:0,y:0},isEmbed:!1,isFullscreen:!1,renderFooter:!1},is_selected:!1})))}},401:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderThumbnail=function(){var e=document.createElement("canvas");e.style.width="100%",e.style.height="100%";var t=e.getContext("2d"),r=document.createElement("div");r.style.width="100%",r.style.height="100%";var o=n.props.item.content.attributes;if(o){var i=new Image;r.innerHTML=n.props.item.content.body.question,i.onload=function(){t.drawImage(i,0,0),e.toBlob(function(e){var t=URL.createObjectURL(e);n.setState({src:t,loaded:!0})})};var a="<svg xmlns='http://www.w3.org/2000/svg' width='"+n.props.item.frame.width+"' height='"+n.props.item.frame.height+"'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml'\n\t\t\t\tstyle=\n\t\t\t\t\"\n\t\t\t\t\tcolor:"+o.color+";\n\t\t\t\t\tfont-size:"+o.size+";\n\t\t\t\t\tfont-weight:"+(o.bold?"bold":"normal")+";\n\t\t\t\t\tfont-style:"+(o.italic?"italic":"normal")+";\n\t\t\t\t\ttext-decoration:"+(o.underline?"underline":"none")+";\n\t\t\t\t\ttext-align:"+o.alignment+';\n\t\t\t\t">'+r.innerHTML.toString()+"</div></foreignObject></svg>";a=a.replace("<br>","<br/>"),i.src="data:image/svg+xml,"+a}},n.state={loaded:!1,src:"https://3efaa8228ae8d8782d83-d080dc8acde12e16e524531aade69ab5.ssl.cf5.rackcdn.com/shared/loading-indicator-80x80.gif"},n.renderThumbnail=(0,i.throttle)(n.renderThumbnail,2e3,{trailing:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentDidMount",value:function(){this.renderThumbnail()}},{key:"componentDidUpdate",value:function(e){JSON.stringify(this.props.item.content.body)===JSON.stringify(e.item.content.body)&&JSON.stringify(this.props.item.content.attributes)===JSON.stringify(e.item.content.attributes)||this.renderThumbnail()}},{key:"render",value:function(){return a.createElement(o.LazyLoadImage,{src:this.state.src})}}]),t}();t.default=s},402:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(5),s=n(194);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderMoreItemsLabel=function(e){return e.length>3?i.createElement("div",{className:"more-items"},i.createElement("p",null,"+",e.length-3)):void 0},n.openEditModal=function(){n.props.openModal("input"),n.props.openModal("input",{handleSubmit:n.handleNameSubmit,title:"Rename Group",message:"Please Enter a Group Name",value:n.props.item.name})},n.handleNameSubmit=function(e){n.props.editGroupName(e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"render",value:function(){var e=this.props.item.content.body,t=["group-thumbnail"];return"string"!=typeof this.props.item.name&&t.push("no-title"),i.createElement("div",{className:t.join(" ")},i.createElement("div",{className:"title-bar"},i.createElement("span",{className:"icon-folder"}),i.createElement("span",{className:"title"},this.props.item.name),i.createElement("span",{className:"icon-edit",onClick:this.openEditModal})),e.slice(0,3).map(function(e,t){return i.createElement("div",{key:"group-item-"+t,className:"group-item-thumbnail"},(0,s.getThumbnailForItem)(e))}),this.renderMoreItemsLabel(e))}}]),t}(),l=(0,a.connect)(void 0,function(e,t){return{editGroupName:function(n){e(o.Actions.updateItem({path:t.item.id+".name",value:n}))},openModal:function(t,n){e(o.Actions.openModal({type:t,props:n}))}}})(c);t.default=l},403:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(196)),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(4);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.canvas=null,n.drawContent=(0,a.throttle)(n.drawContent,2e3,{trailing:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidMount",value:function(){this.proxyContext=new i.default(this.canvas.getContext("2d"))}},{key:"clearCanvas",value:function(){this.renderingContext.clearRect(0,0,this.renderingContext.canvas.width,this.renderingContext.canvas.height)}},{key:"componentDidUpdate",value:function(){this.drawContent()}},{key:"drawContent",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof this.props.item.content.body.base_image){e.next=18;break}return e.prev=1,e.next=4,c.AsyncUtil.loadImage(this.props.item.content.body.base_image);case 4:t=e.sent,this.clearCanvas(),this.renderingContext.save(),this.renderingContext.globalCompositeOperation="source-over",this.renderingContext.drawImage(t,0,0),this.renderingContext.restore(),this.proxyContext.execute(this.props.item.content.body.commands),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1);case 16:e.next=20;break;case 18:this.clearCanvas(),this.proxyContext.execute(this.props.item.content.body.commands);case 20:case"end":return e.stop()}},e,this,[[1,13]])}))}},{key:"render",value:function(){var e=this,t=130/this.props.item.frame.width,n=70/this.props.item.frame.height,r=Math.min(n,t),o={width:this.props.item.frame.width+"px",height:this.props.item.frame.height+"px",transform:"scale("+r+", "+r+")"};return s.createElement("div",{className:"drawing-thumbnail"},s.createElement("div",{style:o},s.createElement("canvas",{width:this.props.item.frame.width,height:this.props.item.frame.height,ref:function(t){e.canvas=t}})))}},{key:"renderingContext",get:function(){return this.proxyContext.innerContext}}]),t}();t.default=d},404:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,i.default)(e,Object.assign({},t,{content:{type:"url",body:"https://img.youtube.com/vi/"+t.content.body+"/hqdefault.jpg"}}))};var r,o=n(101),i=(r=o)&&r.__esModule?r:{default:r}},405:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,i.default)(e,Object.assign({},t,{content:{type:"url",body:"https://i.vimeocdn.com/video/"+t.content.body+"_295x166.jpg"}}))};var r,o=n(101),i=(r=o)&&r.__esModule?r:{default:r}},406:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(function(n,r){var o=document.createElement("video");o.width=t.frame.width,o.height=t.frame.height,o.preload="metadata",o.controls=!1,o.src=t.content.body,o.onerror=r,o.oncanplay=function(){try{var i=e.getContext("2d");i.drawImage(o,t.frame.origin.x,t.frame.origin.y,t.frame.width,t.frame.height),n(e)}catch(e){r("Something went wrong")}}})}},407:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=document.createElement("div");n.style.width="100%",n.style.height="100%",new r.default(n).setContents(t.content.body);var i=n.innerHTML.toString(),a='\n\t \t<svg xmlns="http://www.w3.org/2000/svg" width="'+t.frame.width+'" height="'+t.frame.height+'">\n\t\t\t<foreignObject width="100%" height="100%">\n\t\t\t\t<div xmlns="http://www.w3.org/1999/xhtml">\n\t\t\t\t\t'+i+"\n\t\t\t\t</div>\n\t\t\t</foreignObject>\n\t\t</svg>\n\t";return a=a.replace("<br>","<br/>"),(0,o.default)(e,Object.assign({},t,{content:{type:"url",body:"data:image/svg+xml,"+a}}))};var r=i(n(197)),o=i(n(101));function i(e){return e&&e.__esModule?e:{default:e}}},408:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.svgRectangle=s,t.svgEllipse=c,t.svgTriangle=l,t.default=function(e,t){if("polygon"===t.content.attributes.type)return new Promise(function(n,r){(0,o.requestSVGData)(t,"view",function(o){(0,a.default)(e,Object.assign({},t,{content:{type:"url",body:"data:image/svg+xml,"+o}})).then(n).catch(r)})});var n=void 0;switch(t.content.attributes.type){case"ellipse":n=c(t);break;case"rectangle":n=s(t);break;case"triangle":n=l(t);break;default:throw new Error("Unrecognized shape.")}return(0,a.default)(e,Object.assign({},t,{content:{type:"url",body:"data:image/svg+xml,"+n}}))};var r,o=n(195),i=n(101),a=(r=i)&&r.__esModule?r:{default:r};function s(e){var t=e.content.attributes;return t.stroke_dasharray="string"==typeof t.stroke_dasharray?t.stroke_dasharray:"",'\n\t \t<svg\n\t \t\txmlns="http://www.w3.org/2000/svg"\n\t \t\twidth="'+e.frame.width+'"\n\t\t\theight="'+e.frame.height+'"\n\t\t\tfill-opacity="'+t.fill_opacity+'"\n\t\t\tstroke-width="'+t.stroke_width+'"\n\t\t\tfill="'+t.fill+'"\n\t\t\tstroke="'+t.stroke+'"\n\t\t\t>\n\t\t\t<rect\n\t\t\t\twidth="'+e.frame.width+'"\n\t\t\t\theight="'+e.frame.height+'"\n\t\t\t />\n\t\t</svg>\n\t'}function c(e){var t=e.content.attributes;t.stroke_dasharray="string"==typeof t.stroke_dasharray?t.stroke_dasharray:"";var n=e.frame.width/2,r=e.frame.height/2,o=(e.frame.width-t.stroke_width)/2,i=(e.frame.height-t.stroke_width)/2;return'\n\t\t<svg\n\t \t\txmlns="http://www.w3.org/2000/svg"\n\t \t\twidth="'+e.frame.width+'"\n\t\t\theight="'+e.frame.height+'"\n\t\t\tfill="'+t.fill+'"\n\t\t\tstroke="'+t.stroke+'"\n\t\t\tfill-opacity="'+t.fill_opacity+'"\n\t\t\tstroke-width="'+t.stroke_width+'"\n\t \t>\n\t \t\t<ellipse\n\t\t\t\twidth="'+e.frame.width+'"\n\t\t\t\theight="'+e.frame.height+'"\n\t\t\t\tcx="'+n+'"\n\t\t\t\tcy="'+r+'"\n\t\t\t\trx="'+o+'"\n\t\t\t\try="'+i+'" />\n\t \t</svg>\n\t'}function l(e){var t=e.content.attributes;t.stroke_dasharray="string"==typeof t.stroke_dasharray?t.stroke_dasharray:"";var n=[[e.frame.width/2,t.stroke_width],[t.stroke_width+t.stroke_width/2,e.frame.height-t.stroke_width/2],[e.frame.width-t.stroke_width,e.frame.height-t.stroke_width/2]].join(" ");return'\n\t\t<svg\n\t \t\txmlns="http://www.w3.org/2000/svg"\n\t \t\twidth="'+e.frame.width+'"\n\t\t\theight="'+e.frame.height+'"\n\t\t\tfill="'+t.fill+'"\n\t\t\tstroke="'+t.stroke+'"\n\t\t\tfill-opacity="'+t.fill_opacity+'"\n\t\t\tstroke-width="'+t.stroke_width+'"\n\t \t>\n\t \t\t<polygon\n\t \t\t\tpoints="'+n+'"\n\t\t\t\twidth="'+e.frame.width+'"\n\t\t\t\theight="'+e.frame.height+'"\n\t \t</svg>\n\t'}},409:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(function(n,i){var a=new Image;a.onerror=function(){n(e)},a.onload=function(){try{var r=e.getContext("2d");(0,o.drawImage)(r,a,t.frame,t.opacity,t.rotation,t.flipH,t.flipV),n(e)}catch(e){i("Something went wrong")}},a.src=r.Client.getBaseURI()+"/qr_code?data="+encodeURIComponent(window.config.view_link)})};var r=n(38),o=n(260)},410:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(function(n,r){(0,o.fetchEmbedData)(t).then(function(o){(0,a.default)(e,Object.assign({},t,{content:{type:"url",body:o.thumbnail_url}})).then(n).catch(r)})})};var r,o=n(264),i=n(101),a=(r=i)&&r.__esModule?r:{default:r}},411:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(function(n,i){var a=t,s=function(){var t=new r.default(e.getContext("2d"));t.execute(a.content.body.commands),n(e)};"string"==typeof a.content.body.base_image?(0,o.default)(e,Object.assign({},t,{content:{type:"url",body:a.content.body.base_image}})).then(s).catch(i):s()})};var r=i(n(196)),o=i(n(101));function i(e){return e&&e.__esModule?e:{default:e}}},412:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return m[t.type](e,t)};var r=p(n(411)),o=p(n(101)),i=p(n(410)),a=p(n(409)),s=p(n(408)),c=p(n(407)),l=p(n(406)),u=p(n(405)),d=p(n(404));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){return Promise.resolve(e)},m={image:o.default,text:c.default,drawing:r.default,video:l.default,panoramic:o.default,oembed:i.default,youtube:d.default,vimeo:u.default,group:f,shape:s.default,soundcloud:f,qrcode:a.default,frq:f,mcq:f,three_d:o.default}},413:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){try{var n=e.getContext("2d");if("color"===t.type)return n.globalAlpha=t.attributes?t.attributes.opacity:1,n.fillStyle=t.body,n.fillRect(0,0,e.width,e.height),Promise.resolve(e);if("url"===t.type)return new Promise(function(r,o){var i=new Image;i.onload=function(){var o=0,a=0,s=e.height/i.height;i.width/i.height<e.width/e.height&&(s=e.width/i.width),a=i.height*s,o=i.width*s,n.save(),n.globalAlpha=t.attributes?t.attributes.opacity:1,n.drawImage(i,t.attributes.x,t.attributes.y,o,a),n.restore(),r(e)},i.onerror=o,i.src=t.body});throw new Error("Unsupported background content type.")}catch(e){return Promise.reject("Something went wrong")}}},414:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(140),a=c(n(413)),s=c(n(412));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"enqueue",value:function(t,n,r){var o=new Promise(function(o,i){e.promiseQueue.push({canvasFrame:t,background:n,resolve:o,reject:i,items:r})});return this.worker(),o}},{key:"worker",value:function(){return l(this,void 0,void 0,r.default.mark(function t(){var n,o,c,l,u,d,p,f,m,h,v,y,b,g,w;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.working){t.next=2;break}return t.abrupt("return");case 2:if(0!==e.promiseQueue.length){t.next=4;break}return t.abrupt("return");case 4:return e.working=!0,n=e.promiseQueue.shift(),(o=document.createElement("canvas")).width=n.canvasFrame.width,o.height=n.canvasFrame.height,t.prev=9,t.next=12,(0,a.default)(o,{type:"color",body:"#fff",attributes:{opacity:1}});case 12:if(!n.background){t.next=15;break}return t.next=15,(0,a.default)(o,n.background);case 15:c=!0,l=!1,u=void 0,t.prev=18,d=n.items[Symbol.iterator]();case 20:if(c=(p=d.next()).done){t.next=57;break}if("group"!==(f=p.value).type){t.next=52;break}m=f.content.body,h=!0,v=!1,y=void 0,t.prev=27,b=m[Symbol.iterator]();case 29:if(h=(g=b.next()).done){t.next=36;break}return w=g.value,t.next=33,(0,s.default)(o,Object.assign({},w,{frame:(0,i.offsetRect)(f.frame.origin,w.frame)}));case 33:h=!0,t.next=29;break;case 36:t.next=42;break;case 38:t.prev=38,t.t0=t.catch(27),v=!0,y=t.t0;case 42:t.prev=42,t.prev=43,!h&&b.return&&b.return();case 45:if(t.prev=45,!v){t.next=48;break}throw y;case 48:return t.finish(45);case 49:return t.finish(42);case 50:t.next=54;break;case 52:return t.next=54,(0,s.default)(o,f);case 54:c=!0,t.next=20;break;case 57:t.next=63;break;case 59:t.prev=59,t.t1=t.catch(18),l=!0,u=t.t1;case 63:t.prev=63,t.prev=64,!c&&d.return&&d.return();case 66:if(t.prev=66,!l){t.next=69;break}throw u;case 69:return t.finish(66);case 70:return t.finish(63);case 71:n.resolve(o),e.working=!1,this.worker(),t.next=81;break;case 76:t.prev=76,t.t2=t.catch(9),n.reject(t.t2),e.working=!1,this.worker();case 81:case"end":return t.stop()}},t,this,[[9,76],[18,59,63,71],[27,38,42,50],[43,,45,49],[64,,66,70]])}))}}]),e}();u.promiseQueue=[],t.default=new u},415:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=p(n(56)),d=p(n(261));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onItemClicked=function(e){var t=n.props.slides[e];n.props.setSlideSelected(t,n.props.user),n.props.isPanning&&n.props.updateDisplaySettings("isPanning",!1),n.state={addSlideButtonIndex:-1},void 0!==n.props.selectedItem&&n.props.setItemSelected(n.props.selectedItem.id,null)},n.onReorder=function(e,t){var r=n.props.slides.slice(),o=r[e];r.splice(e,1),r.splice(t,0,o),n.props.setSlides(r)},n.createNewSlide=function(e){var t=n.props.slides.length;"number"==typeof e?t=e:n.state.addSlideButtonIndex>-1&&(t=n.state.addSlideButtonIndex),n.props.addSlide(n.props.slides,t),void 0!==n.props.selectedItem&&n.props.setItemSelected(n.props.selectedItem.id,null),n.props.isPanning&&n.props.updateDisplaySettings("isPanning",!1),n.setState({addSlideButtonIndex:-1})},n.showSlideOptionsModal=function(){n.props.openModal("stitch",{addSlide:n.createNewSlide,openStitch:n.openStitch})},n.onAddBetweenClicked=function(e){n.setState({addSlideButtonIndex:e+1},function(){n.props.preferences.stitching.value?n.showSlideOptionsModal():n.createNewSlide(e+1)})},n.renderAddButtonBetween=function(e){return s.createElement("div",{key:"add-slide-button",className:"btn add-button add-slide-button spacer-item",onClick:function(){n.onAddBetweenClicked(e)}},s.createElement("span",{className:"icon-add"}))},n.openStitch=function(){n.props.openStitch(n.state.addSlideButtonIndex>-1?n.state.addSlideButtonIndex:void 0),n.setState({addSlideButtonIndex:-1})},n.state={addSlideButtonIndex:-1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),r(t,[{key:"onPanelOpen",value:function(){var e=document.getElementsByClassName("canvas-toolbar")[0];e&&(e.style.marginLeft="140px");var t=document.getElementById("item-action-toolbar");t&&(t.style.paddingLeft="140px"),window.dispatchEvent(new Event("resize"))}},{key:"onPanelClose",value:function(){var e=document.getElementsByClassName("canvas-toolbar")[0];e&&(e.style.marginLeft="0");var t=document.getElementById("item-action-toolbar");t&&(t.style.paddingLeft="0"),window.dispatchEvent(new Event("resize"))}},{key:"componentDidMount",value:function(){l.Device.isIPadOrIPhone()||this.onPanelOpen()}},{key:"render",value:function(){var e=this,t=s.createElement("div",{key:"add-slide-button",className:"btn add-button add-slide-button static",onClick:this.props.preferences.stitching.value?this.showSlideOptionsModal:function(){return e.createNewSlide()}},s.createElement("span",{className:"icon-add"})),n=this.props.slides.map(function(t,n){return s.createElement(d.default,{key:t.id,slide:t,index:n,isSelected:e.props.selectedSlides[e.props.user.id]===t.id})}),r=[t];return s.createElement(i.ReorderableSidePanel,{name:"Pages",classNames:["slides-panel"],reorderableChildren:n,staticChildren:r,staticChildrenPosition:"bottom",onItemClicked:this.onItemClicked,onReorder:this.onReorder,isOpen:!l.Device.isIPadOrIPhone(),onOpen:this.onPanelOpen,onClose:this.onPanelClose,renderContentBetween:this.renderAddButtonBetween})}}]),t}(),m=(0,c.connect)(function(e){var t=e.buncee.document.slides,n=e.buncee.selected_slides,r=e.user,o=e.renderingMode,i=e.buncee.selected_items;return{slides:t,selectedSlides:n,user:r,mode:o,selectedItem:(0,a.keys)(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]})[0],preferences:e.preferences,isPanning:e.displaySettings.isPanning}},function(e,t){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(t),{addSlide:function(t,n){var r=(0,l.generateSlide)(),i=l.ArrayUtil.insert(t,r,n);e(o.Actions.batchActions({actions:[o.Actions.updateSlide({path:"",value:i}),o.Actions.updateSlideSelected({path:u.default.getUser().guid,value:r.id})]}))},setSlides:function(t){e(o.Actions.updateSlide({path:"",value:t}))},setSlideSelected:function(t,n){e(o.Actions.updateSlideSelected({path:n.id,value:t.id}))},setItemSelected:function(t,n){e(o.Actions.updateItemsSelected({path:t,value:n})),e(o.Actions.updateItemDefaults({path:"",value:{}}))},openModal:function(t,n){e(o.Actions.openModal({type:t,props:n}))},openStitch:function(t){e(o.Actions.openGateway({activeBrowser:"stitch",addToIndex:t}))},updateDisplaySettings:function(t,n){e(o.Actions.updateStore({path:"displaySettings."+t,value:n}))}}})(f);t.default=m},416:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=n(151);var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onItemClicked=function(e){var t=n.props.items[e],r=n.props.items.find(function(e){return e.id===n.props.selectedItem});void 0!==r&&n.props.setItemSelected(r,null),n.props.setItemSelected(t,n.props.user)},n.onReorder=function(e,t){var r=n.props.slide.items.reverse().slice(),o=r[e];r.splice(e,1),r.splice(t,0,o),n.props.setItems(r.reverse(),n.props.slide.id)},n.openGateway=function(e){n.props.selectedItem&&n.props.deselectItemSelected(n.props.selectedItem),n.props.openGateway("number"==typeof e?e+1:void 0)},n.renderAddButtonBetween=function(e){return s.createElement("div",{className:"btn add-button add-item-button static",key:"add-item-button",onClick:function(){return n.openGateway(e)}},s.createElement("span",{className:"icon-add"}))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),r(t,[{key:"onPanelOpen",value:function(){var e=document.getElementsByClassName("canvas-toolbar")[0];e&&(e.style.marginRight="140px");var t=document.getElementById("item-action-toolbar");t&&(t.style.paddingRight="140px"),window.dispatchEvent(new Event("resize"))}},{key:"onPanelClose",value:function(){var e=document.getElementsByClassName("canvas-toolbar")[0];e&&(e.style.marginRight="0");var t=document.getElementById("item-action-toolbar");t&&(t.style.paddingRight="0"),window.dispatchEvent(new Event("resize"))}},{key:"componentDidMount",value:function(){l.Device.isIPadOrIPhone()||this.onPanelOpen()}},{key:"render",value:function(){var e=this,t=s.createElement("div",{className:"btn add-button add-item-button static",key:"add-item-button",onClick:function(){return e.openGateway()}},s.createElement("span",{className:"icon-add"})),n=this.props.items.map(function(t,n){return s.createElement(u.ItemThumbnail,{key:t.id,item:t,index:n,isSelected:e.props.selectedItem===t.id})}),r=[t];return s.createElement(i.ReorderableSidePanel,{name:"Items",classNames:["items-panel"],reorderableChildren:n,staticChildren:r,staticChildrenPosition:"top",onItemClicked:this.onItemClicked,onReorder:this.onReorder,direction:"right",isOpen:!l.Device.isIPadOrIPhone(),onOpen:this.onPanelOpen,onClose:this.onPanelClose,renderContentBetween:this.renderAddButtonBetween})}}]),t}(),p=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=n.items.map(function(t){return e.buncee.document.items[t]}).reverse().filter(function(e){return e}),o=e.user;return{items:r,selectedItem:(0,a.findKey)(e.buncee.selected_items,function(e){return void 0!==e&&null!==e&&e.id===o.id}),slide:n,user:o}},function(e,t){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(t),{setItems:function(t,n){e(o.Actions.updateSlide({path:"items",id:n,value:t}))},setItemSelected:function(t,n){e(o.Actions.updateItemsSelected({path:t.id,value:n}))},deselectItemSelected:function(t){e(o.Actions.updateItemsSelected({path:t,value:null}))},openGateway:function(t){e(o.Actions.openGateway({activeBrowser:"itemgateway",addToIndex:t}))}}})(d);t.default=p},417:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),c=n(151),l=n(11),u=n(6),d=y(u),p=y(n(0)),f=n(5),m=n(4),h=n(16),v=n(56);function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.user=v.User.getUser(),n.baseFooterRect={width:850,height:235,origin:{x:0,y:0}},n.renderCompactView=function(){return p.createElement("div",{className:"footer mobile-landscape"},n.renderSlidePreviews(),n.renderPreviewSlidesButton(),n.renderFullscreenButton())},n.renderSlideControls=function(){return n.props.slides.length>1?p.createElement("div",{className:"row",id:"slide-controls"},n.renderPreviewSlidesButton(),p.createElement("div",{className:"row"},p.createElement("span",{className:"clickable icon icon-tabsleft "+(0===n.props.currentSlideIndex?" disabled":""),onClick:n.decrementCurrentSlide}),p.createElement("input",{id:"slide-number-input",type:"number",defaultValue:(n.props.currentSlideIndex+1).toString(),max:n.props.slides.length,onKeyDown:n.handleKeyDown,ref:function(e){return n.slideInput=e}}),p.createElement("p",null," of ",n.props.slides.length),p.createElement("span",{className:"clickable icon icon-tabsright "+(n.props.currentSlideIndex>=n.props.slides.length-1?" disabled":""),onClick:n.incrementCurrentSlide})),n.renderAutoPlayButton(),n.renderAutoPlaySettings()):p.createElement("div",{id:"slide-controls"})},n.renderPreviewSlidesButton=function(){if(!n.props.isFullscreen){if(!n.props.renderFooter){var e="10px";return n.state.showSlides&&(e="105px"),p.createElement("div",{className:"preview-button",style:{bottom:e},onClick:n.toggleSlidePreview},p.createElement("div",{className:"icon icon-view"}),p.createElement("span",null,n.state.showSlides?"Hide":"Show"," Pages"))}return p.createElement("div",{className:"preview-button btn",onClick:n.toggleSlidePreview},p.createElement("div",{className:"icon icon-view"}),p.createElement("span",null,n.state.showSlides?"Hide":"Show"," Pages"))}},n.renderSlidePreviews=function(){if(!n.props.isFullscreen){var e=n.props.slides.map(function(e,t){return p.createElement(c.SlideThumbnail,{key:e.id,slide:e,index:t,isSelected:t===n.props.currentSlideIndex,displayIndex:!1})});return p.createElement("div",{id:"slide-preview"},p.createElement(l.SidePanel,{classNames:["slides-panel"],direction:l.Direction.BOTTOM,renderTab:!1,isOpen:n.state.showSlides,children:e,onChildClick:function(e){return n.setCurrentSlide(e)}}))}},n.renderAutoPlayButton=function(){return n.state.autoPlay?p.createElement("div",{className:"btn",onClick:n.toggleAutoPlay,id:"autoplay"},p.createElement("div",{className:"icon icon-pause1"}),p.createElement("span",null,"Pause")):!n.state.autoPlay&&n.props.currentSlideIndex===n.props.slides.length&&n.state.showReplay?p.createElement("div",{className:"btn",onClick:n.replay,id:"autoplay"},p.createElement("div",{className:"icon icon-reset"}),p.createElement("span",null,"Replay")):p.createElement("div",{className:"btn",onClick:n.toggleAutoPlay,id:"autoplay"},p.createElement("div",{className:"icon icon-play1"}),p.createElement("span",null,"Autoplay"))},n.renderAutoPlaySettings=function(){return n.state.autoPlay?p.createElement(l.PopupMenu,{text:"Timer",icon:"icon-timer",iconPosition:"top",buttonClassnames:["btn"],onChange:function(e){n.setState({showTimerPopup:e}),e&&document.addEventListener("click",n.hideTimerMenu,!0)},showMenu:n.state.showTimerPopup},p.createElement("div",{id:"loop-controls"},p.createElement("div",{className:"row timer-row content-group"},p.createElement("label",{className:"column"},"Page Timer"),p.createElement("div",null,p.createElement(l.NumberInput,{step:1,min:.033,max:99,value:n.state.autoPlayTime,onValueChange:n.setAutoPlayTime,unit:"s"}))),p.createElement("div",{className:"row content-group"},p.createElement("label",{className:"column"},"Loop"),p.createElement("div",null,p.createElement(l.Toggle,{onChange:n.toggleLoop,value:n.state.loop}))))):void document.removeEventListener("click",n.hideTimerMenu)},n.renderZoomSlider=function(){if(!(m.Device.isIPadOrIPhone()||n.props.isFullscreen||n.props.isEmbed))return p.createElement("div",{id:"zoom-slider"},p.createElement(l.NumberInput,{step:25,min:25,max:400,value:n.props.scaleOffset,onValueChange:n.handleScaleOffsetChange,text:"Zoom",unit:"%",textPosition:"bottom"}))},n.renderFullscreenButton=function(){if(!m.Device.isIPadOrIPhone()&&document.fullscreenEnabled){var e=n.props.isEmbed?"fullscreen-button":"btn";return n.props.isFullscreen?p.createElement("div",{className:e,onClick:n.toggleFullScreen,id:"fullscreen-button"},p.createElement("div",{className:"icon icon-fullscreen"}),p.createElement("span",null,"Exit")):p.createElement("div",{className:e,onClick:n.toggleFullScreen,id:"fullscreen-button"},p.createElement("div",{className:"icon icon-fullscreen"}),p.createElement("span",null,"Fullscreen"))}},n.handleMouseMove=function(e){var t=m.GeometryUtil.pointFromEvent(e,"page",n.props.displaySettings);screen.height-t.y<=75?(void 0!==n.footerTimeout&&(clearTimeout(n.footerTimeout),n.footerTimeout=void 0),n.state.showFooter||n.setState({showFooter:!0})):void 0===n.footerTimeout&&n.hideFooter()},n.handleScaleOffsetChange=function(e){n.props.updateDisplaySettings("scaleOffset",e)},n.handleKeyDown=function(e){13===e.keyCode&&(e.stopPropagation(),e.preventDefault(),n.setCurrentSlide(parseInt(e.currentTarget.value,10)-1))},n.handleWindowKeyDown=function(e){var t=m.KeyUtil.getKey(e);"INPUT"!==document.activeElement.tagName&&("arrow-left"!==t&&"arrow-up"!==t||n.decrementCurrentSlide(),"arrow-right"!==t&&"arrow-down"!==t||n.incrementCurrentSlide())},n.decrementCurrentSlide=function(){n.setCurrentSlide(n.props.currentSlideIndex-1),n.state.showReplay&&n.setState({showReplay:!1})},n.incrementCurrentSlide=function(){n.setCurrentSlide(n.props.currentSlideIndex+1),n.state.showReplay&&n.setState({showReplay:!1})},n.setCurrentSlide=function(e){e>=n.props.slides.length&&(e=n.props.slides.length-1),e<0&&(e=0),n.props.setSlideSelected(n.props.slides[e],n.user)},n.setAutoPlayTime=function(e){var t=d.toNumber(e.toFixed(3));t<.033&&(t=.033),t>999&&(t=999),n.updateAutoPlayTime(t)},n.updateAutoPlayTime=function(e){n.setState({autoPlayTime:e},function(){n.state.autoPlay&&(clearInterval(n.state.autoPlaytimer),n.startAutoPlay())})},n.hideTimerMenu=function(e){e.target&&(e.target.closest("#loop-controls")||n.setState({showTimerPopup:!1})),document.removeEventListener("click",n.hideTimerMenu)},n.toggleAutoPlay=function(){var e=!n.state.autoPlay;e?n.startAutoPlay():clearInterval(n.state.autoPlaytimer),n.setState({autoPlay:e})},n.toggleLoop=function(){n.setState({loop:!n.state.loop})},n.replay=function(){n.setCurrentSlide(1),n.toggleAutoPlay()},n.toggleFullScreen=function(){var e=document.documentElement;n.props.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},n.handleFullScreenChange=function(e){if(n.isFullScreen()){n.props.updateDisplaySettings("isFullscreen",!0),n.setState({scale:n.props.displaySettings.scale}),document.getElementById("viewport").style.bottom="0",document.getElementById("viewport").style.top="0";var t=(0,m.getCanvasScale)(n.props.canvas,"view",{fullscreen:!0});n.props.updateDisplaySettings("scale",t)}else{n.props.updateDisplaySettings("isFullscreen",!1),n.state.showSlides?document.getElementById("viewport").style.bottom="170px":document.getElementById("viewport").style.bottom="55px",n.props.isEmbed?document.getElementById("viewport").style.top="0":document.getElementById("viewport").style.top="50px";var r=(0,m.getCanvasScale)(n.props.canvas,"view",{fullscreen:!1,embed:n.props.isEmbed,renderFooter:n.props.renderFooter});n.props.updateDisplaySettings("scale",r)}},n.isFullScreen=function(){return null!==(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null)},n.toggleSlidePreview=function(){var e=!n.state.showSlides,t=document.getElementsByClassName("left-nav")[0],r=document.getElementsByClassName("right-nav")[0],o=void 0;e?(o=(0,m.getCanvasScale)(n.props.canvas,n.props.mode,{extraOffset:{width:0,height:95},embed:n.props.isEmbed,fullscreen:n.props.isFullscreen,renderFooter:n.props.renderFooter}),n.props.renderFooter?document.getElementById("viewport").style.bottom="150px":(void 0!==t&&(t.style.height="calc(100% - 175px)"),void 0!==r&&(r.style.height="calc(100% - 175px)"),document.getElementById("viewport").style.bottom="95px")):(o=(0,m.getCanvasScale)(n.props.canvas,n.props.mode,{fullscreen:n.props.isFullscreen,embed:n.props.isEmbed,renderFooter:n.props.renderFooter}),n.props.renderFooter?document.getElementById("viewport").style.bottom="55px":(document.getElementById("viewport").style.bottom="0",void 0!==t&&(t.style.height="calc(100% - 50px)"),void 0!==r&&(r.style.height="calc(100% - 50px)"))),n.props.updateDisplaySettings("scale",o),n.setState({showSlides:e})},n.hideFooter=function(){var e=setTimeout(function(){n.setState({showFooter:!1}),n.footerTimeout=void 0},2e3);n.footerTimeout=e},n.state={autoPlay:!!window.config.timer&&window.config.timer>0,autoPlayTime:window.config.timer&&window.config.timer>0?window.config.timer:5,loop:!!window.config.loop&&"1"===window.config.loop,showSlides:!1,footerRect:n.baseFooterRect,scale:n.props.displaySettings.scale,showFooter:!0,showReplay:!1,showTimerPopup:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.Component),a(t,[{key:"componentDidMount",value:function(){return b(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.setSlideSelected(this.props.slides[0],this.user),window.addEventListener("keydown",this.handleWindowKeyDown),document.addEventListener("webkitfullscreenchange",this.handleFullScreenChange),document.addEventListener("mozfullscreenchange",this.handleFullScreenChange),document.addEventListener("MSFullscreenChange",this.handleFullScreenChange),document.addEventListener("fullscreenchange",this.handleFullScreenChange),window.focus(),window.config.timer>.33&&this.startAutoPlay();case 8:case"end":return e.stop()}},e,this)}))}},{key:"componentDidUpdate",value:function(e){e.isFullscreen!==this.props.isFullscreen&&(this.props.isFullscreen?(this.hideFooter(),document.addEventListener("mousemove",this.handleMouseMove)):(void 0!==this.footerTimeout&&(clearTimeout(this.footerTimeout),this.footerTimeout=void 0),this.setState({showFooter:!0}),document.removeEventListener("mousemove",this.handleMouseMove))),e.currentSlideIndex!==this.props.currentSlideIndex&&this.slideInput&&(this.slideInput.value=(this.props.currentSlideIndex+1).toString()),e.orientation!==this.props.orientation&&(this.state.showSlides?"landscape"===e.orientation?document.getElementById("viewport").style.bottom="150px":document.getElementById("viewport").style.bottom="55px":"landscape"===e.orientation?document.getElementById("viewport").style.bottom="55px":!m.Device.isMobile()&&this.props.renderFooter||(document.getElementById("viewport").style.bottom="0"))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keypress",this.handleWindowKeyDown),document.removeEventListener("webkitfullscreenchange",this.handleFullScreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullScreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullScreenChange),document.removeEventListener("fullscreenchange",this.handleFullScreenChange)}},{key:"render",value:function(){return this.props.renderFooter?p.createElement("div",{className:"footer "+(this.props.isFullscreen?"fullscreen":"")+" "+(this.state.showFooter?"":"hidden")},this.renderSlidePreviews(),p.createElement("div",{className:"footer-content"},p.createElement("div",{className:"row"},this.renderZoomSlider(),this.renderSlideControls(),this.renderFullscreenButton()),this.props.isEmbed&&!m.Device.isWebView()&&p.createElement("a",{href:window.config.web_uri+"/dashboard",className:"buncee-logo",target:"_blank"},p.createElement("img",{src:(0,h.cloudfrontURL)("/images/home/BunceeLogo-white.svg")})))):this.renderCompactView()}},{key:"startAutoPlay",value:function(){var e=this,t=setInterval(function(){var t=e.props.currentSlideIndex+1;t>e.props.slides.length-1?e.state.loop?e.setCurrentSlide(0):(e.toggleAutoPlay(),e.setState({showReplay:!0})):e.setCurrentSlide(t)},1e3*this.state.autoPlayTime);this.setState({autoPlaytimer:t})}}],[{key:"getDerviedStateFromProps",value:function(e){return e.isFullscreen?null:{showFooter:!0}}}]),t}();t.default=(0,f.connect)(function(e){var t=v.User.getUser(),n=e.buncee.selected_slides[t.guid],r=(0,u.findIndex)(e.buncee.document.slides,function(e){return e.id===n});return{scaleOffset:e.displaySettings.scaleOffset,slides:e.buncee.document.slides,canvas:e.buncee.document.canvas,mode:e.renderingMode,isEmbed:e.displaySettings.isEmbed,renderFooter:e.displaySettings.renderFooter,isFullscreen:e.displaySettings.isFullscreen,displaySettings:e.displaySettings,currentSlideIndex:r}},function(e){return{setSlideSelected:function(t,n){e(s.Actions.updateSlideSelected({path:n.guid,value:t.id}))},updateDisplaySettings:function(t,n){e(s.Actions.updateStore({path:"displaySettings."+t,value:n}))}}})(g)},418:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(38),s=n(11),c=n(6),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4),p=n(16),f=n(139);!function(e){e.ERROR="error",e.SIMULTANEOUS_EDIT="simultaneous-edit",e.SUCCESS="success",e.PENDING="pending"}(r||(r={}));var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleScaleOffsetChange=function(e){n.props.updateDisplaySettings("scaleOffset",e)},n.saveTitle=function(){if(null!==n.titleInput){var e=n.titleInput.value;0!==e.length&&(n.props.updateTitle(e),n.titleInput&&n.titleInput.blur())}},n.handleTitleKeyDown=function(e){e.stopPropagation(),13===e.keyCode&&n.saveTitle()},n.handleTitleChange=function(e){e.stopPropagation(),n.setState({title:e.target.value})},n.togglePanning=function(){n.props.updateDisplaySettings("isPanning",!n.props.isPanning),(0,p.displayToastMessage)("Panning "+(n.props.isPanning?"Disabled":"Enabled"),2e3)},n.handleReset=function(){n.props.updateDisplaySettings("scaleOffset",100),n.props.updateDisplaySettings("viewportOffset",{x:0,y:0})},n.renderTitle=function(){return[l.createElement("h2",{key:"title"},0!==n.state.title.length?n.state.title:" "),l.createElement("input",{id:"title-input",key:"title-input",onBlur:n.saveTitle,onKeyDown:n.handleTitleKeyDown,onFocus:function(e){e.currentTarget.setSelectionRange(0,n.state.title.length)},onChange:n.handleTitleChange,className:"edit-title",placeholder:"Untitled...",value:n.state.title,ref:function(e){n.titleInput=e}})]},n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t?n.setState({selectedButton:t}):n.setState({selectedButton:""})},n.handlePreferenceChange=function(e,t){var r=new URLSearchParams;r.set("value",t?"1":"0"),a.Client.put("preferences/"+e.canonical_name,r).then(function(r){r.ok&&n.props.updateStore("preferences."+e.canonical_name+".value",t)});var o="gridlines"===e.canonical_name?" have been turned ":" has been turned ";(0,p.displayToastMessage)(e.name+o+(t?"on":"off"),2e3)},n.renderStatusMessage=function(){if(void 0!==n.state.status)return l.createElement("p",{className:n.state.status.type===r.ERROR?"error":""},n.state.status.message)},n.handleSaveState=function(e){var t=void 0,o=void 0;"done"===e.status?(t=r.SUCCESS,o=d.Device.isIPadOrIPhone()?"Saved.":"All changes saved."):"pending"===e.status?(t=r.PENDING,o="Saving changes..."):"simultaneous-edit"===e.status?(t=r.SIMULTANEOUS_EDIT,o="Error",n.client.socket.disconnect(),n.props.openModal("simultaneousedit")):(t=r.ERROR,o=e.message,n.props.openModal("alert",{title:"Something went wrong!",message:"Refresh to continue working on your masterpiece!",buttons:[l.createElement("div",{className:"btn",onClick:function(){location.reload()}},"Refresh")],iconURL:(0,d.cloudfrontURL)("/images/idle.svg")})),n.setState({status:{type:t,message:o}})},n.handleNoTitle=function(e){n.props.openModal("input",{handleSubmit:n.handleTitleSubmit,validate:n.validateTitle,title:"Please Enter a Title",message:"Looks like your Buncee is missing a title!",onDoneClick:e})},n.validateTitle=function(e){return 0===e.trim().length?{isValid:!1,message:"Please enter a valid title"}:{isValid:!0}},n.handleTitleSubmit=function(e){n.setState({title:e}),n.props.updateTitle(e)},n.handleTimeout=function(){n.setState({status:{type:r.ERROR,message:"You've been idle for too long. Please refresh to continue."}});var e=new Event("error");window.dispatchEvent(e)},n.showShareModal=function(){""===n.state.title.trim()&&n.props.is_editing?n.handleNoTitle(function(){return n.props.openModal("share")}):n.props.openModal("share")},n.goToPreview=function(){""===n.state.title.trim()?n.handleNoTitle(function(){return window.location.href=n.props.links.view}):window.location.href=n.props.links.view},n.bunceeLogoClicked=function(){""===n.state.title.trim()?n.handleNoTitle(function(){return window.location.href="/dashboard"}):window.location.href="/dashboard"},n.showCanvasResizeModal=function(){n.props.openModal("resize")},n.closeSettings=function(e){"settings"===n.state.selectedButton&&(document.getElementById("settings").contains(e.target)||n.setState({selectedButton:""}))},n.titleInput=null,n.state={title:n.props.title,selectedButton:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidMount",value:function(){var e=this;this.client=f.WebsocketClient.getInstance(),this.client.socket.addEventListener("buncee-save",this.handleSaveState),this.client.socket.addEventListener("connect_timeout",this.handleTimeout),window.addEventListener("beforeunload",function(){""===e.state.title&&e.props.updateTitle("My Buncee")},!1),window.addEventListener("mousedown",this.closeSettings),window.addEventListener("touchstart",this.closeSettings)}},{key:"componentWillUnmount",value:function(){this.client.socket.removeEventListener("buncee-save",this.handleSaveState),this.client.socket.removeEventListener("connect_timeout",this.handleTimeout),window.removeEventListener("mousedown",this.closeSettings),window.removeEventListener("touchstart",this.closeSettings)}},{key:"componentDidUpdate",value:function(e){e.title!==this.props.title&&this.setState({title:this.props.title})}},{key:"render",value:function(){var e=this;return l.createElement("div",{className:"header-wrapper"},l.createElement("div",{className:"header",id:"edit-header"},l.createElement("div",{style:{cursor:"pointer"},onClick:this.bunceeLogoClicked},l.createElement("div",{className:"buncee-logo"},l.createElement(s.Tooltip,{text:"Back to your dashboard",direction:"down"},l.createElement("img",{className:"buncee-logo",style:{margin:0},src:(0,d.cloudfrontURL)("/images/home/BunceeLogo-blackBETA.svg")})))),l.createElement("div",{className:"buncee-status"},this.renderStatusMessage()),l.createElement("div",{className:"buncee-title"},this.renderTitle()),l.createElement("div",{className:"buttons row"},l.createElement(s.Tooltip,{text:"Need a hand?",direction:"down"},l.createElement("a",{id:"help-link",href:"https://buncee.zendesk.com/hc/en-us",target:"_blank"},l.createElement("span",{id:"help",className:"icon-frq"}))),l.createElement("div",{className:"btn btn-blue",onClick:this.goToPreview},"Preview"),l.createElement("div",{className:"btn btn-orange",onClick:this.showShareModal},"Share"))),l.createElement("div",{className:"canvas-toolbar"},l.createElement("div",{className:"float-left row"},l.createElement(s.Action,{text:"Undo",icon:"icon-undo",onClick:this.props.undoPrevAction}),l.createElement(s.Action,{text:"Redo",icon:"icon-redo",onClick:this.props.redoPrevAction})),l.createElement("div",{className:"float-middle row"},l.createElement("div",{className:"toolbar-button action",id:"settings",onClick:this.handleButtonClick},l.createElement(s.PopupMenu,{text:"Settings",showMenu:"settings"===this.state.selectedButton,icon:"icon-settings",iconPosition:"top",popDirection:"down"},l.createElement("div",{className:"settings-popup"},(0,c.map)(this.props.preferences,function(t){return"email-notifications"===t.canonical_name?null:("show-watermark"!==t.canonical_name||d.User.isPremium())&&("ireader"!==t.canonical_name||window.config.hasOwnProperty("immersive_reader_key"))?l.createElement("div",{key:t.canonical_name,className:"content-group setting"},l.createElement("label",{className:"column"},t.name),l.createElement("div",{className:"column"},l.createElement(s.Toggle,{"data-name":t.canonical_name,value:t.value,onChange:function(n){e.handlePreferenceChange(t,n)}}))):null})))),l.createElement(s.Action,{className:["button-resize"],text:"Resize Canvas",icon:"icon-canvasresize",onClick:this.showCanvasResizeModal})),l.createElement("div",{className:"float-right"},l.createElement("div",{className:"row"},l.createElement(s.Action,{className:["reset"],text:"Reset",icon:"icon-reset",onClick:this.handleReset}),l.createElement(s.NumberInput,{step:25,min:25,max:400,unit:"%",text:"Zoom",textPosition:"bottom",value:this.props.displaySettings.scaleOffset,onValueChange:this.handleScaleOffsetChange}),l.createElement(s.Action,{text:"Pan",icon:"icon-pan",onClick:this.togglePanning,isActive:this.props.isPanning,className:this.props.isPanning?["panactive"]:["paninactive"]})))))}}]),t}(),h=(0,u.connect)(function(e){return{slides:e.buncee.document.slides,title:e.buncee.title,is_editing:"edit"===e.renderingMode,displaySettings:e.displaySettings,links:e.links,isPanning:e.displaySettings.isPanning,preferences:e.preferences}},function(e){return{undoPrevAction:function(){e(i.Actions.undoPrevAction({}))},redoPrevAction:function(){e(i.Actions.redoPrevAction({}))},updateDisplaySettings:function(t,n){e(i.Actions.updateStore({path:"displaySettings."+t,value:n}))},openModal:function(t,n){e(i.Actions.openModal({type:t,props:n}))},openGateway:function(){e(i.Actions.openGateway({activeBrowser:"itemgateway"}))},openBackgroundBrowser:function(){e(i.Actions.openGateway({activeBrowser:"background"}))},updateTitle:function(t){e(i.Actions.updateBuncee({path:"title",value:t}))},updateStore:function(t,n){e(i.Actions.updateStore({path:t,value:n}))}}})(m);t.default=h},419:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.youtubeRegex=/(http[s]?:[\/]{2}|[\/]{2})??([a-z0-9\-\.]+)??(youtube.com|youtu.be)\/(watch|v|embed)?[/]?(\?v=|v\/)?([a-z0-9\-_]{11,})/i,n.viemoRegex=/vimeo.*?([0-9]+$)/i,n.imageRegex=/\.(jpeg|jpg|gif|png|svg)($|(\?))/i,n.closeModal=function(){n.props.closeModal()},n.getWindowClassNames=function(){return"window transparent white-close"},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"item-preview-modal"},i.createElement("img",{className:"preview",src:this.props.item.content.body}))}}]),t}();t.default=a},420:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(5),s=n(4);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.imageWidth=1,n.imageHeight=1,n.canvasDimensions={width:1,height:1},n.handleMouseDownOrTouchStart=function(e){n.props.isEditingBackground&&(e.stopPropagation(),e.preventDefault(),n.setState({eventOrigin:s.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings)}))},n.onMove=function(e){if(n.props.isEditingBackground&&void 0!==n.state.eventOrigin){e.stopPropagation(),e.preventDefault();var t=s.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings),r=s.GeometryUtil.differenceBetweenPoints(t,n.state.eventOrigin,n.props.displaySettings.scale),o=n.canvasDimensions.height/n.imageHeight;if(n.isPortrait()&&(o=n.canvasDimensions.width/n.imageWidth),n.isPortrait()){if((r=Object.assign({},r,{x:0})).y+n.props.y>0||r.y+n.props.y+n.imageHeight*o<n.canvasDimensions.height)return}else if((r=Object.assign({},r,{y:0})).x+n.props.x>0||r.x+n.props.x+n.imageWidth*o<n.canvasDimensions.width)return;n.setState({offset:r})}},n.handleMouseUpOrTouchEnd=function(e){n.props.isEditingBackground&&n.state.eventOrigin&&(e.stopPropagation(),e.preventDefault(),n.props.updateBackground(n.props.background,n.props.x+n.state.offset.x,n.props.y+n.state.offset.y,n.props.slide),n.setState({offset:{x:0,y:0}})),n.setState({eventOrigin:void 0})},n.getInlineStyleForImageWrapper=function(){var e=n.canvasDimensions.height/n.imageHeight,t=n.props.y+n.state.offset.y,r=n.props.x+n.state.offset.x;return n.isPortrait()?(e=n.canvasDimensions.width/n.imageWidth,r=0):t=0,{zIndex:n.props.isEditingBackground?9999:0,top:t+"px",left:r+"px",width:n.imageWidth*e+"px",height:n.imageHeight*e+"px",opacity:n.props.opacity}},n.getInlineStyleForImage=function(){return n.isPortrait()?{width:"100%",height:"auto"}:{width:"auto",height:"100%"}},n.canvasDimensions=(0,s.getCanvasDimensions)(n.props.canvas),n.state={isLoaded:!1,offset:{x:0,y:0}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"isPortrait",value:function(){return this.imageWidth/this.imageHeight<this.canvasDimensions.width/this.canvasDimensions.height}},{key:"loadImage",value:function(){var e=this,t=new Image;t.onload=function(t){e.imageHeight=t.currentTarget.height,e.imageWidth=t.currentTarget.width,e.setState({isLoaded:!0})},t.src=this.props.background}},{key:"componentDidMount",value:function(){this.loadImage()}},{key:"componentDidUpdate",value:function(e){var t=(0,s.getCanvasDimensions)(this.props.canvas);this.canvasDimensions.width===t.width&&this.canvasDimensions.height===t.height||(this.canvasDimensions=t,this.forceUpdate()),e.background!==this.props.background&&this.loadImage()}},{key:"render",value:function(){if(!this.state.isLoaded)return null;var e=["image"];return this.props.isEditingBackground&&(this.state.eventOrigin?e.push("cursor-grabbing"):e.push("cursor-grab")),i.createElement("div",{id:"viewport-background",className:e.join(" "),style:this.getInlineStyleForImageWrapper(),onMouseDown:this.handleMouseDownOrTouchStart,onTouchStart:this.handleMouseDownOrTouchStart,onMouseMove:this.onMove,onTouchMove:this.onMove,onMouseUp:this.handleMouseUpOrTouchEnd,onTouchEnd:this.handleMouseUpOrTouchEnd},i.createElement("img",{src:this.props.background,alt:"Page Background",className:"w-100 h-100",style:this.getInlineStyleForImage()}),this.props.isEditingBackground?i.createElement("div",{className:"toast"},"Drag background to reposition"):null)}}]),t}();c.defaultProps={x:0,y:0,opacity:1};t.default=(0,a.connect)(function(e){return{canvas:e.buncee.document.canvas,isEditingBackground:e.isEditingBackground,displaySettings:e.displaySettings}},function(e){return{updateBackground:function(t,n,r,i){e(o.Actions.updateSlide({path:"background",id:i.id,value:{type:i.background.type,body:t,attributes:{x:n,y:r,opacity:i.background.attributes?i.background.attributes.opacity:1}}}))}}})(c)},421:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t={backgroundColor:e.color};return e.attributes&&"number"==typeof e.attributes.opacity&&(t.opacity=e.attributes.opacity),r.createElement("div",{id:"viewport-background",style:t})}},422:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(262);t.default=function(e){if(e.slide.background){if("color"===e.slide.background.type)return r.createElement(o.SlideBackgoundColor,{color:e.slide.background.body,attributes:e.slide.background.attributes});if("url"===e.slide.background.type){var t=e.slide.background.attributes||{},n=e.slide.background.body;return"string"!=typeof n&&(n=e.slide.background.body.url),r.createElement(o.SlideBackgroundImage,{background:n,slide:e.slide,x:t.x,y:t.y,opacity:t.opacity})}return r.createElement(o.SlideBackgoundColor,{color:"#fff"})}return r.createElement(o.SlideBackgoundColor,{color:"#fff"})}},423:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item;if("string"!=typeof t.content.body)throw new Error("Invalid content body value. Must be type of 'string'");if(""===t.content.body)throw new Error("Empty content body value. Must have value");if("edit"===e.mode)return r.createElement("div",{className:"item-content"},r.createElement("img",{src:"https://img.youtube.com/vi/"+t.content.body+"/hqdefault.jpg",width:t.frame.width,height:t.frame.height}));var n="https://www.youtube.com/embed/"+t.content.body+"?feature=oembed&rel=0&showinfo=0&modestbranding=0",o={allow:"autoplay; encrypted-media",frameBorder:"0",height:t.frame.height,width:t.frame.width,src:n,allowFullScreen:!0};return r.createElement("div",{className:"item-content",style:e.style},r.createElement("iframe",o))}},424:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item;if("string"!=typeof t.content.body)throw new Error("Invalid content body value. Must be type of 'string'");if("edit"===e.mode)return r.createElement("div",{className:"item-content"},r.createElement("img",{src:"https://i.vimeocdn.com/video/"+t.content.body+"_295x166.jpg",width:t.frame.width,height:t.frame.height}));var n="https://player.vimeo.com/video/"+t.content.body+"?app_id=122963",o={width:t.frame.width,height:t.frame.height,frameBorder:0,src:n,allowFullScreen:!0};return r.createElement("div",{className:"item-content",style:e.style},r.createElement("iframe",o))}},425:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(16);var a=function(e){return"edit"===e};t.default=function(e){var t=r.Util.ObjectUtil.get(e.item,"content.body");if("string"!=typeof t)throw new Error("Invalid content body for video item. Expected a string.");var n,s,c=a(e.mode)?"#t=2":"#t=0.1",l=["item-content"];return a(e.mode)&&l.push("with-overlay"),o.createElement("div",{className:l.join(" "),style:e.style},a(e.mode)?o.createElement("div",{className:"overlay",style:{width:e.item.frame.width,height:e.item.frame.height}},(n=e.item.frame.width,s=(0,i.recalculateFontPixelSize)(n,273),o.createElement("div",{className:"overlay-text",style:{fontSize:s}},"Click Preview To Play Video"))):null,o.createElement("video",{width:e.item.frame.width,height:e.item.frame.height,controls:!a(e.mode),preload:"metadata"},o.createElement("source",{src:t+c,type:"video/mp4"}),"Your browser doesn't support embedded videos."))}},426:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5),c=n(4),l=n(312),u=n(16);var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.initialTap=null,n.throttledUpdate=(0,i.throttle)(function(){n.updateTextItem()},2e3,{leading:!0,trailing:!0}),n.quill=null,n.updateTextItem=function(){n.quill&&n.quill.getContents()&&n.props.updateItem(n.quill.getContents())},n.handleDoubleClick=function(e){e.preventDefault(),e.stopPropagation(),c.Device.isIPadOrIPhone()||n.setState({isEditing:!0})},n.handleLongPress=function(){"view"!==n.props.mode&&(window.clearTimeout(n.longPressTimeout),n.props.openEditorModal(n.props.item.id))},n.handleTouchStart=function(e){"view"!==n.props.mode&&(e.preventDefault(),n.initialTap={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},n.props.is_selected&&(n.longPressTimeout=window.setTimeout(n.handleLongPress,300)))},n.handleTouchEnd=function(e){"view"!==n.props.mode&&(e.preventDefault(),window.clearTimeout(n.longPressTimeout))},n.handleTouchMove=function(e){if("view"!==n.props.mode){var t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY;(Math.abs(t-n.initialTap.x)>10||Math.abs(r-n.initialTap.y)>10)&&window.clearTimeout(n.longPressTimeout)}},n.stopMouseEvent=function(e){n.state.isEditing&&e.stopPropagation()},n.renderDefaultText=function(e,t){var n=void 0;n=e?"Long Press To Edit":"Double Click To Edit";var r=(0,u.recalculateFontPixelSize)(t,273);return a.createElement("span",{style:{fontSize:r}},n)},n.renderTTSIcon=function(){return n.state.isSpeaking?"icon-pause1":"icon-soundmax"},n.shouldRenderTTS=function(){return!c.User.isLoggedIn()||!("edit"===n.props.mode||!n.props.preferences.tts||!n.props.preferences.tts.value)},n.renderTextToSpeech=function(){if(n.shouldRenderTTS()){var e=n.renderTTSIcon();return a.createElement("div",{className:"item-icon text-to-speech",onClick:n.textToSpeech},a.createElement("span",{className:e}))}},n.renderImmersiveReader=function(){if(window.config.hasOwnProperty("immersive_reader_key"))return!c.User.isLoggedIn()||"view"===n.props.mode&&n.props.preferences.ireader&&n.props.preferences.ireader.value?a.createElement("div",{className:"item-icon immersive-reader",onClick:function(){return(0,c.launchImmersiveReader)(n.quill.getText())}},a.createElement("img",{src:(0,u.cloudfrontURL)("images/immersive-reader/ir-icon.svg")})):void 0},n.textToSpeech=function(){if(n.quill){var e=!1;n.state.msg===n.quill.getText()&&""!==n.state.msg||(window.speechSynthesis.cancel(),e=!0,n.setState({isSpeaking:!1})),(0,u.speechSynthSpeak)(new SpeechSynthesisUtterance(n.quill.getText()),function(e){n.setState({isSpeaking:!0,msg:e})},function(e){n.setState({isSpeaking:!1,msg:e})},e)}},n.state={isEditing:!1,isSpeaking:!1,msg:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentDidMount",value:function(){var e=this;this.quill=new c.Quill("#"+this.props.item.id+" .editor",{placeholder:"edit"===this.props.mode?"Add text here...":""}),this.quill.setContents(this.props.item.content.body),this.props.is_selected,this.quill.disable(),this.quill.on("text-change",function(){e.throttledUpdate()})}},{key:"componentDidUpdate",value:function(e,t){if(this.quill)if(c.Device.isIPadOrIPhone()&&this.quill.setContents(this.props.item.content.body),!1===t.isEditing&&!0===this.state.isEditing)try{c.QuillSingleton.initializeInstance(this.quill,this.props.item.content.attributes),this.quill.enable(),this.quill.focus(),this.quill.setSelection(0,this.quill.getText().length)}catch(e){}else if(!1===e.is_selected&&!0===this.props.is_selected)this.quill.setSelection(0,0);else if(!0===e.is_selected&&!1===this.props.is_selected){this.updateTextItem();try{this.quill.setSelection(0,0),this.quill.setSelection(this.quill.getText().length,0),this.quill.disable(),c.QuillSingleton.destroyInstance(this.quill)}catch(e){}this.setState({isEditing:!1})}try{this.quill.container.children[0].scrollTop=0}catch(e){}}},{key:"shouldComponentUpdate",value:function(e,t){if(this.props.is_selected!==e.is_selected)return!0;if(this.props.item.opacity!==e.item.opacity)return!0;if(this.state.isEditing!==t.isEditing)return!0;if(this.state.isSpeaking!==t.isSpeaking)return!0;if(this.props.item.content.attributes&&e.item.content.attributes&&this.props.item.content.attributes.background_color!==e.item.content.attributes.background_color)return!0;if(this.props.item.content.attributes&&e.item.content.attributes&&this.props.item.content.attributes.background_opacity!==e.item.content.attributes.background_opacity)return!0;if(this.props.item.frame.width<273&&!this.state.isEditing){if(this.props.item.frame.width!==e.item.frame.width)return!0}else if(c.Device.isIPadOrIPhone()){var n=this.props.item.content.body,r=e.item.content.body;if(JSON.stringify(n.ops)!==JSON.stringify(r.ops))return!0}return!1}},{key:"componentWillUnmount",value:function(){this.quill=null}},{key:"render",value:function(){var e=["item-content"];this.props.is_selected&&e.push("allow-select"),"edit"===this.props.mode&&e.push("edit-mode");var t=["editor"];this.props.item.content.attributes&&this.props.item.content.attributes.fontFamily&&t.push(this.props.item.content.attributes.fontFamily);var n=null;this.props.is_selected&&"edit"===this.props.mode&&!this.state.isEditing&&(n=a.createElement("div",{className:"text-overlay",onDoubleClick:this.handleDoubleClick},this.renderDefaultText(c.Device.isIPadOrIPhone(),this.props.item.frame.width)));var r=Object.assign({},this.props.style,{overflow:"view"===this.props.mode?"visible":"hidden"});if(this.props.item.content.attributes&&this.props.item.content.attributes.background_color){var o=this.props.item.content.attributes.background_color;r.backgroundColor=(0,l.hexToRGBAString)(o,this.props.item.content.attributes.background_opacity)}return r.opacity=1,a.createElement("div",{className:e.join(" "),onMouseDown:this.stopMouseEvent,onMouseUp:this.stopMouseEvent,onMouseMove:this.stopMouseEvent,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,style:r},a.createElement("div",{className:t.join(" "),style:{opacity:this.props.item.opacity}}),a.createElement("div",{className:"action-wrapper"},this.renderTextToSpeech(),this.renderImmersiveReader()),n)}}]),t}(),p=(0,s.connect)(function(e,t){return{preferences:e.preferences}},function(e,t){return{updateItem:function(n){e(o.Actions.updateItem({path:t.item.id+".content.body",value:n}))},openEditorModal:function(t){e(o.Actions.openModal({type:"text",props:{itemID:t}}))}}})(d);t.default=p},427:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item,n=t.content.attributes,i="string"==typeof n.stroke_dasharray?n.stroke_dasharray:"",a=[[t.frame.width/2,n.stroke_width],[n.stroke_width+n.stroke_width/2,t.frame.height-n.stroke_width/2],[t.frame.width-n.stroke_width,t.frame.height-n.stroke_width/2]],s="thumbnail"===e.mode?5:n.stroke_width;return o.createElement("svg",{width:e.item.frame.width,height:e.item.frame.height,className:"item-content",style:e.style},o.createElement("polygon",r({points:a.join(" "),width:e.item.frame.width,height:e.item.frame.height,fillOpacity:n.fill_opacity,strokeDasharray:i,strokeWidth:s},n)))}},428:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item.content.attributes,n="string"==typeof t.stroke_dasharray?t.stroke_dasharray:"";return o.createElement("svg",{width:e.item.frame.width,height:e.item.frame.height,className:"item-content",style:e.style},o.createElement("rect",r({width:e.item.frame.width,height:e.item.frame.height,strokeDasharray:n,fillOpacity:t.fill_opacity,strokeWidth:t.stroke_width},t)))}},429:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=e.item.content.attributes,n="string"==typeof t.stroke_dasharray?t.stroke_dasharray:"",i=e.item.frame.width/2,a=e.item.frame.height/2;return o.createElement("svg",{width:e.item.frame.width,height:e.item.frame.height,className:"item-content",style:e.style},o.createElement("ellipse",r({strokeDasharray:n,fillOpacity:t.fill_opacity,strokeWidth:t.stroke_width,cx:i,cy:a,rx:(e.item.frame.width-t.stroke_width)/2,ry:(e.item.frame.height-t.stroke_width)/2},t)))}},430:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=r.Client.getBaseURI()+"/qr_code?data="+encodeURIComponent(e.links.view);return o.createElement("div",{className:"item-content item-image",style:e.style},o.createElement("img",{src:t,alt:e.item.alt_text||"This is an image.",className:"w-100 h-100"}))}},431:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(4);t.default=function(e){var t=e.item;if("string"!=typeof t.content.body)throw new Error("Invalid content body value. Must be type of 'string'");if("edit"===e.mode)return o.createElement("div",{className:"item-content"},o.createElement("img",{src:t.content.body,width:t.frame.width,height:t.frame.height}));var n=(0,i.cloudfrontURL)("/player/pannellum/pannellum.htm?panorama="+t.content.body),a={width:t.frame.width,height:t.frame.height,frameBorder:0,src:n};return o.createElement("div",{className:"item-content"},o.createElement("iframe",r({allowFullScreen:!0},a)))}},432:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=d(n(6)),a=d(n(0)),s=n(5),c=n(164),l=n(4),u=n(16);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.lastTap=0,n.initialTap=null,n.handleDoubleClick=function(e){"view"!==n.props.mode&&(e.preventDefault(),e.stopPropagation(),n.props.openEditorModal(n.props.item.id))},n.handleLongPress=function(){"view"!==n.props.mode&&(window.clearTimeout(n.longPressTimeout),n.props.openEditorModal(n.props.item.id))},n.handleTouchStart=function(e){"view"!==n.props.mode&&(e.preventDefault(),n.initialTap={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},n.props.is_selected&&(n.longPressTimeout=window.setTimeout(n.handleLongPress,300)))},n.handleTouchEnd=function(e){"view"!==n.props.mode&&(e.preventDefault(),window.clearTimeout(n.longPressTimeout))},n.handleTouchMove=function(e){if("view"!==n.props.mode&&void 0!==n.longPressTimeout){var t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY;(Math.abs(t-n.initialTap.x)>10||Math.abs(r-n.initialTap.y)>10)&&window.clearTimeout(n.longPressTimeout)}},n.renderTTSIcon=function(){return n.state.isSpeaking?"icon-pause1":"icon-soundmax"},n.renderTextToSpeech=function(){if(!l.User.isLoggedIn()||"view"===n.props.mode&&n.props.preferences.tts&&n.props.preferences.tts.value){var e=n.renderTTSIcon();return a.createElement("div",{className:"item-icon text-to-speech",onClick:n.textToSpeech},a.createElement("span",{className:e}))}},n.renderImmersiveReader=function(){if(window.config.hasOwnProperty("immersive_reader_key"))return!l.User.isLoggedIn()||"view"===n.props.mode&&n.props.preferences.ireader&&n.props.preferences.ireader.value?a.createElement("div",{className:"item-icon immersive-reader",onClick:function(){return(0,l.launchImmersiveReader)((0,u.mcqToString)(n.props.item))}},a.createElement("img",{src:(0,u.cloudfrontURL)("images/immersive-reader/ir-icon.svg")})):void 0},n.textToSpeech=function(){var e=!1,t=(0,u.mcqToString)(n.props.item);n.state.msg===t&&""!==n.state.msg||(window.speechSynthesis.cancel(),e=!0,n.setState({isSpeaking:!1})),(0,u.speechSynthSpeak)(new SpeechSynthesisUtterance(t),function(e){n.setState({isSpeaking:!0,msg:e})},function(e){n.setState({isSpeaking:!1,msg:e})},e)},n.handleCheckedItemChange=function(e){n.setState({checkedItem:e.target.value});var t=window;if((0,u.isWorkingOnSubmission)()&&t.assignment.data.track_question_response){var r=e.target.value;(0,u.storeQuestionResponse)(n.props.item.content,r)}},n.correctChoice=n.props.item.content.body.correct_choice;var r=n.props.item.content.attributes,o=void 0;if("edit"===n.props.mode)(0,u.isWorkingOnSubmission)()||(o=n.correctChoice);else if("submission"===n.props.mode){var s=i.find(window.submission.data.responses,{question_id:r.question_id});s&&(o=s.question_response)}return n.state={checkedItem:o,isSpeaking:!1,msg:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentWillUpdate",value:function(e,t){this.props.item.content.body.correct_choice!==e.item.content.body.correct_choice&&(t.checkedItem=e.item.content.body.correct_choice)}},{key:"render",value:function(){var e=this,t=["item-content","item-mcq"];this.props.is_selected&&t.push("allow-select"),"edit"===this.props.mode&&t.push("edit-mode");var n=null;this.props.is_selected&&"edit"===this.props.mode&&(n=a.createElement("div",{className:"text-overlay"},a.createElement("span",null,l.Device.isIPadOrIPhone()?"Long press to edit":"Double Click To Edit")));var r=this.props.item.content,o=Object.assign({},this.props.style,{color:r.attributes.color?r.attributes.color:"#000",fontWeight:r.attributes.bold?700:400,textDecoration:r.attributes.underline?"underline":"none",fontStyle:r.attributes.italic?"italic":"normal",fontSize:(r.attributes.size?parseInt(r.attributes.size,10):14)+"px",lineHeight:1.4*(r.attributes.size?parseInt(r.attributes.size,10):14)+"px",overflow:"view"===this.props.mode?"visible":"hidden"}),s="ql-font-"+(r.attributes.fontFamily||"lato"),u=null,d=window.assignment;if(!(null===this.state.checkedItem||"string"!=typeof this.correctChoice||"view"!==this.props.mode&&"submission"!==this.props.mode||window.inAssignmentMode()&&d.data.feedback_level!==c.AssignmentFeedbackLevel.INSTANT)){var p=["question-feedback"];this.correctChoice===this.state.checkedItem?p.push("icon-tick","correct"):p.push("icon-cancel1","wrong"),u=a.createElement("span",{className:p.join(" "),style:{fontSize:o.fontSize}})}return a.createElement("div",{className:t.join(" "),onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onDoubleClick:this.handleDoubleClick,style:o},a.createElement("div",{className:"question-wrapper "+s},a.createElement("div",{className:"question-body"},r.body.question&&r.body.question.length>0?r.body.question:"Default question text"),a.createElement("div",{className:"question-choices"},i.keys(r.body.choices).map(function(t){var n=r.body.choices[t];return a.createElement("div",{key:"choice-"+t,className:"choice-group"},a.createElement("div",{className:"choice-radio"},a.createElement("input",{id:t,type:"radio",name:r.attributes.question_id,value:t,checked:t===e.state.checkedItem,disabled:"edit"===e.props.mode,onChange:e.handleCheckedItemChange}),a.createElement("label",{htmlFor:t},n,t===e.state.checkedItem?u:null)))}))),a.createElement("div",{className:"action-wrapper"},this.renderTextToSpeech(),this.renderImmersiveReader()),n)}}]),t}(),f=(0,s.connect)(function(e,t){return{preferences:e.preferences}},function(e,t){return{updateItem:function(n){e(o.Actions.updateItem({path:t.item.id+".content.body",value:n}))},openEditorModal:function(t){e(o.Actions.openModal({type:"mcq",props:{itemID:t}}))}}})(p);t.default=f},433:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){var t=r.Util.ObjectUtil.get(e.item,"content.body");if("string"!=typeof t)throw new Error("Invalid content body for image item. Expected a string.");return o.createElement("div",{className:"item-content item-image",style:e.style},o.createElement("img",{src:t,alt:e.item.alt_text||"This is an image.",className:"w-100 h-100"}))}},435:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(434),s=(r=a)&&r.__esModule?r:{default:r},c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=n(4),d=n(16);var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.lastTap=0,n.initialTap=null,n.handleDoubleClick=function(e){"view"!==n.props.mode&&(e.preventDefault(),e.stopPropagation(),n.props.openEditorModal(n.props.item.id))},n.handleLongPress=function(){"view"!==n.props.mode&&(window.clearTimeout(n.longPressTimeout),n.props.openEditorModal(n.props.item.id))},n.handleTouchStart=function(e){"view"!==n.props.mode&&(e.preventDefault(),n.initialTap={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},n.props.is_selected&&(n.longPressTimeout=window.setTimeout(n.handleLongPress,300)))},n.handleTouchEnd=function(e){"view"!==n.props.mode&&(e.preventDefault(),window.clearTimeout(n.longPressTimeout))},n.handleTouchMove=function(e){if("view"!==n.props.mode&&void 0!==n.longPressTimeout){var t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY;(Math.abs(t-n.initialTap.x)>10||Math.abs(r-n.initialTap.y)>10)&&window.clearTimeout(n.longPressTimeout)}},n.renderTTSIcon=function(){return n.state.isSpeaking?"icon-pause1":"icon-soundmax"},n.renderTextToSpeech=function(){if(!u.User.isLoggedIn()||"view"===n.props.mode&&n.props.preferences.tts&&n.props.preferences.tts.value){var e=n.renderTTSIcon();return c.createElement("div",{className:"item-icon text-to-speech",onClick:n.textToSpeech},c.createElement("span",{className:e}))}},n.renderImmersiveReader=function(){if(window.config.hasOwnProperty("immersive_reader_key"))return!u.User.isLoggedIn()||"view"===n.props.mode&&n.props.preferences.ireader&&n.props.preferences.ireader.value?c.createElement("div",{className:"item-icon immersive-reader",onClick:function(){return(0,u.launchImmersiveReader)(n.props.item.content.body.question)}},c.createElement("img",{src:(0,d.cloudfrontURL)("images/immersive-reader/ir-icon.svg")})):void 0},n.textToSpeech=function(){var e=!1;n.state.msg===n.props.item.content.body.question&&""!==n.state.msg||(window.speechSynthesis.cancel(),e=!0,n.setState({isSpeaking:!1})),(0,d.speechSynthSpeak)(new SpeechSynthesisUtterance(n.props.item.content.body.question),function(e){n.setState({isSpeaking:!0,msg:e})},function(e){n.setState({isSpeaking:!1,msg:e})},e)},n.handleValueChange=function(e){n.setState({value:e.target.value});var t=window;(0,d.isWorkingOnSubmission)()&&(t.assignment.data.track_question_response&&(0,d.storeQuestionResponse)(n.props.item.content,e.target.value))};var r="";if("submission"===n.props.mode){var o=s.default.find(window.submission.data.responses,{question_id:n.props.item.content.attributes.question_id});o&&(r=o.question_response)}return n.state={value:r,isSpeaking:!1,msg:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),o(t,[{key:"render",value:function(){var e=["item-content","item-frq"];this.props.is_selected&&e.push("allow-select"),"edit"===this.props.mode&&e.push("edit-mode");var t=null;this.props.is_selected&&"edit"===this.props.mode&&(t=c.createElement("div",{className:"text-overlay"},c.createElement("span",null,u.Device.isIPadOrIPhone()?"Long press to edit":"Double Click To Edit")));var n=this.props.item.content,r=Object.assign({},this.props.style,{color:n.attributes.color||"#000",fontWeight:n.attributes.bold?700:400,textDecoration:n.attributes.underline?"underline":"none",fontStyle:n.attributes.italic?"italic":"normal",fontSize:(n.attributes.size?parseInt(n.attributes.size,10):60)+"px",lineHeight:1.4*(n.attributes.size?parseInt(n.attributes.size,10):60)+"px",overflow:"view"===this.props.mode?"visible":"hidden"}),o="ql-font-"+(n.attributes.fontFamily||"lato");return c.createElement("div",{className:e.join(" "),onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onDoubleClick:this.handleDoubleClick,style:r},c.createElement("div",{className:"question-wrapper "+o},c.createElement("div",{className:"question-body"},n.body.question&&n.body.question.length>0?n.body.question:"Default question text"),c.createElement("div",{className:"question-input"},c.createElement("textarea",{style:r,disabled:"edit"===this.props.mode,value:this.state.value,onChange:this.handleValueChange}))),c.createElement("div",{className:"action-wrapper"},this.renderTextToSpeech(),this.renderImmersiveReader()),t)}}]),t}(),f=(0,l.connect)(function(e,t){return{preferences:e.preferences}},function(e,t){return{updateItem:function(n){e(i.Actions.updateItem({path:t.item.id+".content.body",value:n}))},openEditorModal:function(t){e(i.Actions.openModal({type:"frq",props:{itemID:t}}))}}})(p);t.default=f},436:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4);var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mode=0,this.size=12,this.color="#000",this.opacity=1,this.mode=t,this.size=n}return r(e,[{key:"begin",value:function(e,t){if(e.strokeStyle=o.ColorUtil.hexToRGBAString(this.color,this.opacity)||this.color,e.lineWidth=this.size,e.lineCap="round",e.lineJoin="round",e.globalAlpha=this.opacity,0===this.mode)e.globalCompositeOperation="source-over";else{if(1!==this.mode)throw new Error("Unsupported brush mode.");e.globalCompositeOperation="destination-out"}e.beginPath(),this.didPaintPath=!1,this.activePathSegment={center:0,points:[t]}}},{key:"paint",value:function(e,t){if(!this.activePathSegment)throw new Error("Brush cannot paint before beginning a path.");this.activePathSegment.center++,this.activePathSegment.points[this.activePathSegment.center]=t,4===this.activePathSegment.center&&(this.activePathSegment.points[3]={x:(this.activePathSegment.points[2].x+this.activePathSegment.points[4].x)/2,y:(this.activePathSegment.points[2].y+this.activePathSegment.points[4].y)/2,space:t.space},this.didPaintPath=!0,this.renderPathSegment(e,this.activePathSegment),this.activePathSegment.points[0]=this.activePathSegment.points[3],this.activePathSegment.points[1]=this.activePathSegment.points[4],this.activePathSegment.center=1)}},{key:"end",value:function(e){this.activePathSegment&&!1===this.didPaintPath&&(e.closePath(),this.renderDot(e,this.activePathSegment.points[0])),this.didPaintPath=void 0,this.activePathSegment=void 0}},{key:"renderDot",value:function(e,t){e.arc(t.x,t.y,this.size/2,0,2*Math.PI),e.fillStyle=o.ColorUtil.hexToRGBAString(this.color,this.opacity)||this.color,e.fill()}},{key:"renderPathSegment",value:function(e,t){e.moveTo(t.points[0].x,t.points[0].y),e.bezierCurveTo(t.points[1].x,t.points[1].y,t.points[2].x,t.points[2].y,t.points[3].x,t.points[3].y),e.stroke()}}]),e}();t.default=i},437:function(e,t,n){"use strict"},438:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(4),a=n(267);var s={},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.state=s,n.isDrawing=!1,n.pointOffset={x:0,y:0},n.beginRenderCycle=function(){n.renderBufferToDOM(),n.isDrawing&&window.requestAnimationFrame(n.beginRenderCycle)},n.renderBufferToDOM=function(){if(n.rootElementContext){var e=n.props.context.canvas;n.rootElementContext.clearRect(0,0,e.width,e.height),n.rootElementContext.drawImage(e,0,0)}},n.handleMouseDownOrTouchStart=function(e){if(!n.rootElement)throw new Error("Root element canvas is not available.");if(n.props.is_selected&&!n.props.displaySettings.isPanning){var t=n.rootElement.getBoundingClientRect();n.pointOffset={x:-1*t.left/(n.props.displaySettings.scaleOffset/100),y:-1*t.top/(n.props.displaySettings.scaleOffset/100)};var r=i.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings),o=i.GeometryUtil.scalePoint(i.GeometryUtil.translatePoint(r,n.pointOffset),1/n.props.displaySettings.scale);n.startDrawing(o),n.addTouchListeners(),n.addMouseListeners()}},n.handleMoveEvent=function(e){if(!n.isDrawing)return n.removeMouseListeners(),void n.removeTouchListeners();var t=i.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings),r=i.GeometryUtil.scalePoint(i.GeometryUtil.translatePoint(t,n.pointOffset),1/n.props.displaySettings.scale);n.brush.paint(n.props.context,r)},n.handleMouseOrTouchEndEvent=function(){n.removeMouseListeners(),n.removeTouchListeners(),n.finishDrawing()};var r=(0,a.classForBrushStyle)(e.brush_style);return n.brush=new r(e.brush_mode,e.brush_size,e.brush_color,e.brush_opacity),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidCatch",value:function(){}},{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e){return this.brush.mode=e.brush_mode,this.brush.color=e.brush_color,this.brush.size=e.brush_size,this.brush.opacity=e.brush_opacity,this.props.is_selected!==e.is_selected?(this.renderBufferToDOM(),this.isDrawing&&this.finishDrawing(),!0):!(!this.props.style||!e.style||(this.renderBufferToDOM(),this.props.style.opacity===e.style.opacity))}},{key:"render",value:function(){var e=this;return o.createElement("canvas",{width:this.props.width,height:this.props.height,ref:function(t){null!=t&&(e.rootElement=t,e.rootElementContext=t.getContext("2d"),e.beginRenderCycle())},onMouseDown:this.handleMouseDownOrTouchStart,onTouchStart:this.handleMouseDownOrTouchStart,style:this.props.style})}},{key:"startDrawing",value:function(e){if(this.isDrawing)throw new Error("There is already a drawing in progress.");this.isDrawing=!0,this.brush.begin(this.props.context,e),this.beginRenderCycle()}},{key:"finishDrawing",value:function(){this.isDrawing=!1,this.props.saveDrawingToStore(),this.brush.end(this.props.context)}},{key:"addTouchListeners",value:function(){window.addEventListener("touchmove",this.handleMoveEvent),window.addEventListener("touchend",this.handleMouseOrTouchEndEvent,{once:!0})}},{key:"addMouseListeners",value:function(){window.addEventListener("mousemove",this.handleMoveEvent),window.addEventListener("mouseup",this.handleMouseOrTouchEndEvent,{once:!0}),document.body.addEventListener("mouseleave",this.handleMouseOrTouchEndEvent,{once:!0})}},{key:"removeMouseListeners",value:function(){window.removeEventListener("mousemove",this.handleMoveEvent),window.removeEventListener("mouseup",this.handleMouseOrTouchEndEvent),document.body.removeEventListener("mouseleave",this.handleMouseOrTouchEndEvent)}},{key:"removeTouchListeners",value:function(){window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleMouseOrTouchEndEvent)}}]),t}();t.default=c,c.defaultProps={width:1920,height:1080}},439:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedDrawingItem=t.DrawingItem=void 0;var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),c=n(6),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=n(5),d=n(4),p=n(270),f=n(267);var m=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},h={did_draw_item_content:!1,isFlushing:!1},v=t.DrawingItem=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.state=h,n.saveDrawingToStore=function(){var e=n.proxyContext.flush();n.props.updateItem(n.props.item.id+".content.body",{base_image:n.props.item.content.body.base_image,commands:n.props.item.content.body.commands.concat(e)})},n.flushDrawingToS3=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return m(n,void 0,void 0,i.default.mark(function t(){var n,r,o,a,s,c=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e||!this.state.isFlushing){t.next=2;break}return t.abrupt("return");case 2:this.setState({isFlushing:!0}),n=this.renderingContext.canvas.toDataURL(),r=window.config.tenant,o=window.config.buncee_guid,a="drawings/"+r+"/"+o+"/",s=this.props.item.content.body.commands.length,(0,p.uploadToS3)(this.props.item.id+".png",a,n).then(function(e){var t=c.props.item.content.body.commands.slice();t.splice(0,s),c.props.updateItem(c.props.item.id+".content.body",{base_image:window.config.web_uri+"/drawing_base_image?path="+e.key,commands:t}),c.setState({isFlushing:!1})});case 9:case"end":return t.stop()}},t,this)}))},!function(e){if("drawing"===e.type&&e.body.hasOwnProperty("base_image")&&e.body.hasOwnProperty("commands")&&Array.isArray(e.body.commands))return!0;return!1}(e.item.content))throw new Error("Unsupported content for drawing item.");return n.initProxyContext(e.item.frame.width,e.item.frame.height),n.saveDrawingToStore=(0,c.throttle)(n.saveDrawingToStore,2e3,{trailing:!0,leading:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),a(t,[{key:"componentDidMount",value:function(){this.drawItemContent()}},{key:"componentWillUnmount",value:function(){this.clearCanvas()}},{key:"componentDidUpdate",value:function(e){e.item!==this.props.item?(this.drawItemContent(),this.props.item.content.body.commands.length>1e3&&this.flushDrawingToS3()):!1===this.props.is_selected&&!0===e.is_selected&&this.flushDrawingToS3(!0)}},{key:"render",value:function(){return l.createElement(f.DrawingCanvas,{context:this.proxyContext,displaySettings:this.props.displaySettings,width:this.props.canvas_width,height:this.props.canvas_height,brush_style:this.props.brush_style,brush_mode:this.props.brush_mode,brush_size:this.props.brush_size,brush_color:this.props.brush_color,brush_opacity:this.props.brush_opacity,is_selected:this.props.is_selected,saveDrawingToStore:this.saveDrawingToStore,style:this.props.style})}},{key:"initProxyContext",value:function(e,t){var n=document.createElement("canvas");n.width=e,n.height=t;var r=n.getContext("2d");this.proxyContext=new f.ProxyCanvasRenderingContext2D(r)}},{key:"drawItemContent",value:function(){return m(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({did_draw_item_content:!1}),"string"!=typeof this.props.item.content.body.base_image){e.next=22;break}return e.prev=2,e.next=5,d.AsyncUtil.loadImage(this.props.item.content.body.base_image);case 5:(t=e.sent).crossOrigin="Anonymous",this.proxyContext.flush(),this.clearCanvas(),this.renderingContext.save(),this.renderingContext.globalCompositeOperation="source-over",this.renderingContext.drawImage(t,0,0),this.renderingContext.restore(),this.proxyContext.execute(this.props.item.content.body.commands),this.setState({did_draw_item_content:!0}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2);case 20:e.next=25;break;case 22:this.clearCanvas(),this.proxyContext.execute(this.props.item.content.body.commands),this.setState({did_draw_item_content:!0});case 25:case"end":return e.stop()}},e,this,[[2,17]])}))}},{key:"clearCanvas",value:function(){this.renderingContext.clearRect(0,0,this.renderingContext.canvas.width,this.renderingContext.canvas.height)}},{key:"renderingContext",get:function(){return this.proxyContext.innerContext}}]),t}();var y=(0,u.connect)(function(e){var t=e.buncee,n=e.item_defaults,r=n.drawing?n.drawing:{brush_color:"#000",brush_style:"CUBIC_BEZIER_BRUSH",brush_mode:0,brush_size:12,brush_opacity:1};return{canvas_width:(0,d.getCanvasDimensions)(t.document.canvas).width,canvas_height:(0,d.getCanvasDimensions)(t.document.canvas).height,brush_size:r.brush_size,brush_style:r.brush_style,brush_mode:r.brush_mode,brush_color:r.brush_color,brush_opacity:r.brush_opacity}},function(e){return{updateItem:function(t,n){e(s.Actions.updateItem({path:t,value:n}))}}})(v);t.ConnectedDrawingItem=y},441:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(440);var r=n(68),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));t.default=function(e){if("string"!=typeof r.Util.ObjectUtil.get(e.item,"content.body"))throw new Error("Invalid content body for image item. Expected a string.");if(!e.item.content.attributes)throw new Error("Invalid content attribute for image item. Expected a string.");return o.createElement("div",{className:"item-content item-image",style:e.style},"view"===e.mode?o.createElement("model-viewer",{class:"w-100 h-100",id:"model-viewer",src:e.item.content.body,"camera-controls":!0,"auto-rotate":!0,autoplay:!0,"background-color":"rgba(0,0,0,0)"}):o.createElement("img",{src:e.item.content.attributes.preview_url,alt:e.item.alt_text||"This is an image.",className:"w-100 h-100"}))}},442:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedCanvasViewport=t.CanvasViewport=void 0;var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=n(268),d=n(262),p=n(7),f=n(6),m=n(4),h=n(16),v=n(102);function y(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},g={keyMap:[],viewportOffset:{x:0,y:0},showItemBorders:!1},w={fill:"white",fill_opacity:0,stroke:"black",stroke_width:5,type:"rectangle",stroke_dasharray:"10 5"},_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.arrowKeyOffset=0,n.numGamepads=0,n.gamepadPollInterval=null,n.openBackroundBrowser=function(e){n.isPanning()||(e.preventDefault(),e.stopPropagation(),n.props.openBrowser("background"))},n.openGateway=function(e){n.isPanning()||(e.preventDefault(),e.stopPropagation(),n.props.openBrowser("itemgateway"))},n.handleScroll=function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.scrollTop=0,e.currentTarget.scrollLeft=0},n.renderDragArea=function(){var e=(0,m.generateItem)({type:"shape",content:{type:"shape",body:{},attributes:w},frame:n.state.dragRect});return e=Object.assign({},e,{id:"drag-rect"}),c.createElement(u.ConnectedHOCItem,{item:e,index:10001})},n.renderGridlines=function(){if("edit"===n.props.mode&&n.props.preferences.gridlines.value){var e=(0,m.getCanvasDimensions)(n.props.canvas),t=[];return n.props.slideItems.forEach(function(e){var r=e.frame,o=(0,h.getBucket)(0,r.origin.y,n.props.canvas);t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-top gridline-row-"+o.row+" gridline-col-"+o.column+" horizontal",style:{top:r.origin.y,left:0}})),o=(0,h.getBucket)(r.origin.x,0,n.props.canvas),t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-left gridline-row-"+o.row+" gridline-col-"+o.column+" vertical",style:{top:0,left:r.origin.x}})),o=(0,h.getBucket)(0,r.origin.y+r.height/2,n.props.canvas),t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-mid gridline-row-"+o.row+" gridline-col-"+o.column+" horizontal",style:{top:r.origin.y+r.height/2,left:0}})),o=(0,h.getBucket)(r.origin.x+r.width/2,0,n.props.canvas),t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-mid gridline-row-"+o.row+" gridline-col-"+o.column+" vertical",style:{top:0,left:r.origin.x+r.width/2}})),o=(0,h.getBucket)(0,r.origin.y+r.height,n.props.canvas),t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-bottom gridline-row-"+o.row+" gridline-col-"+o.column+" horizontal",style:{top:r.origin.y+r.height,left:0}})),o=(0,h.getBucket)(r.origin.x+r.width,0,n.props.canvas),t.push(c.createElement("div",{className:"gridline gridline-"+e.id+" gridline-right gridline-row-"+o.row+" gridline-col-"+o.column+" vertical",style:{top:0,left:r.origin.x+r.width}}))}),c.createElement("div",{id:"gridlines"},c.createElement("div",{className:"gridline vertical",style:{top:0,left:e.width/2}}),c.createElement("div",{className:"gridline horizontal",style:{top:e.height/2,left:0}}),t)}},n.pollGamepad=function(){var e=navigator.getGamepads(),t=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;if(s){var c=s.axes[0],l=s.axes[1];Math.abs(c)>.5&&(c<0?n.nudgeItem("left",20):n.nudgeItem("right",20)),Math.abs(l)>.5&&(l<0?n.nudgeItem("up",20):n.nudgeItem("down",20))}}}catch(e){r=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw o}}},n.handleGamepadConnected=function(e){n.numGamepads++,n.gamepadPollInterval||window.setInterval(n.pollGamepad,t.GAMEPAD_POLLING_INTERVAL)},n.handleGamepadDisconnected=function(e){n.numGamepads--,0===n.numGamepads&&n.gamepadPollInterval&&clearInterval(n.gamepadPollInterval)},n.handleKeyEvent=function(e){return b(n,void 0,void 0,i.default.mark(function t(){var n,r,o;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("INPUT"!==e.target.tagName){t.next=2;break}return t.abrupt("return");case 2:if(n=document.getElementById("confirm-modal"),!(this.props.modal||this.props.gateway||n)){t.next=5;break}return t.abrupt("return");case 5:if(!e.target.classList.contains("ql-editor")){t.next=7;break}return t.abrupt("return");case 7:if((r=this.state.keyMap)[e.keyCode]="keydown"===e.type,"delete"!==(o=m.KeyUtil.getKey(e))||"keyup"===e.type){t.next=16;break}if(!this.props.selectedItem){t.next=16;break}return t.next=14,(0,m.confirm)("Are you sure you want to delete this item?");case 14:t.sent&&this.props.removeItem(this.props.items,this.props.selectedItem,this.props.slide);case 16:if("z"!==o||!e.metaKey&&!e.ctrlKey||e.shiftKey||this.props.undoPrevAction(),"z"===o&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&this.props.redoPrevAction(),"equal"!==o||!e.shiftKey||"keyup"===e.type){t.next=23;break}if(e.preventDefault(),!(this.props.displaySettings.scaleOffset>=400)){t.next=22;break}return t.abrupt("return");case 22:this.zoomIn();case 23:if("minus"!==o||!e.shiftKey||"keyup"===e.type){t.next=28;break}if(e.preventDefault(),!(this.props.displaySettings.scaleOffset<=25)){t.next=27;break}return t.abrupt("return");case 27:this.zoomOut();case 28:if("space"!==o||m.Device.isIPadOrIPhone()||("keydown"===e.type?this.startPanning():this.endPanning()),"esc"===o&&(this.isEditing?this.props.selectedItem&&this.props.deselectItems(this.props.selectedItems):this.props.exitFullscreen()),"v"===o&&(e.metaKey||e.ctrlKey)&&"keyup"!==e.type&&(e.stopPropagation(),e.preventDefault(),this.pasteItem()),"c"===o&&(e.metaKey||e.ctrlKey)&&"keyup"!==e.type&&this.props.selectedItem&&"drawing"!==this.props.selectedItem.type&&(e.stopPropagation(),e.preventDefault(),this.copyToClipboard(this.props.selectedItem),(0,h.displayToastMessage)("Copied to Clipboard",2e3)),"arrow-up"===o&&(e.preventDefault(),this.props.selectedItem&&this.nudgeItem("up",e.shiftKey?7:1,"keyup"===e.type)),"arrow-down"===o&&(e.preventDefault(),this.props.selectedItem&&this.nudgeItem("down",e.shiftKey?7:1,"keyup"===e.type)),"arrow-left"===o&&(e.preventDefault(),this.props.selectedItem&&this.nudgeItem("left",e.shiftKey?7:1,"keyup"===e.type)),"arrow-right"===o&&this.props.selectedItem&&this.nudgeItem("right",e.shiftKey?7:1,"keyup"===e.type),e.target.classList.contains("viewport")){t.next=38;break}return t.abrupt("return");case 38:"m"===o&&(e.metaKey||e.ctrlKey)&&e.preventDefault(),"s"===o&&(e.metaKey||e.ctrlKey),"meta"!==o&&"ctrl"!==o&&"space"!==o||this.setState({keyMap:[].concat(y(r))});case 41:case"end":return t.stop()}},t,this)}))},n.handleViewportClick=function(e){"viewport"===e.target.id&&n.props.selectedItem&&n.props.deselectItems(n.props.selectedItems)},n.handleItemClick=function(e,t){if(n.props.selectedItem){if(n.props.selectedItem.id===t.id)return;var r=void 0,o=!1;if(n.props.items[n.props.selectedItem.id]&&n.props.items[t.id]||(o=!0),!e.ctrlKey&&!e.metaKey||o)n.props.slideItems.filter(function(e){return"group"===e.type&&"string"!=typeof e.name}).forEach(function(e){n.ungroupItems(e)}),r=t;else r=n.groupItems([n.props.selectedItem,t]);n.props.deselectItems(n.props.selectedItems),n.props.updateSelectedItems(r.id,n.props.user)}else n.props.deselectItems(n.props.selectedItems),n.props.updateSelectedItems(t.id,n.props.user)},n.handleMouseDownOrTouchStart=function(e){if(n.isEditing()){var t=m.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings),r=e.target.id;if("viewport-background"===r||"guide-overlay"===r||"gridlines"===r)e.preventDefault(),n.props.selectedItem&&n.props.updateSelectedItems(n.props.selectedItem.id,null),n.props.slideItems.filter(function(e){return"group"===e.type&&"string"!=typeof e.name}).forEach(function(e){n.ungroupItems(e)}),n.setState(Object.assign({},n.state,{dragAnchor:t,showItemBorders:!0}));else n.isPanning()&&n.setState(Object.assign({},n.state,{dragAnchor:t}));n.addEventListeners()}},n.handleMouseUpOrTouchEnd=function(){if(n.isEditing()){if(n.isPanning())n.setCanvasPan();else if(void 0!==n.state.dragRect){var e=n.props.slideItems.filter(function(e){return void 0!==n.state.dragRect&&("drawing"!==e.type&&m.GeometryUtil.isEnclosingRectangle(n.state.dragRect,e.frame))});if(e.length>1){var t=n.groupItems(e);n.props.updateSelectedItems(t.id,n.props.user)}else 1===e.length&&n.props.updateSelectedItems(e[0].id,n.props.user)}n.removeEventListeners()}},n.handleMouseOrTouchMove=function(e){if(n.isEditing()&&void 0!==n.state.dragAnchor){var t=m.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings);if(n.isPanning()){var r={x:n.state.dragAnchor.x-t.x,y:n.state.dragAnchor.y-t.y};n.setState({viewportOffset:r})}else{var o=n.getPointOnCanvas(n.state.dragAnchor),i=n.getPointOnCanvas(t),a=m.GeometryUtil.enclosingRect({origin:{x:o.x/n.props.displaySettings.scale,y:o.y/n.props.displaySettings.scale,space:n.state.dragAnchor.space},width:0,height:0},{origin:{x:i.x/n.props.displaySettings.scale,y:i.y/n.props.displaySettings.scale,space:i.space},width:0,height:0});n.setState(Object.assign({},n.state,{dragRect:a}))}}},n.isPanning=function(){return n.props.isPanning},n.groupItems=function(e,t){var r=(0,v.createGroup)(e,n.props.items,n.props.slide,t);return n.props.updateItems(r.newItemDict,n.props.slide,r.newSlideItems),r.item},n.ungroupItems=function(e){var t=(0,v.ungroupItems)(e,n.props.items,n.props.slide);return n.props.updateItems(t.newItemDict,n.props.slide,t.newSlideItems),t.items},n.copyToClipboard=function(e){n.props.updateClipboard(e)},n.pasteItem=function(){if(void 0!==n.props.clipboard){var e=n.props.clipboard,t=(0,m.generateItem)(),r=[];"group"===e.type&&e.content.body.forEach(function(e){var t=(0,m.generateItem)(),n=Object.assign({},e,{id:t.id});r.push(n)});var o=Object.assign({},e,{frame:Object.assign({},e.frame,{origin:{x:(0,m.getCanvasDimensions)(n.props.canvas).width/2,y:(0,m.getCanvasDimensions)(n.props.canvas).height/2,space:e.frame.origin.space}}),content:Object.assign({},e.content,{body:"group"===e.type?r:e.content.body}),id:t.id});n.props.addItem(o,n.props.slide)}},n.isEditing=function(){return"edit"===n.props.mode},n.renderWatermark=function(){return n.props.showWatermark?c.createElement("img",{className:"watermark",src:(0,h.cloudfrontURL)("images/watermark.png")}):void 0},n.getItemTransformControls=function(e){if("object"===a(n.state.dragRect)){var t={};return m.GeometryUtil.isEnclosingRectangle(n.state.dragRect,e.frame)&&(t={border:"dashed 2px #EE4751"}),{top_left:!1,top_mid:!1,top_right:!1,mid_left:!1,mid_right:!1,bottom_left:!1,bottom_mid:!1,bottom_right:!1,rotation:!1,gridlines:!1,style:t}}},n.state=g,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),s(t,[{key:"componentDidMount",value:function(){this.isEditing()&&this.addKeyListeners(),this.addGamepadListeners()}},{key:"componentWillUnmount",value:function(){this.isEditing()&&this.removeKeyListeners(),this.removeGamepadListeners()}},{key:"componentDidUpdate",value:function(e,t){!e.isPanning&&this.props.isPanning&&(0,h.displayToastMessage)("Panning Enabled",2e3),e.isPanning&&!this.props.isPanning&&(0,h.displayToastMessage)("Panning Disabled",2e3),e.canvas.size_type!==this.props.canvas.size_type&&this.props.updateDisplaySettings("scale",(0,h.getCanvasScale)(this.props.canvas,this.props.mode,{fullscreen:this.props.isFullscreen}))}},{key:"render",value:function(){var e=this,t=null,n=(0,m.getCanvasDimensions)(this.props.canvas);if(0===this.props.slideItems.length&&"edit"===this.props.mode){var r=[];this.props.slide.background||r.push(c.createElement("div",{key:"guide-insert-background",className:"guide-insert-background",onClick:this.openBackroundBrowser},c.createElement("div",{className:"icon-background"}),c.createElement("div",{className:"title"},"Click here to change background"))),r.push(c.createElement("div",{key:"guide-insert-item",className:"guide-insert-item",onClick:this.openGateway},c.createElement("div",{className:"icon-add"}),c.createElement("div",{className:"title"},"Click here to add your first item")));var o=["guide-overlay"];n.height<800&&o.push("small"),n.width*this.props.displaySettings.scale<450&&o.push("narrow"),t=c.createElement("div",{id:"guide-overlay",className:o.join(" ")},r)}var i={x:this.props.displaySettings.viewportOffset.x+this.state.viewportOffset.x,y:this.props.displaySettings.viewportOffset.y+this.state.viewportOffset.y},a=["viewport",this.props.mode];return this.isPanning()&&(this.state.dragAnchor?a.push("cursor-grabbing"):a.push("cursor-grab")),this.props.isFullscreen&&a.push("fullscreen"),(m.Device.isMobile()&&"landscape"===this.props.orientation||"0"===(0,h.getURLParameter)("render_slide_panel"))&&a.push("mobile-landscape"),c.createElement("div",{key:"viewport",id:"viewport",className:a.join(" "),ref:function(t){e.rootElement=t},onClick:this.handleViewportClick,tabIndex:0},c.createElement("div",{id:"canvas",style:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments[3];t*=n/100;var o="translate(calc(-50% - "+r.x+"px), calc(-50% - "+r.y+"px)) scaleX("+t+") scaleY("+t+")";return{width:e.width+"px",height:e.height+"px",transform:o}}(n,this.props.displaySettings.scale,this.props.displaySettings.scaleOffset,i),onTouchStart:this.handleMouseDownOrTouchStart,onMouseDown:this.handleMouseDownOrTouchStart,onScroll:this.handleScroll},c.createElement(d.HOCSlideBackground,{key:this.props.slide.id,slide:this.props.slide}),this.renderGridlines(),this.props.slideItems.map(function(t,n){return c.createElement(u.ConnectedHOCItem,{key:t.id,item:t,handleClick:e.handleItemClick,index:n,transform_controls:e.getItemTransformControls(t)})}),this.state.dragRect&&this.renderDragArea(),t,this.renderWatermark()))}},{key:"addKeyListeners",value:function(){window.addEventListener("keydown",this.handleKeyEvent),window.addEventListener("keyup",this.handleKeyEvent)}},{key:"addGamepadListeners",value:function(){var e=this;"1"===window.config.flags.gamepad&&(window.addEventListener("gamepadconnected",function(t){e.handleGamepadConnected(t)}),window.addEventListener("gamepaddisconnected",function(t){e.handleGamepadDisconnected(t)}))}},{key:"removeKeyListeners",value:function(){window.removeEventListener("keydown",this.handleKeyEvent),window.removeEventListener("keyup",this.handleKeyEvent)}},{key:"removeGamepadListeners",value:function(){window.removeEventListener("gamepadconnected",this.handleKeyEvent),window.removeEventListener("gamepaddisconnected",this.handleKeyEvent)}},{key:"setCanvasPan",value:function(){this.props.updateViewportOffset({x:this.props.displaySettings.viewportOffset.x+this.state.viewportOffset.x,y:this.props.displaySettings.viewportOffset.y+this.state.viewportOffset.y}),this.setState({viewportOffset:{x:0,y:0}})}},{key:"endPanning",value:function(){this.setCanvasPan(),this.props.updateDisplaySettings("isPanning",!1)}},{key:"startPanning",value:function(){this.props.updateDisplaySettings("isPanning",!0)}},{key:"zoomIn",value:function(){this.props.updateDisplaySettings("scaleOffset",this.props.displaySettings.scaleOffset+15)}},{key:"zoomOut",value:function(){this.props.updateDisplaySettings("scaleOffset",this.props.displaySettings.scaleOffset-15)}},{key:"nudgeItem",value:function(e,t,n){this.arrowKeyOffset+=t;var r=document.getElementById(this.props.selectedItem.id);if(r&&r.style.top&&r.style.left){var o=t;switch(e){case"down":n?(this.props.updateItem(this.props.selectedItem.id,"frame.origin.y",this.props.selectedItem.frame.origin.y+this.arrowKeyOffset),this.arrowKeyOffset=0):r.style.top=String(parseInt(r.style.top,10)+o);break;case"up":n?(this.props.updateItem(this.props.selectedItem.id,"frame.origin.y",this.props.selectedItem.frame.origin.y-this.arrowKeyOffset),this.arrowKeyOffset=0):r.style.top=String(parseInt(r.style.top,10)-o);break;case"left":n?(this.props.updateItem(this.props.selectedItem.id,"frame.origin.x",this.props.selectedItem.frame.origin.x-this.arrowKeyOffset),this.arrowKeyOffset=0):r.style.left=String(parseInt(r.style.left,10)-o);break;case"right":n?(this.props.updateItem(this.props.selectedItem.id,"frame.origin.x",this.props.selectedItem.frame.origin.x+this.arrowKeyOffset),this.arrowKeyOffset=0):r.style.left=String(parseInt(r.style.left,10)+o)}}}},{key:"addEventListeners",value:function(){window.addEventListener("mouseup",this.handleMouseUpOrTouchEnd),window.addEventListener("touchend",this.handleMouseUpOrTouchEnd),window.addEventListener("mousemove",this.handleMouseOrTouchMove),window.addEventListener("touchmove",this.handleMouseOrTouchMove),window.addEventListener("mouseleave",this.removeEventListeners),window.addEventListener("touchcancel",this.handleMouseUpOrTouchEnd)}},{key:"removeEventListeners",value:function(){this.setState(Object.assign({},this.state,{dragAnchor:void 0,dragRect:void 0,viewportOffset:{x:0,y:0},showItemBorders:!1})),window.removeEventListener("mouseup",this.handleMouseUpOrTouchEnd),window.removeEventListener("touchend",this.handleMouseUpOrTouchEnd),window.removeEventListener("mousemove",this.handleMouseOrTouchMove),window.removeEventListener("touchmove",this.handleMouseOrTouchMove),window.removeEventListener("mouseleave",this.removeEventListeners),window.removeEventListener("touchcancel",this.handleMouseUpOrTouchEnd)}},{key:"getPointOnCanvas",value:function(e){var t=document.getElementById("canvas").getBoundingClientRect();return{x:e.x-t.left/(this.props.displaySettings.scaleOffset/100),y:e.y-t.top/(this.props.displaySettings.scaleOffset/100),space:e.space}}}]),t}();_.defaultProps={},_.FPS_LOCK=30,_.GAMEPAD_POLLING_INTERVAL=1e3/_.FPS_LOCK;var E=(0,l.connect)(function(e){var t=m.User.getUser(),n=e.buncee.selected_slides[e.user.id],r=e.buncee.document.slides.find(function(e){return e.id===n}),o=r.items.filter(function(t){return void 0!==e.buncee.document.items[t]}).map(function(t){return e.buncee.document.items[t]}),i=(0,f.findKey)(e.buncee.selected_items,function(e){return void 0!==e&&null!==e&&e.id===t.guid}),a=i?e.buncee.document.items[i]:void 0;if(void 0===a){var s=(0,f.values)(e.buncee.document.items).filter(function(e){return void 0!==e&&null!==e&&"group"===e.type}),c=(0,f.flatten)((0,f.map)(s,function(e){return e.content.body}));a=(0,f.find)(c,function(e){return e.id===i})}return{modal:e.openModal,gateway:e.gateway,canvas:e.buncee.document.canvas,slideItems:o,settings:e.settings,selectedItem:a,user:e.user,slide:r,clipboard:e.clipboard,mode:e.renderingMode,items:e.buncee.document.items,itemDefaults:e.item_defaults,isPanning:e.displaySettings.isPanning,displaySettings:e.displaySettings,isFullscreen:e.displaySettings.isFullscreen,preferences:e.preferences,showWatermark:m.User.isLoggedIn()?e.preferences["show-watermark"].value:e.buncee.show_watermark,selectedItems:e.buncee.selected_items}},function(e){return{deselectItems:function(t){var n=m.User.getUser();(0,f.forOwn)(t,function(t,r){null!==t&&t.id===n.guid&&e(p.Actions.updateItemsSelected({path:r,value:null}))})},updateSelectedItems:function(t,n){e(p.Actions.updateItemsSelected({path:t,value:n}))},updateClipboard:function(t){e(p.Actions.updateClipboard({path:"",value:t}))},undoPrevAction:function(){e(p.Actions.undoPrevAction({}))},redoPrevAction:function(){e(p.Actions.redoPrevAction({}))},updateScale:function(t){e(p.Actions.updateStore({path:"displaySettings.scale",value:t}))},updateScaleOffset:function(t){e(p.Actions.updateStore({path:"displaySettings.scaleOffset",value:t}))},updateViewportOffset:function(t){e(p.Actions.updateStore({path:"displaySettings.viewportOffset",value:t}))},updateDisplaySettings:function(t,n){e(p.Actions.updateStore({path:"displaySettings."+t,value:n}))},addItem:function(t,n){e(p.Actions.addItem({item:t})),e(p.Actions.updateSlide({id:n.id,path:"items",value:m.ArrayUtil.push(n.items,t.id)}))},updateItem:function(t,n,r){e(p.Actions.updateItem({path:t+(n.length>0?"."+n:n),value:r}))},updateItems:function(t,n,r){var o=[];o.push(p.Actions.updateItem({path:"",value:t})),"object"===(void 0===n?"undefined":a(n))&&void 0!==r?o.push(p.Actions.updateSlide({id:n.id,path:"items",value:r})):"object"===(void 0===n?"undefined":a(n))&&(r=n.items.filter(function(e){return void 0!==t[e]}),o.push(p.Actions.updateSlide({id:n.id,path:"items",value:r}))),e(p.Actions.batchActions({actions:o}))},openBrowser:function(t){e(p.Actions.openGateway({activeBrowser:t}))},exitFullscreen:function(){e(p.Actions.setFullscreen({value:!1}))},removeItem:function(t,n,r){e(p.Actions.batchActions({actions:[p.Actions.updateItemsSelected({path:n.id,value:null}),p.Actions.updateItem({path:"",value:(0,f.omit)(t,[n.id])}),p.Actions.updateSlide({id:r.id,path:"items",value:m.ArrayUtil.findAndRemove(r.items,function(e){return e===n.id})})]}))}}})(_);t.CanvasViewport=_,t.ConnectedCanvasViewport=E},443:function(e,t,n){"use strict"},444:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(119),i=c(n(124)),a=n(4),s=c(n(269));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}for(var u=s.default.import("formats/font"),d=s.default.import("attributors/style/size"),p=s.default.import("modules/clipboard"),f=s.default.import("delta"),m=1;m<=800;m++)d.whitelist.push(m+"px");u.whitelist=Object.keys(o.Fonts),s.default.register(u,!0),s.default.register(d,!0);var h=function(e){function t(){return l(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p),r(t,[{key:"onPaste",value:function(e){e.preventDefault();var t=this.quill.getSelection(),n=e.clipboardData.getData("text/plain"),r=(new f).retain(t.index).delete(t.length).insert(n),o=n.length+t.index;this.quill.updateContents(r,"silent"),this.quill.setSelection(o,0,"silent"),this.quill.scrollIntoView()}}]),t}();s.default.register(h,!0);var v=function(){function e(){l(this,e)}return r(e,null,[{key:"getInstance",value:function(){return this.quill||null}},{key:"getAttributes",value:function(){return this.attributes||{}}},{key:"initializeInstance",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.quill&&this.destroyInstance(this.quill),this.quill=e,this.attributes=n||{},this.eventHandler=(0,i.default)(function(e,n){t.dispatchEvents(e)},50),this.quill.on("editor-change",this.eventHandler)}},{key:"isEnabled",value:function(){return this.quill&&this.quill.isEnabled()}},{key:"subscribe",value:function(e){this.subscribers.indexOf(e)<0&&this.subscribers.push(e)}},{key:"unsubscribe",value:function(e){try{this.subscribers.splice(this.subscribers.indexOf(e))}catch(e){}}},{key:"destroyInstance",value:function(e){this.quill&&this.quill===e&&(this.quill.off("editor-change",this.eventHandler),this.quill=void 0,this.selection=void 0,this.attributes=void 0,this.subscribers=[])}},{key:"saveSelection",value:function(){if(this.quill){var e=this.quill.getSelection(),t=this.quill.getText().length;this.selection={range:e,totalLength:t}}}},{key:"restoreSelection",value:function(){this.quill&&this.selection&&(this.quill.setSelection(this.selection.range,"api"),this.selection=void 0)}},{key:"format",value:function(e,t){void 0!==this.quill&&(a.Device.isIPadOrIPhone()?this.quill.formatText(0,this.quill.getText().length,e,t):(this.quill.hasFocus()||this.quill.focus(),this.quill.format(e,t)))}},{key:"focus",value:function(){void 0!==this.quill&&this.quill.focus()}},{key:"dispatchEvents",value:function(e){this.subscribers.forEach(function(t){t(e)})}}]),e}();t.default=v,v.subscribers=[]},451:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r};t.launchImmersiveReader=function(e){return s(this,void 0,void 0,i.default.mark(function t(){var n,r,o,s;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==window.config.immersive_reader_key&&null!==window.config.immersive_reader_key){t.next=2;break}return t.abrupt("return");case 2:return n={title:"Immersive Reader",chunks:[{content:e}]},(r=new Headers).set("Content-Type","application/x-www-form-urlencoded"),r.set("Content-Length","0"),r.set("Ocp-Apim-Subscription-Key",window.config.immersive_reader_key),t.next=9,fetch("https://eastus.api.cognitive.microsoft.com/sts/v1.0/issueToken",{method:"POST",headers:r});case 9:return o=t.sent,t.next=12,o.text();case 12:s=t.sent,a.launchAsync(s,n);case 14:case"end":return t.stop()}},t,this)}))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(450));n(449);var s=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})}},452:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKey=function(e){var t=e.keyCode;if(t>=65&&t<=90)return String.fromCharCode(t-65+97);if(t>=97&&t<=122)return String.fromCharCode(t);if(t>=48&&t<=57)return String.fromCharCode(t);if(t>=37&&t<=40)return"arrow-"+["left","up","right","down"][t-37];switch(t){case 8:return"delete";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 27:return"esc";case 32:return"space";case 33:return"arrow-left";case 34:return"arrow-right";case 61:case 187:return"equal";case 91:case 93:case 224:return"meta";case 173:case 189:return"minus";default:return}}},465:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=p(n(163)),a=n(11),s=p(n(0)),c=n(5),l=n(4),u=n(16),d=n(143);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.timer=null,n.closeModal=function(){clearInterval(n.timer),n.props.closeModal()},n.getWindowClassNames=function(){return"window confirm video-modal"},n.state={is_entered:!0,sec:0,timer_visibility:!0,start_button_visibility:!0,start_button_text:"Start Recording"},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Modal),r(t,[{key:"componentDidMount",value:function(){var e=this,t={uploadInBackground:!1,displayMode:i.PickerDisplayMode.inline,dropPane:{},fromSources:["video"],container:"video-modal",storeTo:{location:"s3",path:"user-uploads/"+window.config.tenant+"/"+this.props.user.id+"/"},onUploadDone:function(t){var n=t.filesUploaded[0];(0,d.uploadToFileDatabase)(encodeURI((0,u.cloudfrontURL)(n.key)),n.filename,"video/mp4"),e.props.addItem((0,l.generateItem)({type:"video",content:{type:"url",body:(0,u.cloudfrontURL)(n.key)},frame:(0,u.generateFrame)(610,455,e.props.canvas)}),e.props.addToIndex,e.props.slide),e.closeModal(),e.props.closeGateway()}};l.Device.isSafari()||(this.picker=l.fileStackClient.picker(t),this.picker.open()),window.onclick=function(t){var n=t.target;if(n){var r=document.getElementsByClassName("fsp-modal__sidebar")[0];if("fsp-button fsp-button--primary fsp-button--video"===n.className||"fsp-icon--video-start"===n.className){var o=document.getElementsByClassName("fsp-button--video")[0];o&&(o.style.pointerEvents="none"),e.timer=setInterval(function(){r&&(r.style.pointerEvents="none"),2===e.state.sec&&(o.style.pointerEvents="auto"),e.state.sec>=180?(e.setState({sec:0}),n.click(),clearInterval(e.timer)):e.setState({sec:e.state.sec+1,start_button_visibility:!0,start_button_text:"Stop"})},1e3)}else"fsp-button fsp-button--cancel fsp-button--video"!==n.className&&"fsp-icon--video-stop"!==n.className||(r&&(r.style.pointerEvents="auto"),e.setState({sec:0,timer_visibility:!1,start_button_visibility:!1,start_button_text:"Start Recording"}),clearInterval(e.timer))}"Record Video"!==n.title&&"Record Audio"!==n.title&&"fsp-source-list__icon fsp-icon fsp-icon--video"!==n.className&&"fsp-source-list__icon fsp-icon fsp-icon--audio"!==n.className||e.setState({timer_visibility:!0,start_button_visibility:!0}),"fsp-button fsp-button--cancel"===n.className&&(e.setState({timer_visibility:!0,start_button_visibility:!0,sec:0}),clearInterval(e.timer))}}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),l.Device.isSafari()||this.picker.close()}},{key:"renderWindowContent",value:function(){return s.createElement("div",{className:"video-modal-wrapper",key:"video-wrapper"},l.Device.isSafari()?s.createElement("div",{className:"no-support"},"Your current browser does not support webcam functionality."):s.createElement("div",null,this.state.timer_visibility?s.createElement("div",{className:"video-counter",key:"video-counter"},(0,u.formattedTimer)(this.state.sec),"/3:00"):null,s.createElement("div",{id:"video-modal",key:"video-modal"}),this.state.start_button_visibility?s.createElement("div",{className:"video-start"},this.state.start_button_text):null))}}]),t}(),m=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=void 0!==e.gateway?e.gateway.addToIndex:void 0;return{user:r,slide:n,canvas:e.buncee.document.canvas,addToIndex:o}},function(e,t){return{addItem:function(t,n,r){e(o.Actions.batchActions({actions:[o.Actions.addItem({item:t}),o.Actions.updateSlide({id:r.id,path:"items",value:"number"==typeof n?l.ArrayUtil.insert(r.items,t.id,r.items.length-n):l.ArrayUtil.push(r.items,t.id)})]}))},closeGateway:function(){e(o.Actions.closeGateway({activeBrowser:void 0}))}}})(f);t.default=m},466:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.upgrade=function(){window.open(window.config.web_uri+'/dashboard#{"view":"billing"}'),n.closeModal()},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"upgrade-modal"},i.createElement("div",{className:"modal-header"},i.createElement("h2",null,this.props.title)),i.createElement("p",null,this.props.message),i.createElement("div",{className:"row"},i.createElement("button",{className:"btn btn-blue",onClick:this.upgrade},"Upgrade"),i.createElement("button",{className:"btn btn-pink",onClick:this.props.closeModal},"Close")))}}]),t}();t.default=a},467:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(4),c=n(16);var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.toggleMenu=function(){n.props.showMenu?n.props.closeMenu():n.props.openMenu("link")},n.handleClick=function(e){e.stopPropagation(),e&&e.target.closest("input")||n.toggleMenu()},n.handleKeyDown=function(e){e.stopPropagation();var t=s.QuillSingleton.getInstance();if(13===e.keyCode&&t){e.stopPropagation(),e.preventDefault();var r=n.state.link;if(!s.Device.isIPadOrIPhone()&&0===t.selection.savedRange.length)return(0,c.displayToastMessage)("Oops! Please highlight the text you want to link"),void n.toggleMenu();0===r.length?s.QuillSingleton.format("link",""):0!==r.indexOf("https://")&&0!==r.indexOf("http://")?(r="http://"+r,s.QuillSingleton.format("link",r)):s.QuillSingleton.format("link",r),n.toggleMenu()}},n.handleLinkChange=function(e){e.stopPropagation(),e.preventDefault(),n.setState({link:e.target.value})};var r="";s.Device.isIPadOrIPhone()&&s.QuillSingleton.saveSelection();try{var o=s.QuillSingleton.getInstance();o&&(r=o.getFormat(0,0).link,r=o.getFormat().link)}catch(e){}return s.Device.isIPadOrIPhone()&&s.QuillSingleton.restoreSelection(),n.state={link:r,prevLink:r},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentDidUpdate",value:function(){var e="",t=s.QuillSingleton.getInstance();if(t)try{e=t.getFormat().link}catch(n){e=t.getFormat(0,0).link}(0,i.isEqual)(e,this.state.prevLink)||this.setState({link:e,prevLink:e})}},{key:"render",value:function(){return a.createElement("div",{className:"toolbar-button",id:"link",onClick:this.toggleMenu},a.createElement(o.PopupMenu,{text:"Link",showMenu:this.props.showMenu,icon:"icon-link",iconPosition:"top",classNames:["text-link-input"],popDirection:this.props.direction||"up"},a.createElement("input",{type:"text",onKeyDown:this.handleKeyDown,onChange:this.handleLinkChange,placeholder:"Type link and press Enter",value:this.state.link})))}}]),t}();t.default=l},468:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(4);var i=function(e,t){t.preventDefault();var n=o.QuillSingleton.getInstance();if(e.item&&"function"==typeof e.updateItem)e.updateItem(e.property,!e.item.content.attributes[e.property]);else if(n)try{o.QuillSingleton.format(e.property,!n.getFormat()[e.property])}catch(t){o.QuillSingleton.format(e.property,!n.getFormat(0,0)[e.property])}e.onClick(t)};t.default=function(e){var t=!1;if(e.item)t=e.item.content.attributes[e.property];else try{var n=o.QuillSingleton.getInstance();n&&(t=n.getFormat(0,0)[e.property],t=n.getFormat()[e.property])}catch(e){}return r.createElement("div",{onClick:function(t){i(e,t)},onTouchEnd:function(t){i(e,t)},key:"ql-"+e.property,className:"toolbar-button ql-"+e.property+" "+(t?"active":"")},r.createElement("div",{className:"icon-"+e.property+" top"}),r.createElement("span",{className:"label"},e.property))}},469:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(4);var i=function(e){var t=e.currentTarget.getAttribute("data-value");e.currentTarget.className.split(" ").indexOf("active")>-1?o.QuillSingleton.format("list",!1):o.QuillSingleton.format("list",t)};t.default=function(){var e="";try{var t=o.QuillSingleton.getInstance();t&&(e=t.getFormat().list)}catch(e){}return r.createElement("div",{key:"list",className:"toolbar-button-group no-individual-label-group"},r.createElement("div",{key:"ql-list-ordered",onClick:i,"data-value":"ordered",className:"toolbar-button ql-list ordered"+("ordered"===e?" active":"")},r.createElement("div",{className:"icon-listnumber top"}),r.createElement("span",{className:"label"},"Ordered List")),r.createElement("div",{key:"ql-list-bullet",onClick:i,"data-value":"bullet",className:"toolbar-button ql-list bullet"+("bullet"===e?" active":"")},r.createElement("div",{className:"icon-list top"}),r.createElement("span",{className:"label"},"Unordered List")),r.createElement("span",{className:"label align"},"List"))}},470:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(4);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.handleSizeChange=function(e){n.props.item&&"function"==typeof n.props.updateItem?n.props.updateItem("size",e):a.QuillSingleton.format("size",e+"px"),n.setState({currentSize:e})};var r=60;if(n.props.item&&"function"==typeof n.props.updateItem)r=parseInt(n.props.item.content.attributes.size,10),n.props.updateItem("size",r);else try{var o=a.QuillSingleton.getInstance();o&&(r=parseInt((o.getFormat(0,0).size||"60px").split("px")[0],10),r=parseInt((o.getFormat().size||"60px").split("px")[0],10))}catch(e){}return n.state={currentSize:r,prevSize:r},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"componentDidUpdate",value:function(){try{var e=60;if(this.props.item)e=parseInt(this.props.item.content.attributes.size,10);else try{var t=a.QuillSingleton.getInstance();t&&(e=parseInt((t.getFormat(0,0).size||"60px").split("px")[0],10),e=parseInt((t.getFormat().size||"60px").split("px")[0],10))}catch(e){}e!==this.state.prevSize&&this.setState({currentSize:e,prevSize:e})}catch(e){}}},{key:"render",value:function(){var e=2;return this.state.currentSize>330?e=16:this.state.currentSize>130?e=8:this.state.currentSize>50&&(e=4),i.createElement(o.NumberInput,{value:this.state.currentSize,min:8,max:800,step:e,onValueChange:this.handleSizeChange,text:"Text Size",textPosition:"bottom",disableEditing:!0})}}]),t}();t.default=s},471:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(119),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(4);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleFontclick=function(e){var t=e.currentTarget.getAttribute("data-value");"function"==typeof n.props.updateItem?n.props.updateItem("fontFamily",t):(s.QuillSingleton.format("font",t),n.props.closeMenu())},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"renderOptions",value:function(e){var t=this;return Object.keys(o.Fonts).sort().map(function(n){return a.createElement("div",{key:n,"data-value":n,onClick:t.handleFontclick,className:n===e?"active":""},a.createElement("div",{className:"preview ql-font-"+n},"ABC"),a.createElement("span",{className:"label"},o.Fonts[n].name))})}},{key:"render",value:function(){var e=this.getFont();"string"!=typeof e&&(e=e[0]);var t=a.createElement("div",{className:"input-select",id:"text-font",onClick:this.props.onClick},a.createElement("div",{className:"selected-font"},a.createElement("span",null,o.Fonts[e].name),a.createElement("span",{className:"icon-tabdown"})),a.createElement("p",null,"Font"));return a.createElement(i.PopupMenu,{showMenu:this.props.showMenu,buttonContent:t,classNames:["font-selector"],popDirection:this.props.direction||"up"},a.createElement("div",{className:"select-options"},this.renderOptions(e)))}},{key:"getFont",value:function(){if(this.props.item)return this.props.item.content.attributes.fontFamily;var e=s.QuillSingleton.getAttributes().fontFamily||"lato";try{var t=s.QuillSingleton.getInstance();t&&(e=t.getFormat(0,0).font||e,e=t.getFormat().font||e)}catch(e){}return e}}]),t}();t.default=c},472:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(4);var i=function(e){var t=e.currentTarget.getAttribute("data-value");o.QuillSingleton.format("align",t)};t.default=function(){var e="";try{var t=o.QuillSingleton.getInstance();t&&(e=t.getFormat(0,0).align||"",e=t.getFormat().align||"")}catch(e){}return r.createElement("div",{key:"align",className:"toolbar-button-group no-individual-label-group"},r.createElement("div",{key:"ql-align-left",onClick:i,"data-value":"",className:"toolbar-button ql-align left "+(""===e?" active":"")},r.createElement("div",{className:"icon-alignleft top"}),r.createElement("span",{className:"label"},"Align Left")),r.createElement("div",{key:"ql-align-center",onClick:i,"data-value":"center",className:"toolbar-button ql-align center "+("center"===e?" active":"")},r.createElement("div",{className:"icon-aligncenter top"}),r.createElement("span",{className:"label"},"Align Center")),r.createElement("div",{key:"ql-align-right",onClick:i,"data-value":"right",className:"toolbar-button ql-align right "+("right"===e?" active":"")},r.createElement("div",{className:"icon-alignright top"}),r.createElement("span",{className:"label"},"Align Right")),r.createElement("div",{key:"ql-align-justify",onClick:i,"data-value":"justify",className:"toolbar-button ql-align justify "+("justify"===e?" active":"")},r.createElement("div",{className:"icon-justify top"}),r.createElement("span",{className:"label"},"Align Justify")),r.createElement("span",{className:"label align"},"Align"))}},473:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(84),s=n(273),c=(r=s)&&r.__esModule?r:{default:r},l=n(11),u=m(n(6)),d=m(n(0)),p=n(5),f=n(4);function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.quill=null,n.getWindowClassNames=function(){return"window text-editor"},n.closeModal=function(){f.QuillSingleton.destroyInstance(n.quill),n.props.closeModal()},n.didClickOverlay=function(){},n.saveItem=function(){n.props.updateItem(n.quill.getContents(),n.props.item.id),n.closeModal()},n.renderButtons=function(){return d.createElement("div",{className:"buttons row"},d.createElement("div",{key:"close-button",className:"btn btn-white",onClick:n.closeModal},"Close"),d.createElement("div",{key:"save-button",className:"btn",onClick:n.saveItem},"Save"))},n.state={is_entered:!0},"text"!==e.item.type&&n.closeModal(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Modal),o(t,[{key:"componentDidMount",value:function(){this.quill=new f.Quill("#text-editor-modal .modal-editor",{placeholder:"Add text here..."}),this.quill.setContents(this.props.item.content.body),f.QuillSingleton.initializeInstance(this.quill,this.props.item.content.attributes),this.quill.enable(),this.quill.setSelection(0,this.quill.getText().length),this.quill.on("selection-change",this.handleScroll),this.forceUpdate()}},{key:"componentDidUpdate",value:function(){var e=document.getElementsByClassName("editor-container")[0],t=document.getElementsByClassName("modal-editor")[0],n=e.getBoundingClientRect(),r=["width: "+n.width/this.props.displaySettings.scale+"px","height: "+n.height/this.props.displaySettings.scale+"px","transform: scaleX("+this.props.displaySettings.scale+") scaleY("+this.props.displaySettings.scale+")","opacity: "+this.props.item.opacity];t.setAttribute("style",r.join(";"))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"handleScroll",value:function(){var e=document.getElementsByTagName("body")[0].getBoundingClientRect().height;window.scrollTo(0,23*e/100)}},{key:"preventScroll",value:function(e){e.preventDefault(),$(".editor-wrapper").scrollTop(0)}},{key:"renderWindowContent",value:function(){var e=["modal-editor"];return this.props.item.content.attributes&&this.props.item.content.attributes.fontFamily&&e.push(this.props.item.content.attributes.fontFamily),this.quill,d.createElement("div",{id:"text-editor-modal"},d.createElement("div",{className:"modal-content"},d.createElement("div",{className:"editor-wrapper",onScroll:this.preventScroll},d.createElement(c.default,{mode:a.ToolbarMode.STANDALONE,selectedItem:this.props.item}),d.createElement("div",{className:"editor-container"},d.createElement("div",{className:e.join(" ")})))),this.renderButtons())}}]),t}(),v=(0,p.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=e.buncee.document.canvas,i=e.buncee.selected_items;return{canvas:o,user:r,slide:n,item:u.keys(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]})[0],displaySettings:e.displaySettings}},function(e,t){return{updateItem:function(t,n){e(i.Actions.updateItem({path:n+".content.body",value:t}))}}})(h);t.default=v},474:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tabs=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(218),s=l(n(118)),c=l(n(200));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleFetchTabs=function(){var e="template"===n.props.item_browser?c.default:s.default;n.setState({loading:!0}),(0,a.fetchTabs)(n.props.item_browser).then(function(t){var r=t.map(function(t){return{guid:t.guid,name:t.name,categories_preview:t.categories_preview,canonical_name:t.canonical_name,browser_component:e}});n.setState({loading:!1,tabs:[].concat(u((0,a.getDefaultTabs)(n.props.item_browser)),u(r))})})},n.processSelectedTab=function(e){if(n.setState({selected_tab:e}),!e)throw new Error("Selected Tab not found");n.props.pushSelectedTab(e)},n.imageTab=function(){switch(n.props.item_browser){case"template":case"upload":case"audio":case"omni":return!1}return!0},n.state={tabs:[],selected_tab:(0,a.InfoForBrowserType)(n.props.item_browser).default_tab,loading:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"componentDidMount",value:function(){this.handleFetchTabs(),this.state.selected_tab&&this.props.pushSelectedTab(this.state.selected_tab)}},{key:"render",value:function(){var e=this,t=this.state.tabs.map(function(t,n){var r=["tab"];return e.state.selected_tab&&e.state.selected_tab.canonical_name===t.canonical_name&&r.push("selected"),i.createElement("div",{className:r.join(" "),key:n,onClick:function(){return e.processSelectedTab(t)},id:t.canonical_name},e.imageTab()&&"divider"!==t.guid?i.createElement("div",{className:"tab-wrapper"},i.createElement("img",{className:"tab-img",src:t.categories_preview}),i.createElement("div",{className:"tab-text"},t.name)):i.createElement("div",null,t.name))});return i.createElement("div",{className:"tabs-wrapper"},i.createElement("div",{className:"tabs-static"},this.props.staticContent),this.state.loading?i.createElement(o.LoadingIndicator,{color:"#00A3A8"}):i.createElement("div",{className:"tabs"},t))}}]),t}();t.Tabs=d},475:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StitchBrowser=void 0;var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r};t.StitchBrowser=function(e){var t=["browser-results grid no-tab"],n=e.results.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent})});return n.length<1&&t.push("no-results"),o.createElement("div",{className:t.join(" "),id:"browser-results"},n.length>0?n:o.createElement("div",{className:"no-results-text"},"No clips found"))}},476:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(117),a=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){var t=e.results.map(function(t,n){return o.createElement(a.default,{item_browser:e.item_browser,element:t,key:n,id:n,handleSelected:e.processSelectedResult,handleMouseTouchDown:e.mouseEvent})});return o.createElement("div",{className:["browser-omni-result grid"].join(" ")},t.length?o.createElement("div",null," ",t," "):o.createElement("div",null,"No result found"))}},477:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedItemgateway=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=f(n(6)),s=f(n(0)),c=n(5),l=n(4),u=n(144),d=f(n(140)),p=n(16);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.youtubeRegex=/(http[s]?:[\/]{2}|[\/]{2})??([a-z0-9\-\.]+)??(youtube.com|youtu.be)\/(watch|v|embed)?[/]?(\?v=|v\/)?([a-z0-9\-_]{11,})/i,r.viemoRegex=/vimeo.*?([0-9]+$)/i,r.imageRegex=/\.(jpeg|jpg|gif|png|svg)($|(\?))/i,r.disabled={},r.hidden={},r.renderItemBubble=function(e,t,n){var o=!1,a=!1;return void 0!==r.disabled[e]?(o=!0,n=function(){}):!0===r.hidden[e]?a=!0:t.push("ef-ripple-out"),s.createElement(i.ItemBubble,{label:e,classNames:t,handleClick:n,isDisabled:o,isInvisible:a,disabledMessage:r.disabled[e]})},r.openImportModal=function(){r.props.openModal("input",{validate:r.validateImportUrl,handleSubmit:r.handleImportURL,title:"Insert a URL",message:"Insert a Youtube, Vimeo, or image URL to add to your canvas"})},r.validateImportUrl=function(e){return e.match(r.youtubeRegex)||e.match(r.viemoRegex)||e.match(r.imageRegex)?{isValid:!0}:{isValid:!1,message:"Oops! We don't support that media just yet. Please insert a different URL."}},r.handleImportURL=function(e){if(e.match(r.youtubeRegex)){var t=(0,l.generateItem)({type:"youtube",frame:(0,p.generateFrame)(510,290,r.props.canvas),content:{type:"url",body:(0,p.getYoutubeId)(e)}});r.props.addItem(t,r.props.addToIndex,r.props.slide,r.props.user),r.props.closeGateway()}else if(e.match(r.viemoRegex)){var n=(0,l.generateItem)({type:"vimeo",frame:(0,p.generateFrame)(510,290,r.props.canvas),content:{type:"url",body:(0,p.getVimeoId)(e)}});r.props.addItem(n,r.props.addToIndex,r.props.slide,r.props.user),r.props.closeGateway()}else if(e.match(r.imageRegex)){var o=(0,l.generateItem)({type:"image",frame:(0,p.generateFrame)(400,300,r.props.canvas),content:{type:"url",body:e}});r.props.addItem(o,r.props.addToIndex,r.props.slide,r.props.user),r.props.closeGateway()}},r.addFromItemgateway=function(e){if(r.props.selectedItemId&&r.props.deselectItemSelected(r.props.selectedItemId.id),"drawing"===e.type){r.props.addItem(e,r.props.addToIndex,r.props.slide,r.props.user),r.props.updateDefaultItem("drawing",{brush_color:"#000",brush_mode:0,brush_size:12,brush_style:"CUBIC_BEZIER_BRUSH",brush_opacity:1})}document.getElementById("viewport").focus(),r.props.addItem(e,r.props.addToIndex,r.props.slide,r.props.user),r.props.closeGateway()},r.addItemToCanvas=function(e){var t;switch(e){case"Text":r.addFromItemgateway((0,l.generateItem)({type:"text",content:{type:"text",body:"",attributes:{fontFamily:"raleway",background_color:"#ffffff",background_opacity:0}},frame:(0,p.generateFrame)(600,300,r.props.canvas)}));break;case"MCQ":var n=(0,u.generateId)([],4),o=(m(t={},n,"Choice 1"),m(t,(0,u.generateId)([n],4),"Choice 2"),t),i=(0,l.generateItem)({type:"mcq",content:{type:"any",body:{question:"",choices:o,correct_choice:n},attributes:{question_id:(0,u.generateId)([],16),size:60,bold:!1,italic:!1,underline:!1,fontFamily:"raleway",color:"#000",alignment:"left"}},frame:(0,p.generateFrame)(600,300,r.props.canvas)});r.addFromItemgateway(i),r.props.openEditorModal(i.id,"mcq");break;case"FRQ":var a=(0,l.generateItem)({type:"frq",content:{type:"any",body:{question:""},attributes:{question_id:(0,u.generateId)([],16),size:60,bold:!1,italic:!1,underline:!1,fontFamily:"raleway",color:"#000",alignment:"left"}},frame:(0,p.generateFrame)(600,300,r.props.canvas)});r.addFromItemgateway(a),r.props.openEditorModal(a.id,"frq");break;case"Drawing":r.addFromItemgateway((0,l.generateItem)({type:"drawing",frame:{origin:d.POINT_ZERO,width:(0,l.getCanvasDimensions)(r.props.canvas).width,height:(0,l.getCanvasDimensions)(r.props.canvas).height},content:{type:"drawing",body:{base_image:null,commands:[]}}}));break;case"QR Code":r.addFromItemgateway((0,l.generateItem)({type:"qrcode",content:{type:"empty",body:""},frame:(0,p.generateFrame)(300,300,r.props.canvas)}))}};var o=(m(n={},"Uploads","files.write"),m(n,"Record Video","creation.media.types.video"),m(n,"QR Code","creation.media.types.qrcode"),m(n,"Buncee Sticker","creation.media.vendors.buncee"),m(n,"Buncee Animation","creation.media.vendors.buncee"),m(n,"Buncee Message","creation.media.vendors.buncee"),m(n,"Youtube","creation.media.vendors.youtube"),m(n,"Import URL","creation.media.import_from_url"),m(n,"Web Image","creation.media.vendors.pixabay"),m(n,"Buncee 3D","creation.media.vendors.buncee.3d"),m(n,"Khan Academy","creation.media.vendors.khanacademy"),m(n,"360 Image","creation.media.types.panoramic_image"),m(n,"FRQ","creation.media.types.free_response_question"),m(n,"MCQ","creation.media.types.multiple_choice_question"),n);for(var a in o)l.User.hasPermission(o[a])||(l.User.permissionIsHidden(o[a])?r.hidden[a]=!0:"app"===window.config.tenant?r.disabled[a]="Upgrade to access this feature":r.disabled[a]="Disabled By Administrator");return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),r(t,[{key:"render",value:function(){var e=this;return s.createElement("div",{className:"item-gateway-bubble-wrapper"},s.createElement("div",{className:"item-gateway-bubble"},this.renderItemBubble("Text",["background-yellow yellow-ripple icon-text"],function(){return e.addItemToCanvas("Text")}),this.renderItemBubble("Buncee Animation",["background-cherry cherry-ripple icon-animation"],function(){return e.props.browserChange("animation")}),this.renderItemBubble("Web Image",["background-blue blue-ripple icon-global"],function(){return e.props.browserChange("web")}),this.renderItemBubble("Uploads",["background-green green-ripple icon-upload"],function(){return e.props.browserChange("upload")}),this.renderItemBubble("FRQ",["background-purple purple-ripple icon-frq"],function(){return e.addItemToCanvas("FRQ")})),s.createElement("div",{className:"item-gateway-bubble"},this.renderItemBubble("Shapes",["background-yellow yellow-ripple icon-like2hover"],function(){return e.props.browserChange("shape")}),this.renderItemBubble("Buncee Sticker",["background-cherry cherry-ripple icon-sticker"],function(){return e.props.browserChange("sticker")}),this.renderItemBubble("360 Image",["background-blue blue-ripple icon-360"],function(){return e.props.browserChange("panorama")}),this.renderItemBubble("Import URL",["background-green green-ripple icon-importurl"],function(){return e.openImportModal()}),this.renderItemBubble("MCQ",["background-purple purple-ripple icon-checkboxfilled"],function(){return e.addItemToCanvas("MCQ")})),s.createElement("div",{className:"item-gateway-bubble"},this.renderItemBubble("Drawing",["background-yellow yellow-ripple icon-drawing"],function(){return e.addItemToCanvas("Drawing")}),this.renderItemBubble("Buncee Message",["background-cherry cherry-ripple icon-message"],function(){return e.props.browserChange("message")}),this.renderItemBubble("Khan Academy",["background-blue blue-ripple icon-khan"],function(){return e.props.browserChange("khanacademy")}),this.renderItemBubble("Record Video",["background-green green-ripple icon-recordvideo"],function(){return e.props.openModal("video")}),this.renderItemBubble("QR Code",["background-deep-blue deep-blue-ripple  icon-qr"],function(){return e.addItemToCanvas("QR Code")})),s.createElement("div",{className:"item-gateway-bubble"},this.renderItemBubble("Buncee 3D",["background-cherry cherry-ripple icon-3d"],function(){return e.props.browserChange("three_d")}),this.renderItemBubble("Emoji",["background-cherry cherry-ripple icon-reactions"],function(){return e.props.browserChange("emoji")}),this.renderItemBubble("Youtube",["background-blue blue-ripple icon-youtube2"],function(){return e.props.browserChange("youtube")}),this.renderItemBubble("Take Photo",["background-green green-ripple icon-photo"],function(){return e.props.openModal("photo")})))}}]),t}(),v=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=e.buncee.document.canvas,i=e.buncee.selected_items,s=a.keys(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),c=e.links,l=e.gateway.addToIndex;return{user:r,slide:n,canvas:o,selectedItemId:s[0],links:c,addToIndex:l}},function(e){return{addItem:function(t,n,r,i){var a=void 0;a="number"==typeof n?l.ArrayUtil.insert(r.items,t.id,r.items.length-n):l.ArrayUtil.push(r.items,t.id),e(o.Actions.batchActions({actions:[o.Actions.addItem({item:t}),o.Actions.updateSlide({id:r.id,path:"items",value:a}),o.Actions.updateItemsSelected({path:t.id,value:i}),o.Actions.updateItemDefaults({path:"",value:{}})]}))},deselectItemSelected:function(t){e(o.Actions.updateItemsSelected({path:t,value:null}))},updateDefaultItem:function(t,n){e(o.Actions.updateItemDefaults({path:t,value:n}))},openModal:function(t,n){e(o.Actions.openModal({type:t,props:n}))},openEditorModal:function(t,n){e(o.Actions.openModal({type:n,props:{itemID:t}}))},closeGateway:function(){e(o.Actions.closeGateway({activeBrowser:void 0}))}}})(h);t.ConnectedItemgateway=v},478:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(4);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleResize=function(){var e=n.primaryThumbnailRef.getBoundingClientRect();n.overlayRef.style.width=e.width+"px",n.overlayRef.style.height=e.height+"px"},n.renderActionButton=function(){return n.isLocked()?i.createElement("a",{target:"_blank",href:window.config.web_uri+'/dashboard#{"view":"billing"}',className:"btn btn-yellow"},"Upgrade to Unlock"):i.createElement("button",{className:"btn btn-blue",onClick:n.props.setTemplate},"Use This Template")},n.selectPreview=function(e){n.setState({thumbnail_index:e})},n.isLocked=function(){return!0===n.props.template.is_premium&&!a.User.isPremium()},n.state={thumbnail_index:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"componentDidMount",value:function(){if(this.isLocked()){var e=this.primaryThumbnailRef.getBoundingClientRect();this.overlayRef.style.width=e.width+"px",this.overlayRef.style.height=e.height+"px",window.addEventListener("resize",this.handleResize)}}},{key:"componentWillUnmount",value:function(){this.isLocked()&&window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.props.template.result_payload,n=this.props.template.thumbnails,r=t.canvas.size_type.split("-").map(function(e){return(0,o.capitalize)(e)}).join(" ");return i.createElement("div",{className:"result-preview template-preview"},i.createElement("div",{className:"template-info"},t.title," ",i.createElement("span",{className:"info-divider"},"|")," ",r),i.createElement("div",{id:"primary-thumbnail-container"},i.createElement("img",{id:"primary-thumbnail",src:n[this.state.thumbnail_index],ref:function(t){e.primaryThumbnailRef=t}}),this.isLocked()?i.createElement("div",{className:"overlay icon-lockblack",ref:function(t){e.overlayRef=t}}):null),i.createElement("div",{className:"thumbnails-section"},i.createElement("p",null,"Page ",this.state.thumbnail_index+1," / ",n.length),i.createElement("div",{className:"template-thumbnails"},n.map(function(t,n){return i.createElement("div",{key:n,className:"thumbnail"+(e.state.thumbnail_index===n?" selected":"")},i.createElement("img",{key:n,src:t,onClick:function(){return e.selectPreview(n)}}))}))),i.createElement("div",{className:"template-buttons"},i.createElement("button",{className:"btn btn-orange",onClick:this.props.backToResults},"Back"),this.renderActionButton()))}}]),t}();t.default=s},479:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedHOCResults=t.HOCResults=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(11),s=n(6),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=n(4),d=n(16),p=n(218),f=n(217),m=y(n(216)),h=n(199),v=y(n(478));function y(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var g=800,w=300,_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.cloneChildren=[],n.nextPage="",n.isDragging=!1,n.cancelButton=document.getElementById("cancel-btn"),n.previewOn=function(){return"animation"===n.props.item_browser||("youtube"===n.props.item_browser||("khanacademy"===n.props.item_browser||!(!n.props.selected_tab||"omniVideo"!==n.props.selected_tab.canonical_name)))},n.resultMarkUp=function(e){return e.data.map(function(e){var t=void 0;t=void 0!==e.result_payload?e.result_payload:null!==e.content&&"object"===r(e.content)?e.content:e.entity_url;var o=void 0;return o="string"==typeof e.thumbnails?[e.thumbnails]:e.thumbnails,{id:e.id,title:"template"===n.props.item_browser?t.title:e.title,thumbnails:o,result_payload:t,selected:!1,preview:n.previewOn(),is_premium:e.is_premium,alt_text:e.alt_text,catalog_guid:e.catalog_guid}})},n.getResults=function(){(0,p.resultsFetchMap)(n.props.item_browser,n.props.selected_tab,n.props.search_query).then(function(e){var t=n.resultMarkUp(e);n.setState({results:t,next_links:e.links.next_page,loading:!1})}).catch(function(){return n.setState({results:[],loading:!1})})},n.getMoreResults=function(){(0,p.resultsFetchMoreMap)(n.props.item_browser,n.props.selected_tab,n.state.next_links).then(function(e){var t=n.resultMarkUp(e);n.setState({results:[].concat(b(n.state.results),b(t)),next_links:e.links.next_page,loadMore:!1})}).catch(function(){return n.setState({results:n.state.results,loadMore:!1})})},n.processSelectedResult=function(e,t,r){if(n.eventOrigin&&r&&!n.shouldNotDrag()){var o=u.GeometryUtil.pointFromEvent(r,"client",n.props.displaySettings);o=Object.assign({},o,{x:o.x*(n.props.displaySettings.scaleOffset/100),y:o.y*(n.props.displaySettings.scaleOffset/100)});var i=u.GeometryUtil.differenceBetweenPoints(n.eventOrigin.point,o);if(u.Device.isIPadOrIPhone()&&(i.x>20||i.y>20))return}if(n.state.results){var a=[].concat(b(n.state.results));if("background"!==n.props.item_browser&&"audio"!==n.props.item_browser)"template"===n.props.item_browser&&-1===e?n.props.closeModal():(a[e].selected=t,n.setState({results:[].concat(b(a))}));else{var s=a.map(function(e){return e.selected&&(e.selected=!1),e});s[e].selected=t,n.setState({results:[].concat(b(s))})}var c=n.state.results.filter(function(e){return e.selected});n.props.queueSelectedresults(c)}n.eventOrigin=void 0},n.processSelectedColor=function(e){var t={id:"",title:"",thumbnails:[],result_payload:e,selected:!0,preview:!1};n.props.queueSelectedresults([t])},n.renderResultPreview=function(){switch(n.props.item_browser){case"template":return c.createElement(v.default,{template:n.props.selected_results[0],backToResults:function(){var e=(0,s.findIndex)(n.state.results,function(e){return e.selected});n.processSelectedResult(e,!1)},setTemplate:n.props.handleAddItems});default:return}},n.renderResultBrowser=function(){var e=void 0;return e=n.props.selected_tab?n.props.selected_tab.browser_component:(0,p.InfoForBrowserType)(n.props.item_browser).default_browser_componentType,c.createElement(e,{key:"item-browsers",canvas:n.props.canvas,item_browser:n.props.item_browser,selected_results:n.props.selected_results,search_query:n.props.search_query,results:n.state.results||[],processSelectedResult:n.processSelectedResult,processSelectedColor:n.processSelectedColor,mouseEvent:n.handleMouseDownOrTouchStart,scrollEvent:n.scrollToBottom,browserChange:n.props.handleBrowserChange,promptUpgrade:n.promptUpgrade})},n.renderContent=function(){return"template"===n.props.item_browser&&n.props.selected_results.length>0?n.renderResultPreview():n.renderResultBrowser()},n.shouldNotDrag=function(){var e=n.props.item_browser;return"audio"===e||"stitch"===e||"template"===e},n.handleMouseDownOrTouchStart=function(e){e.persist();var t=u.GeometryUtil.pointFromEvent(e.nativeEvent,"client",n.props.displaySettings);n.shouldNotDrag()||3!==e.nativeEvent.which&&(n.eventOrigin={point:{x:t.x*(n.props.displaySettings.scaleOffset/100),y:t.y*(n.props.displaySettings.scaleOffset/100),space:"client"},target:e.target,width:e.target.offsetWidth,height:e.target.offsetHeight},"VIDEO"===n.eventOrigin.target.nodeName&&(n.eventOrigin=Object.assign({},n.eventOrigin,{target:n.eventOrigin.target.parentElement})),window.clearTimeout(n.initDragTimeout),n.initDragTimeout=window.setTimeout(n.initDragCallback,u.Device.isIPadOrIPhone()&&!n.shouldNotDrag()?g:w),window.addEventListener("mouseup",n.handleMouseDownOrTouchEndEvent),window.addEventListener("mouseleave",n.handleMouseDownOrTouchEndEvent),window.addEventListener("touchend",n.handleMouseDownOrTouchEndEvent))},n.initDragCallback=function(){if(n.addTouchListeners(),n.addMouseListeners(),n.isDragging=!0,n.eventOrigin){n.eventOrigin.target.style.position="absolute",n.eventOrigin.target.style.left=""+(n.eventOrigin.point.x-n.eventOrigin.target.offsetWidth/2),n.eventOrigin.target.style.top=""+(n.eventOrigin.point.y-n.eventOrigin.target.offsetHeight/2),n.cloneChild={point:{x:n.eventOrigin.point.x-n.eventOrigin.target.offsetWidth/2,y:n.eventOrigin.point.y-n.eventOrigin.target.offsetHeight/2},target:n.eventOrigin.target.cloneNode(!0),width:n.eventOrigin.width,height:n.eventOrigin.height},document.body.appendChild(n.cloneChild.target),n.eventOrigin.target.style.position="",n.eventOrigin.target.style.left="",n.eventOrigin.target.style.top="";var e=document.getElementsByClassName("result selected");if(e.length>0)for(var t=0;t<e.length;t++)n.eventOrigin.target.id!==e[t].id&&(n.cloneChildren[t]={point:{x:e[t].getBoundingClientRect().left,y:e[t].getBoundingClientRect().top},target:e[t].cloneNode(!0),width:e[t].offsetWidth,height:e[t].offsetHeight});n.cloneChildren=n.cloneChildren.map(function(e){return e})}n.cloneChildren.forEach(function(e){document.body.appendChild(e.target)}),n.handleGatewayVisiblity("hide")},n.handleSelectedMove=function(e){if(e.preventDefault(),e.stopPropagation(),n.isDragging){var t=0,r=0,o=u.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings);n.cloneChild&&n.eventOrigin&&(n.cloneChild.target.style.position="absolute",n.cloneChild.target.style.pointerEvents="none",t=o.x*(n.props.displaySettings.scaleOffset/100)-n.cloneChild.point.x,r=o.y*(n.props.displaySettings.scaleOffset/100)-n.cloneChild.point.y,n.cloneChild.target.style.left=o.x*(n.props.displaySettings.scaleOffset/100)-n.eventOrigin.target.offsetWidth/2+"px",n.cloneChild.target.style.top=o.y*(n.props.displaySettings.scaleOffset/100)-n.eventOrigin.target.offsetHeight/2+"px"),n.cloneChildren.length>0&&n.cloneChildren.forEach(function(e){e.target.style.position="absolute";var n=e.point.x-e.width/2,o=e.point.y-e.height/2;e.target.style.left=n+t+"px",e.target.style.top=o+r+"px"});var i=n.checkHoveredElement(e);n.cancelButton&&(i.find(function(e){return"cancel-btn"===e.id})?n.cancelButton.style.backgroundColor="#ffbdce":n.cancelButton.style.backgroundColor="#ec2e5f")}else window.clearTimeout(n.initDragTimeout)},n.handleMouseDownOrTouchEndEvent=function(e){if(e.preventDefault(),e.stopPropagation(),window.clearTimeout(n.initDragTimeout),n.isDragging){n.isDragging=!1;var t=document.getElementById("canvas"),r=0,o=0;t&&(r=t.getBoundingClientRect().top,o=t.getBoundingClientRect().left);var i=u.GeometryUtil.pointFromEvent(e,"client",n.props.displaySettings),a=n.checkHoveredElement(e);if(a.find(function(e){return"cancel-btn"===e.id}))n.handleGatewayVisiblity("show"),n.removeAllChildren();else if(a.find(function(e){return"canvas"===e.id})){var c=[];if(n.cloneChild&&n.cloneChild.target.style.top&&n.cloneChild.target.style.left){var l=i.x*(n.props.displaySettings.scaleOffset/100)-n.cloneChild.width/2,d=i.y*(n.props.displaySettings.scaleOffset/100)-n.cloneChild.height/2,f=n.cloneChild.target.firstChild;c=[{point:{x:l,y:d},target:n.cloneChild.target,width:f.offsetWidth,height:f.offsetHeight}]}if(n.cloneChildren&&n.cloneChildren.length>0&&n.cloneChildren.forEach(function(e){if(e.target.style.top&&e.target.style.left){var t=parseInt(e.target.style.left,10),n=parseInt(e.target.style.top,10),r=e.target.firstChild;c=[].concat(b(c),[{point:{x:t,y:n},target:e.target,width:r.offsetWidth,height:r.offsetHeight}])}}),"background"===n.props.item_browser){if(n.state.results){var m=n.state.results.find(function(e){return void 0!==c[0]&&e.id.toString()===c[0].target.id});m&&(n.props.updateBackground({type:"url",body:m.result_payload,attributes:{opacity:1,x:0,y:0}},n.props.slide),(0,p.assetTracking)(m.id,n.props.bunceeId))}}else{var h=[];c.forEach(function(e){n.state.results&&n.state.results.forEach(function(t){if(t.id.toString()===e.target.id){var i=(0,p.InfoForBrowserType)(n.props.item_browser).default_browser_componentType,a=e.point.x/(n.props.displaySettings.scaleOffset/100)/n.props.displaySettings.scale,s=e.point.y/(n.props.displaySettings.scaleOffset/100)/n.props.displaySettings.scale,c={x:a-o/(n.props.displaySettings.scaleOffset/100)/n.props.displaySettings.scale,y:s-r/(n.props.displaySettings.scaleOffset/100)/n.props.displaySettings.scale,width:e.width,height:e.height};n.props.selected_tab&&(i=n.props.selected_tab.browser_component);var l=(0,p.resultToCanvasMap)(n.props.item_browser,i,t,n.props.canvas,c);h.push(l),i===p.BunceeAssetBrowser&&(0,p.assetTracking)(t.id,n.props.bunceeId)}})}),n.props.selectedItem&&n.props.deselectItemSelected(n.props.selectedItem.id),document.getElementById("viewport").focus();var v=(0,s.uniqBy)(h,function(e){return e.content.body});n.props.addItem(v,n.props.addToIndex,n.props.slide,n.props.user),n.props.handleClose()}n.handleGatewayVisiblity("show"),n.removeAllChildren(),n.props.handleClose()}else n.handleGatewayVisiblity("show"),n.removeAllChildren(),n.props.handleClose()}n.cloneChild=void 0,n.cloneChildren=[],n.removeMouseListeners(),n.removeTouchListeners()},n.handleScroll=function(e){e.target.scrollTop<=0&&(e.target.scrollTop=0),n.scrollToBottom()},n.scrollToBottom=function(){var e=document.getElementById("results-content");e&&e.scrollHeight-100<=e.scrollTop+e.offsetHeight&&null!==n.state.results&&n.state.results.length>0&&!n.state.loadMore&&n.setState({loadMore:!0})},n.promptUpgrade=function(){n.props.openModal("upgrade",{title:"Premium "+n.props.item_browser,message:"Please upgrade your plan to use this "+n.props.item_browser})},n.addTouchListeners=function(){window.addEventListener("touchmove",n.handleSelectedMove),window.addEventListener("touchend",n.handleMouseDownOrTouchEndEvent,{once:!0})},n.removeTouchListeners=function(){window.removeEventListener("touchmove",n.handleSelectedMove),window.removeEventListener("touchend",n.handleMouseDownOrTouchEndEvent)},n.addMouseListeners=function(){window.addEventListener("mousemove",n.handleSelectedMove),window.addEventListener("mouseup",n.handleMouseDownOrTouchEndEvent,{once:!0}),document.body.addEventListener("mouseleave",n.handleMouseDownOrTouchEndEvent,{once:!0})},n.removeMouseListeners=function(){window.removeEventListener("mousemove",n.handleSelectedMove),window.removeEventListener("mouseup",n.handleMouseDownOrTouchEndEvent),document.body.removeEventListener("mouseleave",n.handleMouseDownOrTouchEndEvent)},n.state={prve_item_browser:n.props.item_browser,prev_selected_tab:void 0,prev_search_query:"",results:[],next_links:"",loading:!1,loadMore:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),o(t,[{key:"componentDidUpdate",value:function(e,t){null===this.state.results&&this.getResults(),null!==this.state.results&&this.state.loadMore&&this.getMoreResults()}},{key:"render",value:function(){var e=["browser-content"];return"itemgateway"===this.props.item_browser&&e.push("item-gateway"),(this.props.selected_tab&&this.props.selected_tab.browser_component===h.ConnectedUploadBrowser||"audio"===this.props.item_browser)&&e.push("uploader"),!this.props.selected_tab||"Color"!==this.props.selected_tab.name&&"Upload"!==this.props.selected_tab.name||e.push("no-scroll"),"template"!==this.props.item_browser&&e.push("row"),c.createElement("div",{className:e.join(" "),id:"results-content",onScroll:this.handleScroll},this.state.loading?c.createElement(a.LoadingIndicator,{color:"#00A3A8"}):this.renderContent())}},{key:"checkHoveredElement",value:function(e){var t=u.GeometryUtil.pointFromEvent(e,"client",this.props.displaySettings),n=this.props.displaySettings.scaleOffset/100;return document.elementsFromPoint?document.elementsFromPoint(t.x*n,t.y*n):(0,d.elementsFromPoint)(t.x*n,t.y*n)}},{key:"handleGatewayVisiblity",value:function(e){var t=document.getElementById("gateway"),n=document.getElementById("overlay");switch(e){case"hide":t&&n&&(t.style.visibility="hidden",n.style.visibility="hidden"),this.cancelButton&&(this.cancelButton.style.display="block");break;case"show":t&&n&&(t.style.visibility="visible",n.style.visibility="visible"),this.cancelButton&&(this.cancelButton.style.display="none")}}},{key:"removeAllChildren",value:function(){this.cloneChild&&document.body.removeChild(this.cloneChild.target),this.cloneChildren.length>0&&this.cloneChildren.forEach(function(e){document.body.removeChild(e.target)})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return!(void 0===e.selected_tab||e.selected_tab&&e.selected_tab.browser_component!==f.ConnectedAudioBrowser&&e.selected_tab&&e.selected_tab.browser_component!==h.ConnectedUploadBrowser&&e.selected_tab&&e.selected_tab.browser_component!==m.default)||e.search_query===t.prev_search_query&&e.selected_tab===t.prev_selected_tab?{loading:!1}:{prev_selected_tab:e.selected_tab,prev_search_query:e.search_query,results:null,loading:!0}}}]),t}(),E=(0,l.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.buncee.document.canvas,o=e.displaySettings,i=e.buncee.id,a=e.buncee.selected_items,c=(0,s.keys)(a).filter(function(t){return void 0!==a[t]&&null!==a[t]&&a[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]}),l=e.gateway?e.gateway.addToIndex:void 0;return{slide:n,canvas:r,displaySettings:o,bunceeId:i,selectedItem:c[0],user:e.user,addToIndex:l}},function(e,t){return{addItem:function(t,n,r,o){var a=r.items,s=[];t.length>0&&(t.forEach(function(e){s=u.ArrayUtil.push(s,i.Actions.addItem({item:e})),a="number"==typeof n?u.ArrayUtil.insert(a,e.id,a.length-n):u.ArrayUtil.push(a,e.id)}),e(i.Actions.batchActions({actions:[].concat(b(s),[i.Actions.updateSlide({id:r.id,path:"items",value:a}),i.Actions.updateStore({path:"item_defaults",value:{}})])})),e(i.Actions.updateItemsSelected({path:t[0].id,value:o})))},updateBackground:function(t,n){e(i.Actions.updateSlide({path:"background",id:n.id,value:t}))},deselectItemSelected:function(t){e(i.Actions.updateItemsSelected({path:t,value:null}))},closeModal:function(){e(i.Actions.openModal({type:void 0}))},openModal:function(t,n){e(i.Actions.openModal({type:t,props:n}))}}})(_);t.HOCResults=_,t.ConnectedHOCResults=E},56:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(164);var i=t.User=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hasPermission=function(e){return n.permissions_updated?"allowed"===n.permissions_updated[e]:1===n.permissions[e]},this.permissionIsHidden=function(e){return"hidden"===n.permissions_updated[e]},this.firstName=t.first_name,this.lastName=t.last_name,this.type=t.type,this.guid=t.guid,this.permissions=t.permissions,this.permissions_updated=t.permissions_updated,this.settings=t.settings,this.username=t.username,this.avatar=t.avatar}return r(e,null,[{key:"isStudent",value:function(){return"student"===e.user.type}},{key:"isTeacher",value:function(){return e.user.type===o.UserType.TEACHER}},{key:"isLoggedIn",value:function(){return"guest"!==e.user.guid&&!e.isAdmin()}},{key:"isAdmin",value:function(){return e.user.type===o.UserType.ADMIN||e.user.type===o.UserType.OWNER}},{key:"isPremium",value:function(){return"generic-free"!==e.user.type}},{key:"initUser",value:function(t){void 0===e.user&&(e.user=new e(t))}},{key:"getUser",value:function(){return e.user}}]),e}();i.hasPermission=function(e){return i.getUser().hasPermission(e)},i.permissionIsHidden=function(e){return i.getUser().permissionIsHidden(e)},t.default=i},635:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(39));t.fetchTabs=function(e){return m(this,void 0,void 0,r.default.mark(function t(){var n,i,a;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("animation"!==e&&"three_d"!==e&&"sticker"!==e&&"message"!==e&&"emoji"!==e&&"background"!==e&&"template"!==e){t.next=17;break}return(n=new URLSearchParams).set("asset_type","three_d"===e?"3d":e),t.next=5,o.Client.get("/media/buncee/categories",n);case 5:if(!(i=t.sent).ok){t.next=13;break}return t.next=9,i.json();case 9:return a=t.sent,t.abrupt("return",a.data);case 13:return t.abrupt("return",[]);case 15:t.next=18;break;case 17:return t.abrupt("return",[]);case 18:case"end":return t.stop()}},t,this)}))},t.getDefaultTabs=function(e){switch(e){default:return[];case"animation":case"sticker":case"message":case"emoji":case"three_d":return[].concat(v);case"background":return[].concat(h,v);case"upload":return[].concat(y);case"audio":return[].concat(b);case"omni":return[].concat(g);case"template":return[].concat(w)}};var o=n(38),i=n(16),a=n(217),s=f(n(118)),c=f(n(216)),l=f(n(219)),u=f(n(200)),d=n(199),p=f(n(162));function f(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},h=[{name:"Web",guid:"backgroundweb",categories_preview:(0,i.cloudfrontURL)("/images/categories/Background_Web.png"),canonical_name:"backgroundWeb",browser_component:p.default},{name:"Color",guid:"backgroundcolor",categories_preview:(0,i.cloudfrontURL)("/images/categories/Background_Colors.png"),canonical_name:"backgroundColor",browser_component:c.default},{name:"Upload",guid:"backgroundupload",categories_preview:(0,i.cloudfrontURL)("/images/categories/Background_Upload.png"),canonical_name:"backgroundUpload",browser_component:d.ConnectedUploadBrowser},{name:"",guid:"divider",canonical_name:"divider",browser_component:s.default}],v=[{name:"Trending",guid:"trending",categories_preview:(0,i.cloudfrontURL)("/images/categories/Categories_Trending.png"),canonical_name:"trending",browser_component:s.default},{name:"Recently Used",guid:"recent",categories_preview:(0,i.cloudfrontURL)("/images/categories/Categories_RecentlyUsed.png"),canonical_name:"recent",browser_component:s.default},{name:"Newly Added",guid:"newly",categories_preview:(0,i.cloudfrontURL)("/images/categories/Categories_NewlyAdded.png"),canonical_name:"newly",browser_component:s.default},{name:"",guid:"divider",canonical_name:"divider",browser_component:s.default}],y=[{name:"Upload",guid:"upload",canonical_name:"upload",browser_component:d.ConnectedUploadBrowser},{name:"My Images",guid:"myimages",canonical_name:"myimages",browser_component:l.default},{name:"My Documents",guid:"mydocument",canonical_name:"mydocument",browser_component:l.default},{name:"My Videos",guid:"myvideo",canonical_name:"myvideo",browser_component:l.default}],b=[{name:"Record",guid:"record",canonical_name:"record",browser_component:a.ConnectedAudioBrowser},{name:"Upload",guid:"recordupload",canonical_name:"recordUpload",browser_component:d.ConnectedUploadBrowser},{name:"My Audio",guid:"myaudio",canonical_name:"myAudio",browser_component:l.default}],g=[{name:"Buncee Art",guid:"omnibuncee",canonical_name:"omniBunceeArt",browser_component:s.default},{name:"Web Image",guid:"omniweb",canonical_name:"omniWebImage",browser_component:p.default}],w=[{name:"Newly Added",guid:"newly",canonical_name:"newly",browser_component:u.default},{name:"Recently Used",guid:"recent",canonical_name:"recent",browser_component:u.default},{name:"",guid:"divider",canonical_name:"divider",browser_component:u.default}]},636:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resultToCanvasMap=function(e,t,n,l,u){var d=u?u.width:200,p=u?u.height:200,f=document.getElementById(n.id).firstChild;f&&!u&&(f.style.maxWidth="none",d=f.offsetWidth,p=f.offsetHeight);var m=(0,i.generateFrame)(1.8*d,1.8*p,l),h=(0,i.generateFrame)(510,290,l);u&&(m=(0,i.generateFrame)(1.8*d,1.8*p,l,u.x,u.y),h=(0,i.generateFrame)(510,290,l,u.x,u.y));if(t===a.default){if("shape"===e){var v="polygon";(0,r.includes)(n.result_payload,"equilateral_triangle")?v="triangle":(0,r.includes)(n.result_payload,"shapes_rectangle")?v="rectangle":(0,r.includes)(n.result_payload,"shapes_circle")&&(v="ellipse");var y={type:v,fill:"white",stroke:"black",fill_opacity:1,stroke_width:10,svg_url:n.result_payload};return(0,o.generateItem)({type:"shape",frame:m,content:{type:"shape",body:n.result_payload,attributes:y}})}return"three_d"===e?(0,o.generateItem)({type:"three_d",frame:m,content:{type:"url",body:n.result_payload,attributes:{preview_url:n.thumbnails[0]}},alt_text:n.alt_text}):(0,o.generateItem)({type:"image",frame:m,content:{type:"url",body:n.result_payload},alt_text:n.alt_text})}if(t===c.default){if("web"===e||"omni"===e&&!n.preview)return(0,o.generateItem)({id:n.id,type:"image",frame:m,content:{type:"url",body:n.result_payload}});if("youtube"===e||"omni"===e&&n.preview)return(0,o.generateItem)({id:n.id,type:"youtube",frame:h,content:{type:"url",body:n.id}});if("khanacademy"===e)return(0,o.generateItem)({id:n.id,type:"youtube",frame:h,content:{type:"url",body:(0,i.getYoutubeId)(n.result_payload)}});if("panorama"===e)return(0,o.generateItem)({frame:m,id:n.id,type:"panoramic",content:{type:"url",body:n.result_payload}})}else if(t===s.default)return n.result_payload.match(/\.(mp4)($|(\?))/i)?(0,o.generateItem)({id:n.id,type:"video",frame:Object.assign({},h,{width:u?1.7*u.width:1.7*d,height:u?1.7*u.height:1.7*p}),content:{type:"url",body:n.result_payload}}):n.result_payload.match(/\.(pdf)($|(\?))/i)?(0,o.generateItem)({type:"image",content:{type:"url",body:(0,i.cloudfrontURL)("creation/images/item-document.png")},link:n.result_payload,frame:m}):(0,o.generateItem)({id:n.id,type:"image",frame:m,content:{type:"url",body:n.result_payload}});return(0,o.generateItem)()};var r=n(6),o=n(4),i=n(16),a=l(n(118)),s=l(n(219)),c=l(n(162));function l(e){return e&&e.__esModule?e:{default:e}}},637:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserHeader=void 0;var r,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(4),a=n(307),s=(r=a)&&r.__esModule?r:{default:r};t.BrowserHeader=function(e){var t;return o.createElement("div",{className:"browser-header row"},function(t){switch(t){case"background":if(i.Device.isIPadOrIPhone())return null;case"itemgateway":case"audio":case"stitch":return o.createElement("div",{className:"back btn",style:{visibility:"hidden"}});default:return o.createElement("div",{className:"back btn",onClick:e.handleBack},"Back")}}(e.browser),o.createElement(s.default,{handleSearch:e.handleSearch,selected_tab:e.selected_tab,selected_results:e.selected_results,browser:e.browser}),(t=e.browser,0!==e.selected_results.length?"background"===t?o.createElement("div",{className:"background-button row"},o.createElement("div",{className:"add-text"},"Add to"),o.createElement("div",{className:"this-button btn",onClick:e.handleAddClick},"This Page"),o.createElement("div",{className:"all-button btn",onClick:e.handleAllClick},"All Pages")):o.createElement("div",{className:"add btn",onClick:e.handleAddClick},"Add "+e.selected_results.length):null),function(e){return"template"!==e}(e.browser)&&o.createElement("div",{className:"close btn btn-pink",onClick:e.handleClose},"Close"))}},638:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(309),c=(r=s)&&r.__esModule?r:{default:r};var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.didClickOverlay=function(){},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Modal),o(t,[{key:"renderWindowContent",value:function(){return a.createElement("div",{id:"template-modal"},a.createElement(c.default,{key:"browser",activeBrowser:"template",mode:"modal"}))}}]),t}();t.default=l},641:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=p(n(163)),a=n(11),s=p(n(0)),c=n(5),l=n(4),u=n(16),d=n(143);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.picker.close(),n.props.closeModal()},n.getWindowClassNames=function(){return"window confirm photo-modal"},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Modal),r(t,[{key:"componentDidMount",value:function(){var e=this,t={uploadInBackground:!1,displayMode:i.PickerDisplayMode.inline,dropPane:{},fromSources:["webcam"],container:"photo-modal",exposeOriginalFile:!0,storeTo:{location:"s3",path:"user-uploads/"+window.config.tenant+"/"+this.props.user.id+"/"},onUploadDone:function(t){var n=t.filesUploaded[0];(0,d.uploadToFileDatabase)(encodeURI((0,u.cloudfrontURL)(n.key)),n.filename,"image/png");var r=document.getElementsByClassName("fsp-transformer")[0].getElementsByTagName("img")[0],o=t.filesUploaded[0].hasOwnProperty("cropped")?1.3*t.filesUploaded[0].cropped.cropArea.size[0]:r.width,i=t.filesUploaded[0].hasOwnProperty("cropped")?1.3*t.filesUploaded[0].cropped.cropArea.size[1]:r.height;if(t.filesUploaded[0].hasOwnProperty("rotated")){var a=o;o=i,i=a}e.props.addItem((0,l.generateItem)({type:"image",content:{type:"url",body:(0,u.cloudfrontURL)(t.filesUploaded[0].key)},frame:(0,u.generateFrame)(o,i,e.props.canvas)}),e.props.addToIndex,e.props.slide),e.closeModal(),e.props.closeGateway()}};this.picker=l.fileStackClient.picker(t),this.picker.open()}},{key:"componentWillUnmount",value:function(){this.picker.close()}},{key:"renderWindowContent",value:function(){return s.createElement("div",{className:"video-modal-wrapper",key:"video-wrapper"},s.createElement("div",{id:"photo-modal",key:"pho-modal"}))}}]),t}(),m=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=e.gateway?e.gateway.addToIndex:void 0;return{user:r,slide:n,canvas:e.buncee.document.canvas,addToIndex:o}},function(e,t){return{addItem:function(t,n,r){e(o.Actions.batchActions({actions:[o.Actions.addItem({item:t}),o.Actions.updateSlide({id:r.id,path:"items",value:"number"==typeof n?l.ArrayUtil.insert(r.items,t.id,r.items.length-n):l.ArrayUtil.push(r.items,t.id)})]}))},closeGateway:function(){e(o.Actions.closeGateway({activeBrowser:void 0}))}}})(f);t.default=m},642:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(4);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.background=function(){n.props.addSlide(),n.closeModal()},n.stitch=function(){n.props.openStitch(),n.closeModal()},n.canStitch=function(){return"generic-free"!==a.User.getUser().type},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"stitch-modal"},i.createElement("div",{className:"modal-content row"},i.createElement("div",{className:"stitch-modal-icon-wrapper column"},i.createElement("div",{className:"stitch-modal-icon icon-backgrounds"}),i.createElement("div",{className:"stitch-modal-text"},"Blank New Page")),i.createElement("div",{className:"stitch-modal-icon-wrapper column"},!this.canStitch()&&i.createElement("div",{className:"upgrade-overlay"},"Upgrade your account to unlock this feature"),i.createElement("div",{className:"stitch-modal-icon icon-stitch"}),i.createElement("div",{className:"stitch-modal-text"},"Stitching"))),i.createElement("div",{className:"modal-button row"},i.createElement("button",{className:"btn btn-blue",onClick:this.background},"Add"),i.createElement("button",{className:"btn btn-blue",onClick:this.stitch,disabled:!this.canStitch()},"Add")))}}]),t}();t.default=s},643:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(5),s=n(16);var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"simultaneous-edit-modal"},i.createElement("div",{className:"modal-header"},i.createElement("h2",null,"Simultaneous Editing")),i.createElement("div",{className:"modal-content column"},i.createElement("img",{src:(0,s.cloudfrontURL)("images/creation/simultaneous.gif")}),i.createElement("p",null,"Looks like you've been so busy creating that you didn't realize your Buncee is open in another tab! Please refresh to continue creating!")),i.createElement("div",{className:"row"},i.createElement("a",{key:"refresh-btn",href:"#",onClick:function(){window.location.reload()},className:"btn btn-blue"},"Refresh")))}}]),t}();t.default=(0,a.connect)(void 0,void 0)(c)},644:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(39),i=(r=o)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(38),c=n(11),l=f(n(6)),u=f(n(0)),d=n(4),p=n(16);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var m=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderUserCheckbox=function(e){var t=!1;if(e)return n.state.selectedUsers.indexOf(e.guid)>-1&&(t=!0),u.createElement("div",{key:e.guid,className:"md-checkbox"},u.createElement("input",{id:e.guid,type:"checkbox",checked:t,disabled:!1,onChange:n.handleUserCheckboxChange}),u.createElement("label",{htmlFor:e.guid},e.name))},n.fetchShareData=function(){return m(n,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URLSearchParams).set("entity_type","buncee"),e.abrupt("return",s.Client.get("/share/"+this.props.buncee.id,t).then(function(e){return e.json()}).then(function(e){var t=e.data.can_be_shared_with,n=[];return e.data.shared_with.forEach(function(e){n.push(e.user_guid)}),{canBeSharedWith:t,selectedUsers:n}}));case 3:case"end":return e.stop()}},e,this)}))},n.handleUserCheckboxChange=function(e){var t=e.currentTarget.getAttribute("id");e.currentTarget.checked?n.setState({selectedUsers:d.ArrayUtil.push(n.state.selectedUsers,t)}):n.setState({selectedUsers:d.ArrayUtil.remove(n.state.selectedUsers,n.state.selectedUsers.indexOf(t))})},n.save=function(){var e=[];n.state.selectedUsers.forEach(function(t){e.push({user_guid:t})}),n.setState({loading:!0});var t=new URLSearchParams;t.set("entity_type","buncee"),t.set("entity_guid",n.props.buncee.id),e.forEach(function(e,n){Object.keys(e).forEach(function(r){t.set("recipients["+n+"]["+r+"]",e[r])})}),s.Client.post("/share",t).then(function(e){e.ok?(n.setState({loading:!1}),(0,p.displayToastMessage)("Shared!")):(0,p.displayToastMessage)("Failed to share")})},n.state={loading:!1,canBeSharedWith:{},selectedUsers:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),a(t,[{key:"componentDidMount",value:function(){return m(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.fetchShareData();case 3:t=e.sent,this.setState(Object.assign({loading:!1},t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return u.createElement(c.LoadingIndicator,null);var t=this.state.canBeSharedWith.user;return t=l.sortBy(l.values(t),function(e){return e.name}),u.createElement("div",{className:"direct-options student"},u.createElement("div",{className:"content-group share-options"},u.createElement("label",{className:"column"},"Share With"),u.createElement("div",null,u.createElement("div",{className:"share-select user-list"},l.map(t,function(t){return e.renderUserCheckbox(t)})))),u.createElement("div",{className:"share-buttons"},u.createElement("button",{className:"btn",onClick:this.save,onTouchEnd:this.save},"Share")))}}]),t}();t.default=h},645:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(38),a=n(11),s=n(68),c=f(n(6)),l=f(n(0)),u=n(4),d=n(16),p=m(n(56));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderShareSelect=function(){var e=c.sortBy(c.values(n.state.canBeSharedWith.section),function(e){return e.display_name});return l.createElement("div",{className:"content-group share-options"},l.createElement("label",{htmlFor:"sectionsSelect",className:"column"},"Share with"),l.createElement("div",null,l.createElement("select",{id:"sectionsSelect",name:"teachers",className:"form-control",value:n.state.selectedSection,onChange:n.handleSelectedSectionChange},l.createElement("option",{value:"default",disabled:!0},"Add Sections"),c.map(e,function(e){return l.createElement("option",{key:e.guid,value:e.guid},e.display_name)})),l.createElement("div",{className:"row select-buttons share-student-buttons"},l.createElement("span",{className:"btn",onClick:n.selectAllUsers},"Select All"),l.createElement("span",{className:"btn btn-pink",onClick:n.deselectAllUsers},"Deselect All")),n.renderSelectOptions()))},n.renderSelectOptions=function(){if("default"===n.state.selectedSection)return null;var e=n.state.canBeSharedWith.section[n.state.selectedSection].students,t=n.state.canBeSharedWith.section[n.state.selectedSection].teachers.slice(0);return t.splice(t.indexOf(n.user.guid),1),t=c.sortBy(c.values(t),function(e){return n.state.canBeSharedWith.user[e].name}),e=c.sortBy(c.values(e),function(e){return n.state.canBeSharedWith.user[e].name}),l.createElement("div",{className:"share-select"},t.length>0?l.createElement("div",{className:"user-list"},l.createElement("h4",null,"Teachers"),t.map(function(e){var t=n.state.canBeSharedWith.user[e];return n.renderUserCheckbox(t)})):null,e.length>0?l.createElement("div",{className:"user-list"},l.createElement("h4",null,"Students"),e.map(function(e){var t=n.state.canBeSharedWith.user[e];return n.renderUserCheckbox(t)})):null)},n.renderUserCheckbox=function(e){var t=!1;if(e)return n.state.selectedUsers[n.state.selectedSection].indexOf(e.guid)>-1&&(t=!0),l.createElement("div",{key:e.guid,className:"md-checkbox"},l.createElement("input",{id:e.guid,type:"checkbox",checked:t,disabled:!1,onChange:n.handleUserCheckboxChange}),l.createElement("label",{htmlFor:e.guid},e.name))},n.fetchShareData=function(){return h(n,void 0,void 0,r.default.mark(function e(){var t,n=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URLSearchParams).set("entity_type","buncee"),e.abrupt("return",i.Client.get("/share/"+this.props.buncee.id,t).then(function(e){return e.json()}).then(function(e){var t=e.data.can_be_shared_with,r=c.pickBy(t.section,function(e){return e.students.length+e.teachers.length>1});t.section=r;var o={};return c.each(t.section,function(e){o[e.guid]=[]}),e.data.shared_with.forEach(function(e){if(e.section_guid in t.section)if(null===e.user_guid&&null===e.group_guid){var r=t.section[e.section_guid];if(!r)return;var i=r.teachers.slice(0);i.splice(i.indexOf(n.user.guid),1),o[r.guid]=r.students.concat(i)}else null===e.user_guid||o[e.section_guid].push(e.user_guid)}),{canBeSharedWith:t,selectedUsers:o}}));case 3:case"end":return e.stop()}},e,this)}))},n.handleUserCheckboxChange=function(e){var t=e.currentTarget.checked,r=e.currentTarget.getAttribute("id");if(t){var o=u.ArrayUtil.push(n.state.selectedUsers[n.state.selectedSection],r),i=s.Util.ObjectUtil.set(n.state.selectedUsers,n.state.selectedSection,o);n.setState({selectedUsers:i})}else{var a=u.ArrayUtil.findAndRemove(n.state.selectedUsers[n.state.selectedSection],function(e){return e===r}),c=s.Util.ObjectUtil.set(n.state.selectedUsers,n.state.selectedSection,a);n.setState({selectedUsers:c})}},n.handleSelectedSectionChange=function(e){var t=e.currentTarget.value;n.setState({selectedSection:t})},n.selectAllUsers=function(){var e=n.state.canBeSharedWith.section[n.state.selectedSection],t=u.ArrayUtil.findAndRemove(e.teachers,function(e){return e===n.user.guid}),r=n.state.selectedUsers;r[e.guid]=e.students.concat(t),n.setState({selectedUsers:r})},n.deselectAllUsers=function(){var e=n.state.canBeSharedWith.section[n.state.selectedSection],t=n.state.selectedUsers;t[e.guid]=[],n.setState({selectedUsers:t})},n.save=function(){n.setState({loading:!0});var e=[];c.forOwn(n.state.selectedUsers,function(t,r){var o=n.state.canBeSharedWith.section[r],i=o.students,a=u.ArrayUtil.findAndRemove(o.teachers,function(e){return e===n.user.guid});t.length===i.concat(a).length?e.push({section_guid:o.guid}):t.forEach(function(t){e.push({user_guid:t,section_guid:o.guid})})});var t=new URLSearchParams;t.set("entity_type","buncee"),t.set("entity_guid",n.props.buncee.id),e.forEach(function(e,n){Object.keys(e).forEach(function(r){t.set("recipients["+n+"]["+r+"]",e[r])})}),i.Client.post("/share",t).then(function(e){e.ok?(n.setState({loading:!1}),(0,d.displayToastMessage)("Shared!")):(0,d.displayToastMessage)("Failed to share")})},n.user=p.default.getUser(),n.state={loading:!1,selectedSection:"default",canBeSharedWith:{},selectedUsers:{}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),o(t,[{key:"componentDidMount",value:function(){return h(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.fetchShareData();case 3:t=e.sent,this.setState(Object.assign({loading:!1},t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(){return this.state.loading?l.createElement(a.LoadingIndicator,null):l.createElement("div",{className:"direct-options teacher"},this.renderShareSelect(),l.createElement("div",{className:"share-buttons"},l.createElement("button",{className:"btn",onClick:this.save,onTouchEnd:this.save},"Share")))}}]),t}();t.default=v},646:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=n(56),s=(r=a)&&r.__esModule?r:{default:r};var c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.canShareToTeams=function(){return s.default.hasPermission("share.teams")},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),o(t,[{key:"componentDidMount",value:function(){var e=window;e.shareToMicrosoftTeams&&e.shareToMicrosoftTeams.renderButtons()}},{key:"render",value:function(){return this.canShareToTeams()?i.createElement("div",{className:"teams-share-button","data-href":this.props.url,"data-icon-px-size":"68"}):null}}]),t}();t.default=c},647:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(38),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5),c=n(56);var l=["Still working...","Almost there...","Just a moment longer...","Almost done..."],u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.canDownloadPDF=function(){return c.User.isPremium()&&c.User.hasPermission("creation.download.pdf")},n.isCopyableDownload=function(){return c.User.getUser().guid===n.props.buncee.owner_guid||n.props.buncee.copyable},n.downloadPDF=function(){n.canDownloadPDF()&&"working"!==n.state.retrievePDFStatus&&(n.setState({retrievePDFStatus:"working"}),o.Client.post("/buncees/"+window.config.buncee_guid+"/pdf").then(function(e){e.ok&&e.json().then(function(e){var t=e.job_key,r=n;!function e(n,i){if(n===t){if(i>60)return t=null,void r.setState({retrievePDFStatus:"failed",pdfURL:null});i>2&&r.setState({waitMessage:l[(i-2)%l.length]}),o.Client.get("/jobs/"+n).then(function(t){t.ok?200===t.status?t.json().then(function(e){try{var t=e.data.output.url;t&&r.setState({retrievePDFStatus:"success",pdfURL:t})}catch(e){r.setState({retrievePDFStatus:"failed"})}}):setTimeout(function(){e(n,i+1)},5e3):422===t.status?r.setState({retrievePDFStatus:"failed"}):setTimeout(function(){e(n,i+1)},5e3)})}}(t,1)})}))},n.state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"render",value:function(){var e=this,t=void 0;return t=this.canDownloadPDF()?this.isCopyableDownload()?a.createElement("button",{className:"btn btn-blue pdf-download",onClick:this.downloadPDF},"Download Buncee PDF",a.createElement("span",{className:"icon-downloadcloud download-icon"})):a.createElement("a",{className:"btn btn-orange locked",href:"javascript:;"},"Make buncee copyable to Download PDF or Images"):a.createElement("a",{className:"btn btn-orange",href:window.config.web_uri+'/dashboard#{"view":"billing"}',target:"_blank"},"Upgrade to Download PDF or Images"),"working"===this.state.retrievePDFStatus?t=a.createElement("p",null,"Loading..."):"success"===this.state.retrievePDFStatus&&this.state.pdfURL?t=a.createElement("div",null,a.createElement("h2",null,"All Done!"),a.createElement("a",{href:this.state.pdfURL,className:"btn btn-blue",target:"_blank",style:{display:"block"}},"Open PDF")):"failed"===this.state.retrievePDFStatus&&(t=a.createElement("div",null,a.createElement("h2",null,"Something went wrong, please try again later"))),a.createElement("div",{className:"modal-content",id:"share-download"},t,a.createElement("div",{id:"download-divider"},a.createElement("span",{className:"horizontal"}),a.createElement("p",null,"or"),a.createElement("span",{className:"horizontal"})),a.createElement("h2",null,"Click on thumbnail to download individual pages"),a.createElement("div",null,this.props.slides.map(function(t,n){var r=new URLSearchParams;r.set("slide",t.id);var o=window.config.web_uri+"/buncee/"+window.config.buncee_guid+"/thumbnail?"+r.toString();return c.User.isPremium()&&e.isCopyableDownload()?a.createElement("a",{key:t.id,href:o,target:"_blank"},a.createElement("div",{className:"slide-thumbnail"},a.createElement(i.LazyLoadImage,{src:o}),a.createElement("span",{className:"slide-number"},"Page ",n+1))):a.createElement("div",{className:"slide-thumbnail locked"},a.createElement(i.LazyLoadImage,{src:o}),a.createElement("span",{className:"slide-number"},"Page ",n+1))})))}}]),t}();t.default=(0,s.connect)(function(e){return{items:e.buncee.document.items,slides:e.buncee.document.slides,buncee:e.buncee}},void 0)(u)},648:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(4),c=n(16);!function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.CUSTOM="custom"}(r||(r={}));var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.embedLink=null,n.bunceeLink=null,n.renderEmbedOptions=function(){if(n.state.displayOptions){var e=n.state.embedOptions.size;return a.createElement("div",{id:"embed-options"},a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Autoplay"),a.createElement(i.Toggle,{value:n.state.embedOptions.autoplay,onChange:n.onAutoplayChange})),n.state.embedOptions.autoplay?a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Loop"),a.createElement(i.Toggle,{value:n.state.embedOptions.loop,onChange:n.onLoopOptionChange})):null,n.state.embedOptions.autoplay?a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Autoplay Timer"),a.createElement("div",{className:"autoplay-input"},a.createElement(i.NumberInput,{step:1,min:.033,max:99,value:n.state.embedOptions.timer,onValueChange:n.onAutoPlayOptionChange,unit:"s"}))):null,a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Embed Size"),a.createElement("div",null,a.createElement("div",{className:"row"},a.createElement("div",{className:"btn "+(e.type===r.SMALL?"active":""),onClick:function(){return n.handleSizeButtonClick(r.SMALL)}},"Small"),a.createElement("div",{className:"btn "+(e.type===r.MEDIUM?"active":""),onClick:function(){return n.handleSizeButtonClick(r.MEDIUM)}},"Medium"),a.createElement("div",{className:"btn "+(e.type===r.LARGE?"active":""),onClick:function(){return n.handleSizeButtonClick(r.LARGE)}},"Large"),a.createElement("div",{className:"btn "+(e.type===r.CUSTOM?"active":""),onClick:function(){return n.handleSizeButtonClick(r.CUSTOM)}},"Custom")),a.createElement("input",{onKeyDown:n.preventPropagation,className:"size-input",id:"size-input-width",type:"number",value:e.width,disabled:e.type!==r.CUSTOM,onChange:e.type===r.CUSTOM?n.handleEmbedCustom:void 0}),a.createElement("span",null," x "),a.createElement("input",{onKeyDown:n.preventPropagation,className:"size-input",id:"size-input-height",type:"number",value:e.height,disabled:e.type!==r.CUSTOM,onChange:e.type===r.CUSTOM?n.handleEmbedCustom:void 0}),"pixels")))}},n.toggleOptionsDisplay=function(){n.setState({displayOptions:!n.state.displayOptions})},n.onLoopOptionChange=function(e){n.setState({embedOptions:Object.assign({},n.state.embedOptions,{loop:e})})},n.onAutoplayChange=function(e){n.setState({embedOptions:Object.assign({},n.state.embedOptions,{autoplay:e})})},n.onAutoPlayOptionChange=function(e){e<1?n.setState({embedOptions:Object.assign({},n.state.embedOptions,{timer:0})}):n.setState({embedOptions:Object.assign({},n.state.embedOptions,{timer:e})})},n.handleCopyClick=function(e){var t=null;(t="embed"===e?document.getElementById("embedCopy"):document.getElementById("bunceeCopy"))&&n.copyInput(t)},n.handleEmbedCustom=function(e){"size-input-height"===e.target.id?n.setState({embedOptions:Object.assign({},n.state.embedOptions,{size:Object.assign({},n.state.embedOptions.size,{height:e.target.value})})}):n.setState({embedOptions:Object.assign({},n.state.embedOptions,{size:Object.assign({},n.state.embedOptions.size,{width:e.target.value})})})},n.handleSizeButtonClick=function(e){var t=n.state.embedOptions.size.width,o=n.state.embedOptions.size.height;e===r.SMALL&&(t=448,o=252),e===r.MEDIUM&&(t=896,o=504),e===r.LARGE&&(t=1920,o=1080),n.setState({embedOptions:Object.assign({},n.state.embedOptions,{size:{type:e,width:t,height:o}})})},n.preventPropagation=function(e){return e.stopPropagation(),!1},n.state={displayOptions:!1,embedOptions:{loop:!1,slide_panel:!1,autoplay:!1,timer:7,size:{type:r.LARGE,width:1920,height:1080}}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"render",value:function(){var e=this,t='<iframe src="'+this.props.links.embed.split("?")[0]+"?embed=1&render_slide_panel=0&loop="+(this.state.embedOptions.loop?1:0)+"&timer="+this.state.embedOptions.timer+'"width="'+this.state.embedOptions.size.width+'" height="'+this.state.embedOptions.size.height+'" allowFullScreen></iframe>',n=this.props.links.view;return this.state.embedOptions.autoplay&&(n+="?timer="+this.state.embedOptions.timer+(this.state.embedOptions.loop?"&loop=1":"")),a.createElement("div",{className:"modal-content",id:"share-code"},a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Link"),a.createElement("div",{className:"input-group"},a.createElement("input",{id:"bunceeCopy",type:"text",readOnly:!0,value:n,ref:function(t){return e.bunceeLink=t}}),a.createElement("span",{className:"btn",onClick:function(){return e.handleCopyClick("buncee")}},"Copy"))),a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"},"Embed Code"),a.createElement("div",{className:"input-group"},a.createElement("input",{id:"embedCopy",type:"text",readOnly:!0,value:t,ref:function(t){return e.embedLink=t}}),a.createElement("span",{className:"btn",onClick:function(){return e.handleCopyClick("embed")}},"Copy"))),a.createElement("div",{className:"content-group"},a.createElement("label",{className:"column"}),a.createElement("a",{className:"options-toggle",onClick:this.toggleOptionsDisplay},a.createElement("span",{className:"icon-add"})," ",this.state.displayOptions?"Hide Options":"Show options")),this.renderEmbedOptions())}},{key:"copyInput",value:function(e){if(s.Device.isIPadOrIPhone()){var t=e.contentEditable,n=document.createRange();e.contentEditable="true",n.selectNodeContents(e);var r=window.getSelection();r&&(r.removeAllRanges(),r.addRange(n)),e.setSelectionRange(0,999999),document.execCommand("copy"),e.blur(),e.contentEditable=t,(0,c.displayToastMessage)("Copied")}else{e.select(),document.execCommand("copy");var o=window.getSelection();o&&o.removeAllRanges(),(0,c.displayToastMessage)("Copied")}}}]),t}();t.default=l},649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(38),a=n(11),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(164),u=v(n(56)),d=v(n(648)),p=v(n(647)),f=v(n(646)),m=v(n(645)),h=v(n(644));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.isOwner=function(){return u.default.getUser().guid===n.props.buncee.owner_guid},n.renderDownload=function(){return s.createElement(p.default,null)},n.handleTabClick=function(e){n.setState({currentTab:e.target.id.split("-")[0]})},n.handlePrivacyChange=function(e){n.updateBuncee("privacy_level",e.target.value)},n.updateBuncee=function(e,t){if("edit"===n.props.mode)n.props.updateBuncee(e,t);else{var r=new URLSearchParams,o={};o[e]=t,r.set("data",JSON.stringify(o)),i.Client.put("/buncees/"+n.props.buncee.id,r).then(function(r){r.ok&&n.props.updateBuncee(e,t)})}},n.state={currentTab:n.isOwner()?"settings":"code",is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Modal),r(t,[{key:"renderWindowContent",value:function(){return s.createElement("div",{id:"share-modal"},s.createElement("div",{className:"modal-header"},s.createElement("h2",null,"Share"),s.createElement("div",{className:"modal-tabs"},s.createElement("ul",null,this.isOwner()&&s.createElement("li",{className:"tab"+("settings"===this.state.currentTab?" selected":""),id:"settings-tab",onClick:this.handleTabClick},"Settings"),s.createElement("li",{className:"tab"+("code"===this.state.currentTab?" selected":""),id:"code-tab",onClick:this.handleTabClick},"Code"),u.default.isLoggedIn()&&s.createElement("li",{className:"tab"+("email"===this.state.currentTab?" selected":""),id:"email-tab",onClick:this.handleTabClick},"Email"),(this.props.user.type===l.UserType.TEACHER||this.props.user.type===l.UserType.STUDENT)&&this.isOwner()&&s.createElement("li",{className:"tab"+("share"===this.state.currentTab?" selected":""),id:"share-tab",onClick:this.handleTabClick},"Share with ",this.props.user.type===l.UserType.STUDENT?"Teacher":"Students"),u.default.isLoggedIn()&&s.createElement("li",{className:"tab"+("rsvp"===this.state.currentTab?" selected":""),id:"rsvp-tab",onClick:this.handleTabClick},"RSVP"),u.default.isLoggedIn()&&s.createElement("li",{className:"tab"+("social"===this.state.currentTab?" selected":""),id:"social-tab",onClick:this.handleTabClick},"Social"),u.default.isLoggedIn()&&s.createElement("li",{className:"tab"+("download"===this.state.currentTab?" selected":""),id:"download-tab",onClick:this.handleTabClick},"Download")))),s.createElement("div",{className:"divider-horizontal"}),this.renderModalContent())}},{key:"renderModalContent",value:function(){switch(this.state.currentTab){case"settings":return this.renderSettings();case"code":return this.renderCode();case"email":return this.renderEmail();case"share":return this.renderShareWith();case"rsvp":return this.renderRSVP();case"social":return this.renderSocial();case"download":return this.renderDownload();default:return s.createElement("div",{className:"modal-content"})}}},{key:"renderSettings",value:function(){var e=this,t=[];return window.config.tenant===window.config.public_tenant?t.push(s.createElement("option",{value:"public-curatable"},"Anyone")):t.push(s.createElement("option",{value:"domain"},"Anyone part of the domain")),t.push(s.createElement("option",{value:"public"},"Anyone with a link")),t.push(s.createElement("option",{value:"private"},"Only me")),s.createElement("div",{className:"modal-content",id:"share-settings"},s.createElement("div",{className:"content-group setting"},s.createElement("label",{className:"column"},"Who can view"),s.createElement("div",{className:"column"},s.createElement("select",{value:this.props.buncee.privacy_level,onChange:this.handlePrivacyChange},t))),s.createElement("div",{className:"content-group setting"},s.createElement("label",{className:"column"},"Commentable"),s.createElement("div",{className:"column"},s.createElement(a.Toggle,{value:this.props.buncee.commentable,onChange:function(t){return e.updateBuncee("commentable",t)}}))),s.createElement("div",{className:"content-group setting"},s.createElement("label",{className:"column"},"Copyable"),s.createElement("div",{className:"column"},s.createElement(a.Toggle,{value:this.props.buncee.copyable,onChange:function(t){return e.updateBuncee("copyable",t)}}))))}},{key:"renderCode",value:function(){return s.createElement(d.default,{buncee:this.props.buncee,links:this.props.links})}},{key:"renderEmail",value:function(){var e=void 0,t=void 0;return"view"===this.props.mode?(e=window.config.web_uri+'/dashboard#{"view":"addressbook", "buncee":"'+this.props.buncee.id+'"}',t=window.config.web_uri+'/dashboard#{"view":"email-activities", "buncee":"'+this.props.buncee.id+'"}'):(e='/dashboard#{"view":"addressbook", "buncee":"'+this.props.buncee.id+'"}',t='/dashboard#{"view":"email-activities", "buncee":"'+this.props.buncee.id+'"}'),s.createElement("div",{className:"modal-content share-buttons"},s.createElement("div",{className:"row"},s.createElement("a",{className:"btn",href:e,target:"_blank"},"Send Email"),s.createElement("a",{className:"btn",href:t,target:"_blank"},"Check Email Status")))}},{key:"renderShareWith",value:function(){return s.createElement("div",{className:"modal-content",id:"share-with"},u.default.isTeacher()?s.createElement(m.default,{buncee:this.props.buncee}):s.createElement(h.default,{buncee:this.props.buncee}))}},{key:"renderRSVP",value:function(){var e=void 0,t=void 0;return u.default.isPremium()?("view"===this.props.mode?(e=window.config.web_uri+'/dashboard#{"view":"addressbook", "buncee":"'+this.props.buncee.id+'","type":"rsvp"}',t=window.config.web_uri+'/dashboard#{"view":"rsvps-tracking"}'):(e='/dashboard#{"view":"addressbook", "buncee":"'+this.props.buncee.id+'","type":"rsvp"}',t='/dashboard#{"view":"rsvps-tracking"}'),s.createElement("div",{className:"modal-content share-buttons",id:"share-rsvp"},s.createElement("div",{className:"row"},s.createElement("a",{className:"btn",href:e,target:"_blank"},"Send RSVP"),s.createElement("a",{className:"btn",href:t,target:"_blank"},"Check RSVP Status")))):s.createElement("div",{className:"modal-content share-buttons locked",id:"share-rsvp"},s.createElement("p",null,"Upgrade your account to unlock this feature"),s.createElement("a",{target:"_blank",href:window.config.web_uri+'/dashboard#{"view":"billing"}',className:"btn"},"Upgrade"))}},{key:"renderSocial",value:function(){var e=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},t={app_id:"1497004433941192",display:"popup",caption:this.props.buncee.title,link:this.props.links.view,redirect_uri:this.props.links.view},n={text:"Check out my buncee!",url:this.props.links.view},r={url:this.props.links.view,description:this.props.buncee.title},o={url:this.props.links.view},i={mini:!0,url:this.props.links.view,title:this.props.buncee.title,summary:"Check out my buncee!",source:"Buncee for Schools"};return s.createElement("div",{className:"modal-content modal-social"},s.createElement("p",null,"Select a social platform to share the Buncee"),s.createElement("div",{className:"row"},s.createElement("div",{id:"social"},u.default.hasPermission("share.facebook")?s.createElement("a",{href:"https://www.facebook.com/dialog/feed?"+e(t),target:"_blank"},s.createElement("span",{className:"share-icon icon-facebook"})):null,u.default.hasPermission("share.twitter")?s.createElement("a",{href:"https://twitter.com/intent/tweet?"+e(n),target:"_blank"},s.createElement("span",{className:"share-icon icon-twitter"})):null,u.default.hasPermission("share.google-classroom")?s.createElement("a",{href:"https://classroom.google.com/share?"+e(o),target:"_blank"},s.createElement("span",{className:"share-icon icon-googleclassroom"})):null,u.default.hasPermission("share.pinterest")?s.createElement("a",{href:"http://pinterest.com/pin/create/button/?"+e(r),target:"_blank"},s.createElement("span",{className:"share-icon icon-pinterest"})):null,u.default.hasPermission("share.linkedin")?s.createElement("a",{href:"https://www.linkedin.com/shareArticle?"+e(i),target:"_blank"},s.createElement("span",{className:"share-icon icon-linkedin"})):null,s.createElement(f.default,{url:this.props.links.view}))))}}]),t}();t.default=(0,c.connect)(function(e){return{user:e.user,buncee:e.buncee,links:e.links,mode:e.renderingMode}},function(e){return{updateSettings:function(t,n){e(o.Actions.updateSettings({path:t,value:n}))},updateBuncee:function(t,n){e(o.Actions.updateBuncee({path:t,value:n}))}}})(y)},650:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=d(n(6)),s=d(n(0)),c=n(5),l=n(144),u=n(16);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.questionRef=null,n.getWindowClassNames=function(){return"window mcq-editor"},n.closeModal=function(){n.props.closeModal()},n.addChoice=function(){var e=(0,l.generateId)(Object.keys(n.state.choices),4),t=Object.assign({},n.state.choices,p({},e,"Choice "+(Object.keys(n.state.choices).length+1)));n.setState({choices:t})},n.saveItem=function(){if(n.questionRef){var e=n.questionRef.value;n.props.updateItem({question:e,choices:n.state.choices,correct_choice:n.state.correct_choice},n.props.selectedItem.id),n.closeModal()}else(0,u.displayToastMessage)("Something went wrong, please try again")},n.renderButtons=function(){return s.createElement("div",{className:"mcq-editor-buttons row"},s.createElement("div",{key:"close-button",className:"btn btn-white",onClick:n.props.closeModal},"Close"),s.createElement("div",{key:"save-button",className:"btn",onClick:n.saveItem},"Save"))};var r=n.props.selectedItem.content.body.choices,o=n.props.selectedItem.content.body.correct_choice;return n.state={is_entered:!0,choices:r,correct_choice:o},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Modal),r(t,[{key:"renderWindowContent",value:function(){var e=this;return s.createElement("div",{id:"mcq-editor-modal"},s.createElement("h2",null,"Multiple Choice Question"),s.createElement("div",{className:"modal-content"},s.createElement("textarea",{className:"form-control",rows:4,defaultValue:this.props.selectedItem?this.props.selectedItem.content.body.question:"",placeholder:"Enter question here",ref:function(t){e.questionRef=t},onKeyDown:function(e){e.stopPropagation()},onChange:function(e){e.stopPropagation()},onKeyUp:function(e){e.stopPropagation()}}),s.createElement("div",{className:"choices-wrapper"},a.keys(this.state.choices).map(function(t){var n=e.state.choices[t];return s.createElement("div",{key:t,className:"choice-group"},s.createElement("div",{className:"choice-radio"},s.createElement("input",{onClick:function(){e.setState({correct_choice:t})},type:"radio",name:"choices",value:t,checked:t===e.state.correct_choice})),s.createElement("div",{className:"choice-body has-icon"},s.createElement("input",{type:"text",placeholder:n,className:"form-control",onKeyDown:function(e){e.stopPropagation()},onKeyUp:function(e){e.stopPropagation()},onChange:function(n){n.stopPropagation(),n.preventDefault(),e.setState({choices:Object.assign({},e.state.choices,p({},t,n.target.value.substr(0,255)))})}}),s.createElement("span",{onClick:function(){e.state.correct_choice===t&&e.setState({correct_choice:Object.keys(e.state.choices)[0]});var n=Object.assign({},e.state.choices);delete n[t],e.setState({choices:n})},className:"icon-delete2"})))}),Object.keys(this.state.choices).length<10?s.createElement("div",{className:"add-choice btn",onClick:this.addChoice},"Add Choice"):null)),this.renderButtons())}}]),t}(),m=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=e.buncee.document.canvas,i=e.buncee.selected_items;return{canvas:o,user:r,slide:n,selectedItem:a.keys(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]})[0]}},function(e,t){return{updateItem:function(t,n){e(o.Actions.updateItem({path:n+".content.body",value:t}))}}})(f);t.default=m},651:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),s=n(5),c=n(4);var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.input=void 0,n.closeModal=function(){n.props.closeModal()},n.getWindowClassNames=function(){return"window confirm import-url"},n.resetError=function(){n.setState({error:void 0})},n.isDoneDisabled=function(){return n.input&&0===n.input.value.length&&void 0===n.state.error},n.submitInput=function(){var e=n.input.value;if(void 0===n.props.validate)return n.props.handleSubmit(e),n.props.closeModal(),void(n.props.onDoneClick&&n.props.onDoneClick());var t=n.props.validate(e);t.isValid?(n.props.handleSubmit(e),n.props.closeModal(),n.props.onDoneClick&&n.props.onDoneClick()):n.setState({error:t.message})},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Modal),r(t,[{key:"renderWindowContent",value:function(){var e=this;return a.createElement("div",{className:"import-url-wrapper"},a.createElement("div",{id:"import-url-title"},a.createElement("h3",null,this.props.title)),a.createElement("div",{id:"import-url-description"},this.props.message.split("\n").map(function(e,t){return a.createElement("p",{key:t.toString()},e)})),a.createElement("div",{id:"import-url-input-wrapper"},a.createElement("p",{className:"error"},this.state.error),a.createElement("input",{id:"import-url-input",ref:function(t){return e.input=t},onChange:this.resetError,autoFocus:!c.Device.isIPadOrIPhone(),defaultValue:this.props.value})),a.createElement("div",{className:"button-wrapper row"},a.createElement("div",{className:"btn btn-white",onClick:this.props.closeModal},"Cancel"),a.createElement("button",{className:"btn",onClick:this.submitInput,disabled:this.isDoneDisabled()},"Done")))}}]),t}();l.defaultProps={validate:function(){return{isValid:!0}}};var u=(0,s.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t});return{canvas:e.buncee.document.canvas,slide:n}},function(e){return{addItem:function(t,n){e(o.Actions.addItem({item:t})),e(o.Actions.updateSlide({id:n.id,path:"items",value:c.ArrayUtil.push(n.items,t.id)}))},closeGateway:function(){e(o.Actions.closeGateway({activeBrowser:void 0}))}}})(l);t.default=u},652:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),i=n(11),a=u(n(6)),s=u(n(0)),c=n(5),l=n(16);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.editorRef=null,n.getWindowClassNames=function(){return"window frq-editor"},n.closeModal=function(){n.props.closeModal()},n.saveItem=function(){if(n.editorRef){var e=n.editorRef.value;n.props.updateItem({question:e},n.props.selectedItem.id),n.closeModal()}else(0,l.displayToastMessage)("Something went wrong, please try again")},n.renderButtons=function(){return s.createElement("div",{className:"frq-editor-buttons row"},s.createElement("div",{key:"close-button",className:"btn btn-white",onClick:n.props.closeModal},"Close"),s.createElement("div",{key:"save-button",className:"btn",onClick:n.saveItem},"Save"))},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Modal),r(t,[{key:"renderWindowContent",value:function(){var e=this,t="Add Free Response Question";return this.props.selectedItem&&(t="Free Response Question"),s.createElement("div",{id:"frq-editor-modal"},s.createElement("h2",null,t),s.createElement("div",{className:"modal-content"},s.createElement("textarea",{className:"form-control",rows:4,defaultValue:this.props.selectedItem?this.props.selectedItem.content.body.question:"",placeholder:"Enter question here",ref:function(t){e.editorRef=t},onKeyDown:function(e){e.stopPropagation()},onChange:function(e){e.stopPropagation()},onKeyUp:function(e){e.stopPropagation()}})),this.renderButtons())}}]),t}(),p=(0,c.connect)(function(e){var t=e.buncee.selected_slides[e.user.id],n=e.buncee.document.slides.find(function(e){return e.id===t}),r=e.user,o=e.buncee.document.canvas,i=e.buncee.selected_items;return{canvas:o,user:r,slide:n,selectedItem:a.keys(i).filter(function(t){return void 0!==i[t]&&null!==i[t]&&i[t].id===e.user.id}).map(function(t){return e.buncee.document.items[t]})[0]}},function(e,t){return{updateItem:function(t,n){e(o.Actions.updateItem({path:n+".content.body",value:t}))}}})(d);t.default=p},653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(38),i=n(11),a=n(6),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),c=n(5),l=n(4),u=n(16),d=n(56);var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.state={loading:!1,is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Modal),r(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({loading:!0});var t=(0,u.getURLParameter)("client"),n=new URLSearchParams;n.set("guid",this.props.bunceeId),t&&n.set("client",t),o.Client.post("/buncees/duplicate",n).then(function(t){var n=void 0;t.ok?(n="success",t.json().then(function(t){e.setState({loading:!1,status:n,newBunceeLinks:t.links})})):(n=423===t.status?"locked":"failed",e.setState({loading:!1,status:n}))})}},{key:"renderWindowContent",value:function(){if(this.state.loading)return s.createElement("div",{id:"copy-modal"},s.createElement(i.LoadingIndicator,null));var e="",t=[];return"success"===this.state.status?(e="Buncee copied! What would you like to do next ?",t=t.concat([s.createElement("a",{key:"edit-btn",href:this.state.newBunceeLinks.edit,className:"btn btn-yellow"},"Edit"),s.createElement("a",{key:"view-btn",href:this.state.newBunceeLinks.view,className:"btn btn-blue"},"View")])):"locked"===this.state.status?(e="You've been so busy Buncee'ing that you've reached your limit of "+(0,a.get)(d.User.getUser(),"settings.creation.max_buncees")+" free Buncees. Please upgrade your account to keep creating new Buncees and take advantage of our premium features.",t.concat([s.createElement("div",{key:"upgrade-btn",className:"modal-button button-color-cool"},"Upgrade")])):"failed"===this.state.status&&(e="Failed! The buncee could not be copied at this time."),t.push(s.createElement("div",{key:"close-btn",className:"btn btn-pink",onClick:this.closeModal},"Close")),s.createElement("div",{id:"copy-modal"},s.createElement("div",{className:"modal-content column"},"locked"===this.state.status&&s.createElement("img",{className:"status-image",src:(0,l.cloudfrontURL)("images/buncees-limit-reached.png")}),s.createElement("p",{className:"status-message",key:"status-message"},e)),s.createElement("div",{className:"copy-buttons row"},t))}}]),t}();t.default=(0,c.connect)(function(e){return{bunceeId:e.buncee.id}},void 0)(p)},654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeModal=function(){n.props.closeModal()},n.accept=function(){n.props.onAccept(),n.closeModal()},n.deny=function(){n.props.onReject(),n.closeModal()},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"confirm-modal"},i.createElement("div",{className:"modal-header"},i.createElement("h2",null,"Are you sure?")),this.props.message.split("\n").map(function(e,t){return i.createElement("p",{key:t.toString()},e)}),i.createElement("div",{className:"row"},i.createElement("div",{className:"btn btn-white",onClick:this.deny},this.props.rejectText||"No"),i.createElement("div",{className:"btn btn-pink",onClick:this.accept},this.props.acceptText||"Yes")))}}]),t}();t.default=a},656:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(39)),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=n(11),s=f(n(6)),c=f(n(0)),l=n(5),u=n(4),d=m(n(165)),p=n(16);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},v=[{key:"buncee",hasOrientation:!0,title:"Buncee Size (16:9)",greatFor:["Presentation","Lesson Creation","Assignments","Invitation & Cards"],bestSharedOn:["icon-facebook","icon-twitter","icon-blog","icon-pinterest"],isDefaultLandscape:!0,position:0,optionIcon:"icon-bunceesize canvas-icon-size"},{key:"square",hasOrientation:!1,title:"Square (1:1)",greatFor:["Instagram Posts","Profile Avatars"],bestSharedOn:["icon-facebook","icon-twitter","icon-instagram"],isDefaultLandscape:!1,position:1,optionIcon:"icon-instagramsize canvas-icon-size"},{key:"banner",hasOrientation:!0,title:"Banners (3:1)",greatFor:["Twitter Header","Facebook Header"],bestSharedOn:["icon-facebook","icon-twitter"],isDefaultLandscape:!0,position:2,optionIcon:"icon-bannersize canvas-icon-size"},{key:"letter",hasOrientation:!0,title:"Letter (8.5:11)",greatFor:["Assignments","Worksheets","Flyers"],bestSharedOn:["icon-blog","icon-pintrest"],isDefaultLandscape:!1,position:3,optionIcon:"icon-lettersize canvas-icon-size"},{key:"business",hasOrientation:!0,title:"Business Card Size (3.5:2)",greatFor:["Business Cards"],bestSharedOn:[],isDefaultLandscape:!0,position:4,optionIcon:"icon-businesscard canvas-icon-size"},{key:"playingcard",hasOrientation:!0,title:"Playing Card (3:5)",greatFor:["Playing Cards","Flash Cards"],bestSharedOn:[],isDefaultLandscape:!1,position:5,optionIcon:"icon-playingcard canvas-icon-size"}],y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.checkInitOrientation=function(){return!!s.includes(n.props.canvas.size_type.toString(),"landscape")||!s.includes(n.props.canvas.size_type.toString(),"portrait")&&null},n.checkSelectedOrientation=function(e){return n.state.selected_size?!!s.includes(n.state.selected_size.toString(),"landscape")||!s.includes(n.state.selected_size.toString(),"portrait")&&e.isDefaultLandscape:null},n.updateItemPosition=function(){var e={};return s.forEach(n.props.items,function(t,r){var o=(0,p.recalculateItemPosition)(t,n.props.canvas,n.state.selected_size);e[r]=Object.assign({},t,{frame:Object.assign({},t.frame,{origin:Object.assign({},t.frame.origin,{x:o.x,y:o.y})})})}),e},n.updateSlides=function(){return n.props.slides.map(function(e){return e.background&&"url"===e.background.type?Object.assign({},e,{background:Object.assign({},e.background,{body:e.background.body,attributes:{opacity:e.background.attributes?e.background.attributes.opacity:1,x:0,y:0}})}):e})},n.handleApplyClick=function(){return h(n,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({renderWindow:!1}),e.next=3,(0,d.default)("Creativity can get messy!\nChanging your canvas size may shuffle your masterpiece! Continue?","Change Size","No");case 3:e.sent?(this.state.selected_size&&(this.props.updateCanvas(this.updateItemPosition(),this.updateSlides(),this.state.selected_size),this.props.updateDisplaySetting(this.state.selected_size),(0,p.displayToastMessage)("Canvas Size Updated",2e3)),this.closeModal()):this.setState({renderWindow:!0});case 5:case"end":return e.stop()}},e,this)}))},n.handleCustomApply=function(){var e=document.getElementById("custom-width"),t=document.getElementById("custom-height");if(e&&t){var r=parseInt(e.value,10),o=parseInt(t.value,10);n.props.updateCanvas(n.updateItemPosition(),n.updateSlides(),"custom",r,o),n.props.updateDisplaySetting(n.state.selected_size,(0,u.getCanvasDimensions)({size_type:n.state.selected_size,width:r,height:o}).width,(0,u.getCanvasDimensions)({size_type:n.state.selected_size,width:r,height:o}).height)}n.closeModal()},n.closeModal=function(){n.props.closeModal()},n.renderLeftPanel=function(){var e="default",t="gif";return n.state.selected_size&&"custom"!==n.state.selected_size&&(e=n.state.selected_size.split("-")[0],t="svg"),c.createElement("div",{className:"left-panel column",id:e},c.createElement("div",{className:"size-option-image"},c.createElement("img",{src:(0,u.cloudfrontURL)("images/canvas/Canvas+Sizes_"+e+"."+t)})))},n.renderCustomSizeMenu=function(){return c.createElement("div",{className:"size-option-info"},c.createElement("div",{className:"description-wrapper row"},c.createElement("input",{type:"number",className:"custom-input-box",id:"custom-width"}),c.createElement("div",{className:"custom-text"},"inches"),c.createElement("div",{className:"custom-x"}," X "),c.createElement("input",{type:"number",className:"custom-input-box",id:"custom-height"}),c.createElement("div",{className:"custom-text"},"inches")),c.createElement("div",{className:"button-wrapper row"},c.createElement("div",{className:"btn",onClick:n.handleCustomApply},"Apply")))},n.handleOptionClick=function(e,t,r){var o=document.getElementById("size-options");if(!o)throw new Error("Canvas Picker Not found");r===n.state.selected_size?n.setState({selected_size:null,isLandscape:n.checkInitOrientation()}):(n.setState({selected_size:r,isLandscape:n.checkInitOrientation()}),o.style.paddingBottom="200px",e.preventDefault(),o&&(o.scrollTo?o.scrollTo({top:72*t,behavior:"smooth"}):function(){for(var e=o.scrollTop,n=72*t,r=n<e?-1:1,i=Math.abs(n-e);i>0;)setTimeout(function(){o.scrollTop=o.scrollTop+r},1),i--}()),o.style.paddingBottom="0px")},n.handleOrientationClick=function(e,t){var r=e+t,o=null;"-landscape"===t?o=!0:"-portrait"===t&&(o=!1),n.setState({selected_size:r,isLandscape:o})},n.getWindowClassNames=function(){return"window confirm canvas-size-picker"},n.extractKey=function(e){return s.split(e,"-")[0]},n.renderSizeRow=function(e){var t=n.state.selected_size?n.extractKey(n.state.selected_size)===e.key:null,r=n.extractKey(n.props.canvas.size_type)===e.key,o=["size-option-wrapper","row"],i=["icon-landscape"],a=["icon-portrait"],l="";null===n.state.selected_size&&e.hasOrientation&&(l=e.isDefaultLandscape?"-landscape":"-portrait"),t?n.state.selected_size&&e.hasOrientation&&("landscape"===s.split(n.state.selected_size.toString(),"-")[1]?(i.push("selected"),l="-landscape"):(a.push("selected"),l="-portrait")):r&&(o.push("selected"),e.hasOrientation&&("landscape"===s.split(n.props.canvas.size_type.toString(),"-")[1]?(i.push("selected"),l="-landscape"):(a.push("selected"),l="-portrait")));var u=e.key+l;return[c.createElement("div",{className:o.join(" "),key:"canvas-size-option",id:"buncee-option",onClick:function(t){return n.handleOptionClick(t,e.position,u)}},c.createElement("div",{className:e.optionIcon}),c.createElement("div",{className:"size-option-title"},e.title),r?c.createElement("div",{className:"icon-tick"}):c.createElement("div",{className:["icon-tabdown"].join(" ")})),t?c.createElement("div",{key:e.key+"-info"},c.createElement("div",{className:"size-option-info"},c.createElement("div",{className:"description-wrapper row"},c.createElement("div",{className:"left-description"},e.greatFor.length>0?c.createElement("div",{className:"left-description-header"},c.createElement("b",null,"Great for:")):null,c.createElement("ul",null,e.greatFor.map(function(e,t){return c.createElement("li",{key:t},e)}))),c.createElement("div",{className:"right-description"},e.bestSharedOn.length>0?c.createElement("div",{className:"right-description-header"},c.createElement("b",null,"Best shared on:")):null,c.createElement("ul",null,e.bestSharedOn.map(function(e,t){return c.createElement("li",{className:e,key:t})})),e.hasOrientation?c.createElement("div",{className:"orientation-wrapper"},c.createElement("div",{className:"orientation-header"},c.createElement("b",null,"Orientation:")),c.createElement("div",{className:"orientation-button-wrapper row"},c.createElement("div",{className:"orientation-button"},c.createElement("div",{className:i.join(" "),onClick:function(){return n.handleOrientationClick(e.key,"-landscape")}}),c.createElement("div",null,"Landscape")),c.createElement("div",{className:"orientation-button"},c.createElement("div",{className:a.join(" "),onClick:function(){return n.handleOrientationClick(e.key,"-portrait")}}),c.createElement("div",null,"Portrait")))):null)),c.createElement("div",{className:"button-wrapper row"},c.createElement("div",{className:"btn",onClick:n.handleApplyClick},"Apply")))):null]},n.state={selected_size:null,is_entered:!0,isLandscape:n.checkInitOrientation(),renderWindow:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Modal),o(t,[{key:"renderWindowContent",value:function(){var e=this;return this.state.renderWindow?c.createElement("div",{className:"canvas-picker-wrapper row",key:"canvas-picker"},this.renderLeftPanel(),c.createElement("div",{className:"right-panel"},c.createElement("h1",null,c.createElement("b",null,"Select Canvas Size")),c.createElement("div",{className:"size-option",id:"size-options"},v.map(function(t){return e.renderSizeRow(t)}),c.createElement("div",{className:"size-option-wrapper row",onClick:function(t){return e.handleOptionClick(t,6,"custom")}},c.createElement("div",{className:"icon-custom"}),c.createElement("div",{className:"size-option-title",id:"custom-option"},"Custom"),c.createElement("div",{className:"icon-tabdown canvas-icon-size"})),"custom"===this.state.selected_size?c.createElement("div",null,this.renderCustomSizeMenu()):null))):null}}]),t}(),b=(0,l.connect)(function(e){var t=e.buncee.document.items;return{canvas:e.buncee.document.canvas,items:t,slides:e.buncee.document.slides}},function(e,t){return{updateCanvas:function(t,n,r,o,a){e(i.Actions.batchActions({actions:[i.Actions.updateCanvas({path:"",value:{size_type:r,width:o,height:a}}),i.Actions.updateItem({path:"",value:t}),i.Actions.updateSlide({path:"",value:n})]}))},updateDisplaySetting:function(t,n,r){e(i.Actions.updateStore({path:"displaySettings.scale",value:(0,u.getCanvasScale)({size_type:t,width:n||void 0,height:r||void 0})}));var o=100;"business-landscape"===t&&(o=50),"business-portrait"===t&&(o=75),"banner-landscape"===t&&(o=75),e(i.Actions.updateStore({path:"displaySettings.scaleOffset",value:o})),e(i.Actions.updateStore({path:"displaySettings.viewportOffset",value:{x:0,y:0}}))}}})(y);t.default=b},657:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){return new Promise(function(t,n){var r=new Image;r.src=e,r.onload=function(){return t(r)},r.onerror=n})}},658:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAndReplace=t.sort=void 0,t.push=function(e,t){var n=e.slice();return n.push(t),n},t.insert=function(e,t,n){var r=e.slice();return r.splice(n,0,t),r},t.findAndRemove=function(e,t){var n=e.findIndex(t);if(-1===n)throw new Error("Element not found.");var r=e.slice();return r.splice(n,1),r},t.remove=function(e,t){var n=e.slice();return n.splice(t,1),n},t.arrayToObject=function(e,t){return e.reduce(function(e,n){return e[n[t]]=n,e},{})};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(313));t.sort=function(e,t){"string"==typeof t&&(t=function(e,n){var o=r.getProperty(e,t),i=r.getProperty(n,t);return o>i?1:o<i?-1:0});var n=e.slice();return n.sort(t),n},t.findAndReplace=function(e,t,n){"string"==typeof n&&(n=function(e){return r.getProperty(e,n)===r.getProperty(t,n)});var o=e.findIndex(n);if(-1===o)throw new Error("Element not found.");var i=e.slice();return i[o]=t,i}},661:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.getWindowClassNames=function(){return"window alert "+(n.props.closable?"":"no-close")},n.renderButtons=function(){return 0===n.props.buttons.length?i.createElement("div",{className:"btn",onClick:n.props.closeModal},"Close"):i.createElement("div",{className:"row"},n.props.buttons)},n.state={is_entered:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Modal),r(t,[{key:"renderWindowContent",value:function(){return i.createElement("div",{id:"alert-modal"},i.createElement("h2",null,this.props.title),i.createElement("div",{className:"modal-content"},i.createElement("p",null,this.props.message),this.props.iconURL&&i.createElement("img",{src:this.props.iconURL})),this.renderButtons())}}]),t}();a.defaultProps={closable:!1,buttons:[]},t.default=a},662:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTemplate=t.setGridlineIntersect=t.markItemClean=t.markItemDirty=t.markSlideClean=t.markSlideDirty=t.removeComment=t.addComment=t.updateLikes=t.removeTag=t.addTag=t.openViewPanel=t.setFullscreen=t.openModal=t.closeGateway=t.openGateway=t.redoPrevAction=t.undoPrevAction=t.performAction=t.syncWithOTKit=t.batchActions=t.updateStore=t.updateItemDefaults=t.updateClipboard=t.updateCanvas=t.updateSettings=t.updateItemsSelected=t.updateBuncee=t.updateItem=t.updateSlideSelected=t.updateSlide=t.removeItem=t.removeSlide=t.addItem=t.addSlide=t.operationalTransform=void 0;var r,o=n(318),i=(r=o)&&r.__esModule?r:{default:r};t.operationalTransform=(0,i.default)("operational_transform").payload(),t.addSlide=(0,i.default)("add_slide").payload(),t.addItem=(0,i.default)("add_item").payload(),t.removeSlide=(0,i.default)("remove_slide").payload(),t.removeItem=(0,i.default)("remove_item").payload(),t.updateSlide=(0,i.default)("update_slide").payload(),t.updateSlideSelected=(0,i.default)("update_selected_slide").payload(),t.updateItem=(0,i.default)("update_item").payload(),t.updateBuncee=(0,i.default)("update_buncee").payload(),t.updateItemsSelected=(0,i.default)("update_selected_item").payload(),t.updateSettings=(0,i.default)("update_settings").payload(),t.updateCanvas=(0,i.default)("update_canvas").payload(),t.updateClipboard=(0,i.default)("update_clipboard").payload(),t.updateItemDefaults=(0,i.default)("update_item_defaults").payload(),t.updateStore=(0,i.default)("update_store").payload(),t.batchActions=(0,i.default)("batch_actions").payload(),t.syncWithOTKit=(0,i.default)("sync_state").payload(),t.performAction=(0,i.default)("add_history").payload(),t.undoPrevAction=(0,i.default)("undo").payload(),t.redoPrevAction=(0,i.default)("redo").payload(),t.openGateway=(0,i.default)("open_gateway").payload(),t.closeGateway=(0,i.default)("close_gateway").payload(),t.openModal=(0,i.default)("open_modal").payload(),t.setFullscreen=(0,i.default)("set_fullscreen").payload(),t.openViewPanel=(0,i.default)("open_view_panel").payload(),t.addTag=(0,i.default)("add_tag").payload(),t.removeTag=(0,i.default)("remove_tag").payload(),t.updateLikes=(0,i.default)("update_likes").payload(),t.addComment=(0,i.default)("add_comment").payload(),t.removeComment=(0,i.default)("remove_comment").payload(),t.markSlideDirty=(0,i.default)("mark_slide_dirty").payload(),t.markSlideClean=(0,i.default)("mark_slide_clean").payload(),t.markItemDirty=(0,i.default)("mark_item_dirty").payload(),t.markItemClean=(0,i.default)("mark_item_clean").payload(),t.setGridlineIntersect=(0,i.default)("set_gridline_intersect").payload(),t.setTemplate=(0,i.default)("set_template").payload()},663:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),a=_(n(661)),s=n(6),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),l=n(5),u=n(4),d=n(16),p=n(139),f=_(n(309)),m=n(442),h=n(311),v=_(n(419)),y=n(151),b=_(n(259)),g=_(n(386)),w=_(n(378));function _(e){return e&&e.__esModule?e:{default:e}}var E={share:h.ShareModal,resize:h.CanvasResizeModal,photo:h.PhotoModal,input:h.InputModal,video:h.VideoRecordModal,copy:h.CopyModal,simultaneousedit:h.SimultaneousEditModal,itempreview:v.default,alert:a.default,stitch:h.StitchModal,mcq:h.MCQEditorModal,frq:h.FRQEditorModal,text:h.TextEditorModal,templates:h.TemplatesModal,upgrade:h.UpgradeModal},k=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.FPS_LOCK=30,n.renderModal=function(){if(void 0!==n.props.modal){var e=E[n.props.modal.type];return c.createElement(e,r({closeModal:n.closeModal},n.props.modal.props))}},n.renderTour=function(){return"edit"===n.props.mode&&"1"===window.config.first_v3_buncee?c.createElement(w.default,null):void 0},n.rescaleToEmbedMode=function(){n.props.updateDisplaySettings("scale",(0,u.getCanvasScale)(n.props.canvas,n.props.mode,{embed:!0,renderFooter:n.props.renderFooter})),document.getElementById("viewport").style.top="0"},n.renderSideNavigation=function(){if(!n.props.renderFooter){var e=[];return n.props.currentSlideIndex>0&&e.push(c.createElement("div",{className:"nav left-nav"},c.createElement("span",{className:"icon-previous1",onClick:n.decrementCurrentSlide}))),n.props.currentSlideIndex<n.props.slides.length-1&&e.push(c.createElement("div",{className:"nav right-nav"},c.createElement("span",{className:"icon-next1",onClick:n.incrementCurrentSlide}))),c.createElement("div",{className:"side-navigation"},e)}},n.closeModal=function(){n.props.openModal(void 0)},n.renderViewPanel=function(){return c.createElement(b.default,{panelType:n.props.viewPanel})},n.handleResize=function(){var e=(0,u.getCanvasScale)(n.props.canvas,n.props.mode,{renderFooter:n.props.renderFooter,embed:n.props.isEmbed,fullscreen:n.props.isFullscreen});e!==n.props.displaySettings.scale&&n.props.updateDisplaySettings("scale",e)},n.decrementCurrentSlide=function(){n.setCurrentSlide(n.props.currentSlideIndex-1)},n.incrementCurrentSlide=function(){n.setCurrentSlide(n.props.currentSlideIndex+1)},n.setCurrentSlide=function(e){e>=n.props.slides.length&&(e=n.props.slides.length-1),e<0&&(e=0),n.props.setSlideSelected(n.props.slides[e])},n.handleRotate=function(){n.setState({orientation:u.Device.isLandscape()?"landscape":"portrait"}),"0"!==(0,d.getURLParameter)("render_slide_footer")&&u.Device.isMobile()&&u.Device.isLandscape()&&n.props.updateDisplaySettings("renderFooter",!1)},n.handleReconnectFailure=function(){n.props.openModal("alert",{title:"It’s been awhile. Are you still around?",message:"Refresh to continue working on your masterpiece!",buttons:[c.createElement("div",{className:"btn",onClick:function(){location.reload()}},"Refresh")],iconURL:(0,u.cloudfrontURL)("/images/idle.svg")})},n.handleReconnectAttempt=function(){n.props.openModal("alert",{title:"Oops! Something went wrong",message:"Please refresh to continue working on your masterpiece.",iconURL:(0,u.cloudfrontURL)("/images/idle.svg")})},n.handleReconnectSuccessful=function(){n.closeModal(),n.client&&n.client.connect()},n.handleFullScreenChange=function(){n.props.closeViewPanel()},n.handleResize=(0,s.throttle)(n.handleResize,1e3/n.FPS_LOCK),n.state={orientation:u.Device.isLandscape()?"landscape":"portrait"},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),o(t,[{key:"componentDidCatch",value:function(e){var t=new Event("error");window.dispatchEvent(t)}},{key:"renderEditMode",value:function(){return[c.createElement(g.default,{key:"item-action-toolbar"}),c.createElement(y.ItemsPanel,{key:"items-panel"}),c.createElement(y.SlidesPanel,{key:"slides-panel"}),c.createElement(y.EditHeader,{key:"edit-header"}),c.createElement(f.default,{key:"browser",activeBrowser:this.props.activeBrowser,mode:"browser"})]}},{key:"componentDidMount",value:function(){this.client=p.WebsocketClient.getInstance(),"edit"===this.props.mode&&this.client&&(this.client.socket.addEventListener("reconnect_failed",this.handleReconnectFailure),this.client.socket.addEventListener("reconnect_attempt",this.handleReconnectAttempt),this.client.socket.addEventListener("reconnect",this.handleReconnectSuccessful)),this.props.isEmbed&&this.rescaleToEmbedMode(),window.addEventListener("resize",this.handleResize),window.addEventListener("orientationchange",this.handleRotate),document.addEventListener("webkitfullscreenchange",this.handleFullScreenChange),document.addEventListener("mozfullscreenchange",this.handleFullScreenChange),document.addEventListener("MSFullscreenChange",this.handleFullScreenChange),document.addEventListener("fullscreenchange",this.handleFullScreenChange),"edit"===this.props.mode&&"1"===window.config.is_new_buncee&&"1"===window.config.flags.templates&&"1"!==window.config.first_v3_buncee&&this.props.openModal("templates")}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("orientationchange",this.handleRotate),document.removeEventListener("webkitfullscreenchange",this.handleFullScreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullScreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullScreenChange),document.removeEventListener("fullscreenchange",this.handleFullScreenChange),"edit"===this.props.mode&&this.client&&(this.client.socket.removeEventListener("reconnect_failed",this.handleReconnectFailure),this.client.socket.removeEventListener("reconnec_attempt",this.handleReconnectAttempt),this.client.socket.removeEventListener("reconnect_attempt",this.handleReconnectAttempt))}},{key:"componentDidUpdate",value:function(e){e.bunceeTitle!==this.props.bunceeTitle&&(document.title="Buncee - "+this.props.bunceeTitle)}},{key:"renderViewMode",value:function(){return[this.renderSideNavigation(),this.props.isEmbed||this.props.isFullscreen||"submission"===this.props.mode?null:c.createElement(y.ViewHeader,{key:"view-header"}),c.createElement(y.Footer,{key:"view-footer",orientation:this.state.orientation})]}},{key:"render",value:function(){return c.createElement("div",{id:"creation-content",className:"container"},this.renderTour(),c.createElement(m.ConnectedCanvasViewport,{orientation:this.state.orientation}),"edit"===this.props.mode?this.renderEditMode():this.renderViewMode(),this.renderModal(),this.renderViewPanel(),"edit"===this.props.mode&&u.Device.isIPadOrIPhone()?c.createElement("div",{className:"rotateMessage"},c.createElement("p",null,"Please rotate your device to continue")):null,"edit"!==this.props.mode||u.Device.isIPadOrIPhone()?null:c.createElement("div",{className:"sizeSmallMessage"},c.createElement("p",null,"The window size is too small!")),c.createElement("div",{className:"btn btn-pink",id:"cancel-btn"},c.createElement("div",{className:"cancel-text"},c.createElement("span",{className:"icon-delete1"}),"Cancel")))}}]),t}(),O=(0,l.connect)(function(e){var t=e.openModal,n=u.User.getUser(),r=e.buncee.selected_slides[n.guid],o=(0,s.findIndex)(e.buncee.document.slides,function(e){return e.id===r}),i=void 0===e.gateway?void 0:e.gateway.activeBrowser;return{modal:t,mode:e.renderingMode,isEmbed:e.displaySettings.isEmbed,renderFooter:e.displaySettings.renderFooter,viewPanel:e.viewPanel,isFullscreen:e.displaySettings.isFullscreen,canvas:e.buncee.document.canvas,slides:e.buncee.document.slides,currentSlideIndex:o,activeBrowser:i,bunceeTitle:e.buncee.title,displaySettings:e.displaySettings}},function(e,t){return{setSlideSelected:function(t){var n=u.User.getUser();e(i.Actions.updateSlideSelected({path:n.guid,value:t.id}))},openModal:function(t,n){e(i.Actions.openModal({type:t,props:n}))},updateDisplaySettings:function(t,n){e(i.Actions.updateStore({path:"displaySettings."+t,value:n}))},closeViewPanel:function(){e(i.Actions.openViewPanel({viewPanel:null}))}}})(k);t.default=O},671:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(n(39));t.configure=function(){return b(this,void 0,void 0,r.default.mark(function e(){var t,n,i,a,s;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_=window.config,o.Client.configure(_.base_uri,_.auth_token),!o.Client.hasAccessToken()){e.next=8;break}return e.next=5,k();case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0={first_name:"Anonymous",last_name:"",guid:"guest",type:void 0,permissions:{},username:"anonymous"};case 9:return t=e.t0,g&&t&&(g.user={guid:t.guid,username:t.username}),e.next=13,O(_.buncee_guid);case 13:if(n=e.sent,void 0===t){e.next=18;break}m.User.initUser(t),e.next=19;break;case 18:throw new Error("Could not authenticate user");case 19:if((0,f.initializeIds)(n.data.document.items,n.data.document.slides),i={},"guest"===t.guid||m.User.isAdmin()){e.next=29;break}return e.next=24,o.Client.get("preferences");case 24:return a=e.sent,e.next=27,a.json();case 27:e.sent.data.forEach(function(e){e.data.value="1"===e.data.value,i[e.data.canonical_name]=e.data});case 29:E=(0,p.configureStore)((0,f.generateStore)([],S(n.data,t,n.links,_.rendering_mode,i))),"edit"===_.rendering_mode&&(s=_.socket_base_uri+"/creation",h.WebsocketClient.initialize(s,{buncee_id:_.buncee_guid,access_token:_.auth_token,api_url:_.base_uri,user_id:t.guid,reconnectionAttempts:5,secure:!0})),P();case 32:case"end":return e.stop()}},e,this)}))},t.run=P,n(668);var o=n(38),i=y(n(665)),a=y(n(664)),s=y(n(663)),c=y(n(375)),l=v(n(0)),u=v(n(55)),d=n(5),p=n(150),f=n(4),m=n(56),h=n(139);function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}n(362);var b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},g=null;if(window.config.bugsnag_key){var w=window;g=(0,i.default)({apiKey:w.config.bugsnag_key,appVersion:w.config.release_id,releaseStage:w.config.environment})}c.default.config();var _=void 0,E=void 0;function k(){return b(this,void 0,void 0,r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Client.get("/users/me");case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Invalid access token. Could not retrieve authentiated user.");case 5:return e.next=7,t.json();case 7:return n=e.sent,e.abrupt("return",n.data);case 9:case"end":return e.stop()}},e,this)}))}function O(e){return b(this,void 0,void 0,r.default.mark(function t(){var n,i,a,s,c;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,f.getURLParameter)("archive_id"),i=(0,f.getURLParameter)("client"),a=new URLSearchParams,s=void 0,n&&a.set("archive_id",n),t.next=7,o.Client.get("/buncees/"+e,a,[],i);case 7:if((s=t.sent).ok){t.next=10;break}throw new Error("Failed to fetch buncee.");case 10:return t.next=12,s.json();case 12:return c=t.sent,t.abrupt("return",c);case 14:case"end":return t.stop()}},t,this)}))}function S(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"view",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i={};i[t.guid]=e.document.slides[0].id;var a="view"===r&&"1"===(0,f.getURLParameter)("embed")||"submission"===r,s=!(f.Device.isMobile()&&f.Device.isLandscape()||"0"===(0,f.getURLParameter)("render_slide_panel")),c=(0,f.getCanvasScale)(e.document.canvas,r,{embed:a,renderFooter:s});return{buncee:{document:{canvas:Object.assign({},e.document.canvas,{item_defaults:{}}),slides:e.document.slides,items:0===e.document.items.length?{}:e.document.items},owner_guid:e.owner_guid,copyable:e.copyable,commentable:e.commentable,show_watermark:e.show_watermark,privacy_level:e.privacy_level,id:e.id,title:e.title,selected_items:{},selected_slides:i,tags:e.tags},user:{id:t.guid,first_name:t.firstName,last_name:t.lastName,type:t.type,permissions:t.permissions,settings:t.settings,username:t.username},settings:{gridlines:!1,clip_and_stitch:!1},displaySettings:{scale:c,scaleOffset:100,viewportOffset:{x:0,y:0},isPanning:!1,isEmbed:a,renderFooter:s,isFullscreen:!1},bunceeMeta:{likes:e.likes,views:e.views,comments:e.comments,author:e.author,reactions:{}},links:n,renderingMode:r,preferences:o}}function P(){if(void 0===_)throw new Error("Application is not configured.");!function(e){if(g){var t=g.use((0,a.default)(l));u.render(l.createElement(t,null,l.createElement(d.Provider,{store:E},l.createElement(s.default,null))),e)}else u.render(l.createElement(d.Provider,{store:E},l.createElement(s.default,null)),e)}(document.getElementById("creation-container"))}},7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=t.isBatchActionPayload=t.isOperationPayload=t.isSetPayload=t.isRemovePayload=t.isAddItemPayload=t.isAddSlidePayload=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(318);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(662));t.isAddSlidePayload=function(e){return 1===Object.keys(e).length&&void 0===e.operation&&"object"===r(e.slide)},t.isAddItemPayload=function(e){return 1===Object.keys(e).length&&void 0===e.operation&&"object"===r(e.item)},t.isRemovePayload=function(e){return 1===Object.keys(e).length&&void 0===e.operation&&"string"==typeof e.id},t.isSetPayload=function(e){return void 0!==e.value&&"string"==typeof e.path},t.isOperationPayload=function(e){return"object"===r(e.operation)&&1===Object.keys(e).length},t.isBatchActionPayload=function(e){return void 0!==e.actions&&1===Object.keys(e).length};t.Actions=i},83:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));var o=function(e){return r.createElement("div",{onClick:function(){!function(e){"function"==typeof e.handleClick&&e.handleClick(e.text.toLowerCase()),e.action()}(e)},className:"toolbar-button "+(e.active?"active":""),id:"toolbar-"+e.text.toLowerCase()},("top"===e.iconPosition||"left"===e.iconPosition)&&r.createElement("div",{className:e.icon+" "+e.iconPosition}),r.createElement("span",null,e.text),("right"===e.iconPosition||"bottom"===e.iconPosition)&&r.createElement("div",{className:e.icon+" "+e.iconPosition}))};o.defaultProps={text:"",handleClick:function(){},iconPosition:"top"},t.default=o},84:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarMode=void 0;var r=m(n(39)),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(11),s=f(n(6)),c=f(n(0)),l=n(4),u=n(16),d=n(56),p=m(n(83));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},v=t.ToolbarMode=void 0;!function(e){e.STANDALONE="standalone",e.DEFAULT="default"}(v||(t.ToolbarMode=v={}));var y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.prevButtonCount=0,n.handleResize=function(){n.setState({numFittable:999})},n.updateSelectedButton=function(e){n.setState({selectedButton:e})},n.delete=function(){return h(n,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.confirm)("Are you sure you want to delete this item?");case 2:if(!e.sent){e.next=7;break}if(void 0!==this.props.selectedItem){e.next=6;break}return e.abrupt("return");case 6:this.props.removeItem(this.props.items,this.props.selectedItem,this.props.selectedSlide);case 7:case"end":return e.stop()}},e,this)}))},n.flip=function(e){void 0!==n.props.selectedItem&&("horizontal"===e?n.props.updateItem(n.props.selectedItem,"flipH",!n.props.selectedItem.flipH):"vertical"===e&&n.props.updateItem(n.props.selectedItem,"flipV",!n.props.selectedItem.flipV))},n.copy=function(){void 0!==n.props.selectedItem&&(n.props.updateClipboard(n.props.selectedItem),(0,u.displayToastMessage)("Copied to Clipboard",2e3))},n.paste=function(){if(void 0!==n.props.clipboard){var e=n.props.clipboard,t=(0,l.generateItem)(),r=[];"group"===e.type&&e.content.body.forEach(function(e){var t=(0,l.generateItem)(),n=Object.assign({},e,{id:t.id});r.push(n)});var o=(0,u.copyObjectNewCoordinates)(e,n.props.canvas),i=Object.assign({},e,{frame:Object.assign({},e.frame,{origin:{x:o.x,y:o.y,space:e.frame.origin.space}}),content:Object.assign({},e.content,{body:"group"===e.type?r:e.content.body}),id:t.id});n.props.addItem(i,n.props.selectedSlide),n.props.updateItemsSelected(i.id,n.props.user)}},n.duplicate=function(){if(void 0!==n.props.selectedItem){var e=n.props.selectedItem.content,t=n.props.selectedItem;if("group"===t.type){var r=[];s.forEach(t.content.body,function(e){var t=(0,l.generateItem)(Object.assign({},e));r.push(t)}),e={type:"any",body:r}}var o=(0,u.copyObjectNewCoordinates)(t,n.props.canvas),i=(0,l.generateItem)(Object.assign({},t,{content:e,frame:Object.assign({},t.frame,{origin:Object.assign({},t.frame.origin,{x:o.x,y:o.y})})}));n.props.selectedItem&&n.props.updateItemsSelected(n.props.selectedItem.id,null),n.props.addItem(i,n.props.selectedSlide),n.props.updateItemsSelected(i.id,n.props.user),(0,u.displayToastMessage)("Item Duplicated",2e3)}},n.moveToFront=function(){var e=n.props.selectedSlide.items.indexOf(n.props.selectedItem.id);if(-1!==e){var t=n.props.selectedSlide.items.slice();t.splice(e,1),t.splice(n.props.selectedSlide.items.length,0,n.props.selectedItem.id),n.props.setItems(t,n.props.selectedSlide.id)}},n.moveToBack=function(){var e=n.props.selectedSlide.items.indexOf(n.props.selectedItem.id);if(-1!==e){var t=n.props.selectedSlide.items.slice();t.splice(e,1),t.splice(0,0,n.props.selectedItem.id),n.props.setItems(t,n.props.selectedSlide.id)}},n.link=function(e){0===e.length?e="":0!==e.indexOf("https://")&&0!==e.indexOf("http://")&&(e="http://"+e),n.props.updateItem(n.props.selectedItem,"link",e),(0,u.displayToastMessage)("Link Updated",2e3)},n.addAudio=function(){n.props.openBrowser("audio")},n.setAltText=function(e){n.props.updateItem(n.props.selectedItem,"alt_text",e)},n.resetRotation=function(){n.props.updateItem(n.props.selectedItem,"rotation",0)},n.setOpacity=function(e){n.props.updateItem(n.props.selectedItem,"opacity",e/100)},n.getOpacity=function(){return n.props.selectedItem.opacity},n.changeBackground=function(){n.openBackgroundBrowser()},n.moveBackground=function(){n.props.selectedSlide.background&&"url"===n.props.selectedSlide.background.type&&n.props.updateStore("isEditingBackground",!0)},n.openBackgroundBrowser=function(){n.props.openBrowser("background")},n.deleteSlide=function(){return h(n,void 0,void 0,r.default.mark(function e(){var t,n,o,i;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.confirm)("Are you sure you want to delete this page?");case 2:e.sent&&(1===this.props.slides.length?(t=(0,l.generateSlide)(),t=Object.assign({},t,{id:this.props.slides[0].id}),this.props.removeSlide([t],{})):(n=this.props.selectedSlide,(o=this.props.slides.findIndex(function(e){return e.id===n.id}))>0?this.props.updateSlideSelected(this.props.slides[o-1].id,d.User.getUser().guid):this.props.updateSlideSelected(this.props.slides[o+1].id,d.User.getUser().guid),i=s.omit(this.props.items,n.items),this.props.removeSlide(l.ArrayUtil.findAndRemove(this.props.slides,function(e){return e.id===n.id}),i)));case 4:case"end":return e.stop()}},e,this)}))},n.duplicateSlide=function(){var e=n.props.selectedSlide,t=n.props.slides.findIndex(function(t){return t.id===e.id}),r=n.props.items,o=e.items.filter(function(e){return void 0!==n.props.items[e]&&null!==n.props.items[e]}).map(function(e){var t=n.props.items[e],o=(0,l.generateItem)(t);if("group"===t.type){var i=[];s.forEach(t.content.body,function(e){var t=(0,l.generateItem)(Object.assign({},e));i.push(t)}),o=Object.assign({},o,{content:Object.assign({},o.content,{type:"any",body:i})})}return r[o.id]=o,o.id}),i=(0,l.generateSlide)(Object.assign({},e,{items:o}));n.props.addSlide(i,l.ArrayUtil.insert(n.props.slides,i,t+1),r),(0,u.displayToastMessage)("Page Duplicated",2e3)},n.renderLinkButton=function(){return c.createElement("div",{key:"link",className:"toolbar-button",id:"link",onClick:n.handleButtonClick},c.createElement(a.PopupMenu,{text:"Link",showMenu:"link"===n.state.selectedButton,icon:"icon-link",iconPosition:"top"},c.createElement("input",{type:"text",onKeyDown:n.handleKeyUpOrKeyDown,onKeyUp:n.handleKeyUpOrKeyDown,onKeyPress:function(e){n.handleInputKeyPress(e,"link")},placeholder:"Type link and press Enter",defaultValue:n.props.selectedItem.link})))},n.renderAltTextButton=function(){return n.props.preferences["web-accessibility"].value?c.createElement("div",{key:"alt",className:"toolbar-button",id:"alt-text",onClick:n.handleButtonClick},c.createElement(a.PopupMenu,{text:"Alt Text",showMenu:"alt-text"===n.state.selectedButton,icon:"icon-altext",iconPosition:"top"},c.createElement("input",{className:"alt-text-size",type:"text",onKeyDown:n.handleKeyUpOrKeyDown,onKeyUp:n.handleKeyUpOrKeyDown,onKeyPress:function(e){n.handleInputKeyPress(e,"altText")},placeholder:"Type alt text and press Enter",defaultValue:n.props.selectedItem.alt_text}))):void 0},n.renderOpacitySlider=function(){return c.createElement("div",{key:"opacity",className:"toolbar-button opacity-slider",id:"opacity",onClick:n.handleButtonClick},c.createElement(a.PopupMenu,{text:"Opacity",showMenu:"opacity"===n.state.selectedButton,icon:"icon-opacity",iconPosition:"top"},c.createElement(a.Slider,{onChange:function(e){n.setOpacity(e)},minValue:0,maxValue:100,unit:"%",step:10,value:100*n.getOpacity()})))},n.handleKeyUpOrKeyDown=function(e){e.stopPropagation()},n.handleInputKeyPress=function(e,t){if(e.stopPropagation(),"enter"===l.KeyUtil.getKey(e.nativeEvent)){switch(t){case"link":n.link(e.target.value);case"altText":n.setAltText(e.target.value)}n.updateSelectedButton("")}},n.handleButtonClick=function(e){var t=e.currentTarget.id;n.state.selectedButton!==t&&n.updateSelectedButton(e.currentTarget.id)},n.renderCopyGroup=function(){var e=[c.createElement(p.default,o({key:"copy"},n.generateToolbarButtonProps("Copy","icon-copy",n.copy)))];return void 0!==n.props.clipboard&&e.push(c.createElement(p.default,o({key:"paste"},n.generateToolbarButtonProps("Paste","icon-paste",n.paste)))),e.push(c.createElement(p.default,o({key:"duplicate"},n.generateToolbarButtonProps("Duplicate","icon-duplicate",n.duplicate)))),c.createElement("div",{key:"copy-group",className:"toolbar-button-group"},e)},n.toolbar=null,n.handleResize=s.throttle(n.handleResize,100).bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.Component),i(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.setState({numFittable:999});var e=document.getElementById("item-action-toolbar");e&&!l.Device.isIPadOrIPhone()&&(e.style.paddingLeft="140px",e.style.paddingRight="140px")}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),this.updateSelectedButton("")}},{key:"getButtons",value:function(){return[]}},{key:"componentDidUpdate",value:function(e){if(this.toolbar&&this.props.mode!==v.STANDALONE){var t=this.toolbar.children;if(this.prevButtonCount!==this.getButtons().length)return this.prevButtonCount=this.getButtons().length,void this.setState({numFittable:999,selectedButton:""});var n=this.toolbar.getBoundingClientRect().width,r=0,o=0;Array.from(t).forEach(function(e,t){(r+=e.getBoundingClientRect().width)<n&&(o+=1)}),this.state.numFittable!==o&&t.length>o&&this.setState({numFittable:o}),this.props.selectedSlide.id!==e.selectedSlide.id&&this.updateSelectedButton("")}}},{key:"render",value:function(){var e=this,t=this.getButtons(),n=[];t.length>this.state.numFittable&&(n.push(t.slice(this.state.numFittable-1)),t=t.slice(0,this.state.numFittable-1));var r=null;n.length>0&&(r=c.createElement("div",{className:"toolbar-button",id:"more",onClick:this.handleButtonClick},c.createElement(a.PopupMenu,{text:"More",icon:"icon-dotshorizontal",iconPosition:"top",showMenu:"more"===this.state.selectedButton},c.createElement("div",{className:"toolbar-more"},n))),t.push(r));var o=[];return l.Device.isIpadPro()&&this.props.mode===v.DEFAULT&&o.push("ipad-pro"),c.createElement("div",{id:"item-action-toolbar",className:o.join(" ")},c.createElement("div",{id:this.getID(),ref:function(t){e.toolbar=t}},t))}},{key:"getID",value:function(){return""}},{key:"generateToolbarButtonProps",value:function(e,t,n){return{text:e,icon:t,action:n,handleClick:this.updateSelectedButton}}}]),t}();t.default=y,y.defaultProps={mode:v.DEFAULT}},875:function(e,t,n){n(874),e.exports=n(671)}});
//# sourceMappingURL=creation.js.map